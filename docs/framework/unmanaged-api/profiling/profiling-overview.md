---
title: Cenni preliminari sulla profilatura
ms.date: 03/30/2017
helpviewer_keywords:
- managed code, profiling API support
- unmanaged code, combining with managed code in profiling
- notification threads [.NET Framework profiling]
- unmanaged code, profiling
- profiling API [.NET Framework], and COM
- profiling API [.NET Framework], unmanaged code profiling
- profilers, writing
- profiling API [.NET Framework], call stacks
- code profilers, writing
- profiling API [.NET Framework], security considerations
- profiling API [.NET Framework], managed code support
- common language runtime, profiling
- profiling API [.NET Framework], notification threads
- call stacks [.NET Framework profiling]
- profiling API [.NET Framework], stack depth
- common language runtime, writing a profiler
- profiling API [.NET Framework], information retrieval interfaces
- shadow stacks [.NET Framework profiling]
- COM, using in the profiling API
- stack snapshots [.NET Framework profiling]
- profiling API [.NET Framework], supported features
- profiling API [.NET Framework], overview
- security, profiling API considerations
- stack depth [.NET Framework profiling]
ms.assetid: 864c2344-71dc-46f9-96b2-ed59fb6427a8
author: mairaw
ms.author: mairaw
ms.openlocfilehash: dd0fef0e8a2c4b94cd5dd7beb140e669c52a07a8
ms.sourcegitcommit: 3c1c3ba79895335ff3737934e39372555ca7d6d0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 09/06/2018
ms.locfileid: "43862316"
---
# <a name="profiling-overview"></a><span data-ttu-id="a1053-102">Cenni preliminari sulla profilatura</span><span class="sxs-lookup"><span data-stu-id="a1053-102">Profiling Overview</span></span>
<a name="top"></a> <span data-ttu-id="a1053-103">Un profiler è uno strumento che consente di monitorare l'esecuzione di un'altra applicazione.</span><span class="sxs-lookup"><span data-stu-id="a1053-103">A profiler is a tool that monitors the execution of another application.</span></span> <span data-ttu-id="a1053-104">Un profiler CLR (Common Language Runtime) è una DLL costituita da funzioni che ricevono e inviano messaggi a CLR usando l'API di profilatura.</span><span class="sxs-lookup"><span data-stu-id="a1053-104">A common language runtime (CLR) profiler is a dynamic link library (DLL) that consists of functions that receive messages from, and send messages to, the CLR by using the profiling API.</span></span> <span data-ttu-id="a1053-105">La DLL del profiler viene caricata in fase di esecuzione da CLR.</span><span class="sxs-lookup"><span data-stu-id="a1053-105">The profiler DLL is loaded by the CLR at run time.</span></span>  
  
 <span data-ttu-id="a1053-106">Gli strumenti di profilatura tradizionali si basano sulla misurazione dell'esecuzione dell'applicazione,</span><span class="sxs-lookup"><span data-stu-id="a1053-106">Traditional profiling tools focus on measuring the execution of the application.</span></span> <span data-ttu-id="a1053-107">ovvero del tempo impiegato da ciascuna funzione oppure dell'utilizzo della memoria nel tempo da parte dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="a1053-107">That is, they measure the time that is spent in each function or the memory usage of the application over time.</span></span> <span data-ttu-id="a1053-108">L'API di profilatura fa riferimento a una classe più ampia di strumenti di diagnostica, quali utilità di code coverage e persino supporti di debug avanzati,</span><span class="sxs-lookup"><span data-stu-id="a1053-108">The profiling API targets a broader class of diagnostic tools such as code-coverage utilities and even advanced debugging aids.</span></span> <span data-ttu-id="a1053-109">tutti usati per fini diagnostici.</span><span class="sxs-lookup"><span data-stu-id="a1053-109">These uses are all diagnostic in nature.</span></span> <span data-ttu-id="a1053-110">L'API di profilatura non si limita a misurare l'esecuzione di un'applicazione, ne esegue anche il monitoraggio.</span><span class="sxs-lookup"><span data-stu-id="a1053-110">The profiling API not only measures but also monitors the execution of an application.</span></span> <span data-ttu-id="a1053-111">Per questa ragione, non deve mai essere usata dall'applicazione stessa e l'esecuzione dell'applicazione non deve dipendere dal profiler (né esserne influenzata).</span><span class="sxs-lookup"><span data-stu-id="a1053-111">For this reason, the profiling API should never be used by the application itself, and the application’s execution should not depend on (or be affected by) the profiler.</span></span>  
  
 <span data-ttu-id="a1053-112">La profilatura di un'applicazione CLR richiede un maggiore supporto rispetto all'analisi del codice macchina compilato in modo tradizionale,</span><span class="sxs-lookup"><span data-stu-id="a1053-112">Profiling a CLR application requires more support than profiling conventionally compiled machine code.</span></span> <span data-ttu-id="a1053-113">in quanto CLR introduce concetti quali domini applicazione, Garbage Collection, gestione delle eccezioni gestite, compilazione del codice JIT (tramite la conversione del codice MSIL in codice macchina nativo) e funzionalità simili.</span><span class="sxs-lookup"><span data-stu-id="a1053-113">This is because the CLR introduces concepts such as application domains, garbage collection, managed exception handling, just-in-time (JIT) compilation of code (converting Microsoft intermediate language, or MSIL, code into native machine code), and similar features.</span></span> <span data-ttu-id="a1053-114">I meccanismi di profilatura convenzionali non sono in grado di identificare o fornire informazioni utili su queste funzionalità.</span><span class="sxs-lookup"><span data-stu-id="a1053-114">Conventional profiling mechanisms cannot identify or provide useful information about these features.</span></span> <span data-ttu-id="a1053-115">L'API di profilatura fornisce queste informazioni mancanti in modo efficiente, con un impatto minimo sulle prestazioni di CLR e dell'applicazione sottoposta a profilatura.</span><span class="sxs-lookup"><span data-stu-id="a1053-115">The profiling API provides this missing information efficiently, with minimal effect on the performance of the CLR and the profiled application.</span></span>  
  
 <span data-ttu-id="a1053-116">La compilazione JIT in fase di esecuzione offre buone possibilità di profilatura.</span><span class="sxs-lookup"><span data-stu-id="a1053-116">JIT compilation at run time provides good opportunities for profiling.</span></span> <span data-ttu-id="a1053-117">L'API di profilatura consente a un profiler di modificare il flusso di codice MSIL in memoria per una routine prima che venga compilato tramite JIT.</span><span class="sxs-lookup"><span data-stu-id="a1053-117">The profiling API enables a profiler to change the in-memory MSIL code stream for a routine before it is JIT-compiled.</span></span> <span data-ttu-id="a1053-118">In tal modo, il profiler può aggiungere dinamicamente codice di strumentazione a routine specifiche per le quali è richiesta un'indagine più approfondita.</span><span class="sxs-lookup"><span data-stu-id="a1053-118">In this manner, the profiler can dynamically add instrumentation code to particular routines that need deeper investigation.</span></span> <span data-ttu-id="a1053-119">Sebbene questo approccio sia possibile negli scenari convenzionali, è molto più semplice da implementare per CLR usando l'API di profilatura.</span><span class="sxs-lookup"><span data-stu-id="a1053-119">Although this approach is possible in conventional scenarios, it is much easier to implement for the CLR by using the profiling API.</span></span>  
  
 <span data-ttu-id="a1053-120">Questa panoramica include le sezioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="a1053-120">This overview consists of the following sections:</span></span>  
  
-   [<span data-ttu-id="a1053-121">L'API di profilatura</span><span class="sxs-lookup"><span data-stu-id="a1053-121">The Profiling API</span></span>](#profiling_api)  
  
-   [<span data-ttu-id="a1053-122">Funzionalità supportate</span><span class="sxs-lookup"><span data-stu-id="a1053-122">Supported Features</span></span>](#support)  
  
-   [<span data-ttu-id="a1053-123">Thread di notifica</span><span class="sxs-lookup"><span data-stu-id="a1053-123">Notification Threads</span></span>](#notification_threads)  
  
-   [<span data-ttu-id="a1053-124">Sicurezza</span><span class="sxs-lookup"><span data-stu-id="a1053-124">Security</span></span>](#security)  
  
-   [<span data-ttu-id="a1053-125">Combinazione di codice gestito e in un Code Profiler</span><span class="sxs-lookup"><span data-stu-id="a1053-125">Combining Managed and Unmanaged Code in a Code Profiler</span></span>](#combining_managed_unmanaged)  
  
-   [<span data-ttu-id="a1053-126">Profilatura del codice non gestito</span><span class="sxs-lookup"><span data-stu-id="a1053-126">Profiling Unmanaged Code</span></span>](#unmanaged)  
  
-   [<span data-ttu-id="a1053-127">Uso di COM</span><span class="sxs-lookup"><span data-stu-id="a1053-127">Using COM</span></span>](#com)  
  
-   [<span data-ttu-id="a1053-128">Stack di chiamate</span><span class="sxs-lookup"><span data-stu-id="a1053-128">Call stacks</span></span>](#call_stacks)  
  
-   [<span data-ttu-id="a1053-129">Callback e profondità dello Stack</span><span class="sxs-lookup"><span data-stu-id="a1053-129">Callbacks and Stack Depth</span></span>](#callbacks)  
  
-   [<span data-ttu-id="a1053-130">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="a1053-130">Related Topics</span></span>](#related_topics)  
  
<a name="profiling_api"></a>   
## <a name="the-profiling-api"></a><span data-ttu-id="a1053-131">API di profilatura</span><span class="sxs-lookup"><span data-stu-id="a1053-131">The Profiling API</span></span>  
 <span data-ttu-id="a1053-132">In genere, l'API di profilatura consente di scrivere un *code profiler*, ovvero un programma che monitora l'esecuzione di un'applicazione gestita.</span><span class="sxs-lookup"><span data-stu-id="a1053-132">Typically, the profiling API is used to write a *code profiler*, which is a program that monitors the execution of a managed application.</span></span>  
  
 <span data-ttu-id="a1053-133">L'API di profilatura viene usata da una DLL del profiler caricata nello stesso processo dell'applicazione che si sta profilando.</span><span class="sxs-lookup"><span data-stu-id="a1053-133">The profiling API is used by a profiler DLL, which is loaded into the same process as the application that is being profiled.</span></span> <span data-ttu-id="a1053-134">La DLL del profiler implementa un'interfaccia di callback ([ICorProfilerCallback](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback-interface.md) in .NET Framework versione 1.0 e 1.1 [ICorProfilerCallback2](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback2-interface.md) nella versione 2.0 e versioni successive).</span><span class="sxs-lookup"><span data-stu-id="a1053-134">The profiler DLL implements a callback interface ([ICorProfilerCallback](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback-interface.md) in the .NET Framework version 1.0 and 1.1, [ICorProfilerCallback2](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback2-interface.md) in version 2.0 and later).</span></span> <span data-ttu-id="a1053-135">CLR chiama i metodi in tale interfaccia per notificare al profiler gli eventi nel processo profilato.</span><span class="sxs-lookup"><span data-stu-id="a1053-135">The CLR calls the methods in that interface to notify the profiler of events in the profiled process.</span></span> <span data-ttu-id="a1053-136">Il profiler può richiamare nel runtime usando i metodi di [ICorProfilerInfo](../../../../docs/framework/unmanaged-api/profiling/icorprofilerinfo-interface.md) e [ICorProfilerInfo2](../../../../docs/framework/unmanaged-api/profiling/icorprofilerinfo2-interface.md) interfacce per ottenere informazioni sullo stato dell'applicazione profilata.</span><span class="sxs-lookup"><span data-stu-id="a1053-136">The profiler can call back into the runtime by using the methods in the [ICorProfilerInfo](../../../../docs/framework/unmanaged-api/profiling/icorprofilerinfo-interface.md) and [ICorProfilerInfo2](../../../../docs/framework/unmanaged-api/profiling/icorprofilerinfo2-interface.md) interfaces to obtain information about the state of the profiled application.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="a1053-137">Solo la parte della soluzione del profiler relativa alla raccolta dei dati deve essere in esecuzione nello stesso processo dell'applicazione profilata.</span><span class="sxs-lookup"><span data-stu-id="a1053-137">Only the data-gathering part of the profiler solution should be running in the same process as the profiled application.</span></span> <span data-ttu-id="a1053-138">L'interfaccia utente e l'analisi dei dati devono essere eseguite in un processo separato.</span><span class="sxs-lookup"><span data-stu-id="a1053-138">All user interface and data analysis should be performed in a separate process.</span></span>  
  
 <span data-ttu-id="a1053-139">La figura seguente mostra la modalità di interazione della DLL del profiler con l'applicazione che si sta profilando e con CLR.</span><span class="sxs-lookup"><span data-stu-id="a1053-139">The following illustration shows how the profiler DLL interacts with the application that is being profiled and the CLR.</span></span>  
  
 <span data-ttu-id="a1053-140">![Architettura di profilatura](../../../../docs/framework/unmanaged-api/profiling/media/profilingarch.png "ProfilingArch")</span><span class="sxs-lookup"><span data-stu-id="a1053-140">![Profiling Architecture](../../../../docs/framework/unmanaged-api/profiling/media/profilingarch.png "ProfilingArch")</span></span>  
<span data-ttu-id="a1053-141">Architettura di profilatura</span><span class="sxs-lookup"><span data-stu-id="a1053-141">Profiling architecture</span></span>  
  
### <a name="the-notification-interfaces"></a><span data-ttu-id="a1053-142">Interfacce di notifica</span><span class="sxs-lookup"><span data-stu-id="a1053-142">The Notification Interfaces</span></span>  
 <span data-ttu-id="a1053-143">[ICorProfilerCallback](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback-interface.md) e [ICorProfilerCallback2](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback2-interface.md) possono essere considerate interfacce di notifica.</span><span class="sxs-lookup"><span data-stu-id="a1053-143">[ICorProfilerCallback](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback-interface.md) and [ICorProfilerCallback2](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback2-interface.md) can be considered notification interfaces.</span></span> <span data-ttu-id="a1053-144">Queste interfacce costituite da metodi quali [ClassLoadStarted](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback-classloadstarted-method.md), [ClassLoadFinished](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback-classloadfinished-method.md), e [JITCompilationStarted](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback-jitcompilationstarted-method.md).</span><span class="sxs-lookup"><span data-stu-id="a1053-144">These interfaces consist of methods such as [ClassLoadStarted](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback-classloadstarted-method.md), [ClassLoadFinished](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback-classloadfinished-method.md), and [JITCompilationStarted](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback-jitcompilationstarted-method.md).</span></span> <span data-ttu-id="a1053-145">Ogni volta che CLR carica o scarica una classe, compila una funzione e così via, chiama il metodo corrispondente nell'interfaccia `ICorProfilerCallback` o `ICorProfilerCallback2` del profiler.</span><span class="sxs-lookup"><span data-stu-id="a1053-145">Each time the CLR loads or unloads a class, compiles a function, and so on, it calls the corresponding method in the profiler's `ICorProfilerCallback` or `ICorProfilerCallback2` interface.</span></span>  
  
 <span data-ttu-id="a1053-146">Ad esempio, un profiler potrebbe misurare le prestazioni del codice tramite due funzioni di notifica: [FunctionEnter2](../../../../docs/framework/unmanaged-api/profiling/functionenter2-function.md) e [FunctionLeave2](../../../../docs/framework/unmanaged-api/profiling/functionleave2-function.md).</span><span class="sxs-lookup"><span data-stu-id="a1053-146">For example, a profiler could measure code performance through two notification functions: [FunctionEnter2](../../../../docs/framework/unmanaged-api/profiling/functionenter2-function.md) and [FunctionLeave2](../../../../docs/framework/unmanaged-api/profiling/functionleave2-function.md).</span></span> <span data-ttu-id="a1053-147">Il profiler imposta un timestamp per ogni notifica, accumula risultati e restituisce un elenco in cui sono indicate le funzioni che hanno usato maggiormente la CPU o che hanno richiesto più tempo durante l'esecuzione dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="a1053-147">It just time-stamps each notification, accumulates results, and outputs a list that indicates which functions consumed the most CPU or wall-clock time during the execution of the application.</span></span>  
  
### <a name="the-information-retrieval-interfaces"></a><span data-ttu-id="a1053-148">Interfacce di recupero delle informazioni</span><span class="sxs-lookup"><span data-stu-id="a1053-148">The Information Retrieval Interfaces</span></span>  
 <span data-ttu-id="a1053-149">Le altre interfacce principali coinvolte nella profilatura sono [ICorProfilerInfo](../../../../docs/framework/unmanaged-api/profiling/icorprofilerinfo-interface.md) e [ICorProfilerInfo2](../../../../docs/framework/unmanaged-api/profiling/icorprofilerinfo2-interface.md).</span><span class="sxs-lookup"><span data-stu-id="a1053-149">The other main interfaces involved in profiling are [ICorProfilerInfo](../../../../docs/framework/unmanaged-api/profiling/icorprofilerinfo-interface.md) and [ICorProfilerInfo2](../../../../docs/framework/unmanaged-api/profiling/icorprofilerinfo2-interface.md).</span></span> <span data-ttu-id="a1053-150">Il profiler chiama queste interfacce secondo necessità per ottenere una maggiore quantità di informazioni per l'analisi.</span><span class="sxs-lookup"><span data-stu-id="a1053-150">The profiler calls these interfaces as required to obtain more information to help its analysis.</span></span> <span data-ttu-id="a1053-151">Ad esempio, ogni volta che CLR chiama il [FunctionEnter2](../../../../docs/framework/unmanaged-api/profiling/functionenter2-function.md) (funzione), fornisce un identificatore di funzione.</span><span class="sxs-lookup"><span data-stu-id="a1053-151">For example, whenever the CLR calls the [FunctionEnter2](../../../../docs/framework/unmanaged-api/profiling/functionenter2-function.md) function, it supplies a function identifier.</span></span> <span data-ttu-id="a1053-152">Il profiler può ottenere altre informazioni su quella funzione chiamando il [ICorProfilerInfo2::GetFunctionInfo2](../../../../docs/framework/unmanaged-api/profiling/icorprofilerinfo2-getfunctioninfo2-method.md) metodo possa individuare la classe della funzione padre, il nome e così via.</span><span class="sxs-lookup"><span data-stu-id="a1053-152">The profiler can get more information about that function by calling the [ICorProfilerInfo2::GetFunctionInfo2](../../../../docs/framework/unmanaged-api/profiling/icorprofilerinfo2-getfunctioninfo2-method.md) method to discover the function's parent class, its name, and so on.</span></span>  
  
 [<span data-ttu-id="a1053-153">Torna all'inizio</span><span class="sxs-lookup"><span data-stu-id="a1053-153">Back to top</span></span>](#top)  
  
<a name="support"></a>   
## <a name="supported-features"></a><span data-ttu-id="a1053-154">Funzionalità supportate</span><span class="sxs-lookup"><span data-stu-id="a1053-154">Supported Features</span></span>  
 <span data-ttu-id="a1053-155">L'API di profilatura fornisce informazioni su diversi eventi e azioni che si verificano in Common Language Runtime.</span><span class="sxs-lookup"><span data-stu-id="a1053-155">The profiling API provides information about a variety of events and actions that occur in the common language runtime.</span></span> <span data-ttu-id="a1053-156">È possibile usare tali informazioni per monitorare il funzionamento interno dei processi e analizzare le prestazioni dell'applicazione .NET Framework in uso.</span><span class="sxs-lookup"><span data-stu-id="a1053-156">You can use this information to monitor the inner workings of processes and to analyze the performance of your .NET Framework application.</span></span>  
  
 <span data-ttu-id="a1053-157">L'API di profilatura recupera le informazioni sulle azioni e sugli eventi che si verificano in CLR riportati di seguito:</span><span class="sxs-lookup"><span data-stu-id="a1053-157">The profiling API retrieves information about the following actions and events that occur in the CLR:</span></span>  
  
-   <span data-ttu-id="a1053-158">Eventi di avvio e arresto di CLR.</span><span class="sxs-lookup"><span data-stu-id="a1053-158">CLR startup and shutdown events.</span></span>  
  
-   <span data-ttu-id="a1053-159">Eventi di creazione e arresto di domini applicazione.</span><span class="sxs-lookup"><span data-stu-id="a1053-159">Application domain creation and shutdown events.</span></span>  
  
-   <span data-ttu-id="a1053-160">Eventi di caricamento e scaricamento di assembly.</span><span class="sxs-lookup"><span data-stu-id="a1053-160">Assembly loading and unloading events.</span></span>  
  
-   <span data-ttu-id="a1053-161">Eventi di caricamento e scaricamento di moduli.</span><span class="sxs-lookup"><span data-stu-id="a1053-161">Module loading and unloading events.</span></span>  
  
-   <span data-ttu-id="a1053-162">Eventi di creazione e distruzione di vtable COM.</span><span class="sxs-lookup"><span data-stu-id="a1053-162">COM vtable creation and destruction events.</span></span>  
  
-   <span data-ttu-id="a1053-163">Eventi di compilazione JIT e di code pitching.</span><span class="sxs-lookup"><span data-stu-id="a1053-163">Just-in-time (JIT) compilation and code-pitching events.</span></span>  
  
-   <span data-ttu-id="a1053-164">Eventi di caricamento e scaricamento di classi.</span><span class="sxs-lookup"><span data-stu-id="a1053-164">Class loading and unloading events.</span></span>  
  
-   <span data-ttu-id="a1053-165">Eventi di creazione e distruzione di thread.</span><span class="sxs-lookup"><span data-stu-id="a1053-165">Thread creation and destruction events.</span></span>  
  
-   <span data-ttu-id="a1053-166">Eventi di entrata e uscita delle funzioni.</span><span class="sxs-lookup"><span data-stu-id="a1053-166">Function entry and exit events.</span></span>  
  
-   <span data-ttu-id="a1053-167">Eccezioni.</span><span class="sxs-lookup"><span data-stu-id="a1053-167">Exceptions.</span></span>  
  
-   <span data-ttu-id="a1053-168">Transizioni tra l'esecuzione di codice gestito e non gestito.</span><span class="sxs-lookup"><span data-stu-id="a1053-168">Transitions between managed and unmanaged code execution.</span></span>  
  
-   <span data-ttu-id="a1053-169">Transizioni tra contesti di runtime diversi.</span><span class="sxs-lookup"><span data-stu-id="a1053-169">Transitions between different runtime contexts.</span></span>  
  
-   <span data-ttu-id="a1053-170">Informazioni sulle sospensioni del runtime.</span><span class="sxs-lookup"><span data-stu-id="a1053-170">Information about runtime suspensions.</span></span>  
  
-   <span data-ttu-id="a1053-171">Informazioni sull'heap della memoria del runtime e sull'attività di Garbage Collection.</span><span class="sxs-lookup"><span data-stu-id="a1053-171">Information about the runtime memory heap and garbage collection activity.</span></span>  
  
 <span data-ttu-id="a1053-172">L'API di profilatura può essere chiamata da qualsiasi linguaggio compatibile con COM (non gestito).</span><span class="sxs-lookup"><span data-stu-id="a1053-172">The profiling API can be called from any (non-managed) COM-compatible language.</span></span>  
  
 <span data-ttu-id="a1053-173">Dal punto di vista del consumo di CPU e della memoria, l'API si rivela efficiente.</span><span class="sxs-lookup"><span data-stu-id="a1053-173">The API is efficient with regard to CPU and memory consumption.</span></span> <span data-ttu-id="a1053-174">La profilatura non comporta modifiche all'applicazione profilata di importanza tale da provocare risultati fuorvianti.</span><span class="sxs-lookup"><span data-stu-id="a1053-174">Profiling does not involve changes to the profiled application that are significant enough to cause misleading results.</span></span>  
  
 <span data-ttu-id="a1053-175">L'API di profilatura è utile sia per i profiler di campionamento, sia per i profiler non di campionamento.</span><span class="sxs-lookup"><span data-stu-id="a1053-175">The profiling API is useful to both sampling and non-sampling profilers.</span></span> <span data-ttu-id="a1053-176">Oggetto *profiler di campionamento* controlla il profilo a cicli macchina regolari, ad esempio, intervalli di 5 millisecondi.</span><span class="sxs-lookup"><span data-stu-id="a1053-176">A *sampling profiler* inspects the profile at regular clock ticks, say, at 5 milliseconds apart.</span></span> <span data-ttu-id="a1053-177">Oggetto *profiler non di campionamento* viene informato di un evento in modo sincrono con il thread che causa l'evento.</span><span class="sxs-lookup"><span data-stu-id="a1053-177">A *non-sampling profiler* is informed of an event synchronously with the thread that causes the event.</span></span>  
  
### <a name="unsupported-functionality"></a><span data-ttu-id="a1053-178">Funzionalità non supportata</span><span class="sxs-lookup"><span data-stu-id="a1053-178">Unsupported Functionality</span></span>  
 <span data-ttu-id="a1053-179">L'API di profilatura non supporta le funzionalità descritte di seguito:</span><span class="sxs-lookup"><span data-stu-id="a1053-179">The profiling API does not support the following functionality:</span></span>  
  
-   <span data-ttu-id="a1053-180">Codice non gestito, che deve essere profilato usando i metodi Win32 convenzionali.</span><span class="sxs-lookup"><span data-stu-id="a1053-180">Unmanaged code, which must be profiled using conventional Win32 methods.</span></span> <span data-ttu-id="a1053-181">Tuttavia, il profiler CLR include eventi di transizione che consentono di determinare i limiti fra codice gestito e non gestito.</span><span class="sxs-lookup"><span data-stu-id="a1053-181">However, the CLR profiler includes transition events to determine the boundaries between managed and unmanaged code.</span></span>  
  
-   <span data-ttu-id="a1053-182">Applicazioni automodificanti, che modificano il proprio codice per scopi quali la programmazione orientata agli aspetti.</span><span class="sxs-lookup"><span data-stu-id="a1053-182">Self-modifying applications that modify their own code for purposes such as aspect-oriented programming.</span></span>  
  
-   <span data-ttu-id="a1053-183">Verifica dei limiti, in quanto l'API di profilatura non fornisce queste informazioni.</span><span class="sxs-lookup"><span data-stu-id="a1053-183">Bounds checking, because the profiling API does not provide this information.</span></span> <span data-ttu-id="a1053-184">CLR fornisce il supporto intrinseco per la verifica dei limiti di tutto il codice gestito.</span><span class="sxs-lookup"><span data-stu-id="a1053-184">The CLR provides intrinsic support for bounds checking of all managed code.</span></span>  
  
-   <span data-ttu-id="a1053-185">Profilatura remota, non supportata per i motivi seguenti:</span><span class="sxs-lookup"><span data-stu-id="a1053-185">Remote profiling, which is not supported for the following reasons:</span></span>  
  
    -   <span data-ttu-id="a1053-186">La profilatura remota estende il tempo di esecuzione.</span><span class="sxs-lookup"><span data-stu-id="a1053-186">Remote profiling extends execution time.</span></span> <span data-ttu-id="a1053-187">Quando si usano le interfacce di profilatura, è necessario ridurre al minimo il tempo di esecuzione in modo da non influire eccessivamente sui risultati,</span><span class="sxs-lookup"><span data-stu-id="a1053-187">When you use the profiling interfaces, you must minimize execution time so that profiling results will not be unduly affected.</span></span> <span data-ttu-id="a1053-188">soprattutto durante il monitoraggio delle prestazioni di esecuzione.</span><span class="sxs-lookup"><span data-stu-id="a1053-188">This is especially true when execution performance is being monitored.</span></span> <span data-ttu-id="a1053-189">Tuttavia, la profilatura remota non costituisce una limitazione quando le interfacce di profilatura vengono usate per monitorare l'utilizzo della memoria o per ottenere informazioni di runtime sugli stack frame, sugli oggetti e così via.</span><span class="sxs-lookup"><span data-stu-id="a1053-189">However, remote profiling is not a limitation when the profiling interfaces are used to monitor memory usage or to obtain run-time information about stack frames, objects, and so on.</span></span>  
  
    -   <span data-ttu-id="a1053-190">Il Code Profiler di CLR deve registrare una o più interfacce di callback con il runtime sul computer locale su cui è in esecuzione l'applicazione profilata.</span><span class="sxs-lookup"><span data-stu-id="a1053-190">The CLR code profiler must register one or more callback interfaces with the runtime on the local computer on which the profiled application is running.</span></span> <span data-ttu-id="a1053-191">In tal modo la capacità di creare un Code Profiler remoto viene limitata.</span><span class="sxs-lookup"><span data-stu-id="a1053-191">This limits the ability to create a remote code profiler.</span></span>  
  
-   <span data-ttu-id="a1053-192">Profilatura negli ambienti di produzione con requisiti di disponibilità elevata.</span><span class="sxs-lookup"><span data-stu-id="a1053-192">Profiling in production environments with high-availability requirements.</span></span> <span data-ttu-id="a1053-193">L'API di profilatura è stata creata per supportare la diagnostica in fase di sviluppo.</span><span class="sxs-lookup"><span data-stu-id="a1053-193">The profiling API was created to support development-time diagnostics.</span></span> <span data-ttu-id="a1053-194">Non è stata sottoposta ai test accurati richiesti per il supporto degli ambienti di produzione.</span><span class="sxs-lookup"><span data-stu-id="a1053-194">It has not undergone the rigorous testing required to support production environments.</span></span>  
  
 [<span data-ttu-id="a1053-195">Torna all'inizio</span><span class="sxs-lookup"><span data-stu-id="a1053-195">Back to top</span></span>](#top)  
  
<a name="notification_threads"></a>   
## <a name="notification-threads"></a><span data-ttu-id="a1053-196">Thread di notifica</span><span class="sxs-lookup"><span data-stu-id="a1053-196">Notification Threads</span></span>  
 <span data-ttu-id="a1053-197">Nella maggior parte dei casi, il thread che genera un evento esegue anche notifiche.</span><span class="sxs-lookup"><span data-stu-id="a1053-197">In most cases, the thread that generates an event also executes notifications.</span></span> <span data-ttu-id="a1053-198">Tali notifiche (ad esempio, [FunctionEnter](../../../../docs/framework/unmanaged-api/profiling/functionenter-function.md) e [FunctionLeave](../../../../docs/framework/unmanaged-api/profiling/functionleave-function.md)) non è necessario specificare l'impostazione esplicita `ThreadID`.</span><span class="sxs-lookup"><span data-stu-id="a1053-198">Such notifications (for example, [FunctionEnter](../../../../docs/framework/unmanaged-api/profiling/functionenter-function.md) and [FunctionLeave](../../../../docs/framework/unmanaged-api/profiling/functionleave-function.md)) do not need to supply the explicit `ThreadID`.</span></span> <span data-ttu-id="a1053-199">Inoltre, il profiler potrebbe usare la memoria locale del thread per archiviare e aggiornare i blocchi delle analisi anziché indicizzarli in un archivio globale, basato sul `ThreadID` del thread interessato.</span><span class="sxs-lookup"><span data-stu-id="a1053-199">Also, the profiler might decide to use thread-local storage to store and update its analysis blocks instead of indexing the analysis blocks in global storage, based on the `ThreadID` of the affected thread.</span></span>  
  
 <span data-ttu-id="a1053-200">Questi callback non sono serializzati.</span><span class="sxs-lookup"><span data-stu-id="a1053-200">Note that these callbacks are not serialized.</span></span> <span data-ttu-id="a1053-201">Gli utenti dovranno proteggere il codice creando strutture dei dati thread-safe e bloccando il codice del profiler dove necessario, per impedire l'accesso parallelo da più thread.</span><span class="sxs-lookup"><span data-stu-id="a1053-201">Users must protect their code by creating thread-safe data structures and by locking the profiler code where necessary to prevent parallel access from multiple threads.</span></span> <span data-ttu-id="a1053-202">Pertanto, in certi casi è possibile ricevere una sequenza insolita di callback.</span><span class="sxs-lookup"><span data-stu-id="a1053-202">Therefore, in certain cases you can receive an unusual sequence of callbacks.</span></span> <span data-ttu-id="a1053-203">Ad esempio, si supponga che un'applicazione gestita generi due thread che eseguono codice identico.</span><span class="sxs-lookup"><span data-stu-id="a1053-203">For example, assume that a managed application is spawning two threads that are executing identical code.</span></span> <span data-ttu-id="a1053-204">In questo caso, è possibile ricevere una [ICorProfilerCallback:: JITCompilationStarted](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback-jitcompilationstarted-method.md) evento per una funzione da un thread e una `FunctionEnter` callback da altro thread prima di ricevere il [ ICorProfilerCallback:: JITCompilationFinished](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback-jitcompilationfinished-method.md) callback.</span><span class="sxs-lookup"><span data-stu-id="a1053-204">In this case, it is possible to receive a [ICorProfilerCallback::JITCompilationStarted](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback-jitcompilationstarted-method.md) event for some function from one thread and a `FunctionEnter` callback from the other thread before receiving the [ICorProfilerCallback::JITCompilationFinished](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback-jitcompilationfinished-method.md) callback.</span></span> <span data-ttu-id="a1053-205">In questo caso, l'utente riceverà un callback `FunctionEnter` per una funzione che potrebbe non essere ancora stata completamente compilata tramite JIT.</span><span class="sxs-lookup"><span data-stu-id="a1053-205">In this case, the user will receive a `FunctionEnter` callback for a function that may not have been fully just-in-time (JIT) compiled yet.</span></span>  
  
 [<span data-ttu-id="a1053-206">Torna all'inizio</span><span class="sxs-lookup"><span data-stu-id="a1053-206">Back to top</span></span>](#top)  
  
<a name="security"></a>   
## <a name="security"></a><span data-ttu-id="a1053-207">Sicurezza</span><span class="sxs-lookup"><span data-stu-id="a1053-207">Security</span></span>  
 <span data-ttu-id="a1053-208">Una DLL del profiler è una DLL non gestita che viene eseguita parte del motore di Common Language Runtime.</span><span class="sxs-lookup"><span data-stu-id="a1053-208">A profiler DLL is an unmanaged DLL that runs as part of the common language runtime execution engine.</span></span> <span data-ttu-id="a1053-209">Di conseguenza, il codice nella DLL del profiler non è soggetto alle restrizioni di sicurezza dall'accesso di codice gestito.</span><span class="sxs-lookup"><span data-stu-id="a1053-209">As a result, the code in the profiler DLL is not subject to the restrictions of managed code access security.</span></span> <span data-ttu-id="a1053-210">Le uniche limitazioni relative alla DLL del profiler sono quelle imposte dal sistema operativo all'utente che sta eseguendo l'applicazione profilata.</span><span class="sxs-lookup"><span data-stu-id="a1053-210">The only limitations on the profiler DLL are those imposed by the operating system on the user who is running the profiled application.</span></span>  
  
 <span data-ttu-id="a1053-211">Per evitare problemi relativi alla sicurezza, gli autori del profiler devono adottare le precauzioni appropriate.</span><span class="sxs-lookup"><span data-stu-id="a1053-211">Profiler authors should take appropriate precautions to avoid security-related issues.</span></span> <span data-ttu-id="a1053-212">Ad esempio, durante l'installazione, è necessario aggiungere la DLL di un profiler a un elenco di controllo di accesso (ACL), in modo da renderne impossibile la modifica da parte di un utente malintenzionato.</span><span class="sxs-lookup"><span data-stu-id="a1053-212">For example, during installation, a profiler DLL should be added to an access control list (ACL) so that a malicious user cannot modify it.</span></span>  
  
 [<span data-ttu-id="a1053-213">Torna all'inizio</span><span class="sxs-lookup"><span data-stu-id="a1053-213">Back to top</span></span>](#top)  
  
<a name="combining_managed_unmanaged"></a>   
## <a name="combining-managed-and-unmanaged-code-in-a-code-profiler"></a><span data-ttu-id="a1053-214">Combinazione di codice gestito e non gestito in un Code Profiler</span><span class="sxs-lookup"><span data-stu-id="a1053-214">Combining Managed and Unmanaged Code in a Code Profiler</span></span>  
 <span data-ttu-id="a1053-215">La scrittura non corretta di un profiler può provocare dei riferimenti circolari, che determinano un comportamento imprevedibile.</span><span class="sxs-lookup"><span data-stu-id="a1053-215">An incorrectly written profiler can cause circular references to itself, resulting in unpredictable behavior.</span></span>  
  
 <span data-ttu-id="a1053-216">Una verifica dell'API di profilatura di CLR potrebbe dare l'impressione che sia possibile scrivere un profiler contenente componenti gestiti e non gestiti che comunicano tra loro mediante l'interoperabilità COM o chiamate indirette.</span><span class="sxs-lookup"><span data-stu-id="a1053-216">A review of the CLR profiling API may create the impression that you can write a profiler that contains managed and unmanaged components that call each other through COM interop or indirect calls.</span></span>  
  
 <span data-ttu-id="a1053-217">Sebbene sia possibile dal punto di vista della progettazione, l'API di profilatura non supporta i componenti gestiti.</span><span class="sxs-lookup"><span data-stu-id="a1053-217">Although this is possible from a design perspective, the profiling API does not support managed components.</span></span> <span data-ttu-id="a1053-218">Un profiler CLR deve essere completamente non gestito.</span><span class="sxs-lookup"><span data-stu-id="a1053-218">A CLR profiler must be completely unmanaged.</span></span> <span data-ttu-id="a1053-219">Tentativi di combinare codice gestito e codice non gestito in un profiler CLR possono provocare violazioni di accesso, errori di esecuzione del programma o deadlock.</span><span class="sxs-lookup"><span data-stu-id="a1053-219">Attempts to combine managed and unmanaged code in a CLR profiler may cause access violations, program failure, or deadlocks.</span></span> <span data-ttu-id="a1053-220">I componenti gestiti del profiler genererebbero eventi nei relativi componenti non gestiti, che a loro volta effettuerebbero chiamate ai componenti gestiti, dando origine a riferimenti circolari.</span><span class="sxs-lookup"><span data-stu-id="a1053-220">The managed components of the profiler will fire events back to their unmanaged components, which would subsequently call the managed components again, resulting in circular references.</span></span>  
  
 <span data-ttu-id="a1053-221">L'unico percorso in cui un profiler CLR può chiamare in modo sicuro il codice gestito è il corpo di un metodo in codice MSIL (Microsoft Intermediate Language).</span><span class="sxs-lookup"><span data-stu-id="a1053-221">The only location where a CLR profiler can call managed code safely is in the Microsoft intermediate language (MSIL) body of a method.</span></span> <span data-ttu-id="a1053-222">Le procedure consigliate per modificare il corpo MSIL consiste nell'usare i metodi di ricompilazione JIT nel [ICorProfilerCallback4](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback4-interface.md) interfaccia.</span><span class="sxs-lookup"><span data-stu-id="a1053-222">The recommended practice for modifying the MSIL body is to use the  JIT recompilation methods in the [ICorProfilerCallback4](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback4-interface.md) interface.</span></span>  
  
 <span data-ttu-id="a1053-223">È anche possibile usare i metodi di strumentazione precedenti per modificare MSIL.</span><span class="sxs-lookup"><span data-stu-id="a1053-223">It is also possible to use the older instrumentation methods to modify MSIL.</span></span> <span data-ttu-id="a1053-224">Prima che venga completata la compilazione just-in-time (JIT) di una funzione, il profiler può inserire le chiamate gestite nel corpo MSIL di un metodo e quindi la compilazione JIT, (vedere la [ICorProfilerInfo:: GetILFunctionBody](../../../../docs/framework/unmanaged-api/profiling/icorprofilerinfo-getilfunctionbody-method.md) (metodo)).</span><span class="sxs-lookup"><span data-stu-id="a1053-224">Before the just-in-time (JIT) compilation of a function is completed, the profiler can insert managed calls in the MSIL body of a method and then JIT-compile it (see the [ICorProfilerInfo::GetILFunctionBody](../../../../docs/framework/unmanaged-api/profiling/icorprofilerinfo-getilfunctionbody-method.md) method).</span></span> <span data-ttu-id="a1053-225">Questa tecnica può essere usata, con buoni risultati, per la strumentazione selettiva di codice gestito oppure per la raccolta di statistiche e dati sulle prestazioni relativi a JIT.</span><span class="sxs-lookup"><span data-stu-id="a1053-225">This technique can successfully be used for selective instrumentation of managed code, or to gather statistics and performance data about the JIT.</span></span>  
  
 <span data-ttu-id="a1053-226">In alternativa, un Code Profiler può inserire hook nativi nel corpo MSIL di ogni funzione gestita che effettua chiamate nel codice non gestito.</span><span class="sxs-lookup"><span data-stu-id="a1053-226">Alternatively, a code profiler can insert native hooks in the MSIL body of every managed function that calls into unmanaged code.</span></span> <span data-ttu-id="a1053-227">Questa tecnica può essere usata per la strumentazione e il code coverage.</span><span class="sxs-lookup"><span data-stu-id="a1053-227">This technique can be used for instrumentation and coverage.</span></span> <span data-ttu-id="a1053-228">Ad esempio, un Code Profiler potrebbe inserire degli hook di strumentazione dopo ogni blocco di codice MSIL per garantire l'esecuzione del blocco.</span><span class="sxs-lookup"><span data-stu-id="a1053-228">For example, a code profiler could insert instrumentation hooks after every MSIL block to ensure that the block has been executed.</span></span> <span data-ttu-id="a1053-229">La modifica del corpo MSIL di un metodo è un'operazione molto delicata ed è necessario prendere in considerazione molteplici fattori.</span><span class="sxs-lookup"><span data-stu-id="a1053-229">The modification of the MSIL body of a method is a very delicate operation, and there are many factors that should be taken into consideration.</span></span>  
  
 [<span data-ttu-id="a1053-230">Torna all'inizio</span><span class="sxs-lookup"><span data-stu-id="a1053-230">Back to top</span></span>](#top)  
  
<a name="unmanaged"></a>   
## <a name="profiling-unmanaged-code"></a><span data-ttu-id="a1053-231">Profilatura del codice non gestito</span><span class="sxs-lookup"><span data-stu-id="a1053-231">Profiling Unmanaged Code</span></span>  
 <span data-ttu-id="a1053-232">L'API di profilatura di Common Language Runtime fornisce il supporto minimo per la profilatura di codice non gestito.</span><span class="sxs-lookup"><span data-stu-id="a1053-232">The common language runtime (CLR) profiling API provides minimal support for profiling unmanaged code.</span></span> <span data-ttu-id="a1053-233">Sono disponibili le funzionalità seguenti:</span><span class="sxs-lookup"><span data-stu-id="a1053-233">The following functionality is provided:</span></span>  
  
-   <span data-ttu-id="a1053-234">Enumerazione delle catene dello stack.</span><span class="sxs-lookup"><span data-stu-id="a1053-234">Enumeration of stack chains.</span></span> <span data-ttu-id="a1053-235">Questa funzionalità consente a un Code Profiler di determinare il limite tra codice gestito e codice non gestito.</span><span class="sxs-lookup"><span data-stu-id="a1053-235">This feature enables a code profiler to determine the boundary between managed code and unmanaged code.</span></span>  
  
-   <span data-ttu-id="a1053-236">Determinazione della corrispondenza di una catena dello stack a un codice gestito o a un codice nativo.</span><span class="sxs-lookup"><span data-stu-id="a1053-236">Determination whether a stack chain corresponds to managed code or native code.</span></span>  
  
 <span data-ttu-id="a1053-237">In .NET Framework versioni 1.0 e 1.1, questi metodi sono disponibili tramite il subset in-process dell'API di debug di Common Language Runtime.</span><span class="sxs-lookup"><span data-stu-id="a1053-237">In the .NET Framework versions 1.0 and 1.1, these methods are available through the in-process subset of the CLR debugging API.</span></span> <span data-ttu-id="a1053-238">Sono definiti nel file CorDebug.idl.</span><span class="sxs-lookup"><span data-stu-id="a1053-238">They are defined in the CorDebug.idl file.</span></span>  
  
 <span data-ttu-id="a1053-239">In .NET Framework 2.0 e versioni successive, è possibile usare la [ICorProfilerInfo2::DoStackSnapshot](../../../../docs/framework/unmanaged-api/profiling/icorprofilerinfo2-dostacksnapshot-method.md) metodo per questa funzionalità.</span><span class="sxs-lookup"><span data-stu-id="a1053-239">In the .NET Framework 2.0 and later, you can use the [ICorProfilerInfo2::DoStackSnapshot](../../../../docs/framework/unmanaged-api/profiling/icorprofilerinfo2-dostacksnapshot-method.md) method for this functionality.</span></span>  
  
 [<span data-ttu-id="a1053-240">Torna all'inizio</span><span class="sxs-lookup"><span data-stu-id="a1053-240">Back to top</span></span>](#top)  
  
<a name="com"></a>   
## <a name="using-com"></a><span data-ttu-id="a1053-241">Uso di COM</span><span class="sxs-lookup"><span data-stu-id="a1053-241">Using COM</span></span>  
 <span data-ttu-id="a1053-242">Sebbene le interfacce di profilatura vengano definite come interfacce COM, Common Language Runtime non inizializza effettivamente COM per usarle.</span><span class="sxs-lookup"><span data-stu-id="a1053-242">Although the profiling interfaces are defined as COM interfaces, the common language runtime (CLR) does not actually initialize COM to use these interfaces.</span></span> <span data-ttu-id="a1053-243">Il motivo è per evitare di dover impostare il modello di threading usando il [CoInitialize](/windows/desktop/api/objbase/nf-objbase-coinitialize) funzione prima dell'applicazione gestita abbia avuto la possibilità di specificare il modello di threading desiderato.</span><span class="sxs-lookup"><span data-stu-id="a1053-243">The reason is to avoid having to set the threading model by using the [CoInitialize](/windows/desktop/api/objbase/nf-objbase-coinitialize) function before the managed application has had a chance to specify its desired threading model.</span></span> <span data-ttu-id="a1053-244">Analogamente, il profiler non deve chiamare la funzione `CoInitialize`, perché potrebbe scegliere un modello di threading non compatibile con l'applicazione profilata e comprometterne l'esecuzione.</span><span class="sxs-lookup"><span data-stu-id="a1053-244">Similarly, the profiler itself should not call `CoInitialize`, because it may pick a threading model that is incompatible with the application being profiled and may cause the application to fail.</span></span>  
  
 [<span data-ttu-id="a1053-245">Torna all'inizio</span><span class="sxs-lookup"><span data-stu-id="a1053-245">Back to top</span></span>](#top)  
  
<a name="call_stacks"></a>   
## <a name="call-stacks"></a><span data-ttu-id="a1053-246">Stack di chiamate</span><span class="sxs-lookup"><span data-stu-id="a1053-246">Call Stacks</span></span>  
 <span data-ttu-id="a1053-247">L'API di profilatura fornisce due modalità per ottenere gli stack di chiamate: un metodo basato sullo snapshot dello stack, che consente la raccolta di tipo sparse degli stack di chiamate, e un metodo basato sullo shadow stack, che registra lo stack di chiamate in ogni istante.</span><span class="sxs-lookup"><span data-stu-id="a1053-247">The profiling API provides two ways to obtain call stacks: a stack snapshot method, which enables sparse gathering of call stacks, and a shadow stack method, which tracks the call stack at every instant.</span></span>  
  
### <a name="stack-snapshot"></a><span data-ttu-id="a1053-248">Snapshot dello stack</span><span class="sxs-lookup"><span data-stu-id="a1053-248">Stack Snapshot</span></span>  
 <span data-ttu-id="a1053-249">Uno snapshot dello stack è una traccia dello stack di un thread in un istante di tempo.</span><span class="sxs-lookup"><span data-stu-id="a1053-249">A stack snapshot is a trace of the stack of a thread at an instant in time.</span></span> <span data-ttu-id="a1053-250">L'API di profilatura supporta l'analisi di funzioni gestite nello stack, ma lascia l'analisi delle funzioni non gestite alla funzione di verifica del percorso chiamate nello stack del profiler.</span><span class="sxs-lookup"><span data-stu-id="a1053-250">The profiling API supports the tracing of managed functions on the stack, but it leaves the tracing of unmanaged functions to the profiler's own stack walker.</span></span>  
  
 <span data-ttu-id="a1053-251">Per altre informazioni sulla programmazione del profiler per esaminare chiamate negli stack gestiti, vedere la [ICorProfilerInfo2::DoStackSnapshot](../../../../docs/framework/unmanaged-api/profiling/icorprofilerinfo2-dostacksnapshot-method.md) metodo in questo set di documentazione e [analisi dello Stack del Profiler in .NET Framework 2.0: Concetti di base e](https://go.microsoft.com/fwlink/?LinkId=73638).</span><span class="sxs-lookup"><span data-stu-id="a1053-251">For more information about how to program the profiler to walk managed stacks, see the [ICorProfilerInfo2::DoStackSnapshot](../../../../docs/framework/unmanaged-api/profiling/icorprofilerinfo2-dostacksnapshot-method.md) method in this documentation set, and [Profiler Stack Walking in the .NET Framework 2.0: Basics and Beyond](https://go.microsoft.com/fwlink/?LinkId=73638).</span></span>
  
### <a name="shadow-stack"></a><span data-ttu-id="a1053-252">Shadow stack</span><span class="sxs-lookup"><span data-stu-id="a1053-252">Shadow Stack</span></span>  
 <span data-ttu-id="a1053-253">Un uso troppo frequente del metodo basato sullo snapshot può creare rapidamente un problema di prestazioni.</span><span class="sxs-lookup"><span data-stu-id="a1053-253">Using the snapshot method too frequently can quickly create a performance issue.</span></span> <span data-ttu-id="a1053-254">Se si desidera eseguire frequenti tracce dello stack, il profiler deve compilare uno shadow stack usando il [FunctionEnter2](../../../../docs/framework/unmanaged-api/profiling/functionenter2-function.md), [FunctionLeave2](../../../../docs/framework/unmanaged-api/profiling/functionleave2-function.md), [FunctionTailcall2](../../../../docs/framework/unmanaged-api/profiling/functiontailcall2-function.md), e [ICorProfilerCallback2](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback2-interface.md) callback di eccezione.</span><span class="sxs-lookup"><span data-stu-id="a1053-254">If you want to take stack traces frequently, your profiler should instead build a shadow stack by using the [FunctionEnter2](../../../../docs/framework/unmanaged-api/profiling/functionenter2-function.md), [FunctionLeave2](../../../../docs/framework/unmanaged-api/profiling/functionleave2-function.md), [FunctionTailcall2](../../../../docs/framework/unmanaged-api/profiling/functiontailcall2-function.md), and [ICorProfilerCallback2](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback2-interface.md) exception callbacks.</span></span> <span data-ttu-id="a1053-255">Lo shadow stack è sempre aggiornato e può essere rapidamente copiato in un'area di archiviazione quando è necessario uno snapshot dello stack.</span><span class="sxs-lookup"><span data-stu-id="a1053-255">The shadow stack is always current and can quickly be copied to storage whenever a stack snapshot is needed.</span></span>  
  
 <span data-ttu-id="a1053-256">Uno shadow stack può ottenere argomenti della funzione, valori restituiti e informazioni sulle creazioni di istanze generiche.</span><span class="sxs-lookup"><span data-stu-id="a1053-256">A shadow stack may obtain function arguments, return values, and information about generic instantiations.</span></span> <span data-ttu-id="a1053-257">Queste informazioni sono disponibili solo tramite lo shadow stack e possono essere ottenute quando il controllo viene passato a una funzione.</span><span class="sxs-lookup"><span data-stu-id="a1053-257">This information is available only through the shadow stack and may be obtained when control is handed to a function.</span></span> <span data-ttu-id="a1053-258">Tuttavia, queste informazioni potrebbero non essere disponibili in un secondo momento, durante l'esecuzione della funzione.</span><span class="sxs-lookup"><span data-stu-id="a1053-258">However, this information may not be available later during the run of the function.</span></span>  
  
 [<span data-ttu-id="a1053-259">Torna all'inizio</span><span class="sxs-lookup"><span data-stu-id="a1053-259">Back to top</span></span>](#top)  
  
<a name="callbacks"></a>   
## <a name="callbacks-and-stack-depth"></a><span data-ttu-id="a1053-260">Callback e profondità dello stack</span><span class="sxs-lookup"><span data-stu-id="a1053-260">Callbacks and Stack Depth</span></span>  
 <span data-ttu-id="a1053-261">I callback del profiler possono essere generati in condizioni strettamente vincolate allo stack e un overflow dello stack nel callback di un profiler causerà l'uscita immediata dal processo.</span><span class="sxs-lookup"><span data-stu-id="a1053-261">Profiler callbacks may be issued in very stack-constrained circumstances, and a stack overflow in a profiler callback will lead to an immediate process exit.</span></span> <span data-ttu-id="a1053-262">Come risposta ai callback, un profiler deve assicurarsi di usare uno stack di dimensioni ridotte.</span><span class="sxs-lookup"><span data-stu-id="a1053-262">A profiler should make sure to use as little stack as possible in response to callbacks.</span></span> <span data-ttu-id="a1053-263">Se il profiler è destinato all'uso in processi affidabili in caso di overflow dello stack, dovrà evitare di causare un overflow dello stack.</span><span class="sxs-lookup"><span data-stu-id="a1053-263">If the profiler is intended for use against processes that are robust against stack overflow, the profiler itself should also avoid triggering stack overflow.</span></span>  
  
 [<span data-ttu-id="a1053-264">Torna all'inizio</span><span class="sxs-lookup"><span data-stu-id="a1053-264">Back to top</span></span>](#top)  
  
<a name="related_topics"></a>   
## <a name="related-topics"></a><span data-ttu-id="a1053-265">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="a1053-265">Related Topics</span></span>  
  
|<span data-ttu-id="a1053-266">Titolo</span><span class="sxs-lookup"><span data-stu-id="a1053-266">Title</span></span>|<span data-ttu-id="a1053-267">Descrizione</span><span class="sxs-lookup"><span data-stu-id="a1053-267">Description</span></span>|  
|-----------|-----------------|  
|[<span data-ttu-id="a1053-268">Configurazione di un ambiente di profilatura</span><span class="sxs-lookup"><span data-stu-id="a1053-268">Setting Up a Profiling Environment</span></span>](../../../../docs/framework/unmanaged-api/profiling/setting-up-a-profiling-environment.md)|<span data-ttu-id="a1053-269">Illustra come inizializzare un profiler, impostare le notifiche degli eventi e profilare un servizio di Windows.</span><span class="sxs-lookup"><span data-stu-id="a1053-269">Explains how to initialize a profiler, set event notifications, and profile a Windows Service.</span></span>|  
|[<span data-ttu-id="a1053-270">Interfacce di profilatura</span><span class="sxs-lookup"><span data-stu-id="a1053-270">Profiling Interfaces</span></span>](../../../../docs/framework/unmanaged-api/profiling/profiling-interfaces.md)|<span data-ttu-id="a1053-271">Descrive le interfacce non gestite usate dall'API di profilatura.</span><span class="sxs-lookup"><span data-stu-id="a1053-271">Describes the unmanaged interfaces that the profiling API uses.</span></span>|  
|[<span data-ttu-id="a1053-272">Funzioni statiche globali di profilatura</span><span class="sxs-lookup"><span data-stu-id="a1053-272">Profiling Global Static Functions</span></span>](../../../../docs/framework/unmanaged-api/profiling/profiling-global-static-functions.md)|<span data-ttu-id="a1053-273">Descrive le funzioni statiche globali non gestite usate dall'API di profilatura.</span><span class="sxs-lookup"><span data-stu-id="a1053-273">Describes the unmanaged global static functions that the profiling API uses.</span></span>|  
|[<span data-ttu-id="a1053-274">Enumerazioni di profilatura</span><span class="sxs-lookup"><span data-stu-id="a1053-274">Profiling Enumerations</span></span>](../../../../docs/framework/unmanaged-api/profiling/profiling-enumerations.md)|<span data-ttu-id="a1053-275">Descrive le enumerazioni non gestite usate dall'API di profilatura.</span><span class="sxs-lookup"><span data-stu-id="a1053-275">Describes the unmanaged enumerations that the profiling API uses.</span></span>|  
|[<span data-ttu-id="a1053-276">Strutture di profilatura</span><span class="sxs-lookup"><span data-stu-id="a1053-276">Profiling Structures</span></span>](../../../../docs/framework/unmanaged-api/profiling/profiling-structures.md)|<span data-ttu-id="a1053-277">Descrive le strutture non gestite usate dall'API di profilatura.</span><span class="sxs-lookup"><span data-stu-id="a1053-277">Describes the unmanaged structures that the profiling API uses.</span></span>|
