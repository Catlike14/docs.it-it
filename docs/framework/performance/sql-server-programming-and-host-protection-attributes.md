---
title: "SQL Server Programming and Host Protection Attributes | Microsoft Docs"
ms.custom: ""
ms.date: "03/30/2017"
ms.prod: ".net-framework"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "dotnet-clr"
ms.tgt_pltfrm: ""
ms.topic: "article"
helpviewer_keywords: 
  - "SQL Server [.NET Framework]"
  - "permission sets, SQL Server"
  - "SQL Server Programming and Host Protection Attributes"
  - "managed code, SQL Server"
  - "reliability [.NET Framework]"
  - "writing reliable code"
  - "hosts, reliability"
  - "host protection attributes"
  - "HostProtectionAttribute class, reliability"
ms.assetid: 7dfa36b4-e773-4c75-a3ff-ff1af3ce4c4f
caps.latest.revision: 13
author: "mairaw"
ms.author: "mairaw"
manager: "wpickett"
caps.handback.revision: 13
---
# SQL Server Programming and Host Protection Attributes
Per poter caricare ed eseguire codice gestito in un host SQL Server è necessario che siano soddisfatti i requisiti dell'host sia per la sicurezza dall'accesso di codice sia per la sicurezza delle risorse.  I requisiti di sicurezza dall'accesso di codice vengono specificati da uno dei tre set di autorizzazioni di SQL Server: SAFE, EXTERNAL\-ACCESS o UNSAFE.  Per eseguire il codice nell'ambito del set di autorizzazioni SAFE o EXTERNAL\-ACCESS, è necessario evitare alcuni tipi o membri a cui è applicato l'attributo <xref:System.Security.Permissions.HostProtectionAttribute>.  <xref:System.Security.Permissions.HostProtectionAttribute> rappresenta più una garanzia di affidabilità che non un'autorizzazione di sicurezza, in quanto identifica i costrutti di codice specifici, tipi o metodi, che possono essere disattivati dall'host.  L'utilizzo di <xref:System.Security.Permissions.HostProtectionAttribute> impone un modello di programmazione che consente di migliorare la stabilità dell'host.  
  
## Attributi di protezione host  
 Gli attributi di protezione host identificano i tipi o i membri non inclusi nel modello di programmazione host e rappresentano i livelli, riportati di seguito in ordine crescente di gravità, di pericolo per l'affidabilità:  
  
-   Sono altrimenti benigni.  
  
-   Possono determinare la destabilizzazione del codice utente gestito dal server.  
  
-   Possono determinare la destabilizzazione del processo del server.  
  
 SQL Server non consente l'utilizzo di un tipo o di un membro con un'istanza di <xref:System.Security.Permissions.HostProtectionAttribute> che specifica per <xref:System.Security.Permissions.HostProtectionResource> il valore <xref:System.Security.Permissions.HostProtectionResource>, <xref:System.Security.Permissions.HostProtectionResource>, <xref:System.Security.Permissions.HostProtectionResource> o <xref:System.Security.Permissions.HostProtectionResource>.  In questo modo si impedisce agli assembly di chiamare membri che attivano la condivisione dello stato, eseguono la sincronizzazione, possono determinare una perdita di risorse al momento della terminazione o influiscono sull'integrità del processo di SQL Server.  
  
### Membri e tipi non consentiti  
 Nella tabella riportata di seguito vengono identificati tipi e membri i cui valori di <xref:System.Security.Permissions.HostProtectionResource> non sono ammessi da SQL Server.  
  
|Spazio dei nomi|Tipo o membro|  
|---------------------|-------------------|  
|`Microsoft.Win32`|Classe <xref:Microsoft.Win32.PowerModeChangedEventArgs><br /><br /> Delegato <xref:Microsoft.Win32.PowerModeChangedEventHandler><br /><br /> Classe <xref:Microsoft.Win32.SessionEndedEventArgs><br /><br /> Delegato <xref:Microsoft.Win32.SessionEndedEventHandler><br /><br /> Classe <xref:Microsoft.Win32.SessionEndingEventArgs><br /><br /> Delegato <xref:Microsoft.Win32.SessionEndingEventHandler><br /><br /> Classe <xref:Microsoft.Win32.SessionSwitchEventArgs><br /><br /> Delegato <xref:Microsoft.Win32.SessionSwitchEventHandler><br /><br /> Classe <xref:Microsoft.Win32.SystemEvents><br /><br /> Classe <xref:Microsoft.Win32.TimerElapsedEventArgs><br /><br /> Delegato <xref:Microsoft.Win32.TimerElapsedEventHandler><br /><br /> Classe <xref:Microsoft.Win32.UserPreferenceChangedEventArgs><br /><br /> Classe <xref:Microsoft.Win32.UserPreferenceChangingEventArgs>|  
|`System.Collections`|Metodo <xref:System.Collections.ArrayList.Synchronized%2A?displayProperty=fullName><br /><br /> Metodo <xref:System.Collections.Hashtable.Synchronized%2A?displayProperty=fullName><br /><br /> Metodo <xref:System.Collections.Queue.Synchronized%2A?displayProperty=fullName><br /><br /> Metodo <xref:System.Collections.SortedList.Synchronized%2A?displayProperty=fullName><br /><br /> Metodo <xref:System.Collections.Stack.Synchronized%2A?displayProperty=fullName>|  
|`System.ComponentModel`|Classe <xref:System.ComponentModel.AddingNewEventArgs><br /><br /> Delegato <xref:System.ComponentModel.AddingNewEventHandler><br /><br /> Classe <xref:System.ComponentModel.ArrayConverter><br /><br /> Classe <xref:System.ComponentModel.AsyncCompletedEventArgs><br /><br /> Delegato <xref:System.ComponentModel.AsyncCompletedEventHandler><br /><br /> Classe <xref:System.ComponentModel.AsyncOperation><br /><br /> Classe <xref:System.ComponentModel.AsyncOperationManager><br /><br /> Classe <xref:System.ComponentModel.AttributeCollection><br /><br /> Classe <xref:System.ComponentModel.BackgroundWorker><br /><br /> Classe <xref:System.ComponentModel.BaseNumberConverter><br /><br /> Classe <xref:System.ComponentModel.BindingList%601><br /><br /> Classe <xref:System.ComponentModel.BooleanConverter><br /><br /> Classe <xref:System.ComponentModel.ByteConverter><br /><br /> Classe <xref:System.ComponentModel.CancelEventArgs><br /><br /> Delegato <xref:System.ComponentModel.CancelEventHandler><br /><br /> Classe <xref:System.ComponentModel.CharConverter><br /><br /> Classe <xref:System.ComponentModel.CollectionChangeEventArgs><br /><br /> Delegato <xref:System.ComponentModel.CollectionChangeEventHandler><br /><br /> Classe <xref:System.ComponentModel.CollectionConverter><br /><br /> Classe <xref:System.ComponentModel.ComponentCollection><br /><br /> Classe <xref:System.ComponentModel.ComponentConverter><br /><br /> Classe <xref:System.ComponentModel.ComponentEditor><br /><br /> Classe <xref:System.ComponentModel.ComponentResourceManager><br /><br /> Classe <xref:System.ComponentModel.Container><br /><br /> Classe <xref:System.ComponentModel.ContainerFilterService><br /><br /> Classe <xref:System.ComponentModel.CultureInfoConverter><br /><br /> Classe <xref:System.ComponentModel.CustomTypeDescriptor><br /><br /> Classe <xref:System.ComponentModel.DateTimeConverter><br /><br /> Classe <xref:System.ComponentModel.DecimalConverter><br /><br /> Classe <xref:System.ComponentModel.Design.ActiveDesignerEventArgs><br /><br /> Delegato <xref:System.ComponentModel.Design.ActiveDesignerEventHandler><br /><br /> Classe <xref:System.ComponentModel.Design.CheckoutException><br /><br /> Classe <xref:System.ComponentModel.Design.CommandID><br /><br /> Classe <xref:System.ComponentModel.Design.ComponentChangedEventArgs><br /><br /> Delegato <xref:System.ComponentModel.Design.ComponentChangedEventHandler><br /><br /> Classe <xref:System.ComponentModel.Design.ComponentChangingEventArgs><br /><br /> Delegato <xref:System.ComponentModel.Design.ComponentChangingEventHandler><br /><br /> Classe <xref:System.ComponentModel.Design.ComponentEventArgs><br /><br /> Delegato <xref:System.ComponentModel.Design.ComponentEventHandler><br /><br /> Classe <xref:System.ComponentModel.Design.ComponentRenameEventArgs><br /><br /> Delegato <xref:System.ComponentModel.Design.ComponentRenameEventHandler><br /><br /> Classe <xref:System.ComponentModel.Design.DesignerCollection><br /><br /> Classe <xref:System.ComponentModel.Design.DesignerEventArgs><br /><br /> Delegato <xref:System.ComponentModel.Design.DesignerEventHandler><br /><br /> Classe <xref:System.ComponentModel.Design.DesignerOptionService><br /><br /> Classe <xref:System.ComponentModel.Design.DesignerTransaction><br /><br /> Classe <xref:System.ComponentModel.Design.DesignerTransactionCloseEventArgs><br /><br /> Delegato <xref:System.ComponentModel.Design.DesignerTransactionCloseEventHandler><br /><br /> Classe <xref:System.ComponentModel.Design.DesignerVerb><br /><br /> Classe <xref:System.ComponentModel.Design.DesignerVerbCollection><br /><br /> Classe <xref:System.ComponentModel.Design.DesigntimeLicenseContext><br /><br /> Classe <xref:System.ComponentModel.Design.DesigntimeLicenseContextSerializer><br /><br /> Classe <xref:System.ComponentModel.Design.MenuCommand><br /><br /> Classe <xref:System.ComponentModel.Design.Serialization.ComponentSerializationService><br /><br /> Classe <xref:System.ComponentModel.Design.Serialization.ContextStack><br /><br /> Classe <xref:System.ComponentModel.Design.Serialization.DesignerLoader><br /><br /> Classe <xref:System.ComponentModel.Design.Serialization.InstanceDescriptor><br /><br /> Classe <xref:System.ComponentModel.Design.Serialization.MemberRelationshipService><br /><br /> Classe <xref:System.ComponentModel.Design.Serialization.ResolveNameEventArgs><br /><br /> Delegato <xref:System.ComponentModel.Design.Serialization.ResolveNameEventHandler><br /><br /> Classe <xref:System.ComponentModel.Design.Serialization.SerializationStore><br /><br /> Classe <xref:System.ComponentModel.Design.ServiceContainer><br /><br /> Delegato <xref:System.ComponentModel.Design.ServiceCreatorCallback><br /><br /> Classe <xref:System.ComponentModel.Design.StandardCommands><br /><br /> Classe <xref:System.ComponentModel.Design.StandardToolWindows><br /><br /> Classe <xref:System.ComponentModel.DoubleConverter><br /><br /> Classe <xref:System.ComponentModel.DoWorkEventArgs><br /><br /> Delegato <xref:System.ComponentModel.DoWorkEventHandler><br /><br /> Classe <xref:System.ComponentModel.EnumConverter><br /><br /> Classe <xref:System.ComponentModel.EventDescriptor><br /><br /> Classe <xref:System.ComponentModel.EventDescriptorCollection><br /><br /> Classe <xref:System.ComponentModel.EventHandlerList><br /><br /> Classe <xref:System.ComponentModel.ExpandableObjectConverter><br /><br /> Classe <xref:System.ComponentModel.HandledEventArgs><br /><br /> Delegato <xref:System.ComponentModel.HandledEventHandler><br /><br /> Classe <xref:System.ComponentModel.InstanceCreationEditor><br /><br /> Classe <xref:System.ComponentModel.Int16Converter><br /><br /> Classe <xref:System.ComponentModel.Int32Converter><br /><br /> Classe <xref:System.ComponentModel.Int64Converter><br /><br /> Classe <xref:System.ComponentModel.InvalidAsynchronousStateException><br /><br /> Classe <xref:System.ComponentModel.InvalidEnumArgumentException><br /><br /> Metodo <xref:System.ComponentModel.ISynchronizeInvoke.BeginInvoke%2A><br /><br /> Classe <xref:System.ComponentModel.License><br /><br /> Classe <xref:System.ComponentModel.LicenseContext><br /><br /> Classe <xref:System.ComponentModel.LicenseException><br /><br /> Classe <xref:System.ComponentModel.LicenseManager><br /><br /> Classe <xref:System.ComponentModel.LicenseProvider><br /><br /> Classe <xref:System.ComponentModel.LicFileLicenseProvider><br /><br /> Classe <xref:System.ComponentModel.ListChangedEventArgs><br /><br /> Delegato <xref:System.ComponentModel.ListChangedEventHandler><br /><br /> Classe <xref:System.ComponentModel.ListSortDescription><br /><br /> Classe <xref:System.ComponentModel.ListSortDescriptionCollection><br /><br /> Classe <xref:System.ComponentModel.MaskedTextProvider><br /><br /> Classe <xref:System.ComponentModel.MemberDescriptor><br /><br /> Classe <xref:System.ComponentModel.MultilineStringConverter><br /><br /> Classe <xref:System.ComponentModel.NestedContainer><br /><br /> Classe <xref:System.ComponentModel.NullableConverter><br /><br /> Classe <xref:System.ComponentModel.ProgressChangedEventArgs><br /><br /> Delegato <xref:System.ComponentModel.ProgressChangedEventHandler><br /><br /> Classe <xref:System.ComponentModel.PropertyChangedEventArgs><br /><br /> Delegato <xref:System.ComponentModel.PropertyChangedEventHandler><br /><br /> Classe <xref:System.ComponentModel.PropertyDescriptor><br /><br /> Classe <xref:System.ComponentModel.PropertyDescriptorCollection><br /><br /> Classe <xref:System.ComponentModel.ReferenceConverter><br /><br /> Classe <xref:System.ComponentModel.RefreshEventArgs><br /><br /> Delegato <xref:System.ComponentModel.RefreshEventHandler><br /><br /> Classe <xref:System.ComponentModel.RunWorkerCompletedEventArgs><br /><br /> Delegato <xref:System.ComponentModel.RunWorkerCompletedEventHandler><br /><br /> Classe <xref:System.ComponentModel.SByteConverter><br /><br /> Classe <xref:System.ComponentModel.SingleConverter><br /><br /> Classe <xref:System.ComponentModel.StringConverter><br /><br /> Classe <xref:System.ComponentModel.SyntaxCheck><br /><br /> Classe <xref:System.ComponentModel.TimeSpanConverter><br /><br /> Classe <xref:System.ComponentModel.TypeConverter><br /><br /> Classe <xref:System.ComponentModel.TypeDescriptionProvider><br /><br /> Classe <xref:System.ComponentModel.TypeDescriptor><br /><br /> Classe <xref:System.ComponentModel.TypeListConverter><br /><br /> Classe <xref:System.ComponentModel.UInt16Converter><br /><br /> Classe <xref:System.ComponentModel.UInt32Converter><br /><br /> Classe <xref:System.ComponentModel.UInt64Converter><br /><br /> Classe <xref:System.ComponentModel.WarningException><br /><br /> Classe <xref:System.ComponentModel.Win32Exception>|  
|`System.Diagnostics`|Proprietà <xref:System.Diagnostics.Debug.Listeners%2A?displayProperty=fullName><br /><br /> Proprietà <xref:System.Diagnostics.Trace.Listeners%2A?displayProperty=fullName><br /><br /> Proprietà <xref:System.Diagnostics.EventLog.SynchronizingObject%2A?displayProperty=fullName><br /><br /> Classe <xref:System.Diagnostics.ConsoleTraceListener><br /><br /> Classe <xref:System.Diagnostics.DefaultTraceListener><br /><br /> Classe <xref:System.Diagnostics.DelimitedListTraceListener><br /><br /> Classe <xref:System.Diagnostics.EventLogTraceListener><br /><br /> Classe <xref:System.Diagnostics.PerformanceCounter><br /><br /> Classe <xref:System.Diagnostics.PerformanceCounterCategory><br /><br /> Classe <xref:System.Diagnostics.Process><br /><br /> Classe <xref:System.Diagnostics.ProcessStartInfo><br /><br /> Classe <xref:System.Diagnostics.TextWriterTraceListener><br /><br /> Classe <xref:System.Diagnostics.TraceListener><br /><br /> Classe <xref:System.Diagnostics.XmlWriterTraceListener><br /><br /> Proprietà <xref:System.Diagnostics.TraceSource.Listeners%2A?displayProperty=fullName>|  
|`System.IO`|Metodo <xref:System.IO.Stream.Synchronized%2A?displayProperty=fullName><br /><br /> Metodo <xref:System.IO.TextReader.Synchronized%2A?displayProperty=fullName><br /><br /> Metodo <xref:System.IO.TextWriter.Synchronized%2A?displayProperty=fullName>|  
|`System.Reflection.Emit`|Classe <xref:System.Reflection.Emit.ConstructorBuilder><br /><br /> Classe <xref:System.Reflection.Emit.EventBuilder><br /><br /> Classe <xref:System.Reflection.Emit.FieldBuilder><br /><br /> Classe <xref:System.Reflection.Emit.MethodBuilder><br /><br /> Classe <xref:System.Reflection.Emit.CustomAttributeBuilder><br /><br /> Classe <xref:System.Reflection.Emit.MethodRental><br /><br /> Classe <xref:System.Reflection.Emit.ModuleBuilder><br /><br /> Classe <xref:System.Reflection.Emit.PropertyBuilder><br /><br /> Classe <xref:System.Reflection.Emit.TypeBuilder><br /><br /> Classe <xref:System.Reflection.Emit.UnmanagedMarshal>|  
|`System.Text`|Metodo <xref:System.Text.RegularExpressions.Group.Synchronized%2A?displayProperty=fullName><br /><br /> Metodo <xref:System.Text.RegularExpressions.Match.Synchronized%2A?displayProperty=fullName>|  
|`System.Threading`|Classe <xref:System.Threading.AutoResetEvent><br /><br /> Classe <xref:System.Threading.EventWaitHandle><br /><br /> Classe <xref:System.Threading.ManualResetEvent><br /><br /> Classe <xref:System.Threading.Monitor><br /><br /> Classe <xref:System.Threading.Mutex><br /><br /> Classe <xref:System.Threading.ReaderWriterLock><br /><br /> Classe <xref:System.Threading.Semaphore><br /><br /> Metodo <xref:System.Threading.Thread.AllocateNamedDataSlot%2A?displayProperty=fullName><br /><br /> Metodo <xref:System.Threading.Thread.BeginCriticalRegion%2A?displayProperty=fullName><br /><br /> Metodo <xref:System.Threading.Thread.EndCriticalRegion%2A?displayProperty=fullName><br /><br /> Metodo <xref:System.Threading.Thread.FreeNamedDataSlot%2A?displayProperty=fullName><br /><br /> Metodo <xref:System.Threading.Thread.GetData%2A?displayProperty=fullName><br /><br /> Metodo <xref:System.Threading.Thread.Join%2A?displayProperty=fullName><br /><br /> Metodo <xref:System.Threading.Thread.SetApartmentState%2A?displayProperty=fullName><br /><br /> Metodo <xref:System.Threading.Thread.SetData%2A?displayProperty=fullName><br /><br /> Metodo <xref:System.Threading.Thread.SpinWait%2A?displayProperty=fullName><br /><br /> Metodo <xref:System.Threading.Thread.Start%2A?displayProperty=fullName><br /><br /> Metodo <xref:System.Threading.Thread.TrySetApartmentState%2A?displayProperty=fullName><br /><br /> Classe <xref:System.Threading.ThreadPool><br /><br /> Classe <xref:System.Threading.Timer>|  
|`System.Timers`|Classe <xref:System.Timers.Timer>|  
|`System.Web.Configuration`|Classe <xref:System.Web.Configuration.MachineKeyValidationConverter>|  
|`System.Windows.Forms`|Proprietà <xref:System.Windows.Forms.AutoCompleteStringCollection.SyncRoot%2A?displayProperty=fullName>|  
  
## Set di autorizzazioni SQL Server  
 SQL Server consente agli utenti di specificare i requisiti di affidabilità relativi al codice distribuito in un database.  Una volta caricati gli assembly nel database, l'autore dell'assembly può specificare uno dei tre set di autorizzazioni, SAFE, EXTERNAL\-ACCESS o UNSAFE, per tale assembly.  
  
|Set di autorizzazioni|SAFE|EXTERNAL\-ACCESS|UNSAFE|  
|---------------------------|----------|----------------------|------------|  
|Sicurezza dall'accesso di codice|Sola esecuzione|Esecuzione \+ accesso alle risorse esterne|Illimitato|  
|Restrizioni del modello di programmazione|Yes|Yes|Nessuna restrizione|  
|Requisito di verificabilità|Yes|Yes|No|  
|Capacità di chiamata del codice nativo|No|No|Yes|  
  
 Con le restrizioni associate per il modello di programmazione consentito, SAFE rappresenta la modalità più affidabile e sicura.  Il codice SAFE dispone di funzionalità di sicurezza e affidabilità elevate.  Agli assembly SAFE vengono concesse autorizzazioni sufficienti per essere eseguiti, elaborare calcoli e accedere al database locale.  Questi assembly devono essere effettivamente indipendenti dai tipi e non possono chiamare codice non gestito.  
  
 EXTERNAL\-ACCESS, che fornisce un'opzione di sicurezza intermedia, consente al codice di accedere alle risorse esterne al database, offrendo lo stesso livello di affidabilità e protezione di SAFE.  
  
 UNSAFE è un set di autorizzazioni per codice estremamente attendibile, che può essere creato solo dagli amministratori di database.  Questo codice attendibile non presenta restrizioni di accesso al codice e può chiamare il codice non gestito \(nativo\).  
  
 SQL Server utilizza il livello dei criteri di sicurezza dall'accesso di codice a livello di host per impostare criteri host che concedono uno dei tre set di autorizzazioni in base a quello archiviato nei cataloghi di SQL Server.  Il codice gestito in esecuzione all'interno del database ottiene sempre uno di questi set di autorizzazioni di accesso al codice.  
  
## Restrizioni relative al modello di programmazione  
 Per il modello di programmazione relativo al codice gestito in SQL Server sono necessari tipi, funzioni e procedure che non richiedono l'utilizzo dello stato contenuto tra più chiamate né la condivisione dello stato tra più sessioni utente.  Inoltre, come descritto in precedenza, la presenza dello stato condiviso può determinare la generazione di eccezioni critiche che influiscono sulla scalabilità e l'affidabilità dell'applicazione.  
  
 In base a tali considerazioni, SQL Server non consente l'utilizzo di variabili o membri dati statici.  Per gli assembly SAFE ed EXTERNAL\-ACCESS, SQL Server esamina i metadati dell'assembly durante la fase CREATE ASSEMBLY e, se rileva la presenza di variabili e membri dati statici, impedisce la creazione di tali assembly.  
  
## Vedere anche  
 <xref:System.Security.Permissions.HostProtectionAttribute>   
 <xref:System.Security.Permissions.HostProtectionResource>