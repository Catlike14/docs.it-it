---
title: Partecipanti di persistenza
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: f84d2d5d-1c1b-4f19-be45-65b552d3e9e3
caps.latest.revision: "14"
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.workload: dotnet
ms.openlocfilehash: 5b85acf2e3c4d885988e92948481182b7cf8c32c
ms.sourcegitcommit: 16186c34a957fdd52e5db7294f291f7530ac9d24
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 12/22/2017
---
# <a name="persistence-participants"></a><span data-ttu-id="96c97-102">Partecipanti di persistenza</span><span class="sxs-lookup"><span data-stu-id="96c97-102">Persistence Participants</span></span>
<span data-ttu-id="96c97-103">Un partecipante di persistenza può far parte di un'operazione di persistenza (Save o Load) attivata da un'applicazione host.</span><span class="sxs-lookup"><span data-stu-id="96c97-103">A persistence participant can participate in a persistence operation (Save or Load) triggered by an application host.</span></span> <span data-ttu-id="96c97-104">Il [!INCLUDE[netfx_current_long](../../../includes/netfx-current-long-md.md)] sono disponibili due classi astratte, **PersistenceParticipant** e **PersistenceIOParticipant**, che è possibile utilizzare per creare un partecipante di persistenza.</span><span class="sxs-lookup"><span data-stu-id="96c97-104">The [!INCLUDE[netfx_current_long](../../../includes/netfx-current-long-md.md)] ships with two abstract classes, **PersistenceParticipant** and **PersistenceIOParticipant**, which you can use to create a persistence participant.</span></span> <span data-ttu-id="96c97-105">Un partecipante di persistenza deriva da una di queste classi, implementa i metodi di interesse, quindi aggiunge un'istanza della classe alla raccolta <xref:System.ServiceModel.Activities.WorkflowServiceHost.WorkflowExtensions%2A> nell'oggetto <xref:System.ServiceModel.Activities.WorkflowServiceHost>.</span><span class="sxs-lookup"><span data-stu-id="96c97-105">A persistence participant derives from one of these classes, implements the methods of interest, and then adds an instance of the class to the <xref:System.ServiceModel.Activities.WorkflowServiceHost.WorkflowExtensions%2A> collection on the <xref:System.ServiceModel.Activities.WorkflowServiceHost> .</span></span> <span data-ttu-id="96c97-106">L'applicazione host può cercare tali estensioni del flusso di lavoro quando rende persistente un'istanza del flusso di lavoro e richiamare metodi appropriati sui partecipanti di persistenza in momenti appropriati.</span><span class="sxs-lookup"><span data-stu-id="96c97-106">The application host may look for such workflow extensions when persisting a workflow instance and invoke appropriate methods on the persistence participants at appropriate times.</span></span>  
  
 <span data-ttu-id="96c97-107">Nell'elenco seguente vengono descritte le attività eseguite dal sottosistema di persistenza in fasi diverse dell'operazione Persist (Save).</span><span class="sxs-lookup"><span data-stu-id="96c97-107">The following list describes the tasks performed by the persistence subsystem in different stages of the Persist (Save) operation.</span></span> <span data-ttu-id="96c97-108">I partecipanti di persistenza vengono usati nella terza e quarta fase.</span><span class="sxs-lookup"><span data-stu-id="96c97-108">The persistence participants are used in the third and fourth stages.</span></span> <span data-ttu-id="96c97-109">Se il partecipante è un partecipante di IO, ovvero un partecipante di persistenza che fa parte anche di operazioni di IO, viene usato anche nella sesta fase.</span><span class="sxs-lookup"><span data-stu-id="96c97-109">If the participant is an IO participant (a persistence participant that also participates in IO operations), the participant is also used in the sixth stage.</span></span>  
  
1.  <span data-ttu-id="96c97-110">Raccoglie i valori predefiniti, inclusi lo stato del flusso di lavoro, i segnalibri, le variabili mappate e il timestamp.</span><span class="sxs-lookup"><span data-stu-id="96c97-110">Gathers built-in values, including workflow state, bookmarks, mapped variables, and timestamp.</span></span>  
  
2.  <span data-ttu-id="96c97-111">Raccoglie tutti i partecipanti di persistenza aggiunti alla raccolta di estensioni associata all'istanza del flusso di lavoro.</span><span class="sxs-lookup"><span data-stu-id="96c97-111">Gathers all persistence participants that were added to the extension collection associated with the workflow instance.</span></span>  
  
3.  <span data-ttu-id="96c97-112">Richiama il metodo <xref:System.Activities.Persistence.PersistenceParticipant.CollectValues%2A> implementato da tutti i partecipanti di persistenza.</span><span class="sxs-lookup"><span data-stu-id="96c97-112">Invokes the <xref:System.Activities.Persistence.PersistenceParticipant.CollectValues%2A> method implemented by all persistence participants.</span></span>  
  
4.  <span data-ttu-id="96c97-113">Richiama il metodo <xref:System.Activities.Persistence.PersistenceParticipant.MapValues%2A> implementato da tutti i partecipanti di persistenza.</span><span class="sxs-lookup"><span data-stu-id="96c97-113">Invokes the <xref:System.Activities.Persistence.PersistenceParticipant.MapValues%2A> method implemented by all persistence participants.</span></span>  
  
5.  <span data-ttu-id="96c97-114">Rende persistente o salva il flusso di lavoro nell'archivio di persistenza.</span><span class="sxs-lookup"><span data-stu-id="96c97-114">Persist or save the workflow into the persistence store.</span></span>  
  
6.  <span data-ttu-id="96c97-115">Richiama il metodo <xref:System.Activities.Persistence.PersistenceIOParticipant.BeginOnSave%2A> su tutti i partecipanti di IO di persistenza.</span><span class="sxs-lookup"><span data-stu-id="96c97-115">Invokes the <xref:System.Activities.Persistence.PersistenceIOParticipant.BeginOnSave%2A> method on all of the persistence IO participants.</span></span> <span data-ttu-id="96c97-116">Se il partecipante non è un partecipante di IO, questa attività viene ignorata.</span><span class="sxs-lookup"><span data-stu-id="96c97-116">If the participant is not an IO participant, this task is skipped.</span></span> <span data-ttu-id="96c97-117">Se l'episodio di persistenza è transazionale, la transazione viene fornita nella proprietà Transaction.Current.</span><span class="sxs-lookup"><span data-stu-id="96c97-117">If the persistence episode is transactional, the transaction is provided in Transaction.Current property.</span></span>  
  
7.  <span data-ttu-id="96c97-118">Attende il completamento di tutti i partecipanti di persistenza.</span><span class="sxs-lookup"><span data-stu-id="96c97-118">Waits for all persistence participants to complete.</span></span> <span data-ttu-id="96c97-119">Se tutti i partecipanti riescono a rendere persistenti i dati dell'istanza, esegue il commit della transazione.</span><span class="sxs-lookup"><span data-stu-id="96c97-119">If all the participants succeed in persisting instance data, commits the transaction.</span></span>  
  
 <span data-ttu-id="96c97-120">Un partecipante di persistenza deriva il **PersistenceParticipant** classe e può implementare il **CollectValues** e **MapValues** metodi.</span><span class="sxs-lookup"><span data-stu-id="96c97-120">A persistence participant derives from the **PersistenceParticipant** class and may implement the **CollectValues** and **MapValues** methods.</span></span> <span data-ttu-id="96c97-121">Un partecipante di IO di persistenza deriva dal **PersistenceIOParticipant** classe e può implementare il **BeginOnSave** metodo oltre all'implementazione di **CollectValues**e **MapValues** metodi.</span><span class="sxs-lookup"><span data-stu-id="96c97-121">A persistence IO participant derives from the **PersistenceIOParticipant** class and may implement the **BeginOnSave** method in addition to implementing the **CollectValues** and **MapValues** methods.</span></span>  
  
 <span data-ttu-id="96c97-122">Ogni fase viene completata prima dell'inizio della fase successiva.</span><span class="sxs-lookup"><span data-stu-id="96c97-122">Each stage is completed before the next stage begins.</span></span> <span data-ttu-id="96c97-123">Ad esempio, i valori vengono raccolti da **tutti** i partecipanti di persistenza nella prima fase.</span><span class="sxs-lookup"><span data-stu-id="96c97-123">For example, values are collected from **all** persistence participants in the first stage.</span></span> <span data-ttu-id="96c97-124">Quindi tutti i valori raccolti nella prima fase vengono forniti a tutti i partecipanti di persistenza nella seconda fase per il mapping.</span><span class="sxs-lookup"><span data-stu-id="96c97-124">Then all the values collected in the first stage are provided to all persistence participants in the second stage for mapping.</span></span> <span data-ttu-id="96c97-125">Successivamente tutti i valori raccolti e mappati nella prima e seconda fase vengono forniti al provider di persistenza nella terza fase e così via.</span><span class="sxs-lookup"><span data-stu-id="96c97-125">Then all the values collected and mapped in the first and second stages are provided to the persistence provider in the third stage, and so on.</span></span>  
  
 <span data-ttu-id="96c97-126">Nell'elenco seguente vengono descritte le attività eseguite dal sottosistema di persistenza in fasi diverse dell'operazione Load.</span><span class="sxs-lookup"><span data-stu-id="96c97-126">The following list describes the tasks performed by the persistence subsystem in different stages of the Load operation.</span></span> <span data-ttu-id="96c97-127">I partecipanti di persistenza vengono usati nella quarta fase.</span><span class="sxs-lookup"><span data-stu-id="96c97-127">The persistence participants are used in the fourth stage.</span></span> <span data-ttu-id="96c97-128">I partecipanti di IO di persistenza, ovvero i partecipanti di persistenza che fanno parte anche di operazioni di IO, vengono usati anche nella terza fase.</span><span class="sxs-lookup"><span data-stu-id="96c97-128">The persistence IO participants (persistence participants that also participate in IO operations) are also used in the third stage.</span></span>  
  
1.  <span data-ttu-id="96c97-129">Raccoglie tutti i partecipanti di persistenza aggiunti alla raccolta di estensioni associata all'istanza del flusso di lavoro.</span><span class="sxs-lookup"><span data-stu-id="96c97-129">Gathers all persistence participants that were added to the extension collection associated with the workflow instance.</span></span>  
  
2.  <span data-ttu-id="96c97-130">Carica il flusso di lavoro dall'archivio di persistenza.</span><span class="sxs-lookup"><span data-stu-id="96c97-130">Loads the workflow from the persistence store.</span></span>  
  
3.  <span data-ttu-id="96c97-131">Richiama il metodo <xref:System.Activities.Persistence.PersistenceIOParticipant.BeginOnLoad%2A> su tutti i partecipanti di IO di persistenza e attende il completamento di tutti i partecipanti di persistenza.</span><span class="sxs-lookup"><span data-stu-id="96c97-131">Invokes the <xref:System.Activities.Persistence.PersistenceIOParticipant.BeginOnLoad%2A> on all persistence IO participants and waits for all the persistence participants to complete.</span></span> <span data-ttu-id="96c97-132">Se l'episodio di persistenza è transazionale, la transazione viene fornita nell'oggetto Transaction.Current.</span><span class="sxs-lookup"><span data-stu-id="96c97-132">If the persistence episode is transactional, the transaction is provided in Transaction.Current.</span></span>  
  
4.  <span data-ttu-id="96c97-133">Carica l'istanza del flusso di lavoro in memoria in base ai dati recuperati dall'archivio di persistenza.</span><span class="sxs-lookup"><span data-stu-id="96c97-133">Loads the workflow instance in memory based on the data retrieved from the persistence store.</span></span>  
  
5.  <span data-ttu-id="96c97-134">Richiama il metodo <xref:System.Activities.Persistence.PersistenceParticipant.PublishValues%2A> su ogni partecipante di persistenza.</span><span class="sxs-lookup"><span data-stu-id="96c97-134">Invokes <xref:System.Activities.Persistence.PersistenceParticipant.PublishValues%2A> on each persistence participant.</span></span>  
  
 <span data-ttu-id="96c97-135">Un partecipante di persistenza deriva il **PersistenceParticipant** classe e può implementare il **PublishValues** metodo.</span><span class="sxs-lookup"><span data-stu-id="96c97-135">A persistence participant derives from the **PersistenceParticipant** class and may implement the **PublishValues** method.</span></span> <span data-ttu-id="96c97-136">Un partecipante di IO di persistenza deriva dal **PersistenceIOParticipant** classe e può implementare il **BeginOnLoad** metodo oltre all'implementazione di **PublishValues**metodo.</span><span class="sxs-lookup"><span data-stu-id="96c97-136">A persistence IO participant derives from the **PersistenceIOParticipant** class and may implement the **BeginOnLoad** method in addition to implementing the **PublishValues** method.</span></span>  
  
 <span data-ttu-id="96c97-137">Quando si carica un'istanza del flusso di lavoro, il provider di persistenza crea un blocco su tale istanza.</span><span class="sxs-lookup"><span data-stu-id="96c97-137">When loading a workflow instance the persistence provider creates a lock on that instance.</span></span> <span data-ttu-id="96c97-138">In questo modo l'istanza non può essere caricata da più di un host in uno scenario che presenta molteplici nodi.</span><span class="sxs-lookup"><span data-stu-id="96c97-138">This prevents the instance from being loaded by more than one host in a multi-node scenario.</span></span> <span data-ttu-id="96c97-139">Se si tenta di caricare un'istanza del flusso di lavoro che è stata bloccata, si verrà generata un'eccezione simile al seguente: l'eccezione "InstanceLockException: Impossibile completare l'operazione richiesta perché il blocco per l'istanza ' 00000000-0000-0000-0000-000000000000' non è possibile acquisire ".</span><span class="sxs-lookup"><span data-stu-id="96c97-139">If you attempt to load a workflow instance that has been locked you will see an exception like the following: The exception " System.ServiceModel.Persistence.InstanceLockException: The requested operation could not complete because the lock for instance '00000000-0000-0000-0000-000000000000' could not be acquired".</span></span> <span data-ttu-id="96c97-140">Generalmente questo errore si verifica in presenza di una delle seguenti condizioni:</span><span class="sxs-lookup"><span data-stu-id="96c97-140">This error is caused when one of the following occurs:</span></span>  
  
-   <span data-ttu-id="96c97-141">In uno scenario a molteplici nodi l'istanza viene caricata da un altro host.</span><span class="sxs-lookup"><span data-stu-id="96c97-141">In a multi-node scenario the instance is loaded by another host.</span></span>  <span data-ttu-id="96c97-142">Esistono alcuni modi per risolvere questi tipi di conflitti: inoltrare l'elaborazione al nodo proprietario del blocco e tentare o forzare il caricamento, che impedirà all'altro host di salvare il lavoro.</span><span class="sxs-lookup"><span data-stu-id="96c97-142">There are a few different ways to resolve these types of conflicts: forward the processing to the node which owns the lock and retry, or force the load which will cause the other host to be unable to save their work.</span></span>  
  
-   <span data-ttu-id="96c97-143">In uno scenario a nodo singolo l'host si è arrestato in modo anomalo.</span><span class="sxs-lookup"><span data-stu-id="96c97-143">In a single-node scenario and the host crashed.</span></span>  <span data-ttu-id="96c97-144">Quando un host viene riavviato (riciclo di un processo o creando una nuova factory del provider di persistenza), il nuovo host tenta di caricare un'istanza che però è ancora bloccata dall'host precedente poiché il blocco non è ancora scaduto.</span><span class="sxs-lookup"><span data-stu-id="96c97-144">When the host starts up again (a process recycle or creating a new persistence provider factory) the new host attempts to load an instance which is still locked by the old host because the lock hasn't expired yet.</span></span>  
  
-   <span data-ttu-id="96c97-145">In uno scenario a nodo singolo, l'istanza in questione è stata interrotta a un certo punto e viene creata una nuova istanza del provider di persistenza con un ID host differente.</span><span class="sxs-lookup"><span data-stu-id="96c97-145">In a single-node scenario and the instance in question was aborted at some point and a new persistence provider instance is created which has a different host ID.</span></span>  
  
 <span data-ttu-id="96c97-146">Il valore di timeout del blocco predefinito è 5 minuti; è possibile specificare un valore di timeout diverso quando viene chiamato il metodo <xref:System.ServiceModel.Persistence.PersistenceProvider.Load%2A>.</span><span class="sxs-lookup"><span data-stu-id="96c97-146">The lock timeout value has a default value of 5 minutes, you can specify a different timeout value when calling <xref:System.ServiceModel.Persistence.PersistenceProvider.Load%2A>.</span></span>  
  
## <a name="in-this-section"></a><span data-ttu-id="96c97-147">In questa sezione</span><span class="sxs-lookup"><span data-stu-id="96c97-147">In This Section</span></span>  
  
-   [<span data-ttu-id="96c97-148">Procedura: Creare un partecipante di persistenza personalizzato</span><span class="sxs-lookup"><span data-stu-id="96c97-148">How to: Create a Custom Persistence Participant</span></span>](../../../docs/framework/windows-workflow-foundation/how-to-create-a-custom-persistence-participant.md)  
  
## <a name="see-also"></a><span data-ttu-id="96c97-149">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="96c97-149">See Also</span></span>  
 [<span data-ttu-id="96c97-150">Estendibilità dell'archivio</span><span class="sxs-lookup"><span data-stu-id="96c97-150">Store Extensibility</span></span>](../../../docs/framework/windows-workflow-foundation/store-extensibility.md)
