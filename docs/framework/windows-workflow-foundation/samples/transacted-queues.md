---
title: Code transazionali
ms.date: 03/30/2017
ms.assetid: b1b011dd-5e0b-482c-9bb0-9d8727038f14
ms.openlocfilehash: db6a9686334eefb02b9360827a23ca8363127eb5
ms.sourcegitcommit: a885cc8c3e444ca6471348893d5373c6e9e49a47
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 09/06/2018
ms.locfileid: "44048029"
---
# <a name="transacted-queues"></a><span data-ttu-id="6c498-102">Code transazionali</span><span class="sxs-lookup"><span data-stu-id="6c498-102">Transacted Queues</span></span>
<span data-ttu-id="6c498-103">In questo esempio viene illustrato come integrare code e transazioni in Windows Workflow Foundation (WF) per creare servizi affidabili e scalabili.</span><span class="sxs-lookup"><span data-stu-id="6c498-103">This sample shows how to integrate queues and transactions in Windows Workflow Foundation (WF) to create reliable and scalable services.</span></span> <span data-ttu-id="6c498-104">Oggetto <!--zz <xref:System.Activities.TransactionScope>--> `System.Activities.TransactionScope` viene usato nel flusso di lavoro client per inviare messaggi a una coda in una transazione tramite la <xref:System.ServiceModel.NetMsmqBinding>.</span><span class="sxs-lookup"><span data-stu-id="6c498-104">A <!--zz <xref:System.Activities.TransactionScope>--> `System.Activities.TransactionScope` is used in the client workflow to send message to a queue under a transaction using the <xref:System.ServiceModel.NetMsmqBinding>.</span></span> <span data-ttu-id="6c498-105">Un oggetto <xref:System.ServiceModel.Activities.TransactedReceiveScope> viene usato nel server per ricevere messaggi dalla coda e aggiornare lo stato del flusso di lavoro nella stessa transazione.</span><span class="sxs-lookup"><span data-stu-id="6c498-105">A <xref:System.ServiceModel.Activities.TransactedReceiveScope> is used on the server to receive messages from the queue and update the state of the workflow under the same transaction.</span></span>  
  
## <a name="demonstrates"></a><span data-ttu-id="6c498-106">Dimostrazione</span><span class="sxs-lookup"><span data-stu-id="6c498-106">Demonstrates</span></span>  
 <span data-ttu-id="6c498-107"><xref:System.Activities.Statements.TransactionScope>, <xref:System.ServiceModel.Activities.TransactedReceiveScope>, <xref:System.ServiceModel.NetMsmqBinding>, <xref:System.ServiceModel.Activities.Receive> e correlazione basata sul contenuto.</span><span class="sxs-lookup"><span data-stu-id="6c498-107"><xref:System.Activities.Statements.TransactionScope>, <xref:System.ServiceModel.Activities.TransactedReceiveScope>, <xref:System.ServiceModel.NetMsmqBinding>, <xref:System.ServiceModel.Activities.Receive>, and content-based correlation.</span></span>  
  
## <a name="discussion"></a><span data-ttu-id="6c498-108">Discussione</span><span class="sxs-lookup"><span data-stu-id="6c498-108">Discussion</span></span>  
 <span data-ttu-id="6c498-109">Per illustrare le funzionalità analizzate in questo esempio, viene creato un servizio flusso di lavoro `RewardsPoints` che tiene traccia dei punti guadagnati e usati per un account specificato.</span><span class="sxs-lookup"><span data-stu-id="6c498-109">To demonstrate the features covered in this sample, a `RewardsPoints` workflow service is created, which keeps track of the points earned and used for a given account.</span></span> <span data-ttu-id="6c498-110">Il client usa l'oggetto <xref:System.Activities.WorkflowInvoker> per simulare l'invio di varie richieste alla coda.</span><span class="sxs-lookup"><span data-stu-id="6c498-110">The client uses <xref:System.Activities.WorkflowInvoker> to simulate posting various requests to the queue.</span></span> <span data-ttu-id="6c498-111">Per inviare un messaggio alla coda in una transazione, l'attività <xref:System.ServiceModel.Activities.Send> può essere posizionata all'interno della proprietà <xref:System.Activities.Statements.TransactionScope.Body%2A> di un oggetto <xref:System.Activities.Statements.TransactionScope>.</span><span class="sxs-lookup"><span data-stu-id="6c498-111">To post a message to the queue under a transaction, the <xref:System.ServiceModel.Activities.Send> activity can be placed inside the <xref:System.Activities.Statements.TransactionScope.Body%2A> of a <xref:System.Activities.Statements.TransactionScope>.</span></span> <span data-ttu-id="6c498-112">In questo esempio, viene eseguito prima il client, quindi il server, per illustrare come i messaggi in coda possono decuplicare le applicazioni client e quelle server.</span><span class="sxs-lookup"><span data-stu-id="6c498-112">In this sample, the client runs first, followed by the server, to demonstrate how queued messages can decouple the client and server applications.</span></span>  
  
 <span data-ttu-id="6c498-113">Una volta completato il client, il servizio viene configurato e ospitato.</span><span class="sxs-lookup"><span data-stu-id="6c498-113">Once the client completes, the service is configured and hosted.</span></span> <span data-ttu-id="6c498-114">Appena viene visualizzato, avvia l'elaborazione dei messaggi già posizionati nella coda.</span><span class="sxs-lookup"><span data-stu-id="6c498-114">As soon as it opens, it starts processing the messages that have already been placed in the queue.</span></span> <span data-ttu-id="6c498-115">Ogni messaggio viene ricevuto ed elaborato nella stessa transazione server.</span><span class="sxs-lookup"><span data-stu-id="6c498-115">Each message is received and processed under the same server transaction.</span></span> <span data-ttu-id="6c498-116">In questo esempio, il primo messaggio ricevuto è una richiesta `CreateAccount` che crea l'istanza e inizializza la correlazione del contenuto in base al nome dell'account passato come parte del messaggio di richiesta.</span><span class="sxs-lookup"><span data-stu-id="6c498-116">In this sample, the first message received is a `CreateAccount` request that creates the instance and initializes the content correlation based on the account name passed as part of the request message.</span></span> <span data-ttu-id="6c498-117">Per modellare un tipo di servizio prevedibile nel mondo reale, le due seguenti attività <xref:System.ServiceModel.Activities.TransactedReceiveScope> che elaborano i messaggi `AddPoints` e `UsePoints` sono posizionate nei rami paralleli all'interno di un ciclo `while`, in modo che possano elaborare ripetutamente questi messaggi in qualsiasi ordine.</span><span class="sxs-lookup"><span data-stu-id="6c498-117">To model the kind of service you might expect in the real world, the following two <xref:System.ServiceModel.Activities.TransactedReceiveScope> activities that process the `AddPoints` and `UsePoints` messages are placed in parallel branches within a `while` loop so that they can process these messages repeatedly in any order.</span></span>  
  
 <span data-ttu-id="6c498-118"><xref:System.Activities.Statements.TransactionScope> e <xref:System.ServiceModel.Activities.TransactedReceiveScope> dispongono ognuno di un punto di persistenza implicito alla fine dei relativi ambiti, pertanto l'uso di queste attività in [!INCLUDE[wf1](../../../../includes/wf1-md.md)] in combinazione con le code è un modo affidabile per spostare il flusso di lavoro da uno stato coerente al successivo, assicurando che i messaggi non vengano mai persi.</span><span class="sxs-lookup"><span data-stu-id="6c498-118"><xref:System.Activities.Statements.TransactionScope> and <xref:System.ServiceModel.Activities.TransactedReceiveScope> each have an implicit persistence point at the end of their scopes, so using these activities in [!INCLUDE[wf1](../../../../includes/wf1-md.md)] combined with queues is a reliable way to move your workflow from one consistent state to the next, while ensuring that messages are never lost.</span></span>  
  
#### <a name="to-set-up-build-and-run-the-sample"></a><span data-ttu-id="6c498-119">Per impostare, compilare ed eseguire l'esempio</span><span class="sxs-lookup"><span data-stu-id="6c498-119">To set up, build, and run the sample</span></span>  
  
1.  <span data-ttu-id="6c498-120">Installare e configurare MSMQ.</span><span class="sxs-lookup"><span data-stu-id="6c498-120">Install and configure MSMQ.</span></span> <span data-ttu-id="6c498-121">Visualizzare [installazione di Accodamento](https://go.microsoft.com/fwlink/?LinkId=178526) per informazioni dettagliate.</span><span class="sxs-lookup"><span data-stu-id="6c498-121">See [Installing Message Queuing](https://go.microsoft.com/fwlink/?LinkId=178526) for details.</span></span>  
  
2.  <span data-ttu-id="6c498-122">Assicurarsi che MSDTC sia in funzione eseguendo il comando seguente su una riga di comando</span><span class="sxs-lookup"><span data-stu-id="6c498-122">Ensure that MSDTC is running by executing the following command on a command line.</span></span> `net start msdtc`  
  
3.  <span data-ttu-id="6c498-123">Compilare il progetto e aprire il file eseguibile oppure aprire il progetto in [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)] e selezionare un'opzione di avvio dal menu Debug.</span><span class="sxs-lookup"><span data-stu-id="6c498-123">Compile the project and open the executable, or open the project in [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)] and select a start option from the debug menu.</span></span> <span data-ttu-id="6c498-124">Innanzitutto viene creata la coda, quindi viene eseguito il client e vengono inviati messaggi alla coda, infine viene avviato il servizio e vengono elaborati i messaggi.</span><span class="sxs-lookup"><span data-stu-id="6c498-124">First, the queue is created, then the client runs and posts messages to the queue, and finally the service starts and the messages are processed.</span></span> <span data-ttu-id="6c498-125">Per uscire dal programma, premere INVIO.</span><span class="sxs-lookup"><span data-stu-id="6c498-125">To exit the program, press ENTER.</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="6c498-126">È possibile che gli esempi siano già installati nel computer.</span><span class="sxs-lookup"><span data-stu-id="6c498-126">The samples may already be installed on your machine.</span></span> <span data-ttu-id="6c498-127">Verificare la directory seguente (impostazione predefinita) prima di continuare.</span><span class="sxs-lookup"><span data-stu-id="6c498-127">Check for the following (default) directory before continuing.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples`  
>   
>  <span data-ttu-id="6c498-128">Se questa directory non esiste, andare al [Windows Communication Foundation (WCF) e gli esempi di Windows Workflow Foundation (WF) per .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780) per scaricare tutti i Windows Communication Foundation (WCF) e [!INCLUDE[wf1](../../../../includes/wf1-md.md)] esempi.</span><span class="sxs-lookup"><span data-stu-id="6c498-128">If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples.</span></span> <span data-ttu-id="6c498-129">Questo esempio si trova nella directory seguente.</span><span class="sxs-lookup"><span data-stu-id="6c498-129">This sample is located in the following directory.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples\WF\Scenario\Transactions\TransactedQueues`
