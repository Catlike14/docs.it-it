---
title: Traccia attività relative alla protezione dei messaggi
ms.date: 03/30/2017
ms.assetid: 68862534-3b2e-4270-b097-8121b12a2c97
author: BrucePerlerMS
manager: mbaldwin
ms.openlocfilehash: 31882dfff746aa8e0e45698f70b0f19ae413d66a
ms.sourcegitcommit: 3d5d33f384eeba41b2dff79d096f47ccc8d8f03d
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 05/04/2018
ms.locfileid: "33474857"
---
# <a name="activity-tracing-in-message-security"></a><span data-ttu-id="2f5a9-102">Traccia attività relative alla protezione dei messaggi</span><span class="sxs-lookup"><span data-stu-id="2f5a9-102">Activity Tracing in Message Security</span></span>
<span data-ttu-id="2f5a9-103">Questo argomento descrive la traccia attività per l'elaborazione delle operazioni di sicurezza, che si articola nelle tre fasi seguenti.</span><span class="sxs-lookup"><span data-stu-id="2f5a9-103">This topic describes activity tracing for security processing, which happens in the following three phases.</span></span>  
  
-   <span data-ttu-id="2f5a9-104">Scambio negoziazione/SCT:</span><span class="sxs-lookup"><span data-stu-id="2f5a9-104">Negotiation/SCT exchange.</span></span> <span data-ttu-id="2f5a9-105">questa fase può verificarsi a livello di trasporto (tramite lo scambio di dati binari) o a livello di messaggio (tramite lo scambio di messaggi SOAP).</span><span class="sxs-lookup"><span data-stu-id="2f5a9-105">This can happen at the transport later (through binary data exchange) or message layer (through SOAP message exchanges).</span></span>  
  
-   <span data-ttu-id="2f5a9-106">Crittografia/decrittografia dei messaggi (con verifica della firma e autenticazione):</span><span class="sxs-lookup"><span data-stu-id="2f5a9-106">Message encryption/decryption, with signature verification and authentication.</span></span> <span data-ttu-id="2f5a9-107">le tracce vengono riportate nell'attività di ambiente, che in genere è l'attività ProcessAction.</span><span class="sxs-lookup"><span data-stu-id="2f5a9-107">Traces appear in the ambient activity, typically "Process Action."</span></span>  
  
-   <span data-ttu-id="2f5a9-108">Autorizzazione e verifica:</span><span class="sxs-lookup"><span data-stu-id="2f5a9-108">Authorization and verification.</span></span> <span data-ttu-id="2f5a9-109">questa fase può verificarsi localmente oppure durante la comunicazione tra endpoint.</span><span class="sxs-lookup"><span data-stu-id="2f5a9-109">This can happen locally or when communicating between endpoints.</span></span>  
  
## <a name="negotiationsct-exchange"></a><span data-ttu-id="2f5a9-110">Scambio negoziazione/SCT</span><span class="sxs-lookup"><span data-stu-id="2f5a9-110">Negotiation/SCT exchange</span></span>  
 <span data-ttu-id="2f5a9-111">La fase di scambio negoziazione/SCT prevede la creazione di due tipi di attività nel client: l'impostazione della sessione di sicurezza e la chiusura della sessione protetta.</span><span class="sxs-lookup"><span data-stu-id="2f5a9-111">In the negotiation/SCT exchange phase, two activity types are created on the client: "Set up Secure Session" and "Close Secure Session."</span></span> <span data-ttu-id="2f5a9-112">La prima attività contiene le tracce relative agli scambi di messaggi RST/RSTR/SCT mentre la seconda contiene le tracce relative al messaggio di annullamento.</span><span class="sxs-lookup"><span data-stu-id="2f5a9-112">"Set up Secure Session" encompasses traces for the RST/RSTR/SCT message exchanges, while "Close Secure Session" includes traces for the Cancel message.</span></span>  
  
 <span data-ttu-id="2f5a9-113">Nel server, ogni request/reply degli scambi RST/RSTR/SCT viene visualizzato nella propria attività.</span><span class="sxs-lookup"><span data-stu-id="2f5a9-113">On the server, each request/reply for the RST/RSTR/SCT appears in its own activity.</span></span> <span data-ttu-id="2f5a9-114">Se `propagateActivity` = `true` server sia nel client, hanno lo stesso ID attività del server e vengono incluse nella "impostazione sessione di sicurezza" quando viene visualizzato tramite Service Trace Viewer.</span><span class="sxs-lookup"><span data-stu-id="2f5a9-114">If `propagateActivity`=`true` on both the server and client, activities on the server have the same ID, and appear together in the "Setup Secure Session" when viewed through Service Trace Viewer.</span></span>  
  
 <span data-ttu-id="2f5a9-115">Questo modello di traccia attività è valido per le autenticazioni basate su nome/password, certificato o NTLM.</span><span class="sxs-lookup"><span data-stu-id="2f5a9-115">This activity tracing model is valid for user name/password authentication, certificate authentication, and NTLM authentication.</span></span>  
  
 <span data-ttu-id="2f5a9-116">Nella tabella seguente sono elencate le attività e le tracce relative allo scambio negoziazione/SCT.</span><span class="sxs-lookup"><span data-stu-id="2f5a9-116">The following table lists the activities and traces for negotiation and SCT exchange.</span></span>  
  
||<span data-ttu-id="2f5a9-117">Contesto in cui si verifica lo scambio negoziazione/SCT</span><span class="sxs-lookup"><span data-stu-id="2f5a9-117">Time when Negotiation/SCT exchange happens</span></span>|<span data-ttu-id="2f5a9-118">Attività</span><span class="sxs-lookup"><span data-stu-id="2f5a9-118">Activities</span></span>|<span data-ttu-id="2f5a9-119">Tracce</span><span class="sxs-lookup"><span data-stu-id="2f5a9-119">Traces</span></span>|  
|-|-------------------------------------------------|----------------|------------|  
|<span data-ttu-id="2f5a9-120">Protezione a livello di trasporto</span><span class="sxs-lookup"><span data-stu-id="2f5a9-120">Secure Transport</span></span><br /><br /> <span data-ttu-id="2f5a9-121">(HTTPS, SSL)</span><span class="sxs-lookup"><span data-stu-id="2f5a9-121">(HTTPS, SSL)</span></span>|<span data-ttu-id="2f5a9-122">Alla ricezione del primo messaggio.</span><span class="sxs-lookup"><span data-stu-id="2f5a9-122">On first message received.</span></span>|<span data-ttu-id="2f5a9-123">Le tracce vengono generate nell'attività di ambiente.</span><span class="sxs-lookup"><span data-stu-id="2f5a9-123">Traces are emitted in the ambient activity.</span></span>|<span data-ttu-id="2f5a9-124">-Scambio di tracce</span><span class="sxs-lookup"><span data-stu-id="2f5a9-124">-   Exchange traces</span></span><br /><span data-ttu-id="2f5a9-125">-Canale sicuro stabilito</span><span class="sxs-lookup"><span data-stu-id="2f5a9-125">-   Secure channel established</span></span><br /><span data-ttu-id="2f5a9-126">-Condividere l'ottenimento dei segreti.</span><span class="sxs-lookup"><span data-stu-id="2f5a9-126">-   Share secrets obtained.</span></span>|  
|<span data-ttu-id="2f5a9-127">Protezione a livello di messaggio</span><span class="sxs-lookup"><span data-stu-id="2f5a9-127">Secure Message Layer</span></span><br /><br /> <span data-ttu-id="2f5a9-128">(WSHTTP)</span><span class="sxs-lookup"><span data-stu-id="2f5a9-128">(WSHTTP)</span></span>|<span data-ttu-id="2f5a9-129">Alla ricezione del primo messaggio.</span><span class="sxs-lookup"><span data-stu-id="2f5a9-129">On first message received.</span></span>|<span data-ttu-id="2f5a9-130">Nel client:</span><span class="sxs-lookup"><span data-stu-id="2f5a9-130">On the client:</span></span><br /><br /> <span data-ttu-id="2f5a9-131">-"Il programma di installazione sessione protetta" da "Elaborazione azione" di questo primo messaggio per ogni request/reply degli scambi RST/RSTR/SCT.</span><span class="sxs-lookup"><span data-stu-id="2f5a9-131">-   "Setup Secure Session" out of "Process Action" of that first message, for each request/reply for RST/RSTR/SCT.</span></span><br /><span data-ttu-id="2f5a9-132">-"Chiudi sessione protetta" per lo scambio di annullamento, all'esterno di "attività di chiusura del Proxy."</span><span class="sxs-lookup"><span data-stu-id="2f5a9-132">-   "Close Secure Session" for the CANCEL exchange, out of the "Close Proxy activity."</span></span> <span data-ttu-id="2f5a9-133">Questa attività può essere causata da un'altra attività di ambiente, a seconda del momento di chiusura della sessione protetta.</span><span class="sxs-lookup"><span data-stu-id="2f5a9-133">This activity may happen out of some other ambient activity, depending on when the secure session is closed.</span></span><br /><br /> <span data-ttu-id="2f5a9-134">Nel server:</span><span class="sxs-lookup"><span data-stu-id="2f5a9-134">On the server:</span></span><br /><br /> <span data-ttu-id="2f5a9-135">-L'attività "Elaborazione azione" uno per ogni request/reply degli scambi RST/SCT/Cancel nel server.</span><span class="sxs-lookup"><span data-stu-id="2f5a9-135">-   One "Process Action" activity for each request/reply for RST/SCT/Cancel on the server.</span></span> <span data-ttu-id="2f5a9-136">Se `propagateActivity` = `true`, le attività RST/RSTR/SCT vengono unite con "Set della sessione di sicurezza" e l'annullamento viene unita con l'attività "Chiudere" dal client.</span><span class="sxs-lookup"><span data-stu-id="2f5a9-136">If `propagateActivity`=`true`, RST/RSTR/SCT activities are merged with "Set up Security Session", and Cancel is merged with the "Close" activity from the client.</span></span><br /><br /> <span data-ttu-id="2f5a9-137">L'attività di impostazione della sessione di sicurezza si articola in due fasi:</span><span class="sxs-lookup"><span data-stu-id="2f5a9-137">There are two stages for "Set up Secure Session":</span></span><br /><br /> <span data-ttu-id="2f5a9-138">1.  Negoziazione dell'autenticazione:</span><span class="sxs-lookup"><span data-stu-id="2f5a9-138">1.  Authentication negotiation.</span></span> <span data-ttu-id="2f5a9-139">questa fase è facoltativa se il client già dispone delle credenziali corrette.</span><span class="sxs-lookup"><span data-stu-id="2f5a9-139">This is optional if the client already has the proper credentials.</span></span> <span data-ttu-id="2f5a9-140">Questa fase può essere eseguita tramite un trasporto protetto o lo scambio di messaggi.</span><span class="sxs-lookup"><span data-stu-id="2f5a9-140">This phase can be done through secure transport, or through message exchanges.</span></span> <span data-ttu-id="2f5a9-141">Nel secondo caso è possibile che si verifichino 1 o 2 scambi RST/RSTR.</span><span class="sxs-lookup"><span data-stu-id="2f5a9-141">In the latter case, 1 or 2 RST/RSTR exchanges can happen.</span></span> <span data-ttu-id="2f5a9-142">Per questi scambi il sistema genera tracce in nuove attività di request/reply, come descritto in precedenza.</span><span class="sxs-lookup"><span data-stu-id="2f5a9-142">For these exchanges, traces are emitted in new request/reply activities as previously designed.</span></span><br /><span data-ttu-id="2f5a9-143">2.  Creazione di una sessione protetta: in tale fase si verifica un unico scambio RST/RSTR</span><span class="sxs-lookup"><span data-stu-id="2f5a9-143">2.  Secure session establishment (SCT), in which one RST/RSTR exchange happens here.</span></span> <span data-ttu-id="2f5a9-144">avente le stesse attività di ambiente descritte in precedenza.</span><span class="sxs-lookup"><span data-stu-id="2f5a9-144">This has the same ambient activities as described previously.</span></span>|<span data-ttu-id="2f5a9-145">-Scambio di tracce</span><span class="sxs-lookup"><span data-stu-id="2f5a9-145">-   Exchange traces</span></span><br /><span data-ttu-id="2f5a9-146">-Canale sicuro stabilito</span><span class="sxs-lookup"><span data-stu-id="2f5a9-146">-   Secure channel established</span></span><br /><span data-ttu-id="2f5a9-147">-Condividere l'ottenimento dei segreti.</span><span class="sxs-lookup"><span data-stu-id="2f5a9-147">-   Share secrets obtained.</span></span>|  
  
> [!NOTE]
>  <span data-ttu-id="2f5a9-148">In modalità di sicurezza mista, l'autenticazione di negoziazione si verifica in scambi binari. Tuttavia, lo scambio SCT si verifica tramite lo scambio di messaggi.</span><span class="sxs-lookup"><span data-stu-id="2f5a9-148">In mixed security mode, negotiation authentication happens in binary exchanges, but SCT happens in message exchange.</span></span> <span data-ttu-id="2f5a9-149">Nella modalità di trasporto pure, la negoziazione si verifica solo nel trasporto senza alcuna attività aggiuntiva.</span><span class="sxs-lookup"><span data-stu-id="2f5a9-149">In pure transport mode, negotiation happens only in transport with no additional activities.</span></span>  
  
## <a name="message-encryption-and-decryption"></a><span data-ttu-id="2f5a9-150">Crittografia e decrittografia dei messaggi</span><span class="sxs-lookup"><span data-stu-id="2f5a9-150">Message Encryption and Decryption</span></span>  
 <span data-ttu-id="2f5a9-151">Nella tabella seguente sono elencate le attività e le tracce relative alla crittografia/decrittografia dei messaggi, nonché all'autenticazione della firma.</span><span class="sxs-lookup"><span data-stu-id="2f5a9-151">The following table lists the activities and traces for message encryption/decryption, as well as signature authentication.</span></span>  
  
||<span data-ttu-id="2f5a9-152">Protezione a livello di trasporto</span><span class="sxs-lookup"><span data-stu-id="2f5a9-152">Secure Transport</span></span><br /><br /> <span data-ttu-id="2f5a9-153">(HTTPS, SSL) e del livello di messaggio</span><span class="sxs-lookup"><span data-stu-id="2f5a9-153">(HTTPS, SSL) and Secure Message Layer</span></span><br /><br /> <span data-ttu-id="2f5a9-154">(WSHTTP)</span><span class="sxs-lookup"><span data-stu-id="2f5a9-154">(WSHTTP)</span></span>|  
|-|---------------------------------------------------------------------------------|  
|<span data-ttu-id="2f5a9-155">Momento in cui si verificano la crittografia/decrittografia dei messaggi e l'autenticazione della firma</span><span class="sxs-lookup"><span data-stu-id="2f5a9-155">Time when message encryption/decryption, as well as signature authentication happens</span></span>|<span data-ttu-id="2f5a9-156">Alla ricezione del messaggio</span><span class="sxs-lookup"><span data-stu-id="2f5a9-156">On message received</span></span>|  
|<span data-ttu-id="2f5a9-157">Attività</span><span class="sxs-lookup"><span data-stu-id="2f5a9-157">Activities</span></span>|<span data-ttu-id="2f5a9-158">Le tracce vengono generate nell'attività ProcessAction nel client e nel server.</span><span class="sxs-lookup"><span data-stu-id="2f5a9-158">Traces are emitted in the ProcessAction activity on the client and server.</span></span>|  
|<span data-ttu-id="2f5a9-159">Tracce</span><span class="sxs-lookup"><span data-stu-id="2f5a9-159">Traces</span></span>|<span data-ttu-id="2f5a9-160">-sendSecurityHeader (mittente):</span><span class="sxs-lookup"><span data-stu-id="2f5a9-160">-   sendSecurityHeader (sender):</span></span><br /><span data-ttu-id="2f5a9-161">-Firma messaggio</span><span class="sxs-lookup"><span data-stu-id="2f5a9-161">-   Sign message</span></span><br /><span data-ttu-id="2f5a9-162">-Crittografare i dati di richiesta</span><span class="sxs-lookup"><span data-stu-id="2f5a9-162">-   Encrypt request data</span></span><br /><span data-ttu-id="2f5a9-163">-receiveSecurityHeader (destinatario):</span><span class="sxs-lookup"><span data-stu-id="2f5a9-163">-   receiveSecurityHeader (receiver):</span></span><br /><span data-ttu-id="2f5a9-164">-Verificare la firma</span><span class="sxs-lookup"><span data-stu-id="2f5a9-164">-   Verify signature</span></span><br /><span data-ttu-id="2f5a9-165">-Decrittografare i dati di risposta</span><span class="sxs-lookup"><span data-stu-id="2f5a9-165">-   Decrypt response data</span></span><br /><span data-ttu-id="2f5a9-166">-Autenticazione</span><span class="sxs-lookup"><span data-stu-id="2f5a9-166">-   Authentication</span></span>|  
  
> [!NOTE]
>  <span data-ttu-id="2f5a9-167">Nella modalità di trasporto pure, la crittografia/decrittografia dei messaggi si verifica solo nel trasporto senza alcuna attività aggiuntiva.</span><span class="sxs-lookup"><span data-stu-id="2f5a9-167">In pure transport mode, message encryption/decryption happens only in transport with no additional activities.</span></span>  
  
## <a name="authorization-and-verification"></a><span data-ttu-id="2f5a9-168">Autorizzazione e verifica</span><span class="sxs-lookup"><span data-stu-id="2f5a9-168">Authorization and Verification</span></span>  
 <span data-ttu-id="2f5a9-169">Nella tabella seguente sono elencate le attività e le tracce relative all'autorizzazione.</span><span class="sxs-lookup"><span data-stu-id="2f5a9-169">The following table lists the activities and traces for authorization.</span></span>  
  
||<span data-ttu-id="2f5a9-170">Momento in cui si verifica l'autorizzazione</span><span class="sxs-lookup"><span data-stu-id="2f5a9-170">Time when authorization happens</span></span>|<span data-ttu-id="2f5a9-171">Activities</span><span class="sxs-lookup"><span data-stu-id="2f5a9-171">Activities</span></span>|<span data-ttu-id="2f5a9-172">Tracce</span><span class="sxs-lookup"><span data-stu-id="2f5a9-172">Traces</span></span>|  
|-|-------------------------------------|----------------|------------|  
|<span data-ttu-id="2f5a9-173">Locale (impostazione predefinita)</span><span class="sxs-lookup"><span data-stu-id="2f5a9-173">Local (default)</span></span>|<span data-ttu-id="2f5a9-174">Dopo che il messaggio è stato decrittografato nel server</span><span class="sxs-lookup"><span data-stu-id="2f5a9-174">After the message is decrypted on the server</span></span>|<span data-ttu-id="2f5a9-175">Le tracce vengono generate nell'attività ProcessAction nel server.</span><span class="sxs-lookup"><span data-stu-id="2f5a9-175">Traces are emitted in the ProcessAction activity at the server.</span></span>|<span data-ttu-id="2f5a9-176">Autorizzazione dell'utente.</span><span class="sxs-lookup"><span data-stu-id="2f5a9-176">User authorized.</span></span>|  
|<span data-ttu-id="2f5a9-177">Remote</span><span class="sxs-lookup"><span data-stu-id="2f5a9-177">Remote</span></span>|<span data-ttu-id="2f5a9-178">Dopo che il messaggio è stato decrittografato nel server</span><span class="sxs-lookup"><span data-stu-id="2f5a9-178">After the message is decrypted on the server</span></span>|<span data-ttu-id="2f5a9-179">Le tracce vengono generate in una nuova attività richiamata dall'attività ProcessAction.</span><span class="sxs-lookup"><span data-stu-id="2f5a9-179">Traces are emitted in a new activity invoked by the ProcessAction activity.</span></span>|<span data-ttu-id="2f5a9-180">Autorizzazione dell'utente.</span><span class="sxs-lookup"><span data-stu-id="2f5a9-180">User authorized.</span></span>|
