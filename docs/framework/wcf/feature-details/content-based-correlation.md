---
title: Correlazione basata sul contenuto
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: f46a2b68-8d24-4122-bbee-9573fc3f9fb4
caps.latest.revision: "17"
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.openlocfilehash: 0a19c7e8dec9587816d78be8bea58fc4ca366d5e
ms.sourcegitcommit: ce279f2d7fe2220e6ea0a25a8a7a5370ddf8d9f0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 12/02/2017
---
# <a name="content-based-correlation"></a><span data-ttu-id="a2ed2-102">Correlazione basata sul contenuto</span><span class="sxs-lookup"><span data-stu-id="a2ed2-102">Content Based Correlation</span></span>
<span data-ttu-id="a2ed2-103">Quando i servizi flusso di lavoro comunicano con client e altri servizi, sono spesso presenti alcuni dati nei messaggi scambiati che correlano in modo univoco un messaggio a una particolare istanza.</span><span class="sxs-lookup"><span data-stu-id="a2ed2-103">When workflow services communicate with clients and other services, often there is some data in the exchanged messages that uniquely relates a message to a particular instance.</span></span> <span data-ttu-id="a2ed2-104">La correlazione basata sul contenuto usa questi dati nel messaggio, ad esempio un numero cliente o un ID dell'ordine, per indirizzare messaggi all'istanza del flusso di lavoro appropriata.</span><span class="sxs-lookup"><span data-stu-id="a2ed2-104">Content-based correlation uses this data in the message, such as a customer number or order ID, to route messages to the proper workflow instance.</span></span> <span data-ttu-id="a2ed2-105">In questo argomento viene illustrato come usare la correlazione basata sul contenuto nei flussi di lavoro.</span><span class="sxs-lookup"><span data-stu-id="a2ed2-105">This topic explains how to use content-based correlation in workflows.</span></span>  
  
## <a name="using-content-based-correlation"></a><span data-ttu-id="a2ed2-106">Utilizzo della correlazione basata sul contenuto</span><span class="sxs-lookup"><span data-stu-id="a2ed2-106">Using Content-Based Correlation</span></span>  
 <span data-ttu-id="a2ed2-107">La correlazione basata sul contenuto viene usata se un servizio flusso di lavoro dispone di più metodi a cui viene eseguito l'accesso da parte di un solo client e una parte dei dati nei messaggi scambiati identifica l'istanza desiderata.</span><span class="sxs-lookup"><span data-stu-id="a2ed2-107">Content-based correlation is used when a workflow service has multiple methods that are accessed by a single client and a piece of data in the exchanged messages identifies the desired instance.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="a2ed2-108">La correlazione basata sul contenuto risulta utile se non è possibile usare la correlazione del contesto in quanto l'associazione non rientra tra quelle di scambio del contesto supportate.</span><span class="sxs-lookup"><span data-stu-id="a2ed2-108">Content-based correlation is useful when context correlation cannot be used because the binding is not one of the supported context exchange bindings.</span></span> [!INCLUDE[crabout](../../../../includes/crabout-md.md)]<span data-ttu-id="a2ed2-109">la correlazione del contesto, vedere [scambio del contesto](../../../../docs/framework/wcf/feature-details/context-exchange-correlation.md).</span><span class="sxs-lookup"><span data-stu-id="a2ed2-109"> context correlation, see [Context Exchange](../../../../docs/framework/wcf/feature-details/context-exchange-correlation.md).</span></span>  
  
 <span data-ttu-id="a2ed2-110">Ogni attività di messaggistica usata in queste comunicazioni deve specificare il percorso dei dati nel messaggio che identificano in modo univoco l'istanza.</span><span class="sxs-lookup"><span data-stu-id="a2ed2-110">Each messaging activity used in these communications must specify the location of the data in the message that uniquely identifies the instance.</span></span> <span data-ttu-id="a2ed2-111">A tale scopo viene fornito un elemento <xref:System.ServiceModel.MessageQuerySet>, che usa un elemento <xref:System.ServiceModel.Activities.QueryCorrelationInitializer> o <xref:System.ServiceModel.Activities.Receive.CorrelatesOn%2A>, che esegue una query nel messaggio per una o più parti di dati che identificano in modo univoco l'istanza.</span><span class="sxs-lookup"><span data-stu-id="a2ed2-111">This is done by providing a <xref:System.ServiceModel.MessageQuerySet>, using either a <xref:System.ServiceModel.Activities.QueryCorrelationInitializer> or <xref:System.ServiceModel.Activities.Receive.CorrelatesOn%2A>, that queries the message for the piece or pieces of data that uniquely identify the instance.</span></span>  
  
> [!WARNING]
>  <span data-ttu-id="a2ed2-112">Per i dati usati per l'identificazione dell'istanza viene generato un hash in una chiave di correlazione.</span><span class="sxs-lookup"><span data-stu-id="a2ed2-112">The data that is used to identify the instance is hashed into a correlation key.</span></span> <span data-ttu-id="a2ed2-113">È necessario verificare che i dati usati per la correlazione siano univoci. In caso contrario si potrebbero verificare conflitti nella chiave con hash e i messaggi potrebbero essere indirizzati in modo errato.</span><span class="sxs-lookup"><span data-stu-id="a2ed2-113">Care must be taken to ensure that the data used for correlation is unique or else collisions in the hashed key could occur and cause messages to be misrouted.</span></span> <span data-ttu-id="a2ed2-114">Una correlazione basata esclusivamente su un nome di cliente può ad esempio generare un conflitto, poiché possono esistere più clienti con lo stesso nome.</span><span class="sxs-lookup"><span data-stu-id="a2ed2-114">For example, a correlation based solely on a customer name may cause a collision because there may be multiple customers with the same name.</span></span> <span data-ttu-id="a2ed2-115">Non usare i due punti (`:`) come parte dei dati per correlare il messaggio, poiché vengono già usati per delimitare il valore e la chiave della query del messaggio per formattare la stringa per la quale verrà generato un hash.</span><span class="sxs-lookup"><span data-stu-id="a2ed2-115">The colon (`:`) should not be used as part of the data used to correlate the message because it is already used to delimit the message query’s key and value to form the string that is subsequently hashed.</span></span>  
  
 <span data-ttu-id="a2ed2-116">Nell'esempio seguente, il primo <xref:System.ServiceModel.Activities.Receive> / <xref:System.ServiceModel.Activities.SendReply> in un servizio flusso di lavoro restituisce un `OrderId`, che viene quindi passato nuovamente dal client alla chiamata al seguente <xref:System.ServiceModel.Activities.Receive> attività nel servizio del flusso di lavoro.</span><span class="sxs-lookup"><span data-stu-id="a2ed2-116">In the following example, the initial <xref:System.ServiceModel.Activities.Receive>/<xref:System.ServiceModel.Activities.SendReply> in a workflow service returns an `OrderId`, which is then passed back by the client on the call to the following <xref:System.ServiceModel.Activities.Receive> activity in the workflow service.</span></span>  
  
 [!code-csharp[CFX_ContentCorrelation#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_contentcorrelation/cs/program.cs#1)]  
  
 <span data-ttu-id="a2ed2-117">Nell'esempio precedente viene mostrata una correlazione basata sul contenuto inizializzata da <xref:System.ServiceModel.Activities.SendReply>.</span><span class="sxs-lookup"><span data-stu-id="a2ed2-117">The previous example shows a content-based correlation that is initialized by the <xref:System.ServiceModel.Activities.SendReply>.</span></span> <span data-ttu-id="a2ed2-118"><xref:System.ServiceModel.MessageQuerySet> specifica che i dati usati per identificare i messaggi successivi a questo servizio sono di tipo `OrderId`.</span><span class="sxs-lookup"><span data-stu-id="a2ed2-118">The <xref:System.ServiceModel.MessageQuerySet> specifies that the data used to identify subsequent messages to this service is the `OrderId`.</span></span>  
  
 [!code-csharp[CFX_ContentCorrelation#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_contentcorrelation/cs/program.cs#2)]  
  
 <span data-ttu-id="a2ed2-119">L'attività <xref:System.ServiceModel.Activities.Receive> che successiva a <xref:System.ServiceModel.Activities.SendReply> nel flusso di lavoro segue la correlazione inizializzata da <xref:System.ServiceModel.Activities.SendReply>.</span><span class="sxs-lookup"><span data-stu-id="a2ed2-119">The <xref:System.ServiceModel.Activities.Receive> activity that follows the <xref:System.ServiceModel.Activities.SendReply> in the workflow follows the correlation that was initialized by the <xref:System.ServiceModel.Activities.SendReply>.</span></span> <span data-ttu-id="a2ed2-120">Entrambe le attività condividono lo stesso elemento <xref:System.ServiceModel.Activities.CorrelationHandle>, ma ognuna dispone di specifici elementi <xref:System.ServiceModel.MessageQuerySet> e <xref:System.ServiceModel.XPathMessageQuery> che indicano la posizione all'interno del messaggio in cui si trovano i dati di identificazione.</span><span class="sxs-lookup"><span data-stu-id="a2ed2-120">Both activities share the same <xref:System.ServiceModel.Activities.CorrelationHandle>, but each one has its own <xref:System.ServiceModel.MessageQuerySet> and <xref:System.ServiceModel.XPathMessageQuery> that specifies where the identifying data is in that particular message.</span></span> <span data-ttu-id="a2ed2-121">Nell'attività che inizializza la correlazione, questo elemento <xref:System.ServiceModel.MessageQuerySet> viene specificato nella proprietà <xref:System.ServiceModel.Activities.Receive.CorrelationInitializers%2A> e, per qualsiasi attività <xref:System.ServiceModel.Activities.Receive> successiva, mediante la proprietà <xref:System.ServiceModel.Activities.Receive.CorrelatesOn%2A>.</span><span class="sxs-lookup"><span data-stu-id="a2ed2-121">On the activity that initializes the correlation, this <xref:System.ServiceModel.MessageQuerySet> is specified in the <xref:System.ServiceModel.Activities.Receive.CorrelationInitializers%2A> property, and for any following <xref:System.ServiceModel.Activities.Receive> activities, it is specified using the <xref:System.ServiceModel.Activities.Receive.CorrelatesOn%2A> property.</span></span>  
  
 [!code-csharp[CFX_ContentCorrelation#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_contentcorrelation/cs/program.cs#3)]  
  
 <span data-ttu-id="a2ed2-122">Una correlazione basata sul contenuto può essere inizializzata da qualsiasi attività di messaggistica (<xref:System.ServiceModel.Activities.Send>, <xref:System.ServiceModel.Activities.Receive>, <xref:System.ServiceModel.Activities.SendReply>, <xref:System.ServiceModel.Activities.ReceiveReply>) quando i dati vengono propagati come parte di un messaggio.</span><span class="sxs-lookup"><span data-stu-id="a2ed2-122">A content-based correlation can be initialized by any messaging activity (<xref:System.ServiceModel.Activities.Send>, <xref:System.ServiceModel.Activities.Receive>, <xref:System.ServiceModel.Activities.SendReply>, <xref:System.ServiceModel.Activities.ReceiveReply>) when the data flows as part of a message.</span></span> <span data-ttu-id="a2ed2-123">Se questa parte di dati non viene propagata come parte di un messaggio, è possibile inizializzarla in modo esplicito tramite l'attività <xref:System.ServiceModel.Activities.InitializeCorrelation>.</span><span class="sxs-lookup"><span data-stu-id="a2ed2-123">If the particular piece of data does not flow as part of a message, then it can be initialized explicitly by using the <xref:System.ServiceModel.Activities.InitializeCorrelation> activity.</span></span> <span data-ttu-id="a2ed2-124">Se sono necessarie più parti di dati per identificare in modo univoco il messaggio, è possibile aggiungere più query a <xref:System.ServiceModel.MessageQuerySet>.</span><span class="sxs-lookup"><span data-stu-id="a2ed2-124">If multiple pieces of data are required to uniquely identify the message, then multiple queries can be added to the <xref:System.ServiceModel.MessageQuerySet>.</span></span> <span data-ttu-id="a2ed2-125">In questi esempi è stato fornito in modo esplicito un elemento <xref:System.ServiceModel.Activities.CorrelationHandle> a ogni attività che usa le proprietà `CorrelatesWith` o `CorrelationHandle`, ma se è necessaria una sola correlazione per l'intero flusso di lavoro intero, come in questo caso, in cui tutti gli elementi vengono correlati in `OrderId`, è sufficiente la gestione dell'handle di correlazione implicita fornita da <xref:System.ServiceModel.Activities.WorkflowServiceHost>.</span><span class="sxs-lookup"><span data-stu-id="a2ed2-125">In these examples, a <xref:System.ServiceModel.Activities.CorrelationHandle> was explicitly provided to each of the activities using the `CorrelatesWith` or `CorrelationHandle` properties, but if there is only one correlation required for the entire workflow, such as in this example where everything correlates on `OrderId`, the implicit correlation handle management provided by <xref:System.ServiceModel.Activities.WorkflowServiceHost> is sufficient.</span></span>  
  
## <a name="using-the-initializecorrelation-activity"></a><span data-ttu-id="a2ed2-126">Utilizzo dell'attività InitializeCorrelation</span><span class="sxs-lookup"><span data-stu-id="a2ed2-126">Using the InitializeCorrelation Activity</span></span>  
 <span data-ttu-id="a2ed2-127">Nell'esempio precedente l'elemento `OrderId` è stato propagato al chiamante tramite l'attività <xref:System.ServiceModel.Activities.SendReply> e la correlazione è stata inizializzata in questo punto.</span><span class="sxs-lookup"><span data-stu-id="a2ed2-127">In the previous example, the `OrderId` flowed to the caller through the <xref:System.ServiceModel.Activities.SendReply> activity and this is where the correlation was initialized.</span></span> <span data-ttu-id="a2ed2-128">È possibile ottenere lo stesso comportamento usando l'attività <xref:System.ServiceModel.Activities.InitializeCorrelation>.</span><span class="sxs-lookup"><span data-stu-id="a2ed2-128">The same behavior can be accomplished by using the <xref:System.ServiceModel.Activities.InitializeCorrelation> activity.</span></span> <span data-ttu-id="a2ed2-129">L'attività <xref:System.ServiceModel.Activities.InitializeCorrelation> usa l'elemento <xref:System.ServiceModel.Activities.CorrelationHandle> e un dizionario di elementi che rappresentano i dati usati per eseguire il mapping del messaggio all'istanza corretta.</span><span class="sxs-lookup"><span data-stu-id="a2ed2-129">The <xref:System.ServiceModel.Activities.InitializeCorrelation> activity takes the <xref:System.ServiceModel.Activities.CorrelationHandle> and a dictionary of items that represent the data used to map the message to the correct instance.</span></span> <span data-ttu-id="a2ed2-130">Per usare l'attività <xref:System.ServiceModel.Activities.InitializeCorrelation> nell'esempio precedente, rimuovere <xref:System.ServiceModel.Activities.SendReply.CorrelationInitializers%2A> dall'attività <xref:System.ServiceModel.Activities.SendReply> e inizializzare la correlazione usando l'attività <xref:System.ServiceModel.Activities.InitializeCorrelation>.</span><span class="sxs-lookup"><span data-stu-id="a2ed2-130">To use the <xref:System.ServiceModel.Activities.InitializeCorrelation> activity in the preceding sample, remove the <xref:System.ServiceModel.Activities.SendReply.CorrelationInitializers%2A> from the <xref:System.ServiceModel.Activities.SendReply> activity and initialize the correlation using the <xref:System.ServiceModel.Activities.InitializeCorrelation> activity.</span></span>  
  
 [!code-csharp[CFX_ContentCorrelation#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_contentcorrelation/cs/program.cs#4)]  
  
 <span data-ttu-id="a2ed2-131">L'attività <xref:System.ServiceModel.Activities.InitializeCorrelation> viene quindi usata nel flusso di lavoro, dopo il popolamento delle variabili contenenti i dati ma prima dell'attività <xref:System.ServiceModel.Activities.Receive> correlata all'elemento <xref:System.ServiceModel.Activities.CorrelationHandle> inizializzato.</span><span class="sxs-lookup"><span data-stu-id="a2ed2-131">The <xref:System.ServiceModel.Activities.InitializeCorrelation> activity is then used in the workflow, after the variables that hold the data are populated but before the <xref:System.ServiceModel.Activities.Receive> activity that correlates with the initialized <xref:System.ServiceModel.Activities.CorrelationHandle>.</span></span>  
  
 [!code-csharp[CFX_ContentCorrelation#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_contentcorrelation/cs/program.cs#5)]  
  
## <a name="configuring-xpath-queries-using-the-workflow-designer"></a><span data-ttu-id="a2ed2-132">Configurazione di query XPath mediante Progettazione flussi di lavoro</span><span class="sxs-lookup"><span data-stu-id="a2ed2-132">Configuring XPath Queries Using the Workflow Designer</span></span>  
 <span data-ttu-id="a2ed2-133">Negli esempi precedenti le attività e le query XPath usate nelle query del messaggio sono state specificate nel codice.</span><span class="sxs-lookup"><span data-stu-id="a2ed2-133">In the previous examples, the activities and the XPath queries used in the message queries were specified in code.</span></span> <span data-ttu-id="a2ed2-134">Progettazione flussi di lavoro in [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)] fornisce inoltre la possibilità di generare query XPath dai tipi `DataContract` per la correlazione basata sul contenuto.</span><span class="sxs-lookup"><span data-stu-id="a2ed2-134">The workflow designer in [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)] also provides the ability to generate XPaths from `DataContract` types for content-based correlation.</span></span> <span data-ttu-id="a2ed2-135">La prima query XPath nell'esempio precedente è stata configurata per <xref:System.ServiceModel.Activities.SendReply>.</span><span class="sxs-lookup"><span data-stu-id="a2ed2-135">The first XPath configured in the previous example was configured for the <xref:System.ServiceModel.Activities.SendReply>.</span></span>  
  
 [!code-csharp[CFX_ContentCorrelation#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_contentcorrelation/cs/program.cs#2)]  
  
 <span data-ttu-id="a2ed2-136">Per configurare la query XPath per un'attività di messaggistica in Progettazione flussi di lavoro, selezionare l'attività all'interno dell'utilità.</span><span class="sxs-lookup"><span data-stu-id="a2ed2-136">To configure the XPath for a messaging activity in the workflow designer, select the activity in the workflow designer.</span></span> <span data-ttu-id="a2ed2-137">Se l'attività sta inizializzando la correlazione, come nell'esempio precedente, fare clic sul pulsante con puntini di sospensione per il **CorrelationInitializers** proprietà il **proprietà** finestra.</span><span class="sxs-lookup"><span data-stu-id="a2ed2-137">If the activity is initializing the correlation, as in the previous example, click the ellipsis button for the **CorrelationInitializers** property in the **Properties** window.</span></span> <span data-ttu-id="a2ed2-138">Consente di visualizzare il **Aggiungi inizializzatori di correlazione** finestra di dialogo.</span><span class="sxs-lookup"><span data-stu-id="a2ed2-138">This displays the **Add Correlation Initializers** dialog window.</span></span> <span data-ttu-id="a2ed2-139">Da questa finestra di dialogo è possibile specificare il tipo di correlazione e selezionare il contenuto usato per la correlazione.</span><span class="sxs-lookup"><span data-stu-id="a2ed2-139">From this dialog you can specify the correlation type and select the content that is used for the correlation.</span></span> <span data-ttu-id="a2ed2-140">Il <xref:System.ServiceModel.Activities.CorrelationHandle> variabile viene specificata nel **aggiungere inizializzatore** casella e il tipo di correlazione e dati usati per la correlazione è selezionato dal **query XPath** sezione della finestra di dialogo.</span><span class="sxs-lookup"><span data-stu-id="a2ed2-140">The <xref:System.ServiceModel.Activities.CorrelationHandle> variable is specified in the **Add initializer** box, and the correlation type and data used for the correlation is selected from the **XPath Queries** section of the dialog box.</span></span>  
  
 <span data-ttu-id="a2ed2-141">![Finestra di dialogo CorrelationInitializer](../../../../docs/framework/wcf/feature-details/media/correlationinitializerdlg.jpg "CorrelationInitializerDlg")</span><span class="sxs-lookup"><span data-stu-id="a2ed2-141">![CorrelationInitializer Dialog](../../../../docs/framework/wcf/feature-details/media/correlationinitializerdlg.jpg "CorrelationInitializerDlg")</span></span>  
  
 <span data-ttu-id="a2ed2-142">La seconda query XPath nell'esempio precedente è stata configurata nell'attività <xref:System.ServiceModel.Activities.Receive>.</span><span class="sxs-lookup"><span data-stu-id="a2ed2-142">The second XPath query in the previous example was configured in the <xref:System.ServiceModel.Activities.Receive> activity.</span></span>  
  
 [!code-csharp[CFX_ContentCorrelation#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_contentcorrelation/cs/program.cs#3)]  
  
 <span data-ttu-id="a2ed2-143">Per configurare la query XPath per un'attività di messaggistica che non inizializza la correlazione, selezionare l'attività nella finestra di progettazione del flusso di lavoro e quindi fare clic sul pulsante con puntini di sospensione per il **CorrelatesOn** proprietà il  **Proprietà** finestra.</span><span class="sxs-lookup"><span data-stu-id="a2ed2-143">To configure the XPath query for a messaging activity that does not initialize the correlation, select the activity in the workflow designer and then click the ellipsis button for the **CorrelatesOn** property in the **Properties** window.</span></span> <span data-ttu-id="a2ed2-144">Consente di visualizzare il **definizione di CorrelatesOn** finestra di dialogo.</span><span class="sxs-lookup"><span data-stu-id="a2ed2-144">This displays the **CorrelatesOn Definition** dialog window.</span></span>  
  
 <span data-ttu-id="a2ed2-145">![Definizione di CorrelatesOn](../../../../docs/framework/wcf/feature-details/media/correlatesondialog.jpg "CorrelatesOnDialog")</span><span class="sxs-lookup"><span data-stu-id="a2ed2-145">![CorrelatesOn Definition](../../../../docs/framework/wcf/feature-details/media/correlatesondialog.jpg "CorrelatesOnDialog")</span></span>  
  
 <span data-ttu-id="a2ed2-146">Da questa finestra di dialogo è possibile specificare il <xref:System.ServiceModel.Activities.CorrelationHandle> e sceglie elementi nel **query XPath** elenco per compilare la query XPath.</span><span class="sxs-lookup"><span data-stu-id="a2ed2-146">From this dialog you specify the <xref:System.ServiceModel.Activities.CorrelationHandle> and choose items in the **XPath Queries** list to build the XPath query.</span></span>
