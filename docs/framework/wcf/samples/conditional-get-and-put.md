---
title: Verifica Get e Put condizionale
ms.date: 03/30/2017
ms.assetid: 3d22067f-57b8-4e0f-a571-a694512187ae
ms.openlocfilehash: 29819f89327128cdd71cc89eb8d14126522dc2df
ms.sourcegitcommit: a885cc8c3e444ca6471348893d5373c6e9e49a47
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 09/06/2018
ms.locfileid: "43879565"
---
# <a name="conditional-get-and-put"></a><span data-ttu-id="e37cd-102">Verifica Get e Put condizionale</span><span class="sxs-lookup"><span data-stu-id="e37cd-102">Conditional Get and Put</span></span>
<span data-ttu-id="e37cd-103">In questo esempio viene descritto come utilizzare le nuove API di aggiornamento e recupero condizionali per il modello di programmazione WCF REST.</span><span class="sxs-lookup"><span data-stu-id="e37cd-103">This sample demonstrates how to use the new conditional retrieve and update APIs for the WCF REST programming model.</span></span> <span data-ttu-id="e37cd-104">Poiché sono più appropriati per l'aggiornamento e recupero condizionali orientato alle risorse e servizi REST, questo esempio estende il [servizio risorse di base](../../../../docs/framework/wcf/samples/basic-resource-service.md) esempio.</span><span class="sxs-lookup"><span data-stu-id="e37cd-104">Because conditional retrieve and update are most appropriate for resource-oriented and REST services, this sample extends the [Basic Resource Service](../../../../docs/framework/wcf/samples/basic-resource-service.md) sample.</span></span> <span data-ttu-id="e37cd-105">Questo esempio si concentra sull'aggiunta del supporto per l'aggiornamento e recupero condizionali le [servizio risorse di base](../../../../docs/framework/wcf/samples/basic-resource-service.md) di esempio usando le nuove API introdotte [!INCLUDE[netfx40_long](../../../../includes/netfx40-long-md.md)].</span><span class="sxs-lookup"><span data-stu-id="e37cd-105">This sample focuses on adding support for conditional retrieve and update to the [Basic Resource Service](../../../../docs/framework/wcf/samples/basic-resource-service.md) sample using the new APIs introduced in [!INCLUDE[netfx40_long](../../../../includes/netfx40-long-md.md)].</span></span>  
  
## <a name="demonstrates"></a><span data-ttu-id="e37cd-106">Dimostrazione</span><span class="sxs-lookup"><span data-stu-id="e37cd-106">Demonstrates</span></span>  
 <span data-ttu-id="e37cd-107">Aggiornamento e recupero condizionali</span><span class="sxs-lookup"><span data-stu-id="e37cd-107">Conditional Retrieve and Update</span></span>  
  
## <a name="discussion"></a><span data-ttu-id="e37cd-108">Discussione</span><span class="sxs-lookup"><span data-stu-id="e37cd-108">Discussion</span></span>  
 <span data-ttu-id="e37cd-109">In questo esempio, il servizio WCF presenta una raccolta di clienti in modo REST e orientato alle risorse.</span><span class="sxs-lookup"><span data-stu-id="e37cd-109">The WCF service in this sample exposes a collection of customers in a resource-oriented and REST manner.</span></span> <span data-ttu-id="e37cd-110">Per una descrizione dettagliata dell'implementazione del servizio, vedere la [servizio risorse di base](../../../../docs/framework/wcf/samples/basic-resource-service.md) esempio.</span><span class="sxs-lookup"><span data-stu-id="e37cd-110">For a detailed description of the service implementation, please see the [Basic Resource Service](../../../../docs/framework/wcf/samples/basic-resource-service.md) sample.</span></span>  
  
 <span data-ttu-id="e37cd-111">In questo esempio aggiunge funzionalità di aggiornamento per e recupero condizionali le [servizio risorse di base](../../../../docs/framework/wcf/samples/basic-resource-service.md) esempio.</span><span class="sxs-lookup"><span data-stu-id="e37cd-111">This sample adds conditional retrieve and update capabilities to the [Basic Resource Service](../../../../docs/framework/wcf/samples/basic-resource-service.md) sample.</span></span> <span data-ttu-id="e37cd-112">Aggiornamento e recupero condizionali utilizzano tag di entità HTTP e le intestazioni HTTP If-None-Match e If-Match per convalidare il fatto che i client dispongano o meno dell'entità più aggiornata per una determinata risorsa.</span><span class="sxs-lookup"><span data-stu-id="e37cd-112">Conditional retrieve and update use HTTP entity tags and the HTTP If-None-Match and If-Match headers to validate that clients either have or do not have the most current entity for a given resource.</span></span> <span data-ttu-id="e37cd-113">Tuttavia, l'attività di implementazione di codice per analizzare correttamente le intestazioni HTTP If-None-Match e If-Match può essere monotona e soggetta ad errori.</span><span class="sxs-lookup"><span data-stu-id="e37cd-113">However, implementing the code to correctly parse the HTTP If-None-Match and If-Match headers can be tedious and error-prone.</span></span> <span data-ttu-id="e37cd-114">Pertanto, i metodi <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> e <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> sono stati aggiunti a <xref:System.ServiceModel.Web.IncomingWebRequestContext>, a cui è possibile accedere utilizzando l'istanza corrente di <xref:System.ServiceModel.Web.WebOperationContext>.</span><span class="sxs-lookup"><span data-stu-id="e37cd-114">Therefore, the <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> and <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> methods have been added to the <xref:System.ServiceModel.Web.IncomingWebRequestContext>, which can be accessed using the current instance of the <xref:System.ServiceModel.Web.WebOperationContext>.</span></span> <span data-ttu-id="e37cd-115">Inoltre, il metodo `SetETag` è stato aggiunto a <xref:System.ServiceModel.Web.OutgoingWebRequestContext>, semplificando la restituzione di tag di entità validi.</span><span class="sxs-lookup"><span data-stu-id="e37cd-115">In addition, the `SetETag` method has been added to the <xref:System.ServiceModel.Web.OutgoingWebRequestContext>, making it easier to return valid entity tags.</span></span>  
  
 <span data-ttu-id="e37cd-116">Il metodo <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> deve essere utilizzato con operazioni [WebGet].</span><span class="sxs-lookup"><span data-stu-id="e37cd-116">The <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> method is intended to be used with [WebGet] operations.</span></span> <span data-ttu-id="e37cd-117">Il tag di entità corrente per la risorsa specificata viene considerato come parametro `entityTag`, che può essere di tipo `string`, `int`, `long` o `Guid`.</span><span class="sxs-lookup"><span data-stu-id="e37cd-117">It takes the current entity tag for the given resource as the `entityTag` parameter, which can be a `string`, `int`, `long` or `Guid`.</span></span> <span data-ttu-id="e37cd-118">Il metodo <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> verifica il tag di entità nell'intestazione HTTP If-None-Match della richiesta.</span><span class="sxs-lookup"><span data-stu-id="e37cd-118">The <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> method checks the entity tag against the HTTP If-None-Match header of the request.</span></span> <span data-ttu-id="e37cd-119">Se il tag di entità è presente nell'intestazione HTTP If-None-Match, viene generata un'eccezione <xref:System.ServiceModel.Web.WebFaultException> con il codice di stato Non modificato (304); in caso contrario, il metodo termina.</span><span class="sxs-lookup"><span data-stu-id="e37cd-119">If the entity tag is present in the HTTP If-None-Match header, then a <xref:System.ServiceModel.Web.WebFaultException> with a status code of Not Modified (304) is thrown; otherwise the method returns.</span></span> <span data-ttu-id="e37cd-120">Il meccanismo di recupero condizionale consente al client di indicare al server che dispone di tale entità e di inviare l'entità corrente solo se il client ne è sprovvisto.</span><span class="sxs-lookup"><span data-stu-id="e37cd-120">The conditional retrieve mechanism allows the client to tell the server that it has this entity and to only send the current entity if the client does not already have it.</span></span> <span data-ttu-id="e37cd-121">È possibile visualizzare l'utilizzo di esempio del metodo <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> nelle operazioni `GetCustomer` e `GetCustomers` del servizio.</span><span class="sxs-lookup"><span data-stu-id="e37cd-121">Example usage of the <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> method can be seen in the `GetCustomer` and `GetCustomers` operations of the service.</span></span> <span data-ttu-id="e37cd-122">È importante notare che le chiamate a <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> potrebbero non restituire alcun risultato.</span><span class="sxs-lookup"><span data-stu-id="e37cd-122">It is important to note that calls to <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> may not return.</span></span> <span data-ttu-id="e37cd-123">Gli sviluppatori devono implementare l'operazione in modo tale che sia possibile determinare l'esito positivo della richiesta prima che venga eseguita la chiamata a <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A>. In mancanza della chiamata a <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A>, il servizio invierebbe in questo modo una risposta con un codice di stato che indica un esito positivo.</span><span class="sxs-lookup"><span data-stu-id="e37cd-123">Developers should implement the operation so that the request is already known to be successful before the call to <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> is executed, such that if the call to <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> was not present, the service would send a response with a successful status code.</span></span>  
  
 <span data-ttu-id="e37cd-124">Il metodo <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> è analogo al metodo <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A>.</span><span class="sxs-lookup"><span data-stu-id="e37cd-124">The <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> method is similar to the <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A> method.</span></span> <span data-ttu-id="e37cd-125">Il tag di entità corrente viene utilizzato anche per la risorsa specificata.</span><span class="sxs-lookup"><span data-stu-id="e37cd-125">It also takes the current entity tag for the given resource.</span></span> <span data-ttu-id="e37cd-126">Tuttavia, destinato a essere utilizzato con operazioni [WebInvoke] in cui il metodo è impostato su "PUT" o "DELETE".</span><span class="sxs-lookup"><span data-stu-id="e37cd-126">However, it is intended to be used with [WebInvoke] operations in which the method is set to "PUT" or "DELETE".</span></span> <span data-ttu-id="e37cd-127">Il metodo <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> verifica il tag di entità nell'intestazione HTTP If-Match della richiesta.</span><span class="sxs-lookup"><span data-stu-id="e37cd-127">The <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> method checks the entity tag against the HTTP If-Match header of the request.</span></span> <span data-ttu-id="e37cd-128">Se il tag di entità non è presente nell'intestazione HTTP If-Match, viene generata un'eccezione <xref:System.ServiceModel.Web.WebFaultException> con il codice di stato Precondizione non riuscita (412).</span><span class="sxs-lookup"><span data-stu-id="e37cd-128">If the entity tag is not present in the HTTP If-Match header, then a <xref:System.ServiceModel.Web.WebFaultException> with a status code of Precondition Failed (412) is thrown.</span></span> <span data-ttu-id="e37cd-129">Il meccanismo di aggiornamento condizionale consente al client di indicare al server che dispone di tale entità per la risorsa. Consente inoltre solo al client di modificare la risorsa, se l'entità di cui dispone è corrente.</span><span class="sxs-lookup"><span data-stu-id="e37cd-129">The conditional update mechanism allows the client to tell the server that it has this entity for the resource and to only allow the client to alter the resource; if the entity it has is current.</span></span> <span data-ttu-id="e37cd-130">È possibile visualizzare l'utilizzo di esempio del metodo <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> nelle operazioni `UpdateCustomer` e `DeleteCustomer` del servizio.</span><span class="sxs-lookup"><span data-stu-id="e37cd-130">Example usage of the <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> method can be seen in the `UpdateCustomer` and `DeleteCustomer` operations of the service.</span></span> <span data-ttu-id="e37cd-131">In modo analogo a quanto avviene con <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A>, è importante notare che le chiamate a <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> potrebbero non restituire alcun risultato.</span><span class="sxs-lookup"><span data-stu-id="e37cd-131">Just as with <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalRetrieve%2A>, it is important to note that calls to <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> may not return.</span></span> <span data-ttu-id="e37cd-132">Gli sviluppatori devono implementare l'operazione in modo tale che sia possibile determinare l'esito positivo della richiesta prima che venga eseguita la chiamata a <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A>. In mancanza della chiamata a <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A>, il servizio invierebbe in questo modo una risposta con un codice di stato che indica un'esito positivo.</span><span class="sxs-lookup"><span data-stu-id="e37cd-132">Developers should implement the operation such that the request is already known to be successful before the call to <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> is executed, such that if the call to <xref:System.ServiceModel.Web.IncomingWebRequestContext.CheckConditionalUpdate%2A> was not present, the service would respond with a successful status code.</span></span>  
  
 <span data-ttu-id="e37cd-133">L'esempio è costituito da un servizio indipendente e da un client in esecuzione in un'applicazione console.</span><span class="sxs-lookup"><span data-stu-id="e37cd-133">The sample consists of a self-hosted service and a client that runs within a console application.</span></span> <span data-ttu-id="e37cd-134">Quando l'applicazione console è in esecuzione, il client invia richieste al servizio e scrive nella finestra della console le informazioni pertinenti incluse nelle risposte.</span><span class="sxs-lookup"><span data-stu-id="e37cd-134">As the console application runs, the client makes requests to the service and writes the pertinent information from the responses to the console window.</span></span>  
  
#### <a name="to-run-the-sample"></a><span data-ttu-id="e37cd-135">Per eseguire l'esempio</span><span class="sxs-lookup"><span data-stu-id="e37cd-135">To run the sample</span></span>  
  
1.  <span data-ttu-id="e37cd-136">Aprire la soluzione per l'esempio relativo alla verifica Get e Put condizionale.</span><span class="sxs-lookup"><span data-stu-id="e37cd-136">Open the solution for the Conditional Get and Put sample.</span></span> <span data-ttu-id="e37cd-137">Per garantire l'esecuzione corretta dell'esempio, è necessario avviare [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)] come amministratore.</span><span class="sxs-lookup"><span data-stu-id="e37cd-137">When launching [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)], you must run as an administrator to execute the sample successfully.</span></span> <span data-ttu-id="e37cd-138">Eseguire questa operazione facendo clic con il [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)] icona e scegliendo **Esegui come amministratore** dal menu di scelta rapida.</span><span class="sxs-lookup"><span data-stu-id="e37cd-138">Do this by right-clicking the [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)] icon and choosing **Run as Administrator** from the context menu.</span></span>  
  
2.  <span data-ttu-id="e37cd-139">Premere CTRL+MAIUSC+B per compilare la soluzione, quindi premere CTRL+F5 per eseguire il progetto di applicazione console.</span><span class="sxs-lookup"><span data-stu-id="e37cd-139">Press CTRL+SHIFT+B to build the solution and then press CTRL+F5 to run the console application project.</span></span> <span data-ttu-id="e37cd-140">Se nell'esecuzione del progetto il debug è abilitato (premendo F5 anziché CTRL+F5), il debugger si arresta quando viene generata un'eccezione dalla verifica GET e PUT condizionale.</span><span class="sxs-lookup"><span data-stu-id="e37cd-140">If running this project with debugging enabled (by pressing F5 instead of CTRL+F5), the debugger stops when an exception is thrown by the conditional GET and PUT checking.</span></span> <span data-ttu-id="e37cd-141">Quando ciò si verifica, premere F5 per continuare l'esecuzione dell'esempio.</span><span class="sxs-lookup"><span data-stu-id="e37cd-141">When this happens, press F5 to continue executing the sample.</span></span>  
  
3.  <span data-ttu-id="e37cd-142">Viene visualizzata la finestra della console, che fornisce l'URI del servizio in esecuzione e l'URI della pagina della Guida HTML per il servizio in esecuzione.</span><span class="sxs-lookup"><span data-stu-id="e37cd-142">The console window appear sand provides the URI of the running service and the URI of the HTML help page for the running service.</span></span>  
  
4.  <span data-ttu-id="e37cd-143">Durante l'esecuzione dell'esempio, il client invia richieste al servizio e scrive le risposte nella finestra della console.</span><span class="sxs-lookup"><span data-stu-id="e37cd-143">As the sample runs, the client sends requests to the service and writes the responses to the console window.</span></span>  
  
5.  <span data-ttu-id="e37cd-144">Premere un tasto qualsiasi per terminare l'esempio.</span><span class="sxs-lookup"><span data-stu-id="e37cd-144">Press any key to terminate the sample.</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="e37cd-145">È possibile che gli esempi siano già installati nel computer.</span><span class="sxs-lookup"><span data-stu-id="e37cd-145">The samples may already be installed on your machine.</span></span> <span data-ttu-id="e37cd-146">Verificare la directory seguente (impostazione predefinita) prima di continuare.</span><span class="sxs-lookup"><span data-stu-id="e37cd-146">Check for the following (default) directory before continuing.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples`  
>   
>  <span data-ttu-id="e37cd-147">Se questa directory non esiste, andare al [Windows Communication Foundation (WCF) e gli esempi di Windows Workflow Foundation (WF) per .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780) per scaricare tutti i Windows Communication Foundation (WCF) e [!INCLUDE[wf1](../../../../includes/wf1-md.md)] esempi.</span><span class="sxs-lookup"><span data-stu-id="e37cd-147">If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples.</span></span> <span data-ttu-id="e37cd-148">Questo esempio si trova nella directory seguente.</span><span class="sxs-lookup"><span data-stu-id="e37cd-148">This sample is located in the following directory.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples\WCF\Basic\Web\ConditionalGetAndPut`
