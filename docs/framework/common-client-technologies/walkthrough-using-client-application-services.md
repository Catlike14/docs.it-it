---
title: 'Procedura dettagliata: utilizzo di servizi delle applicazioni client'
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology:
- dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
helpviewer_keywords:
- application services host [client application services]
- client application services, walkthroughs
ms.assetid: bb7c8950-4517-4dae-b705-b74a14059b26
caps.latest.revision: 47
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.translationtype: HT
ms.sourcegitcommit: 306c608dc7f97594ef6f72ae0f5aaba596c936e1
ms.openlocfilehash: 64a27269ee6f3711f0c51f2c97cd8876c3ea6103
ms.contentlocale: it-it
ms.lasthandoff: 07/28/2017

---
# <a name="walkthrough-using-client-application-services"></a><span data-ttu-id="9d9b0-102">Procedura dettagliata: utilizzo di servizi delle applicazioni client</span><span class="sxs-lookup"><span data-stu-id="9d9b0-102">Walkthrough: Using Client Application Services</span></span>
<span data-ttu-id="9d9b0-103">Questo argomento descrive come creare un'applicazione Windows che usa i servizi delle applicazioni client per autenticare gli utenti e recuperare impostazioni e ruoli utente.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-103">This topic describes how to create a Windows application that uses client application services to authenticate users and retrieve user roles and settings.</span></span>  
  
 <span data-ttu-id="9d9b0-104">Questa procedura dettagliata prevede l'esecuzione delle attività seguenti:</span><span class="sxs-lookup"><span data-stu-id="9d9b0-104">In this walkthrough, you perform the following tasks:</span></span>  
  
-   <span data-ttu-id="9d9b0-105">Creare un'applicazione Windows Form e usare Progettazione progetti di [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)] per abilitare e configurare i servizi delle applicazioni client.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-105">Create a Windows Forms application and use the [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)] project designer to enable and configure client application services.</span></span>  
  
-   <span data-ttu-id="9d9b0-106">Creare una semplice applicazione del servizio Web ASP.NET per ospitare i servizi delle applicazioni e testare la configurazione client.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-106">Create a simple ASP.NET Web Service application to host the application services and test your client configuration.</span></span>  
  
-   <span data-ttu-id="9d9b0-107">Aggiungere l'autenticazione basata su form all'applicazione.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-107">Add forms authentication to your application.</span></span> <span data-ttu-id="9d9b0-108">Si inizierà usando un nome utente e una password specificati a livello di codice (hardcoded) per testare il servizio.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-108">You will start by using a hard-coded user name and password to test the service.</span></span> <span data-ttu-id="9d9b0-109">Si proseguirà quindi aggiungendo un form di accesso specificandolo come provider di credenziali nella configurazione dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-109">You will then add a login form by specifying it as a credentials provider in your application configuration.</span></span>  
  
-   <span data-ttu-id="9d9b0-110">Aggiungere la funzionalità basata sui ruoli, abilitando e visualizzando un pulsante solo per gli utenti nel ruolo "manager".</span><span class="sxs-lookup"><span data-stu-id="9d9b0-110">Add role-based functionality, enabling and displaying a button only for users in the "manager" role.</span></span>  
  
-   <span data-ttu-id="9d9b0-111">Accedere alle impostazioni Web.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-111">Access Web settings.</span></span> <span data-ttu-id="9d9b0-112">Si inizierà con il caricamento delle impostazioni Web di un utente (test) autenticato nella pagina **Impostazioni** di Progettazione progetti.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-112">You will start by loading Web settings for an authenticated (test) user on the **Settings** page of the project designer.</span></span> <span data-ttu-id="9d9b0-113">Si proseguirà quindi con l'uso di Progettazione Windows Form per associare una casella di testo a un'impostazione Web.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-113">You will then use the Windows Forms Designer to bind a text box to a Web setting.</span></span> <span data-ttu-id="9d9b0-114">Infine, il valore modificato verrà salvato nuovamente sul server.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-114">Finally, you will save the modified value back to the server.</span></span>  
  
-   <span data-ttu-id="9d9b0-115">Implementare la disconnessione.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-115">Implement logout.</span></span> <span data-ttu-id="9d9b0-116">Verrà aggiunta un'opzione di disconnessione al form e verrà chiamato un metodo di disconnessione.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-116">You will add a logout option to the form and call a logout method.</span></span>  
  
-   <span data-ttu-id="9d9b0-117">Abilitare la modalità offline.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-117">Enable offline mode.</span></span> <span data-ttu-id="9d9b0-118">Si fornirà una casella di controllo che consenta agli utenti di specificare lo stato della connessione.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-118">You will provide a check box so that users can specify their connection status.</span></span> <span data-ttu-id="9d9b0-119">Si userà quindi questo valore per specificare se i provider di servizi delle applicazioni client dovranno usare localmente i dati memorizzati nella cache anziché accedere ai servizi Web.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-119">You will then use this value to specify whether the client application service providers will use locally cached data instead of accessing their Web services.</span></span> <span data-ttu-id="9d9b0-120">Infine, verrà autenticato di nuovo l'utente corrente dopo che l'applicazione torna in modalità online.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-120">Finally, you will re-authenticate the current user when the application returns to online mode.</span></span>  
  
## <a name="prerequisites"></a><span data-ttu-id="9d9b0-121">Prerequisiti</span><span class="sxs-lookup"><span data-stu-id="9d9b0-121">Prerequisites</span></span>  
 <span data-ttu-id="9d9b0-122">Per completare questa procedura dettagliata, è necessario disporre del componente seguente:</span><span class="sxs-lookup"><span data-stu-id="9d9b0-122">You need the following component to complete this walkthrough:</span></span>  
  
-   [!INCLUDE[vs_orcas_long](../../../includes/vs-orcas-long-md.md)]<span data-ttu-id="9d9b0-123">.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-123">.</span></span>  
  
## <a name="creating-the-client-application"></a><span data-ttu-id="9d9b0-124">Creazione dell'applicazione client</span><span class="sxs-lookup"><span data-stu-id="9d9b0-124">Creating the Client Application</span></span>  
 <span data-ttu-id="9d9b0-125">È innanzitutto necessario creare un progetto Windows Form.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-125">The first thing that you will do is create a Windows Forms project.</span></span> <span data-ttu-id="9d9b0-126">Questa procedura dettagliata usa i Windows Form perché familiari a più persone. Il processo è tuttavia simile per i progetti Windows Presentation Foundation (WPF).</span><span class="sxs-lookup"><span data-stu-id="9d9b0-126">This walkthrough uses Windows Forms because more people are familiar with it, but the process is similar for Windows Presentation Foundation (WPF) projects.</span></span>  
  
#### <a name="to-create-a-client-application-and-enable-client-application-services"></a><span data-ttu-id="9d9b0-127">Per creare un'applicazione client e abilitare i servizi dell'applicazione client</span><span class="sxs-lookup"><span data-stu-id="9d9b0-127">To create a client application and enable client application services</span></span>  
  
1.  <span data-ttu-id="9d9b0-128">In [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)] selezionare l'opzione di menu **File &#124; Nuovo &#124; Progetto**.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-128">In [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)], select the **File &#124; New &#124; Project** menu option.</span></span>  
  
2.  <span data-ttu-id="9d9b0-129">Nel riquadro **Tipi progetto** della finestra di dialogo **Nuovo progetto** espandere il nodo **Visual Basic** o **Visual C#**, quindi selezionare il tipo di progetto **Windows**.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-129">In the **New Project** dialog box, in the **Project types** pane, expand the **Visual Basic** or **Visual C#** node and select the **Windows** project type.</span></span>  
  
3.  <span data-ttu-id="9d9b0-130">Assicurarsi che l'opzione **.NET Framework 3.5** sia selezionata, quindi selezionare il modello **Applicazione Windows Form** .</span><span class="sxs-lookup"><span data-stu-id="9d9b0-130">Make sure that **.NET Framework 3.5** is selected, and then select the **Windows Forms Application** template.</span></span>  
  
4.  <span data-ttu-id="9d9b0-131">Modificare il **Nome** del progetto in `ClientAppServicesDemo`, quindi fare clic su **OK**.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-131">Change the project **Name** to `ClientAppServicesDemo`, and then click **OK**.</span></span>  
  
     <span data-ttu-id="9d9b0-132">In [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)]verrà aperto un nuovo progetto Windows Form.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-132">A new Windows Forms project is opened in [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)].</span></span>  
  
5.  <span data-ttu-id="9d9b0-133">Scegliere **Proprietà di ClientAppServicesDemo** dal menu **Progetto**.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-133">On the **Project** menu, select **ClientAppServicesDemo Properties**.</span></span>  
  
     <span data-ttu-id="9d9b0-134">Verrà visualizzata la finestra Progettazione progetti.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-134">The project designer appears.</span></span>  
  
6.  <span data-ttu-id="9d9b0-135">Nella scheda **Servizi** selezionare **Attiva servizi applicazioni client**.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-135">On the **Services** tab, select **Enable client application services**.</span></span>  
  
7.  <span data-ttu-id="9d9b0-136">Assicurarsi che l'opzione **Usa autenticazione basata su form** sia selezionata, quindi impostare **Percorso servizio di autenticazione**, **Percorso servizi ruoli**e **Percorso servizi impostazioni Web** su `http://localhost:55555/AppServices`.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-136">Make sure that **Use Forms authentication** is selected, and then set **Authentication service location**, **Roles service location**, and **Web settings service location** to `http://localhost:55555/AppServices`.</span></span>  
  
8.  <span data-ttu-id="9d9b0-137">In [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]selezionare la scheda **Applicazione** e scegliere **Definita dall'applicazione** per **Modalità di autenticazione**.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-137">For [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)], on the **Application** tab, set **Authentication mode** to **Application-defined**.</span></span>  
  
 <span data-ttu-id="9d9b0-138">Le impostazioni specificate nel file app.config dell'applicazione vengono archiviate nella finestra di progettazione.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-138">The designer stores the specified settings in the application's app.config file.</span></span>  
  
 <span data-ttu-id="9d9b0-139">A questo punto l'applicazione è configurata per accedere a tutti e tre i servizi dallo stesso host.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-139">At this point, the application is configured to access all three services from the same host.</span></span> <span data-ttu-id="9d9b0-140">Nella sezione successiva verrà creato l'host come semplice applicazione del servizio Web in modo che sia possibile testare la configurazione client.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-140">In the next section, you will create the host as a simple Web service application, enabling you to test your client configuration.</span></span>  
  
## <a name="creating-the-application-services-host"></a><span data-ttu-id="9d9b0-141">Creazione dell'host per i servizi delle applicazioni</span><span class="sxs-lookup"><span data-stu-id="9d9b0-141">Creating the Application Services Host</span></span>  
 <span data-ttu-id="9d9b0-142">In questa sezione verrà creata una semplice applicazione servizio Web in grado di accedere ai dati dell'utente da un file di database di SQL Server Compact locale.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-142">In this section, you will create a simple Web service application that accesses user data from a local SQL Server Compact database file.</span></span> <span data-ttu-id="9d9b0-143">Quindi, il database verrà popolato usando lo [ASP.NET Web Site Administration Tool](http://msdn.microsoft.com/library/100ddd8b-7d11-4df9-91ef-0bbbe92e5aec).</span><span class="sxs-lookup"><span data-stu-id="9d9b0-143">Then, you will populate the database using the [ASP.NET Web Site Administration Tool](http://msdn.microsoft.com/library/100ddd8b-7d11-4df9-91ef-0bbbe92e5aec).</span></span> <span data-ttu-id="9d9b0-144">Questa semplice configurazione consente di testare rapidamente l'applicazione client.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-144">This simple configuration enables you to quickly test your client application.</span></span> <span data-ttu-id="9d9b0-145">In alternativa, è possibile configurare l'host del servizio Web per accedere ai dati dell'utente da un database SQL Server completo o mediante le classi personalizzate <xref:System.Web.Security.MembershipProvider> e <xref:System.Web.Security.RoleProvider> .</span><span class="sxs-lookup"><span data-stu-id="9d9b0-145">As an alternative, you can configure the Web service host to access user data from a full SQL Server database or through custom <xref:System.Web.Security.MembershipProvider> and <xref:System.Web.Security.RoleProvider> classes.</span></span> <span data-ttu-id="9d9b0-146">Per altre informazioni, vedere [Creating and Configuring the Application Services Database for SQL Server](http://msdn.microsoft.com/library/ab894e83-7e2f-4af8-a116-b1bff8f815b2).</span><span class="sxs-lookup"><span data-stu-id="9d9b0-146">For more information, see [Creating and Configuring the Application Services Database for SQL Server](http://msdn.microsoft.com/library/ab894e83-7e2f-4af8-a116-b1bff8f815b2).</span></span>  
  
 <span data-ttu-id="9d9b0-147">Nella procedura seguente viene creato e configurato il servizio Web di AppServices.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-147">In the following procedure, you create and configure the AppServices Web service.</span></span>  
  
#### <a name="to-create-and-configure-the-application-services-host"></a><span data-ttu-id="9d9b0-148">Per creare e configurare l'host dei servizi delle applicazioni</span><span class="sxs-lookup"><span data-stu-id="9d9b0-148">To create and configure the application services host</span></span>  
  
1.  <span data-ttu-id="9d9b0-149">In **Esplora soluzioni** selezionare la soluzione ClientAppServicesDemo, quindi scegliere **Aggiungi&#124; Nuovo progetto** dal menu **File**.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-149">In **Solution Explorer**, select the ClientAppServicesDemo solution, and then on the **File** menu, select **Add &#124; New Project**.</span></span>  
  
2.  <span data-ttu-id="9d9b0-150">Nel riquadro **Tipi progetto** della finestra di dialogo **Aggiungi nuovo progetto** espandere il nodo **Visual Basic** o **Visual C#**, quindi scegliere il tipo di progetto **Web**.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-150">In the **Add New Project** dialog box, in the **Project types** pane, expand the **Visual Basic** or **Visual C#** node and select the **Web** project type.</span></span>  
  
3.  <span data-ttu-id="9d9b0-151">Assicurarsi che l'opzione **.NET Framework 3.5** sia selezionata, quindi selezionare il modello **Applicazione servizio Web ASP.NET** .</span><span class="sxs-lookup"><span data-stu-id="9d9b0-151">Make sure that **.NET Framework 3.5** is selected, and then select the **ASP.NET Web Service Application** template.</span></span>  
  
4.  <span data-ttu-id="9d9b0-152">Modificare il **Nome** del progetto in `AppServices` , quindi fare clic su **OK**.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-152">Change the project **Name** to `AppServices` and then click **OK**.</span></span>  
  
     <span data-ttu-id="9d9b0-153">Viene aggiunto un nuovo progetto di applicazione del servizio Web ASP.NET alla soluzione e nell'editor viene visualizzato il file Service1.asmx.vb o Service1.asmx.cs.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-153">A new ASP.NET Web service application project is added to the solution, and the Service1.asmx.vb or Service1.asmx.cs file appears in the editor.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="9d9b0-154">Il file Service1.asmx.vb o Service1.asmx.cs in questo esempio non viene usato.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-154">The Service1.asmx.vb or Service1.asmx.cs file is not used in this example.</span></span> <span data-ttu-id="9d9b0-155">È possibile chiuderlo ed eliminarlo da **Esplora soluzioni**per non ingombrare l'ambiente di lavoro.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-155">If you want to keep your work environment uncluttered, you can close it and delete it from **Solution Explorer**.</span></span>  
  
5.  <span data-ttu-id="9d9b0-156">In **Esplora soluzioni**selezionare il progetto AppServices, quindi scegliere **Proprietà di AppServices** dal menu **Progetto**.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-156">In **Solution Explorer**, select the AppServices project, and then on the **Project** menu, select **AppServices Properties**.</span></span>  
  
     <span data-ttu-id="9d9b0-157">Verrà visualizzata la finestra Progettazione progetti.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-157">The project designer appears.</span></span>  
  
6.  <span data-ttu-id="9d9b0-158">Nella scheda **Web** verificare che l'opzione **Usa Visual Studio Development Server** sia selezionata.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-158">On the **Web** tab, make sure that **Use Visual Studio Development Server** is selected.</span></span>  
  
7.  <span data-ttu-id="9d9b0-159">Selezionare **Porta specifica**, specificare il valore `55555`, quindi impostare **Percorso virtuale** su `/AppServices`.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-159">Select **Specific port**, specify a value of `55555`, and then set **Virtual path** to `/AppServices`.</span></span>  
  
8.  <span data-ttu-id="9d9b0-160">Salvare tutti i file.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-160">Save all files.</span></span>  
  
9. <span data-ttu-id="9d9b0-161">In **Esplora soluzioni**aprire il file Web.config e individuare il tag di apertura `<system.web>` .</span><span class="sxs-lookup"><span data-stu-id="9d9b0-161">In **Solution Explorer**, open Web.config and find the `<system.web>` opening tag.</span></span>  
  
10. <span data-ttu-id="9d9b0-162">Aggiungere il markup seguente prima del tag `<system.web>` .</span><span class="sxs-lookup"><span data-stu-id="9d9b0-162">Add the following markup before the `<system.web>` tag.</span></span>  
  
     <span data-ttu-id="9d9b0-163">Gli elementi `authenticationService`, `profileService`e `roleService` in questo markup abilitano e configurano i servizi delle applicazioni.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-163">The `authenticationService`, `profileService`, and `roleService` elements in this markup enable and configure the application services.</span></span> <span data-ttu-id="9d9b0-164">Ai fini dell'esecuzione del test, l'attributo `requireSSL` dell'elemento `authenticationService` viene impostato su "false".</span><span class="sxs-lookup"><span data-stu-id="9d9b0-164">For testing purposes, the `requireSSL` attribute of the `authenticationService` element is set to "false".</span></span> <span data-ttu-id="9d9b0-165">Gli attributi `readAccessProperties` e `writeAccessProperties` dell'elemento `profileService` indicano che la proprietà `WebSettingsTestText` è di lettura/scrittura.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-165">The `readAccessProperties` and `writeAccessProperties` attributes of the `profileService` element indicate that the `WebSettingsTestText` property is read/write.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="9d9b0-166">Nel codice di produzione è consigliabile accedere al servizio di autenticazione sempre tramite SSL (Secure Sockets Layer) usando il protocollo HTTPS.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-166">In production code, you should always access the authentication service over the secure sockets layer (SSL, by using the HTTPS protocol).</span></span> <span data-ttu-id="9d9b0-167">Per informazioni sulla configurazione di SSL, vedere [Configurazione di SSL (Secure Sockets Layer) nella guida operativa di IIS 6.0](http://go.microsoft.com/fwlink/?LinkId=91844).</span><span class="sxs-lookup"><span data-stu-id="9d9b0-167">For information about how to set up SSL, see [Configuring Secure Sockets Layer (IIS 6.0 Operations Guide)](http://go.microsoft.com/fwlink/?LinkId=91844).</span></span>  
  
    ```xml  
    <system.web.extensions>  
      <scripting>  
        <webServices>  
          <authenticationService enabled="true" requireSSL = "false"/>  
          <profileService enabled="true"  
            readAccessProperties="WebSettingsTestText"  
            writeAccessProperties="WebSettingsTestText" />  
          <roleService enabled="true"/>  
        </webServices>  
      </scripting>  
    </system.web.extensions>  
    ```  
  
11. <span data-ttu-id="9d9b0-168">Aggiungere il markup seguente dopo il tag di apertura `<system.web>` in modo che venga incluso nell'elemento `<system.web>` .</span><span class="sxs-lookup"><span data-stu-id="9d9b0-168">Add the following markup after the `<system.web>` opening tag so that it is within the `<system.web>` element.</span></span>  
  
     <span data-ttu-id="9d9b0-169">L'elemento `profile` configura una sola impostazione Web denominata `WebSettingsTestText`.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-169">The `profile` element configures a single Web setting named `WebSettingsTestText`.</span></span>  
  
    ```xml  
    <profile enabled="true" >  
      <properties>  
        <add name="WebSettingsTestText" type="string"   
          readOnly="false" defaultValue="DefaultText"   
          serializeAs="String" allowAnonymous="false" />  
      </properties>  
    </profile>  
    ```  
  
 <span data-ttu-id="9d9b0-170">Nella procedura seguente viene usato lo strumento Amministrazione sito Web di ASP.NET per completare la configurazione del servizio e popolare il file di database locale.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-170">In the following procedure, you use the ASP.NET Web Site Administration tool to complete the service configuration and populate the local database file.</span></span> <span data-ttu-id="9d9b0-171">Vengono aggiunti due utenti denominati `employee` e `manager` appartenenti ai due ruoli con gli stessi nomi.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-171">You will add two users named `employee` and `manager` belonging to two roles with the same names.</span></span> <span data-ttu-id="9d9b0-172">Le password utente sono, rispettivamente, `employee!` e `manager!` .</span><span class="sxs-lookup"><span data-stu-id="9d9b0-172">The user passwords are `employee!` and `manager!` respectively.</span></span>  
  
#### <a name="to-configure-membership-and-roles"></a><span data-ttu-id="9d9b0-173">Per configurare l'appartenenza e i ruoli</span><span class="sxs-lookup"><span data-stu-id="9d9b0-173">To configure membership and roles</span></span>  
  
1.  <span data-ttu-id="9d9b0-174">In **Esplora soluzioni**selezionare il progetto AppServices, quindi scegliere **Configurazione ASP.NET** dal menu **Progetto**.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-174">In **Solution Explorer**, select the AppServices project, and then on the **Project** menu, select **ASP.NET Configuration**.</span></span>  
  
     <span data-ttu-id="9d9b0-175">Viene visualizzato lo **Strumento Amministrazione sito Web di ASP.NET** .</span><span class="sxs-lookup"><span data-stu-id="9d9b0-175">The **ASP.NET Web Site Administration Tool** appears.</span></span>  
  
2.  <span data-ttu-id="9d9b0-176">Nella scheda **Sicurezza** scegliere **Usare la Configurazione guidata sicurezza per configurare la sicurezza mediante passaggi successivi**.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-176">On the **Security** tab, click **Use the security Setup Wizard to configure security step by step**.</span></span>  
  
     <span data-ttu-id="9d9b0-177">Viene aperta la **Configurazione guidata sicurezza** e viene visualizzato il passaggio **Introduzione** .</span><span class="sxs-lookup"><span data-stu-id="9d9b0-177">The **Security Setup Wizard** appears and displays the **Welcome** step.</span></span>  
  
3.  <span data-ttu-id="9d9b0-178">Scegliere **Avanti**.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-178">Click **Next**.</span></span>  
  
     <span data-ttu-id="9d9b0-179">Viene visualizzato il passaggio **Selezione del metodo di accesso** .</span><span class="sxs-lookup"><span data-stu-id="9d9b0-179">The **Select Access Method** step appears.</span></span>  
  
4.  <span data-ttu-id="9d9b0-180">Selezionare **Da Internet**.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-180">Select **From the internet**.</span></span> <span data-ttu-id="9d9b0-181">Il servizio viene configurato in modo da usare l'autenticazione basata su form anziché l'autenticazione di Windows.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-181">This configures the service to use Forms authentication instead of Windows authentication.</span></span>  
  
5.  <span data-ttu-id="9d9b0-182">Scegliere **Avanti** per due volte.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-182">Click **Next** twice.</span></span>  
  
     <span data-ttu-id="9d9b0-183">Viene visualizzato il passaggio **Definizione dei ruoli** .</span><span class="sxs-lookup"><span data-stu-id="9d9b0-183">The **Define Roles** step appears.</span></span>  
  
6.  <span data-ttu-id="9d9b0-184">Selezionare **Abilitare i ruoli per il sito Web**.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-184">Select **Enable roles for this Web site**.</span></span>  
  
7.  <span data-ttu-id="9d9b0-185">Scegliere **Avanti**.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-185">Click **Next**.</span></span> <span data-ttu-id="9d9b0-186">Viene visualizzato il form **Crea nuovo ruolo** .</span><span class="sxs-lookup"><span data-stu-id="9d9b0-186">The **Create New Role** form appears.</span></span>  
  
8.  <span data-ttu-id="9d9b0-187">Nella casella di testo **Nuovo nome ruolo** digitare `manager` , quindi fare clic su **Aggiungi ruolo**.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-187">In the **New Role Name** text box, type `manager` and then click **Add Role**.</span></span>  
  
     <span data-ttu-id="9d9b0-188">Viene visualizzata la tabella **Ruoli esistenti** con il valore specificato.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-188">The **Existing Roles** table appears with the specified value.</span></span>  
  
9. <span data-ttu-id="9d9b0-189">Nella casella di testo **Nuovo nome ruolo** sostituire `manager` con `employee` , quindi fare clic su **Aggiungi ruolo**.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-189">In the **New Role Name** text box, replace `manager` with `employee` and then click **Add Role**.</span></span>  
  
     <span data-ttu-id="9d9b0-190">Il nuovo valore viene visualizzato nella tabella **Ruoli esistenti** .</span><span class="sxs-lookup"><span data-stu-id="9d9b0-190">The new value appears in the **Existing Roles** table.</span></span>  
  
10. <span data-ttu-id="9d9b0-191">Scegliere **Avanti**.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-191">Click **Next**.</span></span>  
  
     <span data-ttu-id="9d9b0-192">Viene visualizzato il passaggio **Aggiunta di nuovi utenti** .</span><span class="sxs-lookup"><span data-stu-id="9d9b0-192">The **Add New Users** step appears.</span></span>  
  
11. <span data-ttu-id="9d9b0-193">Nel form **Crea utente** specificare i valori seguenti.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-193">In the **Create User** form, specify the following values.</span></span>  
  
  	|||  
  	|-|-|  
  	|<span data-ttu-id="9d9b0-194">**Nome utente**</span><span class="sxs-lookup"><span data-stu-id="9d9b0-194">**User Name**</span></span>|`manager`|  
  	|<span data-ttu-id="9d9b0-195">**Password**</span><span class="sxs-lookup"><span data-stu-id="9d9b0-195">**Password**</span></span>|`manager!`|  
  	|<span data-ttu-id="9d9b0-196">**Conferma password**</span><span class="sxs-lookup"><span data-stu-id="9d9b0-196">**Confirm Password**</span></span>|`manager!`|  
  	|<span data-ttu-id="9d9b0-197">**Posta elettronica**</span><span class="sxs-lookup"><span data-stu-id="9d9b0-197">**E-mail**</span></span>|`manager@contoso.com`|  
  	|<span data-ttu-id="9d9b0-198">**Domanda segreta**</span><span class="sxs-lookup"><span data-stu-id="9d9b0-198">**Security Question**</span></span>|`manager`|  
  	|<span data-ttu-id="9d9b0-199">**Risposta segreta**</span><span class="sxs-lookup"><span data-stu-id="9d9b0-199">**Security Answer**</span></span>|`manager`|  
  
12. <span data-ttu-id="9d9b0-200">Fare clic su **Crea utente**.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-200">Click **Create User**.</span></span>  
  
     <span data-ttu-id="9d9b0-201">Viene visualizzato un messaggio che indica l'esito positivo dell'operazione.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-201">A success message appears.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="9d9b0-202">Nel form è richiesta l'immissione dei valori **Posta elettronica**, **Domanda segreta**e **Risposta segreta** ; in questo esempio tuttavia questi valori non vengono usati.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-202">The **E-mail**, **Security Question**, and **Security Answer** values are required by the form, but are not used in this example.</span></span>  
  
13. <span data-ttu-id="9d9b0-203">Scegliere **Continua**.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-203">Click **Continue**.</span></span>  
  
     <span data-ttu-id="9d9b0-204">Viene visualizzato nuovamente il form **Crea utente** .</span><span class="sxs-lookup"><span data-stu-id="9d9b0-204">The **Create User** form reappears.</span></span>  
  
14. <span data-ttu-id="9d9b0-205">Nel form **Crea utente** specificare i valori seguenti.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-205">In the **Create User** form, specify the following values.</span></span>  
  
  	|||  
  	|-|-|  
  	|<span data-ttu-id="9d9b0-206">**Nome utente**</span><span class="sxs-lookup"><span data-stu-id="9d9b0-206">**User Name**</span></span>|`employee`|  
  	|<span data-ttu-id="9d9b0-207">**Password**</span><span class="sxs-lookup"><span data-stu-id="9d9b0-207">**Password**</span></span>|`employee!`|  
  	|<span data-ttu-id="9d9b0-208">**Conferma password**</span><span class="sxs-lookup"><span data-stu-id="9d9b0-208">**Confirm Password**</span></span>|`employee!`|  
  	|<span data-ttu-id="9d9b0-209">**Posta elettronica**</span><span class="sxs-lookup"><span data-stu-id="9d9b0-209">**E-mail**</span></span>|`employee@contoso.com`|  
  	|<span data-ttu-id="9d9b0-210">**Domanda segreta**</span><span class="sxs-lookup"><span data-stu-id="9d9b0-210">**Security Question**</span></span>|`Employee`|  
  	|<span data-ttu-id="9d9b0-211">**Risposta segreta**</span><span class="sxs-lookup"><span data-stu-id="9d9b0-211">**Security Answer**</span></span>|`employee`|  
  
15. <span data-ttu-id="9d9b0-212">Fare clic su **Crea utente**.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-212">Click **Create User**.</span></span>  
  
     <span data-ttu-id="9d9b0-213">Viene visualizzato un messaggio che indica l'esito positivo dell'operazione.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-213">A success message appears.</span></span>  
  
16. <span data-ttu-id="9d9b0-214">Scegliere **Fine**.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-214">Click **Finish**.</span></span>  
  
     <span data-ttu-id="9d9b0-215">Viene visualizzato nuovamente lo **Strumento Amministrazione sito Web di ASP.NET** .</span><span class="sxs-lookup"><span data-stu-id="9d9b0-215">The **Web Site Administration Tool** reappears.</span></span>  
  
17. <span data-ttu-id="9d9b0-216">Fare clic su **Utenti Manager**.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-216">Click **Manager users**.</span></span>  
  
     <span data-ttu-id="9d9b0-217">Viene visualizzato l'elenco degli utenti.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-217">The list of users appears.</span></span>  
  
18. <span data-ttu-id="9d9b0-218">Fare clic su **Modifica ruoli** per l'utente **employee** , quindi selezionare il ruolo **employee** .</span><span class="sxs-lookup"><span data-stu-id="9d9b0-218">Click **Edit roles** for the **employee** user, and then select the **employee** role.</span></span>  
  
19. <span data-ttu-id="9d9b0-219">Fare clic su **Modifica ruoli** per l'utente **manager** , quindi selezionare il ruolo **manager** .</span><span class="sxs-lookup"><span data-stu-id="9d9b0-219">Click **Edit roles** for the **manager** user, and then select the **manager** role.</span></span>  
  
20. <span data-ttu-id="9d9b0-220">Chiudere la finestra del browser contenente lo **Strumento Amministrazione sito Web**.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-220">Close the browser window that hosts the **Web Site Administration Tool**.</span></span>  
  
21. <span data-ttu-id="9d9b0-221">Se viene visualizzata una finestra di messaggio in cui viene chiesto se si vuole ricaricare il file Web.config modificato, fare clic su **Sì**.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-221">If a message box appears asking if you want to reload the modified Web.config file, click **Yes**.</span></span>  
  
 <span data-ttu-id="9d9b0-222">Questo completa la configurazione del servizio Web.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-222">This completes the Web service setup.</span></span> <span data-ttu-id="9d9b0-223">A questo punto è possibile premere F5 per eseguire l'applicazione client insieme alla quale verrà automaticamente avviato il **Server di sviluppo ASP.NET** .</span><span class="sxs-lookup"><span data-stu-id="9d9b0-223">At this point, you can press F5 to run the client application, and the **ASP.NET Development Server** will start automatically along with your client application.</span></span> <span data-ttu-id="9d9b0-224">Il server rimarrà in esecuzione dopo la chiusura dell'applicazione, ma verrà riavviato al riavvio dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-224">The server will continue to run after you exit the application, but will restart when you restart the application.</span></span> <span data-ttu-id="9d9b0-225">In questo modo è possibile rilevare tutte le modifiche apportate al file Web.config.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-225">This allows it to detect any changes you have made to Web.config.</span></span>  
  
 <span data-ttu-id="9d9b0-226">Per arrestare manualmente il server, fare clic con il pulsante destro del mouse sull'icona di Server di sviluppo ASP.NET nell'area di notifica della barra delle applicazioni, quindi scegliere **Arresta**.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-226">To stop the server manually, right-click the ASP.NET Development Server icon in the notification area of the taskbar and then click **Stop**.</span></span> <span data-ttu-id="9d9b0-227">Questa operazione è talvolta utile per assicurarsi che il riavvio venga eseguito correttamente.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-227">This is useful occasionally to make sure that a clean restart occurs.</span></span>  
  
## <a name="adding-forms-authentication"></a><span data-ttu-id="9d9b0-228">Aggiunta dell'autenticazione basata su form</span><span class="sxs-lookup"><span data-stu-id="9d9b0-228">Adding Forms Authentication</span></span>  
 <span data-ttu-id="9d9b0-229">Nella procedura seguente viene aggiunto il codice al form principale che tenta di convalidare l'utente e nega l'accesso quando l'utente specifica credenziali non valide.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-229">In the following procedure, you add code to the main form that attempts to validate the user, and denies access when the user supplies invalid credentials.</span></span> <span data-ttu-id="9d9b0-230">Vengono usati un nome utente e una password specificati a livello di codice (hardcoded) per testare il servizio.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-230">You use a hard-coded user name and password to test the service.</span></span>  
  
#### <a name="to-validate-the-user-in-your-application-code"></a><span data-ttu-id="9d9b0-231">Per convalidare l'utente nel codice dell'applicazione</span><span class="sxs-lookup"><span data-stu-id="9d9b0-231">To validate the user in your application code</span></span>  
  
1.  <span data-ttu-id="9d9b0-232">Nel progetto ClientAppServicesDemo in **Esplora soluzioni** aggiungere un riferimento all'assembly System.Web.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-232">In **Solution Explorer**, in the ClientAppServicesDemo project, add a reference to the System.Web assembly.</span></span>  
  
2.  <span data-ttu-id="9d9b0-233">Selezionare il file Form1, quindi scegliere **Visualizza &#124; Codice** dal menu principale di [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)].</span><span class="sxs-lookup"><span data-stu-id="9d9b0-233">Select the Form1 file and then select **View &#124; Code** from the [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)] main menu.</span></span>  
  
3.  <span data-ttu-id="9d9b0-234">Nell'editor del codice aggiungere le seguenti istruzioni all'inizio del file Form1.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-234">In the code editor, add the following statements to the top of the Form1 file.</span></span>  
  
     <span data-ttu-id="9d9b0-235">[!code-csharp[ClientApplicationServices#001](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#001)]  [!code-vb[ClientApplicationServices#001](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#001)]</span><span class="sxs-lookup"><span data-stu-id="9d9b0-235">[!code-csharp[ClientApplicationServices#001](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#001)]  [!code-vb[ClientApplicationServices#001](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#001)]</span></span>  
  
4.  <span data-ttu-id="9d9b0-236">In **Esplora soluzioni** fare doppio clic su Form1 per visualizzare la finestra di progettazione.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-236">In **Solution Explorer**, double-click Form1 to display the designer.</span></span>  
  
5.  <span data-ttu-id="9d9b0-237">Nella finestra di progettazione fare doppio clic nell'area del form per generare un gestore eventi <xref:System.Windows.Forms.Form.Load?displayProperty=fullName> denominato `Form1_Load`.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-237">In the designer, double-click the form surface to generate a <xref:System.Windows.Forms.Form.Load?displayProperty=fullName> event handler named `Form1_Load`.</span></span>  
  
     <span data-ttu-id="9d9b0-238">Verrà visualizzato il cursore nel metodo `Form1_Load` all'interno dell'editor del codice.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-238">The code editor appears with the cursor in the `Form1_Load` method.</span></span>  
  
6.  <span data-ttu-id="9d9b0-239">Aggiungere al metodo `Form1_Load` il seguente codice.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-239">Add the following code to the `Form1_Load` method.</span></span>  
  
     <span data-ttu-id="9d9b0-240">Questo codice nega l'accesso agli utenti non autenticati chiudendo l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-240">This code denies access to unauthenticated users by exiting the application.</span></span> <span data-ttu-id="9d9b0-241">In alternativa, è possibile consentire agli utenti non autenticati di accedere al form ma non a specifiche funzionalità.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-241">Alternatively, you could allow unauthenticated users access to the form, but deny access to specific functionality.</span></span> <span data-ttu-id="9d9b0-242">Generalmente non è necessario specificare a livello di codice il nome utente e la password, tuttavia questa operazione è utile a scopo di test.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-242">Normally, you will not hard-code the user name and password like this, but it is useful for testing purposes.</span></span> <span data-ttu-id="9d9b0-243">Nella sezione successiva verrà sostituito questo codice con un codice più affidabile che visualizza una finestra di dialogo di accesso e include la gestione delle eccezioni.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-243">In the next section, you will replace this code with more robust code that displays a login dialog box and includes exception handling.</span></span>  
  
     <span data-ttu-id="9d9b0-244">Si noti che il metodo `static` <xref:System.Web.Security.Membership.ValidateUser%2A?displayProperty=fullName> è incluso in [!INCLUDE[dnprdnext](../../../includes/dnprdnext-md.md)].</span><span class="sxs-lookup"><span data-stu-id="9d9b0-244">Note that the `static` <xref:System.Web.Security.Membership.ValidateUser%2A?displayProperty=fullName> method is in the [!INCLUDE[dnprdnext](../../../includes/dnprdnext-md.md)].</span></span> <span data-ttu-id="9d9b0-245">Questo metodo delega il lavoro al provider di autenticazione configurato e restituisce `true` se l'autenticazione viene eseguita correttamente.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-245">This method delegates its work to the configured authentication provider, and returns `true` if authentication is successful.</span></span> <span data-ttu-id="9d9b0-246">L'applicazione non richiede un riferimento diretto al provider di autenticazione del client.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-246">Your application does not require a direct reference to the client authentication provider.</span></span>  
  
     <span data-ttu-id="9d9b0-247">[!code-csharp[ClientApplicationServices#300](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Class1.cs#300)]  [!code-vb[ClientApplicationServices#300](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Class1.vb#300)]</span><span class="sxs-lookup"><span data-stu-id="9d9b0-247">[!code-csharp[ClientApplicationServices#300](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Class1.cs#300)]  [!code-vb[ClientApplicationServices#300](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Class1.vb#300)]</span></span>  
  
 <span data-ttu-id="9d9b0-248">È ora possibile premere F5 per eseguire l'applicazione. Poiché sono stati specificati un nome utente e una password corretti, è possibile vedere il form.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-248">You can now press F5 to run the application, and because you provide a correct user name and password, you will see the form.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="9d9b0-249">Se non si è in grado di eseguire l'applicazione, provare ad arrestare il server di sviluppo ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-249">If you are unable to run the application, try stopping the ASP.NET Development Server.</span></span> <span data-ttu-id="9d9b0-250">Al riavvio del server verificare che la porta sia impostata su 55555.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-250">When the server restarts, verify that the port is set to 55555.</span></span>  
  
 <span data-ttu-id="9d9b0-251">Per visualizzare invece il messaggio di errore, modificare i parametri <xref:System.Web.Security.Membership.ValidateUser%2A> .</span><span class="sxs-lookup"><span data-stu-id="9d9b0-251">To see the error message instead, change the <xref:System.Web.Security.Membership.ValidateUser%2A> parameters.</span></span> <span data-ttu-id="9d9b0-252">Sostituire ad esempio il secondo parametro `"manager!"` con una password non corretta come `"MANAGER"`.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-252">For example, replace the second `"manager!"` parameter with an incorrect password like `"MANAGER"`.</span></span>  
  
## <a name="adding-a-login-form-as-a-credentials-provider"></a><span data-ttu-id="9d9b0-253">Aggiunta di un form di accesso come provider di credenziali</span><span class="sxs-lookup"><span data-stu-id="9d9b0-253">Adding a Login Form as a Credentials Provider</span></span>  
 <span data-ttu-id="9d9b0-254">È possibile acquisire le credenziali utente nel codice dell'applicazione e passarli al metodo <xref:System.Web.Security.Membership.ValidateUser%2A> .</span><span class="sxs-lookup"><span data-stu-id="9d9b0-254">You can acquire the user credentials in your application code and pass them to the <xref:System.Web.Security.Membership.ValidateUser%2A> method.</span></span> <span data-ttu-id="9d9b0-255">Tuttavia, è spesso utile separare il codice di acquisizione delle credenziali da quello dell'applicazione, qualora dovesse essere necessario modificarlo in seguito.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-255">However, it is often useful to keep your credentials-acquiring code separate from your application code, in case you want to change it later.</span></span>  
  
 <span data-ttu-id="9d9b0-256">Nella procedura seguente viene configurata l'applicazione per usare un provider di credenziali e quindi viene modificata la chiamata al metodo <xref:System.Web.Security.Membership.ValidateUser%2A> in modo da passare <xref:System.String.Empty> per entrambi i parametri.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-256">In the following procedure, you configure your application to use a credentials provider, and then change your <xref:System.Web.Security.Membership.ValidateUser%2A> method call to pass <xref:System.String.Empty> for both parameters.</span></span> <span data-ttu-id="9d9b0-257">Le stringhe vuote indicano al metodo <xref:System.Web.Security.Membership.ValidateUser%2A> di chiamare il metodo <xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider.GetCredentials%2A> del provider di credenziali configurato.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-257">The empty strings signal the <xref:System.Web.Security.Membership.ValidateUser%2A> method to call the <xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider.GetCredentials%2A> method of the configured credentials provider.</span></span>  
  
#### <a name="to-configure-your-application-to-use-a-credentials-provider"></a><span data-ttu-id="9d9b0-258">Per configurare l'applicazione in modo da usare un provider di credenziali</span><span class="sxs-lookup"><span data-stu-id="9d9b0-258">To configure your application to use a credentials provider</span></span>  
  
1.  <span data-ttu-id="9d9b0-259">In **Esplora soluzioni**selezionare il progetto ClientAppServicesDemo, quindi scegliere **Proprietà di ClientAppServicesDemo** dal menu **Progetto**.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-259">In **Solution Explorer**, select the ClientAppServicesDemo project, and then on the **Project** menu, select **ClientAppServicesDemo Properties**.</span></span>  
  
     <span data-ttu-id="9d9b0-260">Verrà visualizzata la finestra Progettazione progetti.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-260">The project designer appears.</span></span>  
  
2.  <span data-ttu-id="9d9b0-261">Nella scheda **Servizi** impostare il valore seguente per **Facoltativo: provider di credenziali** .</span><span class="sxs-lookup"><span data-stu-id="9d9b0-261">On the **Services** tab, set **Optional: Credential provider** to the following value.</span></span> <span data-ttu-id="9d9b0-262">Questo valore indica il nome di tipo qualificato dall'assembly.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-262">This value indicates the assembly-qualified type name.</span></span>  
  
    ```  
    ClientAppServicesDemo.Login, ClientAppServicesDemo  
    ```  
  
3.  <span data-ttu-id="9d9b0-263">Nel file di codice Form1 sostituire il codice nel metodo `Form1_Load` con il codice seguente.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-263">In the Form1 code file, replace the code in the `Form1_Load` method with the following code.</span></span>  
  
     <span data-ttu-id="9d9b0-264">Questo codice visualizza un messaggio di benvenuto e quindi chiama il metodo `ValidateUsingCredentialsProvider` che verrà aggiunto nel passaggio successivo.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-264">This code displays a welcome message and then calls the `ValidateUsingCredentialsProvider` method that you will add in the next step.</span></span> <span data-ttu-id="9d9b0-265">Se l'utente non è autenticato, il metodo `ValidateUsingCredentialsProvider` restituisce `false` e viene restituito il metodo `Form1_Load` .</span><span class="sxs-lookup"><span data-stu-id="9d9b0-265">If the user is not authenticated, the `ValidateUsingCredentialsProvider` method returns `false` and the `Form1_Load` method returns.</span></span> <span data-ttu-id="9d9b0-266">In questo modo si evita l'esecuzione di codice aggiuntivo prima di uscire dall'applicazione.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-266">This prevents any additional code from running before the application exits.</span></span> <span data-ttu-id="9d9b0-267">Il messaggio di benvenuto è utile per capire quando viene riavviata l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-267">The welcome message is useful to make it clear when the application restarts.</span></span> <span data-ttu-id="9d9b0-268">Il codice per riavviare l'applicazione verrà aggiunto quando si implementa la disconnessione più avanti in questa procedura dettagliata.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-268">You will add code to restart the application when you implement logout later in this walkthrough.</span></span>  
  
     <span data-ttu-id="9d9b0-269">[!code-csharp[ClientApplicationServices#011](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#011)]  [!code-vb[ClientApplicationServices#011](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#011)]</span><span class="sxs-lookup"><span data-stu-id="9d9b0-269">[!code-csharp[ClientApplicationServices#011](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#011)]  [!code-vb[ClientApplicationServices#011](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#011)]</span></span>  
  
4.  <span data-ttu-id="9d9b0-270">Aggiungere il metodo seguente dopo il metodo `Form1_Load`.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-270">Add the following method after the `Form1_Load` method.</span></span>  
  
     <span data-ttu-id="9d9b0-271">Questo metodo passa stringhe vuote al metodo `static` <xref:System.Web.Security.Membership.ValidateUser%2A?displayProperty=fullName> in modo che venga visualizzata la finestra di dialogo Accesso.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-271">This method passes empty strings to the `static` <xref:System.Web.Security.Membership.ValidateUser%2A?displayProperty=fullName> method, which causes the Login dialog box to appear.</span></span> <span data-ttu-id="9d9b0-272">Se il servizio di autenticazione non è disponibile, il metodo <xref:System.Web.Security.Membership.ValidateUser%2A> genererà un'eccezione <xref:System.Net.WebException>.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-272">If the authentication service is unavailable, the <xref:System.Web.Security.Membership.ValidateUser%2A> method will throw a <xref:System.Net.WebException>.</span></span> <span data-ttu-id="9d9b0-273">In questo caso, il metodo `ValidateUsingCredentialsProvider` visualizza un messaggio di avviso e chiede se l'utente vuole riprovare in modalità offline.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-273">In this case, the `ValidateUsingCredentialsProvider` method displays a warning message and asks if the user wants to try again in offline mode.</span></span> <span data-ttu-id="9d9b0-274">Questa funzionalità richiede la funzione **Salva hash della password localmente per consentire l'accesso offline** descritta in [How to: Configure Client Application Services](../../../docs/framework/common-client-technologies/how-to-configure-client-application-services.md).</span><span class="sxs-lookup"><span data-stu-id="9d9b0-274">This functionality requires the **Save password hash locally to enable offline login** feature described in [How to: Configure Client Application Services](../../../docs/framework/common-client-technologies/how-to-configure-client-application-services.md).</span></span> <span data-ttu-id="9d9b0-275">Questa funzionalità è abilitata per impostazione predefinita per i nuovi progetti.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-275">This feature is enabled by default for new projects.</span></span>  
  
     <span data-ttu-id="9d9b0-276">Se l'utente non è convalidato, il metodo `ValidateUsingCredentialsProvider` visualizza un messaggio di errore e chiude l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-276">If the user is not validated, the `ValidateUsingCredentialsProvider` method displays an error message and exits the application.</span></span> <span data-ttu-id="9d9b0-277">Quindi, restituisce il risultato del tentativo di autenticazione.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-277">Finally, this method returns the result of the authentication attempt.</span></span>  
  
     <span data-ttu-id="9d9b0-278">[!code-csharp[ClientApplicationServices#020](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#020)]  [!code-vb[ClientApplicationServices#020](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#020)]</span><span class="sxs-lookup"><span data-stu-id="9d9b0-278">[!code-csharp[ClientApplicationServices#020](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#020)]  [!code-vb[ClientApplicationServices#020](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#020)]</span></span>  
  
### <a name="creating-a-login-form"></a><span data-ttu-id="9d9b0-279">Creazione di un form di accesso</span><span class="sxs-lookup"><span data-stu-id="9d9b0-279">Creating a Login Form</span></span>  
 <span data-ttu-id="9d9b0-280">Un provider di credenziali è una classe che implementa l'interfaccia <xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider> .</span><span class="sxs-lookup"><span data-stu-id="9d9b0-280">A credentials provider is a class that implements the <xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider> interface.</span></span> <span data-ttu-id="9d9b0-281">Questa interfaccia contiene un solo metodo denominato <xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider.GetCredentials%2A> che restituisce un oggetto <xref:System.Web.ClientServices.Providers.ClientFormsAuthenticationCredentials> .</span><span class="sxs-lookup"><span data-stu-id="9d9b0-281">This interface has a single method named <xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider.GetCredentials%2A> that returns a <xref:System.Web.ClientServices.Providers.ClientFormsAuthenticationCredentials> object.</span></span> <span data-ttu-id="9d9b0-282">Le procedure seguenti illustrano come creare una finestra di dialogo di accesso che implementi <xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider.GetCredentials%2A> in modo che venga visualizzata la finestra stessa e vengano restituite le credenziali specificate dall'utente.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-282">The following procedures describe how to create a login dialog box that implements <xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider.GetCredentials%2A> to display itself and return the user-specified credentials.</span></span>  
  
 <span data-ttu-id="9d9b0-283">È necessario seguire procedure separate per [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)] e C# perché [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)] include un modello **Form di accesso** ,</span><span class="sxs-lookup"><span data-stu-id="9d9b0-283">Separate procedures are provided for [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)] and C# because [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)] provides a **Login Form** template.</span></span> <span data-ttu-id="9d9b0-284">che consente di risparmiare tempo richiedendo meno codice da scrivere.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-284">This saves some time and coding effort.</span></span>  
  
##### <a name="to-create-a-login-dialog-box-as-a-credentials-provider-in-visual-basic"></a><span data-ttu-id="9d9b0-285">Per creare una finestra di dialogo di accesso come provider di credenziali in Visual Basic</span><span class="sxs-lookup"><span data-stu-id="9d9b0-285">To create a login dialog box as a credentials provider in Visual Basic</span></span>  
  
1.  <span data-ttu-id="9d9b0-286">In **Esplora soluzioni**selezionare il progetto ClientAppServicesDemo, quindi scegliere **Aggiungi nuovo elemento** dal menu **Progetto**.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-286">In **Solution Explorer**, select the ClientAppServicesDemo project, and then on the **Project** menu, select **Add New Item**.</span></span>  
  
2.  <span data-ttu-id="9d9b0-287">Nella finestra di dialogo **Aggiungi nuovo elemento** selezionare il modello **Form di accesso** , modificare l'elemento **Nome** su `Login.vb`, quindi fare clic su **Aggiungi**.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-287">In the **Add New Item** dialog box, select the **Login Form** template, change the item **Name** to `Login.vb`, and then click **Add**.</span></span>  
  
     <span data-ttu-id="9d9b0-288">In Progettazione Windows Form verrà visualizzata la finestra di dialogo di accesso.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-288">The login dialog box appears in the Windows Forms Designer.</span></span>  
  
3.  <span data-ttu-id="9d9b0-289">Nella finestra di progettazione scegliere **OK** , quindi impostare **su** nella finestra `DialogResult` Proprietà `OK`.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-289">In the designer, select the **OK** button and then, in the **Properties** window, set `DialogResult` to `OK`.</span></span>  
  
4.  <span data-ttu-id="9d9b0-290">Nella finestra di progettazione aggiungere un controllo `CheckBox` al form sotto la casella di testo **Password** .</span><span class="sxs-lookup"><span data-stu-id="9d9b0-290">In the designer, add a `CheckBox` control to the form under the **Password** text box.</span></span>  
  
5.  <span data-ttu-id="9d9b0-291">Nella finestra **Proprietà** specificare il valore  **per** (Name)`rememberMeCheckBox` e il valore  **per** Text`&Remember me`.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-291">In the **Properties** window, specify a **(Name)** value of `rememberMeCheckBox` and a **Text** value of `&Remember me`.</span></span>  
  
6.  <span data-ttu-id="9d9b0-292">Scegliere **Visualizza &#124; Codice** dal menu principale di [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)].</span><span class="sxs-lookup"><span data-stu-id="9d9b0-292">Select **View &#124; Code** from the [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)] main menu.</span></span>  
  
7.  <span data-ttu-id="9d9b0-293">Nell'editor del codice aggiungere il codice seguente all'inizio del file.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-293">In the code editor, add the following code to the top of the file.</span></span>  
  
     <span data-ttu-id="9d9b0-294">[!code-vb[ClientApplicationServices#101](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Login.vb#101)]</span><span class="sxs-lookup"><span data-stu-id="9d9b0-294">[!code-vb[ClientApplicationServices#101](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Login.vb#101)]</span></span>  
  
8.  <span data-ttu-id="9d9b0-295">Modificare la firma della classe in modo che quest'ultima implementi l'interfaccia <xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider>.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-295">Modify the class signature so that the class implements the <xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider> interface.</span></span>  
  
     <span data-ttu-id="9d9b0-296">[!code-vb[ClientApplicationServices#110](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Class1.vb#110)]</span><span class="sxs-lookup"><span data-stu-id="9d9b0-296">[!code-vb[ClientApplicationServices#110](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Class1.vb#110)]</span></span>  
  
9. <span data-ttu-id="9d9b0-297">Assicurarsi che il cursore sia posizionato dopo `IClientformsAuthenticationCredentialsProvider`, quindi premere INVIO per generare il metodo `GetCredentials`.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-297">Make sure that the cursor is after `IClientformsAuthenticationCredentialsProvider`, and then press ENTER to generate the `GetCredentials` method.</span></span>  
  
10. <span data-ttu-id="9d9b0-298">Individuare l'implementazione di <xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider.GetCredentials%2A>, quindi sostituirla con il codice seguente.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-298">Locate the <xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider.GetCredentials%2A> implementation and then replace it with the following code.</span></span>  
  
     <span data-ttu-id="9d9b0-299">[!code-vb[ClientApplicationServices#120](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Login.vb#120)]</span><span class="sxs-lookup"><span data-stu-id="9d9b0-299">[!code-vb[ClientApplicationServices#120](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Login.vb#120)]</span></span>  
  
 <span data-ttu-id="9d9b0-300">La procedura C# seguente fornisce l'elenco di codice completo per la generazione di una semplice finestra di dialogo di accesso.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-300">The following C# procedure provides the entire code listing for a simple login dialog box.</span></span> <span data-ttu-id="9d9b0-301">La parte importante di questa finestra di dialogo dal layout piuttosto essenziale è costituita dall'implementazione di <xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider.GetCredentials%2A> .</span><span class="sxs-lookup"><span data-stu-id="9d9b0-301">The layout for this dialog box is a bit crude, but the important part is the <xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider.GetCredentials%2A> implementation.</span></span>  
  
##### <a name="to-create-a-login-dialog-box-as-a-credentials-provider-in-c"></a><span data-ttu-id="9d9b0-302">Per creare una finestra di dialogo di accesso come provider di credenziali in C#</span><span class="sxs-lookup"><span data-stu-id="9d9b0-302">To create a login dialog box as a credentials provider in C#</span></span>  
  
1.  <span data-ttu-id="9d9b0-303">In **Esplora soluzioni**selezionare il progetto ClientAppServicesDemo, quindi scegliere **Aggiungi classe** dal menu **Progetto**.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-303">In **Solution Explorer**, select the ClientAppServicesDemo project, and then on the **Project** menu, select **Add Class**.</span></span>  
  
2.  <span data-ttu-id="9d9b0-304">Nella finestra di dialogo **Aggiungi nuovo elemento** modificare il **Nome** in `Login.cs`, quindi fare clic su **Aggiungi**.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-304">In the **Add New Item** dialog box, change the **Name** to `Login.cs`, and then click **Add**.</span></span>  
  
     <span data-ttu-id="9d9b0-305">Il file Login.cs verrà aperto nell'editor del codice.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-305">The Login.cs file opens in the code editor.</span></span>  
  
3.  <span data-ttu-id="9d9b0-306">Sostituire il codice predefinito con il codice seguente.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-306">Replace the default code with the following code.</span></span>  
  
     <span data-ttu-id="9d9b0-307">[!code-csharp[ClientApplicationServices#200](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Login.cs#200)]</span><span class="sxs-lookup"><span data-stu-id="9d9b0-307">[!code-csharp[ClientApplicationServices#200](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Login.cs#200)]</span></span>  
  
 <span data-ttu-id="9d9b0-308">È ora possibile eseguire l'applicazione che visualizzerà la finestra di dialogo di accesso.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-308">You can now run the application and see the login dialog box appear.</span></span> <span data-ttu-id="9d9b0-309">Per testare questo codice, provare a specificare credenziali diverse, sia valide che non valide, e verificare che sia possibile accedere al form solo con le credenziali valide.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-309">To test this code, try different credentials, both valid and invalid, and confirm that you can access the form only with valid credentials.</span></span> <span data-ttu-id="9d9b0-310">I nomi utente validi sono `employee` e `manager` con le password `employee!` e `manager!` , rispettivamente.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-310">Valid user names are `employee` and `manager` with passwords `employee!` and `manager!` respectively.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="9d9b0-311">Non selezionare **Memorizza dati** in questa fase, altrimenti non sarà possibile accedere come altro utente finché non si implementa la disconnessione più avanti in questa procedura dettagliata.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-311">Do not select **Remember me** at this point or you will not be able to login as another user until you implement logout later in this walkthrough.</span></span>  
  
## <a name="adding-role-based-functionality"></a><span data-ttu-id="9d9b0-312">Aggiunta di funzionalità basate su ruoli</span><span class="sxs-lookup"><span data-stu-id="9d9b0-312">Adding Role-Based Functionality</span></span>  
 <span data-ttu-id="9d9b0-313">Nella procedura seguente verrà aggiunto al form un pulsante che verrà visualizzato solo dagli utenti nel ruolo di manager.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-313">In the following procedure, you add a button to the form and display it only for users in the manager role.</span></span>  
  
#### <a name="to-change-the-user-interface-based-on-user-role"></a><span data-ttu-id="9d9b0-314">Per modificare l'interfaccia utente basata sul ruolo utente</span><span class="sxs-lookup"><span data-stu-id="9d9b0-314">To change the user interface based on user role</span></span>  
  
1.  <span data-ttu-id="9d9b0-315">In **Esplora soluzioni** nel progetto ClientAppServicesDemo, selezionare Form1, quindi scegliere **Visualizza &#124; Finestra di progettazione** dal menu principale di [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)].</span><span class="sxs-lookup"><span data-stu-id="9d9b0-315">In **Solution Explorer**, in the ClientAppServicesDemo project, select Form1 and then select **View &#124; Designer** from the [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)] main menu.</span></span>  
  
2.  <span data-ttu-id="9d9b0-316">Nella finestra di progettazione aggiungere un controllo <xref:System.Windows.Forms.Button> al form dalla **Casella degli strumenti**.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-316">In the designer, add a <xref:System.Windows.Forms.Button> control to the form from the **ToolBox**.</span></span>  
  
3.  <span data-ttu-id="9d9b0-317">Nella finestra **Proprietà** impostare le proprietà seguenti per il pulsante.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-317">In the **Properties** window, set the following properties for the button.</span></span>  
  
  	|<span data-ttu-id="9d9b0-318">Proprietà</span><span class="sxs-lookup"><span data-stu-id="9d9b0-318">Property</span></span>|<span data-ttu-id="9d9b0-319">Valore</span><span class="sxs-lookup"><span data-stu-id="9d9b0-319">Value</span></span>|  
  	|--------------|-----------|  
  	|<span data-ttu-id="9d9b0-320">**per**</span><span class="sxs-lookup"><span data-stu-id="9d9b0-320">**(Name)**</span></span>|<span data-ttu-id="9d9b0-321">managerOnlyButton</span><span class="sxs-lookup"><span data-stu-id="9d9b0-321">managerOnlyButton</span></span>|  
  	|<span data-ttu-id="9d9b0-322">**per**</span><span class="sxs-lookup"><span data-stu-id="9d9b0-322">**Text**</span></span>|<span data-ttu-id="9d9b0-323">&Manager task</span><span class="sxs-lookup"><span data-stu-id="9d9b0-323">&Manager task</span></span>|  
  	|<span data-ttu-id="9d9b0-324">**Visible**</span><span class="sxs-lookup"><span data-stu-id="9d9b0-324">**Visible**</span></span>|`False`|  
  
4.  <span data-ttu-id="9d9b0-325">Nell'editor di codice relativo a Form1 aggiungere il codice seguente alla fine del metodo `Form1_Load` .</span><span class="sxs-lookup"><span data-stu-id="9d9b0-325">In the code editor for Form1, add the following code to the end of the `Form1_Load` method.</span></span>  
  
     <span data-ttu-id="9d9b0-326">Questo codice chiama il metodo `DisplayButtonForManagerRole` che verrà aggiunto nel passaggio successivo.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-326">This code calls the `DisplayButtonForManagerRole` method that you will add in the next step.</span></span>  
  
     <span data-ttu-id="9d9b0-327">[!code-csharp[ClientApplicationServices#012](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#012)]  [!code-vb[ClientApplicationServices#012](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#012)]</span><span class="sxs-lookup"><span data-stu-id="9d9b0-327">[!code-csharp[ClientApplicationServices#012](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#012)]  [!code-vb[ClientApplicationServices#012](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#012)]</span></span>  
  
5.  <span data-ttu-id="9d9b0-328">Aggiungere il metodo seguente alla fine della classe Form1.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-328">Add the following method to the end of the Form1 class.</span></span>  
  
     <span data-ttu-id="9d9b0-329">Questo metodo chiama il metodo <xref:System.Security.Principal.IPrincipal.IsInRole%2A> dell'oggetto <xref:System.Security.Principal.IPrincipal> restituito dalla proprietà `static` <xref:System.Threading.Thread.CurrentPrincipal%2A?displayProperty=fullName> .</span><span class="sxs-lookup"><span data-stu-id="9d9b0-329">This method calls the <xref:System.Security.Principal.IPrincipal.IsInRole%2A> method of the <xref:System.Security.Principal.IPrincipal> returned by the `static` <xref:System.Threading.Thread.CurrentPrincipal%2A?displayProperty=fullName> property.</span></span> <span data-ttu-id="9d9b0-330">Per le applicazioni configurate per l'uso dei servizi delle applicazioni client, questa proprietà restituisce un oggetto <xref:System.Web.ClientServices.ClientRolePrincipal>.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-330">For applications configured to use client application services, this property returns a <xref:System.Web.ClientServices.ClientRolePrincipal>.</span></span> <span data-ttu-id="9d9b0-331">Poiché questa classe implementa l'interfaccia <xref:System.Security.Principal.IPrincipal> , non è necessario farvi riferimento in modo esplicito.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-331">Because this class implements the <xref:System.Security.Principal.IPrincipal> interface, you do not need to reference it explicitly.</span></span>  
  
     <span data-ttu-id="9d9b0-332">Se l'utente appartiene al ruolo "manager", il metodo `DisplayButtonForManagerRole` imposta la proprietà <xref:System.Windows.Forms.Control.Visible%2A> di `managerOnlyButton` su `true`.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-332">If the user is in the "manager" role, the `DisplayButtonForManagerRole` method sets the <xref:System.Windows.Forms.Control.Visible%2A> property of the `managerOnlyButton` to `true`.</span></span> <span data-ttu-id="9d9b0-333">Se viene generata un'eccezione <xref:System.Net.WebException> , questo metodo visualizza anche un messaggio di errore che indica che il servizio dei ruoli non è disponibile.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-333">This method also displays an error message if a <xref:System.Net.WebException> is thrown, which indicates that the roles service is unavailable.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="9d9b0-334">Il metodo <xref:System.Web.ClientServices.ClientRolePrincipal.IsInRole%2A> restituirà sempre `false` se l'accesso utente è scaduto.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-334">The <xref:System.Web.ClientServices.ClientRolePrincipal.IsInRole%2A> method will always return `false` if the user login has expired.</span></span> <span data-ttu-id="9d9b0-335">Questo messaggio di errore non viene visualizzato se l'applicazione chiama il metodo <xref:System.Security.Principal.IPrincipal.IsInRole%2A> una volta subito dopo l'autenticazione, come illustrato nel codice di esempio nella presente procedura dettagliata.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-335">This will not occur if your application calls the <xref:System.Security.Principal.IPrincipal.IsInRole%2A> method one time shortly after authentication, as shown in the example code for this walkthrough.</span></span> <span data-ttu-id="9d9b0-336">Se l'applicazione deve recuperare ruoli utente in altri momenti, è necessario aggiungere il codice per riconvalidare gli utenti con accesso scaduto.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-336">If your application must retrieve user roles at other times, you might want to add code to revalidate users whose login has expired.</span></span> <span data-ttu-id="9d9b0-337">Se tutti gli utenti validi sono stati assegnati ai ruoli, è possibile determinare se l'accesso è scaduto chiamando il metodo <xref:System.Web.ClientServices.Providers.ClientRoleProvider.GetRolesForUser%2A?displayProperty=fullName> .</span><span class="sxs-lookup"><span data-stu-id="9d9b0-337">If all valid users are assigned to roles, you can determine whether the login has expired by calling the <xref:System.Web.ClientServices.Providers.ClientRoleProvider.GetRolesForUser%2A?displayProperty=fullName> method.</span></span> <span data-ttu-id="9d9b0-338">Se non viene restituito alcun ruolo, l'accesso è scaduto.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-338">If no roles are returned, the login has expired.</span></span> <span data-ttu-id="9d9b0-339">Per un esempio di questa funzionalità, vedere il metodo <xref:System.Web.ClientServices.Providers.ClientRoleProvider.GetRolesForUser%2A> .</span><span class="sxs-lookup"><span data-stu-id="9d9b0-339">For an example of this functionality, see the <xref:System.Web.ClientServices.Providers.ClientRoleProvider.GetRolesForUser%2A> method.</span></span> <span data-ttu-id="9d9b0-340">Questa funzionalità è necessaria solo se è stato selezionato **Richiedi agli utenti di accedere di nuovo a ogni scadenza del cookie del server** nella configurazione dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-340">This functionality is only necessary if you have selected **Require users to log on again whenever the server cookie expires** in your application configuration.</span></span> <span data-ttu-id="9d9b0-341">Per altre informazioni, vedere [Procedura: Configurare i servizi delle applicazioni client](../../../docs/framework/common-client-technologies/how-to-configure-client-application-services.md).</span><span class="sxs-lookup"><span data-stu-id="9d9b0-341">For more information, see [How to: Configure Client Application Services](../../../docs/framework/common-client-technologies/how-to-configure-client-application-services.md).</span></span>  
  
     <span data-ttu-id="9d9b0-342">[!code-csharp[ClientApplicationServices#030](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#030)]  [!code-vb[ClientApplicationServices#030](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#030)]</span><span class="sxs-lookup"><span data-stu-id="9d9b0-342">[!code-csharp[ClientApplicationServices#030](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#030)]  [!code-vb[ClientApplicationServices#030](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#030)]</span></span>  
  
 <span data-ttu-id="9d9b0-343">Se l'autenticazione viene eseguita correttamente, il provider di autenticazione del client imposta la proprietà <xref:System.Threading.Thread.CurrentPrincipal%2A?displayProperty=fullName> su un'istanza della classe <xref:System.Web.ClientServices.ClientRolePrincipal>.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-343">If authentication is successful, the client authentication provider sets the <xref:System.Threading.Thread.CurrentPrincipal%2A?displayProperty=fullName> property to an instance of the <xref:System.Web.ClientServices.ClientRolePrincipal> class.</span></span> <span data-ttu-id="9d9b0-344">Questa classe implementa il metodo <xref:System.Security.Principal.IPrincipal.IsInRole%2A> in modo che il lavoro venga delegato al provider di ruoli configurato.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-344">This class implements the <xref:System.Security.Principal.IPrincipal.IsInRole%2A> method so that the work is delegated to the configured role provider.</span></span> <span data-ttu-id="9d9b0-345">Come in precedenza il codice dell'applicazione non richiede un riferimento diretto al provider di servizi.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-345">As before, your application code does not require a direct reference to the service provider.</span></span>  
  
 <span data-ttu-id="9d9b0-346">È ora possibile eseguire l'applicazione e accedere come employee per non vedere il pulsante e come manager per visualizzarlo.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-346">You can now run the application and log in as employee to see that the button does not appear, and then log in as manager to see the button.</span></span>  
  
## <a name="accessing-web-settings"></a><span data-ttu-id="9d9b0-347">Accesso alle impostazioni Web</span><span class="sxs-lookup"><span data-stu-id="9d9b0-347">Accessing Web Settings</span></span>  
 <span data-ttu-id="9d9b0-348">Nella procedura seguente verrà aggiunta al form una casella di testo che verrà associata a un'impostazione Web.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-348">In the following procedure, you add a text box to the form and bind it to a Web setting.</span></span> <span data-ttu-id="9d9b0-349">Come il codice precedente che usa autenticazione e ruoli, il codice delle impostazioni non accede direttamente al provider delle impostazioni.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-349">Like the previous code that uses authentication and roles, your settings code does not access the settings provider directly.</span></span> <span data-ttu-id="9d9b0-350">Usa invece la classe `Settings` fortemente tipizzata (alla quale si accede come `Properties.Settings.Default` in C# e come `My.Settings` in [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]) generata per il progetto da [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)].</span><span class="sxs-lookup"><span data-stu-id="9d9b0-350">Instead, it uses the strongly-typed `Settings` class (accessed as `Properties.Settings.Default` in C# and `My.Settings` in [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]) generated for your project by [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)].</span></span>  
  
#### <a name="to-use-web-settings-in-your-user-interface"></a><span data-ttu-id="9d9b0-351">Per usare le impostazioni Web nell'interfaccia utente</span><span class="sxs-lookup"><span data-stu-id="9d9b0-351">To use Web settings in your user interface</span></span>  
  
1.  <span data-ttu-id="9d9b0-352">Assicurarsi che il **Server di sviluppo Web ASP.NET** sia ancora in esecuzione controllando l'area di notifica della barra delle applicazioni.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-352">Make sure that the **ASP.NET Web Development Server** is still running by checking the notification area of the taskbar.</span></span> <span data-ttu-id="9d9b0-353">Se è stato arrestato il server, riavviare l'applicazione (la quale avvia automaticamente il server), quindi chiudere la finestra di dialogo di accesso.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-353">If you have stopped the server, restart the application (which starts the server automatically) then close the login dialog box.</span></span>  
  
2.  <span data-ttu-id="9d9b0-354">In **Esplora soluzioni**selezionare il progetto ClientAppServicesDemo, quindi scegliere **Proprietà di ClientAppServicesDemo** dal menu **Progetto**.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-354">In **Solution Explorer**, select the ClientAppServicesDemo project, and then on the **Project** menu, select **ClientAppServicesDemo Properties**.</span></span>  
  
     <span data-ttu-id="9d9b0-355">Verrà visualizzata la finestra Progettazione progetti.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-355">The project designer appears.</span></span>  
  
3.  <span data-ttu-id="9d9b0-356">Nella scheda **Impostazioni** fare clic su **Carica impostazioni Web**.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-356">On the **Settings** tab, click **Load Web Settings**.</span></span>  
  
     <span data-ttu-id="9d9b0-357">Verrà visualizzata la finestra di dialogo **Accesso** .</span><span class="sxs-lookup"><span data-stu-id="9d9b0-357">A **Login** dialog box appears.</span></span>  
  
4.  <span data-ttu-id="9d9b0-358">Immettere le credenziali per employee o manager, quindi fare clic su **Accedi**.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-358">Enter credentials for employee or manager and click **Log In**.</span></span> <span data-ttu-id="9d9b0-359">L'impostazione Web che verrà usata è configurata per l'accesso solo da parte di utenti autenticati. Pertanto, se si seleziona **Ignora accesso** , non verrà caricata alcuna impostazione.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-359">The Web setting you will use is configured for access by authenticated users only, so clicking **Skip Login** will not load any settings.</span></span>  
  
     <span data-ttu-id="9d9b0-360">L'impostazione `WebSettingsTestText` viene visualizzata nella finestra di progettazione con il valore predefinito `DefaultText`.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-360">The `WebSettingsTestText` setting appears in the designer with the default value of `DefaultText`.</span></span> <span data-ttu-id="9d9b0-361">Inoltre, per il progetto viene generata una classe `Settings` che contiene una proprietà `WebSettingsTestText`.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-361">Additionally, a `Settings` class that contains a `WebSettingsTestText` property is generated for your project.</span></span>  
  
5.  <span data-ttu-id="9d9b0-362">In **Esplora soluzioni** nel progetto ClientAppServicesDemo, selezionare Form1, quindi scegliere **Visualizza &#124; Finestra di progettazione** dal menu principale di [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)].</span><span class="sxs-lookup"><span data-stu-id="9d9b0-362">In **Solution Explorer**, in the ClientAppServicesDemo project, select Form1 and then select **View &#124; Designer** from the [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)] main menu.</span></span>  
  
6.  <span data-ttu-id="9d9b0-363">Nella finestra di progettazione aggiungere un controllo <xref:System.Windows.Forms.TextBox> al form.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-363">In the designer, add a <xref:System.Windows.Forms.TextBox> control to the form.</span></span>  
  
7.  <span data-ttu-id="9d9b0-364">Nella finestra **Proprietà** specificare una valore **per** (Name) `webSettingsTestTextBox`.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-364">In the **Properties** window, specify a **(Name)** value of `webSettingsTestTextBox`.</span></span>  
  
8.  <span data-ttu-id="9d9b0-365">Nell'editor del codice aggiungere il codice seguente alla fine del metodo `Form1_Load` .</span><span class="sxs-lookup"><span data-stu-id="9d9b0-365">In the code editor, add the following code to the end of the `Form1_Load` method.</span></span>  
  
     <span data-ttu-id="9d9b0-366">Questo codice chiama il metodo `BindWebSettingsTestTextBox` che verrà aggiunto nel passaggio successivo.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-366">This code calls the `BindWebSettingsTestTextBox` method that you will add in the next step.</span></span>  
  
     <span data-ttu-id="9d9b0-367">[!code-csharp[ClientApplicationServices#013](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#013)]  [!code-vb[ClientApplicationServices#013](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#013)]</span><span class="sxs-lookup"><span data-stu-id="9d9b0-367">[!code-csharp[ClientApplicationServices#013](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#013)]  [!code-vb[ClientApplicationServices#013](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#013)]</span></span>  
  
9. <span data-ttu-id="9d9b0-368">Aggiungere il metodo seguente alla fine della classe Form1.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-368">Add the following method to the end of the Form1 class.</span></span>  
  
     <span data-ttu-id="9d9b0-369">Questo metodo associa la proprietà <xref:System.Windows.Forms.TextBox.Text%2A> di `webSettingsTestTextBox` alla proprietà `WebSettingsTestText` della classe `Settings` generata precedentemente in questa procedura.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-369">This method binds the <xref:System.Windows.Forms.TextBox.Text%2A> property of the `webSettingsTestTextBox` to the `WebSettingsTestText` property of the `Settings` class generated earlier in this procedure.</span></span> <span data-ttu-id="9d9b0-370">Se viene generata un'eccezione <xref:System.Net.WebException>, questo metodo visualizza inoltre un messaggio di errore che indica che il servizio di impostazioni Web non è disponibile.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-370">This method also displays an error message if a <xref:System.Net.WebException> is thrown, which indicates that the Web settings service is unavailable.</span></span>  
  
     <span data-ttu-id="9d9b0-371">[!code-csharp[ClientApplicationServices#040](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#040)]   [!code-vb[ClientApplicationServices#040](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#040)]</span><span class="sxs-lookup"><span data-stu-id="9d9b0-371">[!code-csharp[ClientApplicationServices#040](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#040)]   [!code-vb[ClientApplicationServices#040](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#040)]</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="9d9b0-372">In genere viene usato un data binding per abilitare la comunicazione bidirezionale automatica tra un controllo e un'impostazione Web.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-372">You will typically use data binding to enable automatic two-way communication between a control and a Web setting.</span></span> <span data-ttu-id="9d9b0-373">Tuttavia, è anche possibile accedere direttamente alle impostazioni Web come illustrato nell'esempio seguente:</span><span class="sxs-lookup"><span data-stu-id="9d9b0-373">However, you can also access Web settings directly as shown in the following example:</span></span>  
  
     <span data-ttu-id="9d9b0-374">[!code-csharp[ClientApplicationServices#322](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Class1.cs#322)]   [!code-vb[ClientApplicationServices#322](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Class1.vb#322)]</span><span class="sxs-lookup"><span data-stu-id="9d9b0-374">[!code-csharp[ClientApplicationServices#322](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Class1.cs#322)]   [!code-vb[ClientApplicationServices#322](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Class1.vb#322)]</span></span>  
  
10. <span data-ttu-id="9d9b0-375">Selezionare il modulo nella finestra di progettazione, quindi fare clic sul pulsante **Eventi** nella finestra **Proprietà**.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-375">In the designer, select the form, and then, in the **Properties** window, click the **Events** button.</span></span>  
  
11. <span data-ttu-id="9d9b0-376">Selezionare l'evento <xref:System.Windows.Forms.Form.FormClosing> , quindi premere INVIO per generare un gestore eventi.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-376">Select the <xref:System.Windows.Forms.Form.FormClosing> event and then press ENTER to generate an event handler.</span></span>  
  
12. <span data-ttu-id="9d9b0-377">Sostituire il metodo generato con il codice seguente.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-377">Replace the generated method with the following code.</span></span>  
  
     <span data-ttu-id="9d9b0-378">Il gestore eventi <xref:System.Windows.Forms.Form.FormClosing> chiama il metodo `SaveSettings` che viene usato anche dalla funzionalità di disconnessione che verrà aggiunta nella sezione successiva.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-378">The <xref:System.Windows.Forms.Form.FormClosing> event handler calls the `SaveSettings` method, which is also used by the logout functionality that you will add in the next section.</span></span> <span data-ttu-id="9d9b0-379">Il metodo `SaveSettings` verifica innanzitutto che l'utente non sia disconnesso.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-379">The `SaveSettings` method first confirms that the user has not logged out.</span></span> <span data-ttu-id="9d9b0-380">Questa operazione viene eseguita controllando la proprietà <xref:System.Security.Principal.IIdentity.AuthenticationType%2A> dell'oggetto <xref:System.Security.Principal.IIdentity> restituito dall'entità corrente,</span><span class="sxs-lookup"><span data-stu-id="9d9b0-380">It does this by checking the <xref:System.Security.Principal.IIdentity.AuthenticationType%2A> property of the <xref:System.Security.Principal.IIdentity> returned by the current principal.</span></span> <span data-ttu-id="9d9b0-381">la quale viene recuperata mediante la proprietà `static` <xref:System.Threading.Thread.CurrentPrincipal%2A> .</span><span class="sxs-lookup"><span data-stu-id="9d9b0-381">The current principal is retrieved through the `static` <xref:System.Threading.Thread.CurrentPrincipal%2A> property.</span></span> <span data-ttu-id="9d9b0-382">Se l'utente è stato autenticato per i servizi delle applicazioni client, il tipo di autenticazione sarà "ClientForms."</span><span class="sxs-lookup"><span data-stu-id="9d9b0-382">If the user has been authenticated for client application services, the authentication type will be "ClientForms".</span></span> <span data-ttu-id="9d9b0-383">Il metodo `SaveSettings` non può controllare solo la proprietà <xref:System.Security.Principal.IIdentity.IsAuthenticated%2A?displayProperty=fullName> perché l'utente potrebbe usare un'identità di Windows valida dopo la disconnessione.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-383">The `SaveSettings` method cannot just check the <xref:System.Security.Principal.IIdentity.IsAuthenticated%2A?displayProperty=fullName> property because the user might have a valid Windows identity after logout.</span></span>  
  
     <span data-ttu-id="9d9b0-384">Se l'utente non si è disconnesso, il metodo `SaveSettings` chiama il metodo <xref:System.Configuration.ApplicationSettingsBase.Save%2A> della classe `Settings` generata precedentemente in questa procedura.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-384">If the user has not logged out, the `SaveSettings` method calls the <xref:System.Configuration.ApplicationSettingsBase.Save%2A> method of the `Settings` class generated earlier in this procedure.</span></span> <span data-ttu-id="9d9b0-385">Questo metodo può generare un'eccezione <xref:System.Net.WebException> se il cookie di autenticazione è scaduto.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-385">This method can throw a <xref:System.Net.WebException> if the authentication cookie has expired.</span></span> <span data-ttu-id="9d9b0-386">Questa situazione si verifica solo se è stata selezionata l'opzione **Richiedi agli utenti di accedere di nuovo a ogni scadenza del cookie del server** nella configurazione dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-386">This occurs only if you have selected **Require users to log on again whenever the server cookie expires** in your application configuration.</span></span> <span data-ttu-id="9d9b0-387">Per altre informazioni, vedere [How to: Configure Client Application Services](../../../docs/framework/common-client-technologies/how-to-configure-client-application-services.md).</span><span class="sxs-lookup"><span data-stu-id="9d9b0-387">For more information, see [How to: Configure Client Application Services](../../../docs/framework/common-client-technologies/how-to-configure-client-application-services.md).</span></span> <span data-ttu-id="9d9b0-388">Il metodo `SaveSettings` gestisce la scadenza del cookie chiamando <xref:System.Web.Security.Membership.ValidateUser%2A> per visualizzare la finestra di dialogo di accesso.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-388">The `SaveSettings` method handles cookie expiration by calling <xref:System.Web.Security.Membership.ValidateUser%2A> to display the login dialog box.</span></span> <span data-ttu-id="9d9b0-389">Se l'utente accede correttamente, il metodo `SaveSettings` tenta di salvare nuovamente le impostazioni chiamando se stesso.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-389">If the user logs in successfully, the `SaveSettings` method tries to save the settings again by calling itself.</span></span>  
  
     <span data-ttu-id="9d9b0-390">Come nel codice precedente, il metodo `SaveSettings` visualizza un messaggio di errore se il servizio remoto non è disponibile.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-390">Like in previous code, the `SaveSettings` method displays an error message if the remote service is unavailable.</span></span> <span data-ttu-id="9d9b0-391">Se il provider delle impostazioni non può accedere al servizio remoto, le impostazioni vengono ancora salvate nella cache locale e ricaricate all'avvio dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-391">If the settings provider cannot access the remote service, the settings are still saved to the local cache and reloaded when the application restarts.</span></span>  
  
     <span data-ttu-id="9d9b0-392">[!code-csharp[ClientApplicationServices#050](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#050)]  [!code-vb[ClientApplicationServices#050](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#050)]</span><span class="sxs-lookup"><span data-stu-id="9d9b0-392">[!code-csharp[ClientApplicationServices#050](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#050)]  [!code-vb[ClientApplicationServices#050](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#050)]</span></span>  
  
13. <span data-ttu-id="9d9b0-393">Aggiungere il metodo seguente alla fine della classe Form1.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-393">Add the following method to the end of the Form1 class.</span></span>  
  
     <span data-ttu-id="9d9b0-394">Questo codice gestisce l'evento <xref:System.Web.ClientServices.Providers.ClientSettingsProvider.SettingsSaved?displayProperty=fullName> e visualizza un messaggio di avviso se non è stato possibile salvare un'impostazione.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-394">This code handles the <xref:System.Web.ClientServices.Providers.ClientSettingsProvider.SettingsSaved?displayProperty=fullName> event and displays a warning if any of the settings could not be saved.</span></span> <span data-ttu-id="9d9b0-395">L'evento <xref:System.Web.ClientServices.Providers.ClientSettingsProvider.SettingsSaved> non si verifica se il servizio delle impostazioni non è disponibile o se il cookie di autenticazione è scaduto.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-395">The <xref:System.Web.ClientServices.Providers.ClientSettingsProvider.SettingsSaved> event does not occur if the settings service is unavailable or if the authentication cookie has expired.</span></span> <span data-ttu-id="9d9b0-396">L'evento <xref:System.Web.ClientServices.Providers.ClientSettingsProvider.SettingsSaved> si verifica ad esempio se l'utente si è già disconnesso.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-396">One example of when the <xref:System.Web.ClientServices.Providers.ClientSettingsProvider.SettingsSaved> event will occur is if the user has already logged out.</span></span> <span data-ttu-id="9d9b0-397">È possibile testare questo gestore eventi aggiungendo il codice di disconnessione al metodo `SaveSettings` direttamente prima della chiamata al metodo <xref:System.Configuration.ApplicationSettingsBase.Save%2A> .</span><span class="sxs-lookup"><span data-stu-id="9d9b0-397">You can test this event handler by adding logout code to the `SaveSettings` method directly before the <xref:System.Configuration.ApplicationSettingsBase.Save%2A> method call.</span></span> <span data-ttu-id="9d9b0-398">Il codice di disconnessione che è possibile usare verrà descritto nella sezione successiva.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-398">Logout code that you can use is described in the next section.</span></span>  
  
     <span data-ttu-id="9d9b0-399">[!code-csharp[ClientApplicationServices#090](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#090)]  [!code-vb[ClientApplicationServices#090](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#090)]</span><span class="sxs-lookup"><span data-stu-id="9d9b0-399">[!code-csharp[ClientApplicationServices#090](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#090)]  [!code-vb[ClientApplicationServices#090](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#090)]</span></span>  
  
14. <span data-ttu-id="9d9b0-400">Per il linguaggio C# aggiungere il codice seguente alla fine del metodo `Form1_Load`.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-400">For C#, add the following code to the end of the `Form1_Load` method.</span></span> <span data-ttu-id="9d9b0-401">Questo codice associa il metodo aggiunto nell'ultimo passaggio all'evento <xref:System.Web.ClientServices.Providers.ClientSettingsProvider.SettingsSaved>.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-401">This code associates the method you added in the last step with the <xref:System.Web.ClientServices.Providers.ClientSettingsProvider.SettingsSaved> event.</span></span>  
  
     <span data-ttu-id="9d9b0-402">[!code-csharp[ClientApplicationServices#015](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#015)]</span><span class="sxs-lookup"><span data-stu-id="9d9b0-402">[!code-csharp[ClientApplicationServices#015](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#015)]</span></span>  
  
 <span data-ttu-id="9d9b0-403">Per testare l'applicazione in questa fase, eseguire più volte questo codice sia come employee che come manager e digitare i diversi valori nella casella di testo.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-403">To test the application at this point, run it multiple times as both employee and manager, and type different values into the text box.</span></span> <span data-ttu-id="9d9b0-404">I valori rimarranno validi per tutte le sessioni di ciascun utente.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-404">The values will persist across sessions on a per-user basis.</span></span>  
  
## <a name="implementing-logout"></a><span data-ttu-id="9d9b0-405">Implementazione della disconnessione</span><span class="sxs-lookup"><span data-stu-id="9d9b0-405">Implementing Logout</span></span>  
 <span data-ttu-id="9d9b0-406">Se l'utente seleziona la casella di controllo **Memorizza dati** all'accesso, l'applicazione autenticherà automaticamente l'utente nelle esecuzioni successive.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-406">When the user selects the **Remember me** check box when logging in, the application will automatically authenticate the user on subsequent runs.</span></span> <span data-ttu-id="9d9b0-407">L'autenticazione automatica continuerà quindi mentre l'applicazione è in modalità offline o fino alla scadenza del cookie di autenticazione.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-407">Automatic authentication will then continue while the application is in offline mode or until the authentication cookie expires.</span></span> <span data-ttu-id="9d9b0-408">Può tuttavia capitare che all'applicazione debbano accedere più utenti oppure un solo utente più volte con credenziali diverse.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-408">Sometimes, however, multiple users will need access to the application or a single user might occasionally log in with different credentials.</span></span> <span data-ttu-id="9d9b0-409">Per consentire questo scenario, è necessario implementare la funzionalità di disconnessione, come descritto nella procedura seguente.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-409">To enable this scenario, you must implement logout functionality, as described in the following procedure.</span></span>  
  
#### <a name="to-implement-logout-functionality"></a><span data-ttu-id="9d9b0-410">Per implementare la funzionalità di disconnessione</span><span class="sxs-lookup"><span data-stu-id="9d9b0-410">To implement logout functionality</span></span>  
  
1.  <span data-ttu-id="9d9b0-411">Nella finestra di progettazione Form1 aggiungere un controllo <xref:System.Windows.Forms.Button> al form dalla **Casella degli strumenti**.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-411">In the Form1 designer, add a <xref:System.Windows.Forms.Button> control to the form from the **ToolBox**.</span></span>  
  
2.  <span data-ttu-id="9d9b0-412">Nella finestra **Proprietà** specificare il valore  **per** (Name)`logoutButton` e il valore **&Disconnetti** per **Text**.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-412">In the **Properties** window, specify a **(Name)** value of `logoutButton` and a **Text** value of **&Log Out**.</span></span>  
  
3.  <span data-ttu-id="9d9b0-413">Fare doppio clic su `logoutButton` per generare un gestore eventi <xref:System.Windows.Forms.Control.Click>.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-413">Double-click the `logoutButton` to generate a <xref:System.Windows.Forms.Control.Click> event handler.</span></span>  
  
     <span data-ttu-id="9d9b0-414">Verrà visualizzato il cursore nel metodo `logoutButton_Click` all'interno dell'editor del codice.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-414">The code editor appears with the cursor in the `logoutButton_Click` method.</span></span>  
  
4.  <span data-ttu-id="9d9b0-415">Sostituire il metodo `logoutButton_Click` generato con il codice seguente.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-415">Replace the generated `logoutButton_Click` method with the following code.</span></span>  
  
     <span data-ttu-id="9d9b0-416">Questo gestore eventi chiama innanzitutto il metodo `SaveSettings` aggiunto nella sezione precedente.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-416">This event handler first calls the `SaveSettings` method that you added in the previous section.</span></span> <span data-ttu-id="9d9b0-417">Il gestore eventi chiama quindi il metodo <xref:System.Web.ClientServices.Providers.ClientFormsAuthenticationMembershipProvider.Logout%2A?displayProperty=fullName> .</span><span class="sxs-lookup"><span data-stu-id="9d9b0-417">Then, the event handler calls the <xref:System.Web.ClientServices.Providers.ClientFormsAuthenticationMembershipProvider.Logout%2A?displayProperty=fullName> method.</span></span> <span data-ttu-id="9d9b0-418">Se il servizio di autenticazione non è disponibile, il metodo <xref:System.Web.ClientServices.Providers.ClientFormsAuthenticationMembershipProvider.Logout%2A> genererà un'eccezione <xref:System.Net.WebException>.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-418">If the authentication service is unavailable, the <xref:System.Web.ClientServices.Providers.ClientFormsAuthenticationMembershipProvider.Logout%2A> method will throw a <xref:System.Net.WebException>.</span></span> <span data-ttu-id="9d9b0-419">In questo caso, il metodo `logoutButton_Click` visualizza un messaggio di avviso e passa temporaneamente alla modalità offline per disconnettere l'utente.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-419">In this case, the `logoutButton_Click` method displays a warning message and switches temporarily to offline mode to log the user out.</span></span> <span data-ttu-id="9d9b0-420">La modalità offline viene descritta nella sezione successiva.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-420">Offline mode is described in the next section.</span></span>  
  
     <span data-ttu-id="9d9b0-421">Con la disconnessone viene eliminato il cookie di autenticazione locale in modo che all'avvio dell'applicazione vengano richieste le credenziali di accesso.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-421">Logout deletes the local authentication cookie so that login will be required when the application is restarted.</span></span> <span data-ttu-id="9d9b0-422">Dopo la disconnessione il gestore eventi riavvia l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-422">After logout, the event handler restarts the application.</span></span> <span data-ttu-id="9d9b0-423">Al riavvio dell'applicazione viene visualizzato il messaggio di benvenuto seguito dalla finestra di dialogo di accesso.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-423">When the application restarts, it displays the welcome message followed by the login dialog box.</span></span> <span data-ttu-id="9d9b0-424">Il messaggio di benvenuto serve a indicare in modo esplicito che l'applicazione è stata riavviata.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-424">The welcome message makes it clear that the application has restarted.</span></span> <span data-ttu-id="9d9b0-425">Questo processo semplifica le operazioni qualora l'utente dovesse effettuare l'accesso per salvare le impostazioni e quindi eseguire di nuovo l'accesso a causa del riavvio dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-425">This prevents potential confusion if the user must log in to save settings, and then must log in again because the application has restarted.</span></span>  
  
     <span data-ttu-id="9d9b0-426">[!code-csharp[ClientApplicationServices#070](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#070)]  [!code-vb[ClientApplicationServices#070](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#070)]</span><span class="sxs-lookup"><span data-stu-id="9d9b0-426">[!code-csharp[ClientApplicationServices#070](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#070)]  [!code-vb[ClientApplicationServices#070](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#070)]</span></span>  
  
 <span data-ttu-id="9d9b0-427">Per testare la funzionalità di disconnessione, eseguire l'applicazione e selezionare **Memorizza dati** nella finestra di dialogo Accesso.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-427">To test the logout functionality, run the application and select **Remember me** on the Login dialog box.</span></span> <span data-ttu-id="9d9b0-428">Quindi, chiudere e riavviare l'applicazione per assicurarsi di non dover più eseguire l'accesso.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-428">Next, close and restart the application to confirm that you no longer have to log in.</span></span> <span data-ttu-id="9d9b0-429">Riavviare quindi l'applicazione facendo clic su Disconnessione.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-429">Finally, restart the application by clicking Log out.</span></span>  
  
## <a name="enabling-offline-mode"></a><span data-ttu-id="9d9b0-430">Abilitazione della modalità offline</span><span class="sxs-lookup"><span data-stu-id="9d9b0-430">Enabling Offline Mode</span></span>  
 <span data-ttu-id="9d9b0-431">Nella procedura seguente viene aggiunta una casella di controllo al form per consentire all'utente di attivare la modalità offline.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-431">In the following procedure, you add a check box to the form to enable the user to enter offline mode.</span></span> <span data-ttu-id="9d9b0-432">L'applicazione indica che è attiva la modalità offline impostando la proprietà `static` <xref:System.Web.ClientServices.ConnectivityStatus.IsOffline%2A?displayProperty=fullName> su `true`.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-432">Your application indicates offline mode by setting the `static` <xref:System.Web.ClientServices.ConnectivityStatus.IsOffline%2A?displayProperty=fullName> property to `true`.</span></span> <span data-ttu-id="9d9b0-433">Lo stato offline viene archiviato sul disco rigido locale nel percorso indicato dalla proprietà <xref:System.Windows.Forms.Application.UserAppDataPath%2A?displayProperty=fullName> .</span><span class="sxs-lookup"><span data-stu-id="9d9b0-433">The offline status is stored on the local hard disk at the location indicated by the <xref:System.Windows.Forms.Application.UserAppDataPath%2A?displayProperty=fullName> property.</span></span> <span data-ttu-id="9d9b0-434">Ciò significa che lo stato offline viene archiviato in base all'utente e all'applicazione.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-434">This means that the offline status is stored on a per-user, per-application basis.</span></span>  
  
 <span data-ttu-id="9d9b0-435">In modalità offline, tutte le richieste dei servizi delle applicazioni client recuperano i dati dalla cache locale anziché tentare di accedere ai servizi.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-435">In offline mode, all client application service requests retrieve data from the local cache instead of trying to access the services.</span></span> <span data-ttu-id="9d9b0-436">Nella configurazione predefinita, i dati locali includono la password crittografata dell'utente,</span><span class="sxs-lookup"><span data-stu-id="9d9b0-436">In the default configuration, the local data includes an encrypted form of the user's password.</span></span> <span data-ttu-id="9d9b0-437">per consentire all'utente di effettuare l'accesso mentre l'applicazione è in modalità offline.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-437">This enables the user to log in while the application is in offline mode.</span></span> <span data-ttu-id="9d9b0-438">Per altre informazioni, vedere [How to: Configure Client Application Services](../../../docs/framework/common-client-technologies/how-to-configure-client-application-services.md).</span><span class="sxs-lookup"><span data-stu-id="9d9b0-438">For more information, see [How to: Configure Client Application Services](../../../docs/framework/common-client-technologies/how-to-configure-client-application-services.md).</span></span>  
  
#### <a name="to-enable-offline-mode-in-your-application"></a><span data-ttu-id="9d9b0-439">Per abilitare la modalità offline nell'applicazione</span><span class="sxs-lookup"><span data-stu-id="9d9b0-439">To enable offline mode in your application</span></span>  
  
1.  <span data-ttu-id="9d9b0-440">In **Esplora soluzioni** nel progetto ClientAppServicesDemo, selezionare Form1, quindi scegliere **Visualizza &#124; Finestra di progettazione** dal menu principale di [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)].</span><span class="sxs-lookup"><span data-stu-id="9d9b0-440">In **Solution Explorer**, in the ClientAppServicesDemo project, select Form1 and then select **View &#124; Designer** from the [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)] main menu.</span></span>  
  
2.  <span data-ttu-id="9d9b0-441">Nella finestra di progettazione aggiungere un controllo <xref:System.Windows.Forms.CheckBox> al form.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-441">In the designer, add a <xref:System.Windows.Forms.CheckBox> control to the form.</span></span>  
  
3.  <span data-ttu-id="9d9b0-442">Nella finestra **Proprietà** specificare un valore **(Name)** di `workOfflineCheckBox` e un valore **Text** di **&Non in linea**.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-442">In the **Properties** window, specify a **(Name)** value of `workOfflineCheckBox` and a **Text** value of **&Work offline**.</span></span>  
  
4.  <span data-ttu-id="9d9b0-443">Nella finestra **Proprietà** fare clic sul pulsante **Eventi**.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-443">In the **Properties** window, click the **Events** button.</span></span>  
  
5.  <span data-ttu-id="9d9b0-444">Selezionare l'evento <xref:System.Windows.Forms.CheckBox.CheckedChanged> , quindi premere INVIO per generare un gestore eventi.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-444">Select the <xref:System.Windows.Forms.CheckBox.CheckedChanged> event and then press ENTER to generate an event handler.</span></span>  
  
6.  <span data-ttu-id="9d9b0-445">Sostituire il metodo generato con il codice seguente.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-445">Replace the generated method with the following code.</span></span>  
  
     <span data-ttu-id="9d9b0-446">Questo codice aggiorna il valore <xref:System.Web.ClientServices.ConnectivityStatus.IsOffline%2A> e riconvalida l'utente automaticamente quando ritorna in modalità online.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-446">This code updates the <xref:System.Web.ClientServices.ConnectivityStatus.IsOffline%2A> value and silently revalidates the user when they return to online mode.</span></span> <span data-ttu-id="9d9b0-447">Il metodo <xref:System.Web.ClientServices.ClientFormsIdentity.RevalidateUser%2A?displayProperty=fullName> usa le credenziali memorizzate nella cache in modo che l'utente non debba eseguire l'accesso in modo esplicito.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-447">The <xref:System.Web.ClientServices.ClientFormsIdentity.RevalidateUser%2A?displayProperty=fullName> method uses the cached credentials so that the user does not have to explicitly log in.</span></span> <span data-ttu-id="9d9b0-448">Se il servizio di autenticazione non è disponibile, viene visualizzato un messaggio di avviso e l'applicazione rimane in modalità offline.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-448">If the authentication service is unavailable, a warning message appears and the application stays offline.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="9d9b0-449">Il metodo <xref:System.Web.ClientServices.ClientFormsIdentity.RevalidateUser%2A> viene fornito solo per praticità</span><span class="sxs-lookup"><span data-stu-id="9d9b0-449">The <xref:System.Web.ClientServices.ClientFormsIdentity.RevalidateUser%2A> method is for convenience only.</span></span> <span data-ttu-id="9d9b0-450">e poiché non restituisce un valore non può indicare se la riconvalida non è riuscita.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-450">Because it does not have a return value, it cannot indicate whether revalidation has failed.</span></span> <span data-ttu-id="9d9b0-451">La riconvalida può non riuscire, ad esempio, se le credenziali utente sono state modificato nel server.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-451">Revalidation can fail, for example, if the user credentials have changed on the server.</span></span> <span data-ttu-id="9d9b0-452">In questo caso, è necessario includere il codice che convalida in modo esplicito gli utenti dopo l'esito negativo di una chiamata al servizio.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-452">In this case, you might want to include code that explicitly validates users after a service call fails.</span></span> <span data-ttu-id="9d9b0-453">Per altre informazioni, vedere la sezione Accesso alle impostazioni Web descritta in precedenza in questa procedura dettagliata.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-453">For more information, see the Accessing Web Settings section earlier in this walkthrough.</span></span>  
  
     <span data-ttu-id="9d9b0-454">Dopo la riconvalida, questo codice salva tutte le modifiche apportate alle impostazioni Web locali chiamando il metodo `SaveSettings` aggiunto in precedenza.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-454">After revalidation, this code saves any changes to the local Web settings by calling the `SaveSettings` method that you added previously.</span></span> <span data-ttu-id="9d9b0-455">Recupera quindi tutti i nuovi valori nel server chiamando il metodo <xref:System.Configuration.ApplicationSettingsBase.Reload%2A> della classe `Settings` del progetto (alla quale si accede come `Properties.Settings.Default` in C# e come `My.Settings` in [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]).</span><span class="sxs-lookup"><span data-stu-id="9d9b0-455">It then retrieves any new values on the server by calling the <xref:System.Configuration.ApplicationSettingsBase.Reload%2A> method of the project's `Settings` class (accessed as `Properties.Settings.Default` in C# and `My.Settings` in [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]).</span></span>  
  
     <span data-ttu-id="9d9b0-456">[!code-csharp[ClientApplicationServices#080](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#080)]  [!code-vb[ClientApplicationServices#080](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#080)]</span><span class="sxs-lookup"><span data-stu-id="9d9b0-456">[!code-csharp[ClientApplicationServices#080](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#080)]  [!code-vb[ClientApplicationServices#080](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#080)]</span></span>  
  
7.  <span data-ttu-id="9d9b0-457">Aggiungere il codice seguente alla fine del metodo `Form1_Load` per assicurarsi che la casella di controllo visualizzi lo stato di connessione corrente.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-457">Add the following code to the end of the `Form1_Load` method to make sure that the check box displays the current connection state.</span></span>  
  
     <span data-ttu-id="9d9b0-458">[!code-csharp[ClientApplicationServices#014](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#014)]  [!code-vb[ClientApplicationServices#014](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#014)]</span><span class="sxs-lookup"><span data-stu-id="9d9b0-458">[!code-csharp[ClientApplicationServices#014](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#014)]  [!code-vb[ClientApplicationServices#014](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#014)]</span></span>  
  
 <span data-ttu-id="9d9b0-459">Questo completa l'applicazione di esempio.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-459">This completes the example application.</span></span> <span data-ttu-id="9d9b0-460">Per testare la funzionalità offline, eseguire l'applicazione, accedere come employee o manager e quindi selezionare **Offline**.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-460">To test the offline capability, run the application, log in as either employee or manager, and then select **Work offline**.</span></span> <span data-ttu-id="9d9b0-461">Modificare il valore nella casella di testo, quindi chiudere l'applicazione</span><span class="sxs-lookup"><span data-stu-id="9d9b0-461">Modify the value in the text box, and then close the application.</span></span> <span data-ttu-id="9d9b0-462">e riavviarla.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-462">Restart the application.</span></span> <span data-ttu-id="9d9b0-463">Prima di effettuare l'accesso, fare clic con il pulsante destro del mouse sull'icona di Server di sviluppo ASP.NET nell'area di notifica della barra delle applicazioni, quindi scegliere **Arresta**.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-463">Before you log in, right-click the ASP.NET Development Server icon in the notification area of the taskbar and then click **Stop**.</span></span> <span data-ttu-id="9d9b0-464">Eseguire l'accesso normalmente.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-464">Then, log in like normal.</span></span> <span data-ttu-id="9d9b0-465">Anche quando il server non è in esecuzione, è comunque possibile eseguire l'accesso.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-465">Even when the server is not running, you can still log in.</span></span> <span data-ttu-id="9d9b0-466">Modificare il valore della casella di testo e riavviare per visualizzare il valore modificato.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-466">Modify the text box value, exit, and restart to see the modified value.</span></span>  
  
## <a name="summary"></a><span data-ttu-id="9d9b0-467">Riepilogo</span><span class="sxs-lookup"><span data-stu-id="9d9b0-467">Summary</span></span>  
 <span data-ttu-id="9d9b0-468">In questa procedura dettagliata è stato descritto come abilitare e usare i servizi delle applicazioni client in un'applicazione Windows Form.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-468">In this walkthrough, you learned how to enable and use client application services in a Windows Forms application.</span></span> <span data-ttu-id="9d9b0-469">Dopo avere configurato un server di prova, è stato aggiunto il codice all'applicazione per autenticare gli utenti e recuperare i ruoli utente e le impostazioni dell'applicazione dal server.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-469">After setting up a test server, you added code to your application to authenticate users and retrieve user roles and application settings from the server.</span></span> <span data-ttu-id="9d9b0-470">È stato inoltre descritto come abilitare la modalità offline per consentire all'applicazione di usare una cache di dati locale anziché i servizi remoti quando la connessione non è disponibile.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-470">You also learned how to enable offline mode so that your application uses a local data cache instead of the remote services when connectivity is not available.</span></span>  
  
## <a name="next-steps"></a><span data-ttu-id="9d9b0-471">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="9d9b0-471">Next Steps</span></span>  
 <span data-ttu-id="9d9b0-472">In un'applicazione reale si accederà ai dati di molti utenti da un server remoto che non sempre potrebbe essere disponibile o che potrebbe arrestarsi senza preavviso.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-472">In a real-world application, you will access data for many users from a remote server that may not always be available, or may go down without notice.</span></span> <span data-ttu-id="9d9b0-473">Per rendere affidabile l'applicazione, è necessario reagire in maniera appropriata quando il servizio non è disponibile.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-473">To make your application robust, you must respond appropriately to situations where the service is not available.</span></span> <span data-ttu-id="9d9b0-474">Questa procedura dettagliata include blocchi try/catch che consentono di rilevare un'eccezione <xref:System.Net.WebException> e visualizzare un messaggio di errore quando il servizio non è disponibile.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-474">This walkthrough includes try/catch blocks to catch a <xref:System.Net.WebException> and display an error message when the service is not available.</span></span> <span data-ttu-id="9d9b0-475">Nel codice di produzione può essere opportuno gestire questa situazione passando alla modalità offline, uscendo dall'applicazione o negando l'accesso a funzionalità specifiche.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-475">In production code, you might want to handle this case by switching to offline mode, exiting the application, or denying access to specific functionality.</span></span>  
  
 <span data-ttu-id="9d9b0-476">Per aumentare la sicurezza dell'applicazione, assicurarsi di testare completamente l'applicazione e il server prima della distribuzione.</span><span class="sxs-lookup"><span data-stu-id="9d9b0-476">To increase the security of your application, make sure to thoroughly test the application and server before deployment.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="9d9b0-477">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="9d9b0-477">See Also</span></span>  
 <span data-ttu-id="9d9b0-478">[Servizi applicazioni client](../../../docs/framework/common-client-technologies/client-application-services.md) </span><span class="sxs-lookup"><span data-stu-id="9d9b0-478">[Client Application Services](../../../docs/framework/common-client-technologies/client-application-services.md) </span></span>  
 <span data-ttu-id="9d9b0-479">[Cenni preliminari sui servizi delle applicazioni client](../../../docs/framework/common-client-technologies/client-application-services-overview.md) </span><span class="sxs-lookup"><span data-stu-id="9d9b0-479">[Client Application Services Overview](../../../docs/framework/common-client-technologies/client-application-services-overview.md) </span></span>  
 <span data-ttu-id="9d9b0-480">[Procedura: Configurare i servizi delle applicazioni client](../../../docs/framework/common-client-technologies/how-to-configure-client-application-services.md) </span><span class="sxs-lookup"><span data-stu-id="9d9b0-480">[How to: Configure Client Application Services](../../../docs/framework/common-client-technologies/how-to-configure-client-application-services.md) </span></span>  
 <span data-ttu-id="9d9b0-481">[Strumento Amministrazione sito Web di ASP.NET](http://msdn.microsoft.com/library/100ddd8b-7d11-4df9-91ef-0bbbe92e5aec) </span><span class="sxs-lookup"><span data-stu-id="9d9b0-481">[ASP.NET Web Site Administration Tool](http://msdn.microsoft.com/library/100ddd8b-7d11-4df9-91ef-0bbbe92e5aec) </span></span>  
 <span data-ttu-id="9d9b0-482">[Creazione e configurazione del database dei servizi dell'applicazione per SQL Server](http://msdn.microsoft.com/library/ab894e83-7e2f-4af8-a116-b1bff8f815b2) </span><span class="sxs-lookup"><span data-stu-id="9d9b0-482">[Creating and Configuring the Application Services Database for SQL Server](http://msdn.microsoft.com/library/ab894e83-7e2f-4af8-a116-b1bff8f815b2) </span></span>  
 [<span data-ttu-id="9d9b0-483">Procedura dettagliata: utilizzo di servizi delle applicazioni client</span><span class="sxs-lookup"><span data-stu-id="9d9b0-483">Walkthrough: Using ASP.NET Application Services</span></span>](http://msdn.microsoft.com/library/f3f394f0-20d6-4361-aa8f-4b21bf4933eb)

