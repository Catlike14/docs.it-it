---
title: Firma di stored procedure in SQL Server
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-ado
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: eeed752c-0084-48e5-9dca-381353007a0d
caps.latest.revision: "6"
author: JennieHubbard
ms.author: jhubbard
manager: jhubbard
ms.openlocfilehash: 86c2a6c3f2c84c931df15e4809980a76cb6d826c
ms.sourcegitcommit: 4f3fef493080a43e70e951223894768d36ce430a
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 11/21/2017
---
# <a name="signing-stored-procedures-in-sql-server"></a><span data-ttu-id="15468-102">Firma di stored procedure in SQL Server</span><span class="sxs-lookup"><span data-stu-id="15468-102">Signing Stored Procedures in SQL Server</span></span>
<span data-ttu-id="15468-103">È possibile firmare una stored procedure con un certificato o una chiave asimmetrica.</span><span class="sxs-lookup"><span data-stu-id="15468-103">You can sign a stored procedure with a certificate or an asymmetric key.</span></span> <span data-ttu-id="15468-104">Le firme sono progettate per scenari in cui le autorizzazioni non possono essere ereditate tramite il concatenamento della proprietà oppure in cui la catena di proprietà è interrotta, come nel caso delle istruzioni SQL dinamiche.</span><span class="sxs-lookup"><span data-stu-id="15468-104">This is designed for scenarios when permissions cannot be inherited through ownership chaining or when the ownership chain is broken, such as dynamic SQL.</span></span> <span data-ttu-id="15468-105">Viene quindi eseguito il mapping di un utente creato al certificato e vengono concesse le autorizzazioni dell'utente del certificato sugli oggetti cui la stored procedure deve accedere.</span><span class="sxs-lookup"><span data-stu-id="15468-105">You then create a user mapped to the certificate, granting the certificate user permissions on the objects the stored procedure needs to access.</span></span>  
  
 <span data-ttu-id="15468-106">Durante l'esecuzione della stored procedure, SQL Server combina le autorizzazioni dell'utente del certificato con quelle del chiamante.</span><span class="sxs-lookup"><span data-stu-id="15468-106">When the stored procedure is executed, SQL Server combines the permissions of the certificate user with those of the caller.</span></span> <span data-ttu-id="15468-107">A differenza della clausola EXECUTE AS, il contesto di esecuzione della stored procedure non viene modificato.</span><span class="sxs-lookup"><span data-stu-id="15468-107">Unlike the EXECUTE AS clause, it does not change the execution context of the procedure.</span></span> <span data-ttu-id="15468-108">Le funzioni predefinite che restituiscono i nomi di accesso e i nomi utente restituiscono il nome del chiamante e non il nome dell'utente del certificato.</span><span class="sxs-lookup"><span data-stu-id="15468-108">Built-in functions that return login and user names return the name of the caller, not the certificate user name.</span></span>  
  
 <span data-ttu-id="15468-109">Un firma digitale è un digest di dati crittografato con la chiave privata del firmatario.</span><span class="sxs-lookup"><span data-stu-id="15468-109">A digital signature is a data digest encrypted with the private key of the signer.</span></span> <span data-ttu-id="15468-110">La chiave privata garantisce che la firma digitale è univoca per il titolare o il proprietario.</span><span class="sxs-lookup"><span data-stu-id="15468-110">The private key ensures that the digital signature is unique to its bearer or owner.</span></span> <span data-ttu-id="15468-111">È possibile usare la firma per stored procedure, funzioni o trigger.</span><span class="sxs-lookup"><span data-stu-id="15468-111">You can sign stored procedures, functions, or triggers.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="15468-112">Per concedere autorizzazioni a livello di server, è possibile creare un certificato nel database master.</span><span class="sxs-lookup"><span data-stu-id="15468-112">You can create a certificate in the master database to grant server-level permissions.</span></span>  
  
## <a name="creating-certificates"></a><span data-ttu-id="15468-113">Creazione di certificati</span><span class="sxs-lookup"><span data-stu-id="15468-113">Creating Certificates</span></span>  
 <span data-ttu-id="15468-114">Quando si firma una stored procedure con un certificato, viene usata la chiave privata per creare un digest di dati costituito dall'hash crittografato del codice della stored procedure code.</span><span class="sxs-lookup"><span data-stu-id="15468-114">When you sign a stored procedure with a certificate, a data digest consisting of the encrypted hash of the stored procedure code is created using the private key.</span></span> <span data-ttu-id="15468-115">In fase di esecuzione il digest di dati viene decrittografato usando la chiave pubblica e confrontato con il valore hash della stored procedure.</span><span class="sxs-lookup"><span data-stu-id="15468-115">At run time, the data digest is decrypted with the public key and compared with the hash value of the stored procedure.</span></span> <span data-ttu-id="15468-116">La modifica della stored procedure invalida il valore hash, annullando di fatto la corrispondenza della firma digitale.</span><span class="sxs-lookup"><span data-stu-id="15468-116">Modifying the stored procedure invalidates the hash value so that the digital signature no longer matches.</span></span> <span data-ttu-id="15468-117">In tal modo si impedisce che un utente che non disponga di accesso alla chiave privata possa modificare il codice della stored procedure.</span><span class="sxs-lookup"><span data-stu-id="15468-117">This prevents someone who does not have access to the private key from changing the stored procedure code.</span></span> <span data-ttu-id="15468-118">È pertanto necessario firmare nuovamente la procedura ogni volta che viene modificata.</span><span class="sxs-lookup"><span data-stu-id="15468-118">Therefore you must re-sign the procedure each time you modify it.</span></span>  
  
 <span data-ttu-id="15468-119">La firma di un modulo è un processo in quattro passaggi:</span><span class="sxs-lookup"><span data-stu-id="15468-119">There are four steps involved in signing a module:</span></span>  
  
1.  <span data-ttu-id="15468-120">Creazione di un certificato tramite l'istruzione `CREATE CERTIFICATE [certificateName]` Transact-SQL.</span><span class="sxs-lookup"><span data-stu-id="15468-120">Create a certificate using the Transact-SQL `CREATE CERTIFICATE [certificateName]` statement.</span></span> <span data-ttu-id="15468-121">Questa istruzione prevede diverse opzioni per l'impostazione di una data di inizio e una data di fine, nonché di una password.</span><span class="sxs-lookup"><span data-stu-id="15468-121">This statement has several options for setting a start and end date and a password.</span></span> <span data-ttu-id="15468-122">La data di scadenza predefinita è pari a un anno.</span><span class="sxs-lookup"><span data-stu-id="15468-122">The default expiration date is one year</span></span>  
  
2.  <span data-ttu-id="15468-123">Creazione di un utente del database associato al certificato tramite l'istruzione `CREATE USER [userName] FROM CERTIFICATE [certificateName]` Transact-SQL.</span><span class="sxs-lookup"><span data-stu-id="15468-123">Create a database user associated with that certificate using the Transact-SQL `CREATE USER [userName] FROM CERTIFICATE [certificateName]` statement.</span></span> <span data-ttu-id="15468-124">Questo utente esiste solo nel database e non è associato a un account di accesso.</span><span class="sxs-lookup"><span data-stu-id="15468-124">This user exists in the database only and is not associated with a login.</span></span>  
  
3.  <span data-ttu-id="15468-125">Concessione delle autorizzazioni necessarie sugli oggetti di database all'utente del certificato.</span><span class="sxs-lookup"><span data-stu-id="15468-125">Grant the certificate user the required permissions on the database objects.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="15468-126">Un certificato non può concedere autorizzazioni a un utente al quale sono state revocate autorizzazioni usando l'istruzione DENY.</span><span class="sxs-lookup"><span data-stu-id="15468-126">A certificate cannot grant permissions to a user that has had permissions revoked using the DENY statement.</span></span> <span data-ttu-id="15468-127">DENY ha sempre la precedenza su GRANT e impedisce al chiamante di ereditare autorizzazioni concesse all'utente del certificato.</span><span class="sxs-lookup"><span data-stu-id="15468-127">DENY always takes precedence over GRANT, preventing the caller from inheriting permissions granted to the certificate user.</span></span>  
  
1.  <span data-ttu-id="15468-128">Firma della stored procedure con il certificato tramite l'istruzione `ADD SIGNATURE TO [procedureName] BY CERTIFICATE [certificateName]` Transact-SQL.</span><span class="sxs-lookup"><span data-stu-id="15468-128">Sign the procedure with the certificate using the Transact-SQL `ADD SIGNATURE TO [procedureName] BY CERTIFICATE [certificateName]` statement.</span></span>  
  
## <a name="external-resources"></a><span data-ttu-id="15468-129">Risorse esterne</span><span class="sxs-lookup"><span data-stu-id="15468-129">External Resources</span></span>  
 <span data-ttu-id="15468-130">Per altre informazioni, vedere le risorse seguenti.</span><span class="sxs-lookup"><span data-stu-id="15468-130">For more information, see the following resources.</span></span>  
  
|<span data-ttu-id="15468-131">Risorsa</span><span class="sxs-lookup"><span data-stu-id="15468-131">Resource</span></span>|<span data-ttu-id="15468-132">Descrizione</span><span class="sxs-lookup"><span data-stu-id="15468-132">Description</span></span>|  
|--------------|-----------------|  
|<span data-ttu-id="15468-133">[Firma del modulo](http://go.microsoft.com/fwlink/?LinkId=98590) nella documentazione Online di SQL Server</span><span class="sxs-lookup"><span data-stu-id="15468-133">[Module Signing](http://go.microsoft.com/fwlink/?LinkId=98590) in SQL Server Books Online</span></span>|<span data-ttu-id="15468-134">Viene descritta la procedura di firma dei moduli e vengono forniti uno scenario di esempio e collegamenti agli argomenti Transact-SQL attinenti.</span><span class="sxs-lookup"><span data-stu-id="15468-134">Describes module signing, providing a sample scenario and links to the relevant Transact-SQL topics.</span></span>|  
|<span data-ttu-id="15468-135">[Stored procedure con un certificato di firma](http://msdn.microsoft.com/library/bb283630.aspx) nella documentazione Online di SQL Server</span><span class="sxs-lookup"><span data-stu-id="15468-135">[Signing Stored Procedures with a Certificate](http://msdn.microsoft.com/library/bb283630.aspx) in SQL Server Books Online</span></span>|<span data-ttu-id="15468-136">Viene fornita un'esercitazione per firmare una stored procedure con un certificato.</span><span class="sxs-lookup"><span data-stu-id="15468-136">Provides a tutorial for signing a stored procedure with a certificate.</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="15468-137">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="15468-137">See Also</span></span>  
 [<span data-ttu-id="15468-138">Protezione delle applicazioni ADO.NET</span><span class="sxs-lookup"><span data-stu-id="15468-138">Securing ADO.NET Applications</span></span>](../../../../../docs/framework/data/adonet/securing-ado-net-applications.md)  
 [<span data-ttu-id="15468-139">Panoramica della sicurezza SQL Server</span><span class="sxs-lookup"><span data-stu-id="15468-139">Overview of SQL Server Security</span></span>](../../../../../docs/framework/data/adonet/sql/overview-of-sql-server-security.md)  
 [<span data-ttu-id="15468-140">Scenari di sicurezza in SQL Server</span><span class="sxs-lookup"><span data-stu-id="15468-140">Application Security Scenarios in SQL Server</span></span>](../../../../../docs/framework/data/adonet/sql/application-security-scenarios-in-sql-server.md)  
 [<span data-ttu-id="15468-141">Gestione delle autorizzazioni con Stored procedure in SQL Server</span><span class="sxs-lookup"><span data-stu-id="15468-141">Managing Permissions with Stored Procedures in SQL Server</span></span>](../../../../../docs/framework/data/adonet/sql/managing-permissions-with-stored-procedures-in-sql-server.md)  
 [<span data-ttu-id="15468-142">Scrittura dinamica sicura in SQL Server</span><span class="sxs-lookup"><span data-stu-id="15468-142">Writing Secure Dynamic SQL in SQL Server</span></span>](../../../../../docs/framework/data/adonet/sql/writing-secure-dynamic-sql-in-sql-server.md)  
 [<span data-ttu-id="15468-143">Personalizzazione delle autorizzazioni con rappresentazione in SQL Server</span><span class="sxs-lookup"><span data-stu-id="15468-143">Customizing Permissions with Impersonation in SQL Server</span></span>](../../../../../docs/framework/data/adonet/sql/customizing-permissions-with-impersonation-in-sql-server.md)  
 [<span data-ttu-id="15468-144">Modifica dei dati con le Stored procedure</span><span class="sxs-lookup"><span data-stu-id="15468-144">Modifying Data with Stored Procedures</span></span>](../../../../../docs/framework/data/adonet/modifying-data-with-stored-procedures.md)  
 [<span data-ttu-id="15468-145">Provider gestiti ADO.NET e Centro per sviluppatori di set di dati</span><span class="sxs-lookup"><span data-stu-id="15468-145">ADO.NET Managed Providers and DataSet Developer Center</span></span>](http://go.microsoft.com/fwlink/?LinkId=217917)
