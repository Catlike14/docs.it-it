---
title: "Interoperatività di WPF e Direct3D9"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology:
- dotnet-wpf
ms.tgt_pltfrm: 
ms.topic: article
dev_langs:
- cpp
helpviewer_keywords:
- WPF [WPF], creating Direct3D9 content
- Direct3D9 [WPF interoperability], creating Direct3D9 content
ms.assetid: 1b14b823-69c4-4e8d-99e4-f6dade58f89a
caps.latest.revision: 
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.workload:
- dotnet
ms.openlocfilehash: abfdeb4dbf72d0173b020e201f85a30b57cfb3e2
ms.sourcegitcommit: 16186c34a957fdd52e5db7294f291f7530ac9d24
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 12/22/2017
---
# <a name="wpf-and-direct3d9-interoperation"></a><span data-ttu-id="70606-102">Interoperatività di WPF e Direct3D9</span><span class="sxs-lookup"><span data-stu-id="70606-102">WPF and Direct3D9 Interoperation</span></span>
<span data-ttu-id="70606-103">È possibile includere contenuto Direct3D9 in un'applicazione Windows Presentation Foundation (WPF).</span><span class="sxs-lookup"><span data-stu-id="70606-103">You can include Direct3D9 content in a Windows Presentation Foundation (WPF) application.</span></span> <span data-ttu-id="70606-104">In questo argomento viene descritto come creare contenuto Direct3D9 in modo che in modo efficiente interagisce con WPF.</span><span class="sxs-lookup"><span data-stu-id="70606-104">This topic describes how to create Direct3D9 content so that it efficiently interoperates with WPF.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="70606-105">Quando si utilizza il contenuto Direct3D9 in WPF, è necessario anche valutare le prestazioni.</span><span class="sxs-lookup"><span data-stu-id="70606-105">When using Direct3D9 content in WPF, you also need to think about performance.</span></span> <span data-ttu-id="70606-106">Per ulteriori informazioni su come ottimizzare le prestazioni, vedere [considerazioni sulle prestazioni per l'interoperabilità di WPF e Direct3D9](../../../../docs/framework/wpf/advanced/performance-considerations-for-direct3d9-and-wpf-interoperability.md).</span><span class="sxs-lookup"><span data-stu-id="70606-106">For more information about how to optimize for performance, see [Performance Considerations for Direct3D9 and WPF Interoperability](../../../../docs/framework/wpf/advanced/performance-considerations-for-direct3d9-and-wpf-interoperability.md).</span></span>  
  
## <a name="display-buffers"></a><span data-ttu-id="70606-107">Buffer di visualizzazione</span><span class="sxs-lookup"><span data-stu-id="70606-107">Display Buffers</span></span>  
 <span data-ttu-id="70606-108">Il <xref:System.Windows.Interop.D3DImage> classe gestisce due buffer di visualizzazione, ovvero il *buffer nascosto* e *buffer front-*.</span><span class="sxs-lookup"><span data-stu-id="70606-108">The <xref:System.Windows.Interop.D3DImage> class manages two display buffers, which are called the *back buffer* and the *front buffer*.</span></span> <span data-ttu-id="70606-109">Il buffer rappresenta la superficie Direct3D9.</span><span class="sxs-lookup"><span data-stu-id="70606-109">The back buffer is your Direct3D9 surface.</span></span> <span data-ttu-id="70606-110">Le modifiche apportate al buffer nascosto vengono copiate nel front buffer quando si chiama il <xref:System.Windows.Interop.D3DImage.Unlock%2A> metodo.</span><span class="sxs-lookup"><span data-stu-id="70606-110">Changes to the back buffer are copied forward to the front buffer when you call the <xref:System.Windows.Interop.D3DImage.Unlock%2A> method.</span></span>  
  
 <span data-ttu-id="70606-111">Nella figura seguente viene illustrata la relazione tra il buffer nascosto e il buffer anteriore.</span><span class="sxs-lookup"><span data-stu-id="70606-111">The following illustration shows the relationship between the back buffer and the front buffer.</span></span>  
  
 <span data-ttu-id="70606-112">![Buffer di visualizzazione D3DImage](../../../../docs/framework/wpf/advanced/media/d3dimage-buffers.png "D3DImage_buffers")</span><span class="sxs-lookup"><span data-stu-id="70606-112">![D3DImage display buffers](../../../../docs/framework/wpf/advanced/media/d3dimage-buffers.png "D3DImage_buffers")</span></span>  
  
## <a name="direct3d9-device-creation"></a><span data-ttu-id="70606-113">Creazione di un dispositivo Direct3D9</span><span class="sxs-lookup"><span data-stu-id="70606-113">Direct3D9 Device Creation</span></span>  
 <span data-ttu-id="70606-114">Per eseguire il rendering Direct3D9 contenuto, è necessario creare un dispositivo Direct3D9.</span><span class="sxs-lookup"><span data-stu-id="70606-114">To render Direct3D9 content, you must create a Direct3D9 device.</span></span> <span data-ttu-id="70606-115">Esistono due oggetti Direct3D9 che è possibile utilizzare per creare un dispositivo, `IDirect3D9` e `IDirect3D9Ex`.</span><span class="sxs-lookup"><span data-stu-id="70606-115">There are two Direct3D9 objects that you can use to create a device, `IDirect3D9` and `IDirect3D9Ex`.</span></span> <span data-ttu-id="70606-116">Utilizzare questi oggetti per creare `IDirect3DDevice9` e `IDirect3DDevice9Ex` dispositivi, rispettivamente.</span><span class="sxs-lookup"><span data-stu-id="70606-116">Use these objects to create `IDirect3DDevice9` and `IDirect3DDevice9Ex` devices, respectively.</span></span>  
  
 <span data-ttu-id="70606-117">Creare un dispositivo chiamando uno dei metodi seguenti.</span><span class="sxs-lookup"><span data-stu-id="70606-117">Create a device by calling one of the following methods.</span></span>  
  
-   `IDirect3D9 * Direct3DCreate9(UINT SDKVersion);`  
  
-   `HRESULT Direct3DCreate9Ex(UINT SDKVersion, IDirect3D9Ex **ppD3D);`  
  
 <span data-ttu-id="70606-118">In Windows Vista o versioni successive del sistema operativo, utilizzare il `Direct3DCreate9Ex` metodo con una visualizzazione che è configurata per l'utilizzo di Windows Driver Model (WDDM Display).</span><span class="sxs-lookup"><span data-stu-id="70606-118">On Windows Vista or later operating system, use the `Direct3DCreate9Ex` method with a display that is configured to use the Windows Display Driver Model (WDDM).</span></span> <span data-ttu-id="70606-119">Utilizzare il `Direct3DCreate9` metodo su qualsiasi altra piattaforma.</span><span class="sxs-lookup"><span data-stu-id="70606-119">Use the `Direct3DCreate9` method on any other platform.</span></span>  
  
### <a name="availability-of-the-direct3dcreate9ex-method"></a><span data-ttu-id="70606-120">Disponibilità del metodo Direct3DCreate9Ex</span><span class="sxs-lookup"><span data-stu-id="70606-120">Availability of the Direct3DCreate9Ex method</span></span>  
 <span data-ttu-id="70606-121">È il d3d9.dll il `Direct3DCreate9Ex` metodo solo in Windows Vista o versioni successive del sistema operativo.</span><span class="sxs-lookup"><span data-stu-id="70606-121">The d3d9.dll has the `Direct3DCreate9Ex` method only on Windows Vista or later operating system.</span></span> <span data-ttu-id="70606-122">Se si collega direttamente la funzione in Windows XP, l'applicazione non riesce a caricare.</span><span class="sxs-lookup"><span data-stu-id="70606-122">If you directly link the function on Windows XP, your application fails to load.</span></span> <span data-ttu-id="70606-123">Per determinare se il `Direct3DCreate9Ex` metodo è supportato, caricare la DLL e cercare l'indirizzo di routine.</span><span class="sxs-lookup"><span data-stu-id="70606-123">To determine whether the `Direct3DCreate9Ex` method is supported, load the DLL and look for the proc address.</span></span> <span data-ttu-id="70606-124">Il codice seguente viene illustrato come verificare la presenza di `Direct3DCreate9Ex` metodo.</span><span class="sxs-lookup"><span data-stu-id="70606-124">The following code shows how to test for the `Direct3DCreate9Ex` method.</span></span> <span data-ttu-id="70606-125">Per un esempio di codice completo, vedere [procedura dettagliata: creazione di contenuto Direct3D9 per l'Hosting in WPF](../../../../docs/framework/wpf/advanced/walkthrough-creating-direct3d9-content-for-hosting-in-wpf.md).</span><span class="sxs-lookup"><span data-stu-id="70606-125">For a full code example, see [Walkthrough: Creating Direct3D9 Content for Hosting in WPF](../../../../docs/framework/wpf/advanced/walkthrough-creating-direct3d9-content-for-hosting-in-wpf.md).</span></span>  
  
 [!code-cpp[System.Windows.Interop.D3DImage#RendererManager_EnsureD3DObjects](../../../../samples/snippets/cpp/VS_Snippets_Wpf/System.Windows.Interop.D3DImage/cpp/renderermanager.cpp#renderermanager_ensured3dobjects)]  
  
### <a name="hwnd-creation"></a><span data-ttu-id="70606-126">Creazione di un HWND</span><span class="sxs-lookup"><span data-stu-id="70606-126">HWND Creation</span></span>  
 <span data-ttu-id="70606-127">Creazione di un dispositivo richiede un elemento HWND.</span><span class="sxs-lookup"><span data-stu-id="70606-127">Creating a device requires an HWND.</span></span> <span data-ttu-id="70606-128">In generale, si crea un HWND fittizio Direct3D9 da utilizzare.</span><span class="sxs-lookup"><span data-stu-id="70606-128">In general, you create a dummy HWND for Direct3D9 to use.</span></span> <span data-ttu-id="70606-129">Esempio di codice seguente viene illustrato come creare un HWND fittizio.</span><span class="sxs-lookup"><span data-stu-id="70606-129">The following code example shows how to create a dummy HWND.</span></span>  
  
 [!code-cpp[System.Windows.Interop.D3DImage#RendererManager_EnsureHWND](../../../../samples/snippets/cpp/VS_Snippets_Wpf/System.Windows.Interop.D3DImage/cpp/renderermanager.cpp#renderermanager_ensurehwnd)]  
  
### <a name="present-parameters"></a><span data-ttu-id="70606-130">Parametri presenti</span><span class="sxs-lookup"><span data-stu-id="70606-130">Present Parameters</span></span>  
 <span data-ttu-id="70606-131">La creazione di un dispositivo richiede anche un `D3DPRESENT_PARAMETERS` struct, ma solo alcuni parametri sono importanti.</span><span class="sxs-lookup"><span data-stu-id="70606-131">Creating a device also requires a `D3DPRESENT_PARAMETERS` struct, but only a few parameters are important.</span></span> <span data-ttu-id="70606-132">Questi parametri vengono scelti per ridurre il footprint di memoria.</span><span class="sxs-lookup"><span data-stu-id="70606-132">These parameters are chosen to minimize the memory footprint.</span></span>  
  
 <span data-ttu-id="70606-133">Impostare il `BackBufferHeight` e `BackBufferWidth` campi su 1.</span><span class="sxs-lookup"><span data-stu-id="70606-133">Set the `BackBufferHeight` and `BackBufferWidth` fields to 1.</span></span> <span data-ttu-id="70606-134">Se li su 0, che è possibile impostare le dimensioni di HWND.</span><span class="sxs-lookup"><span data-stu-id="70606-134">Setting them to 0 causes them to be set to the dimensions of the HWND.</span></span>  
  
 <span data-ttu-id="70606-135">Impostare sempre la `D3DCREATE_MULTITHREADED` e `D3DCREATE_FPU_PRESERVE` flag per evitare il danneggiamento della memoria utilizzata da Direct3D9 e per impedire a Direct3D9 di modificare le impostazioni FPU.</span><span class="sxs-lookup"><span data-stu-id="70606-135">Always set the `D3DCREATE_MULTITHREADED` and `D3DCREATE_FPU_PRESERVE` flags to prevent corrupting memory used by Direct3D9 and to prevent Direct3D9 from changing FPU settings.</span></span>  
  
 <span data-ttu-id="70606-136">Il codice seguente viene illustrato come inizializzare il `D3DPRESENT_PARAMETERS` struct.</span><span class="sxs-lookup"><span data-stu-id="70606-136">The following code shows how to initialize the `D3DPRESENT_PARAMETERS` struct.</span></span>  
  
 [!code-cpp[System.Windows.Interop.D3DImage#Renderer_Init](../../../../samples/snippets/cpp/VS_Snippets_Wpf/System.Windows.Interop.D3DImage/cpp/renderer.cpp#renderer_init)]  
  
## <a name="creating-the-back-buffer-render-target"></a><span data-ttu-id="70606-137">Creazione di destinazione di rendering del Buffer nascosto</span><span class="sxs-lookup"><span data-stu-id="70606-137">Creating the Back Buffer Render Target</span></span>  
 <span data-ttu-id="70606-138">Per visualizzare il contenuto Direct3D9 in un <xref:System.Windows.Interop.D3DImage>, si crea una superficie di Direct3D9 e assegnarlo chiamando il <xref:System.Windows.Interop.D3DImage.SetBackBuffer%2A> metodo.</span><span class="sxs-lookup"><span data-stu-id="70606-138">To display Direct3D9 content in a <xref:System.Windows.Interop.D3DImage>, you create a Direct3D9 surface and assign it by calling the <xref:System.Windows.Interop.D3DImage.SetBackBuffer%2A> method.</span></span>  
  
### <a name="verifying-adapter-support"></a><span data-ttu-id="70606-139">Supporto per gli Adapter di verifica</span><span class="sxs-lookup"><span data-stu-id="70606-139">Verifying Adapter Support</span></span>  
 <span data-ttu-id="70606-140">Prima di creare un'area, verificare che tutti gli adapter supportano la superficie di attacco proprietà che necessarie.</span><span class="sxs-lookup"><span data-stu-id="70606-140">Before creating a surface, verify that all adapters support the surface properties you require.</span></span> <span data-ttu-id="70606-141">Anche se si esegue il rendering di una sola scheda, la finestra WPF è visualizzata in qualsiasi scheda nel sistema.</span><span class="sxs-lookup"><span data-stu-id="70606-141">Even if you render to only one adapter, the WPF window may be displayed on any adapter in the system.</span></span> <span data-ttu-id="70606-142">È necessario scrivere sempre codice Direct3D9 che gestisce le configurazioni delle multi- schede e controllare tutte le schede per il supporto, poiché WPF è possibile spostare l'area tra le schede disponibili.</span><span class="sxs-lookup"><span data-stu-id="70606-142">You should always write Direct3D9 code that handles multi-adapter configurations, and you should check all adapters for support, because WPF might move the surface among the available adapters.</span></span>  
  
 <span data-ttu-id="70606-143">Esempio di codice seguente viene illustrato come controllare tutte le schede sul sistema per Direct3D9 supportano.</span><span class="sxs-lookup"><span data-stu-id="70606-143">The following code example shows how to check all adapters on the system for Direct3D9 support.</span></span>  
  
 [!code-cpp[System.Windows.Interop.D3DImage#RendererManager_TestSurfaceSettings](../../../../samples/snippets/cpp/VS_Snippets_Wpf/System.Windows.Interop.D3DImage/cpp/renderermanager.cpp#renderermanager_testsurfacesettings)]  
  
### <a name="creating-the-surface"></a><span data-ttu-id="70606-144">La creazione della superficie</span><span class="sxs-lookup"><span data-stu-id="70606-144">Creating the Surface</span></span>  
 <span data-ttu-id="70606-145">Prima di creare un'area, verificare che le funzionalità dei dispositivi supportano buone prestazioni nel sistema operativo di destinazione.</span><span class="sxs-lookup"><span data-stu-id="70606-145">Before creating a surface, verify that the device capabilities support good performance on the target operating system.</span></span> <span data-ttu-id="70606-146">Per ulteriori informazioni, vedere [considerazioni sulle prestazioni per l'interoperabilità di WPF e Direct3D9](../../../../docs/framework/wpf/advanced/performance-considerations-for-direct3d9-and-wpf-interoperability.md).</span><span class="sxs-lookup"><span data-stu-id="70606-146">For more information, see [Performance Considerations for Direct3D9 and WPF Interoperability](../../../../docs/framework/wpf/advanced/performance-considerations-for-direct3d9-and-wpf-interoperability.md).</span></span>  
  
 <span data-ttu-id="70606-147">Dopo avere verificato le funzionalità di dispositivo, è possibile creare l'area.</span><span class="sxs-lookup"><span data-stu-id="70606-147">When you have verified device capabilities, you can create the surface.</span></span> <span data-ttu-id="70606-148">Esempio di codice seguente viene illustrato come creare la destinazione di rendering.</span><span class="sxs-lookup"><span data-stu-id="70606-148">The following code example shows how to create the render target.</span></span>  
  
 [!code-cpp[System.Windows.Interop.D3DImage#Renderer_CreateSurface](../../../../samples/snippets/cpp/VS_Snippets_Wpf/System.Windows.Interop.D3DImage/cpp/renderer.cpp#renderer_createsurface)]  
  
### <a name="wddm"></a><span data-ttu-id="70606-149">WDDM</span><span class="sxs-lookup"><span data-stu-id="70606-149">WDDM</span></span>  
 <span data-ttu-id="70606-150">In Windows Vista e versioni successive, che sono configurati per l'utilizzo di WDDM, è possibile creare una trama di destinazione di rendering e passare la superficie di livello 0 per il <xref:System.Windows.Interop.D3DImage.SetBackBuffer%2A> metodo.</span><span class="sxs-lookup"><span data-stu-id="70606-150">On Windows Vista and later operating systems, which are configured to use the WDDM, you can create a render target texture and pass the level 0 surface to the <xref:System.Windows.Interop.D3DImage.SetBackBuffer%2A> method.</span></span> <span data-ttu-id="70606-151">Questo approccio non è consigliato in Windows XP, perché non è possibile creare una trama di destinazione di rendering bloccabile e prestazioni risultano ridotte.</span><span class="sxs-lookup"><span data-stu-id="70606-151">This approach is not recommended on Windows XP, because you cannot create a lockable render target texture and performance will be reduced.</span></span>  
  
## <a name="handling-device-state"></a><span data-ttu-id="70606-152">Gestione dello stato del dispositivo</span><span class="sxs-lookup"><span data-stu-id="70606-152">Handling Device State</span></span>  
 <span data-ttu-id="70606-153">Il <xref:System.Windows.Interop.D3DImage> classe gestisce due buffer di visualizzazione, ovvero il *buffer nascosto* e *buffer front-*.</span><span class="sxs-lookup"><span data-stu-id="70606-153">The <xref:System.Windows.Interop.D3DImage> class manages two display buffers, which are called the *back buffer* and the *front buffer*.</span></span> <span data-ttu-id="70606-154">Il buffer rappresenta la superficie di Direct3D.</span><span class="sxs-lookup"><span data-stu-id="70606-154">The back buffer is your Direct3D surface.</span></span>  <span data-ttu-id="70606-155">Le modifiche apportate al buffer nascosto vengono copiate nel front buffer quando si chiama il <xref:System.Windows.Interop.D3DImage.Unlock%2A> (metodo), in cui vengono visualizzati nell'hardware.</span><span class="sxs-lookup"><span data-stu-id="70606-155">Changes to the back buffer are copied forward to the front buffer when you call the <xref:System.Windows.Interop.D3DImage.Unlock%2A> method, where it is displayed on the hardware.</span></span> <span data-ttu-id="70606-156">In alcuni casi, il front buffer non è più disponibile.</span><span class="sxs-lookup"><span data-stu-id="70606-156">Occasionally, the front buffer becomes unavailable.</span></span> <span data-ttu-id="70606-157">La mancanza di disponibilità può essere causata dal blocco dello schermo, applicazioni Direct3D esclusive a schermo intero, cambio utente o altre attività di sistema.</span><span class="sxs-lookup"><span data-stu-id="70606-157">This lack of availability can be caused by screen locking, full-screen exclusive Direct3D applications, user-switching, or other system activities.</span></span> <span data-ttu-id="70606-158">In questo caso, l'applicazione WPF notifica gestendo il <xref:System.Windows.Interop.D3DImage.IsFrontBufferAvailableChanged> evento.</span><span class="sxs-lookup"><span data-stu-id="70606-158">When this occurs, your WPF application is notified by handling the <xref:System.Windows.Interop.D3DImage.IsFrontBufferAvailableChanged> event.</span></span>  <span data-ttu-id="70606-159">Modalità di risposta dell'applicazione nel front buffer non sono più disponibili dipende dal tipo di attivazione WPF per eseguire il fallback per il rendering software.</span><span class="sxs-lookup"><span data-stu-id="70606-159">How your application responds to the front buffer becoming unavailable depends on whether WPF is enabled to fall back to software rendering.</span></span> <span data-ttu-id="70606-160">Il <xref:System.Windows.Interop.D3DImage.SetBackBuffer%2A> metodo presenta un overload che accetta un parametro che specifica se il fallback WPF per il rendering software.</span><span class="sxs-lookup"><span data-stu-id="70606-160">The <xref:System.Windows.Interop.D3DImage.SetBackBuffer%2A> method has an overload that takes a parameter that specifies whether WPF falls back to software rendering.</span></span>  
  
 <span data-ttu-id="70606-161">Quando si chiama il <xref:System.Windows.Interop.D3DImage.SetBackBuffer%28System.Windows.Interop.D3DResourceType%2CSystem.IntPtr%29> overload o chiamare il <xref:System.Windows.Interop.D3DImage.SetBackBuffer%28System.Windows.Interop.D3DResourceType%2CSystem.IntPtr%2CSystem.Boolean%29> eseguire l'overload con il `enableSoftwareFallback` parametro impostato su `false`, il sistema di rendering rilascia il riferimento al buffer nascosto quando il front buffer non è più disponibile e non è visualizzato.</span><span class="sxs-lookup"><span data-stu-id="70606-161">When you call the <xref:System.Windows.Interop.D3DImage.SetBackBuffer%28System.Windows.Interop.D3DResourceType%2CSystem.IntPtr%29> overload or call the <xref:System.Windows.Interop.D3DImage.SetBackBuffer%28System.Windows.Interop.D3DResourceType%2CSystem.IntPtr%2CSystem.Boolean%29> overload with the `enableSoftwareFallback` parameter set to `false`, the rendering system releases its reference to the back buffer when the front buffer becomes unavailable and nothing is displayed.</span></span> <span data-ttu-id="70606-162">Quando il buffer anteriore è nuovamente disponibile, il sistema di rendering genera il <xref:System.Windows.Interop.D3DImage.IsFrontBufferAvailableChanged> evento per notificare all'applicazione WPF.</span><span class="sxs-lookup"><span data-stu-id="70606-162">When the front buffer is available again, the rendering system raises the <xref:System.Windows.Interop.D3DImage.IsFrontBufferAvailableChanged> event to notify your WPF application.</span></span>  <span data-ttu-id="70606-163">È possibile creare un gestore eventi per il <xref:System.Windows.Interop.D3DImage.IsFrontBufferAvailableChanged> riavviare il rendering con una superficie Direct3D valida dell'evento.</span><span class="sxs-lookup"><span data-stu-id="70606-163">You can create an event handler for the <xref:System.Windows.Interop.D3DImage.IsFrontBufferAvailableChanged> event to restart rendering again with a valid Direct3D surface.</span></span> <span data-ttu-id="70606-164">Per riavviare il rendering, è necessario chiamare <xref:System.Windows.Interop.D3DImage.SetBackBuffer%2A>.</span><span class="sxs-lookup"><span data-stu-id="70606-164">To restart rendering, you must call <xref:System.Windows.Interop.D3DImage.SetBackBuffer%2A>.</span></span>  
  
 <span data-ttu-id="70606-165">Quando si chiama il <xref:System.Windows.Interop.D3DImage.SetBackBuffer%28System.Windows.Interop.D3DResourceType%2CSystem.IntPtr%2CSystem.Boolean%29> eseguire l'overload con il `enableSoftwareFallback` parametro impostato su `true`, il sistema di rendering mantiene il relativo riferimento al buffer nascosto quando il front buffer non è disponibile, in modo non è necessario chiamare <xref:System.Windows.Interop.D3DImage.SetBackBuffer%2A> quando all'inizio buffer sarà nuovamente disponibile.</span><span class="sxs-lookup"><span data-stu-id="70606-165">When you call the <xref:System.Windows.Interop.D3DImage.SetBackBuffer%28System.Windows.Interop.D3DResourceType%2CSystem.IntPtr%2CSystem.Boolean%29> overload with the `enableSoftwareFallback` parameter set to `true`, the rendering system retains its reference to the back buffer when the front buffer becomes unavailable, so there is no need to call <xref:System.Windows.Interop.D3DImage.SetBackBuffer%2A> when the front buffer is available again.</span></span>  
  
 <span data-ttu-id="70606-166">Quando è abilitato per il rendering software, potrebbero verificarsi situazioni in cui il dispositivo dell'utente non è più disponibile, ma il sistema di rendering mantiene un riferimento all'area di Direct3D.</span><span class="sxs-lookup"><span data-stu-id="70606-166">When software rendering is enabled, there may be situations where the user’s device becomes unavailable, but the rendering system retains a reference to the Direct3D surface.</span></span> <span data-ttu-id="70606-167">Per verificare se un dispositivo Direct3D9 è disponibile, chiamare il `TestCooperativeLevel` metodo.</span><span class="sxs-lookup"><span data-stu-id="70606-167">To check whether a Direct3D9 device is unavailable, call the `TestCooperativeLevel` method.</span></span> <span data-ttu-id="70606-168">Per verificare una chiamata di dispositivi Direct3D9Ex il `CheckDeviceState` (metodo), in quanto il `TestCooperativeLevel` metodo è obsoleto e restituisce sempre esito positivo.</span><span class="sxs-lookup"><span data-stu-id="70606-168">To check a Direct3D9Ex devices call the `CheckDeviceState` method, because the `TestCooperativeLevel` method is deprecated and always returns success.</span></span> <span data-ttu-id="70606-169">Se il dispositivo dell'utente non è più disponibile, chiamare <xref:System.Windows.Interop.D3DImage.SetBackBuffer%2A> per rilasciare il riferimento di WPF al buffer nascosto.</span><span class="sxs-lookup"><span data-stu-id="70606-169">If the user device has become unavailable, call <xref:System.Windows.Interop.D3DImage.SetBackBuffer%2A> to release WPF’s reference to the back buffer.</span></span>  <span data-ttu-id="70606-170">Per reimpostare il dispositivo, è necessario chiamare <xref:System.Windows.Interop.D3DImage.SetBackBuffer%2A> con il `backBuffer` parametro impostato su `null`e quindi chiamare <xref:System.Windows.Interop.D3DImage.SetBackBuffer%2A> con `backBuffer` impostato su una superficie Direct3D valida.</span><span class="sxs-lookup"><span data-stu-id="70606-170">If you need to reset your device, call <xref:System.Windows.Interop.D3DImage.SetBackBuffer%2A> with the `backBuffer` parameter set to `null`, and then call <xref:System.Windows.Interop.D3DImage.SetBackBuffer%2A> again with `backBuffer` set to a valid Direct3D surface.</span></span>  
  
 <span data-ttu-id="70606-171">Chiamare il `Reset` metodo per recuperare da un dispositivo non valido solo se si implementa il supporto per più adattatori.</span><span class="sxs-lookup"><span data-stu-id="70606-171">Call the `Reset` method to recover from an invalid device only if you implement multi-adapter support.</span></span> <span data-ttu-id="70606-172">In caso contrario, rilascia tutte le interfacce Direct3D9 e ricrearle completamente.</span><span class="sxs-lookup"><span data-stu-id="70606-172">Otherwise, release all Direct3D9 interfaces and re-create them completely.</span></span> <span data-ttu-id="70606-173">Se è stato modificato il layout dell'adattatore, gli oggetti Direct3D9 creati prima della modifica non vengono aggiornati.</span><span class="sxs-lookup"><span data-stu-id="70606-173">If the adapter layout has changed, Direct3D9 objects created before the change are not updated.</span></span>  
  
## <a name="handling-resizing"></a><span data-ttu-id="70606-174">Gestione del ridimensionamento</span><span class="sxs-lookup"><span data-stu-id="70606-174">Handling Resizing</span></span>  
 <span data-ttu-id="70606-175">Se un <xref:System.Windows.Interop.D3DImage> viene visualizzata una risoluzione diversa da quella nativa, viene ridimensionato in base alle corrente <xref:System.Windows.Media.RenderOptions.BitmapScalingMode%2A>, ad eccezione del fatto che <xref:System.Windows.Media.Effects.SamplingMode.Bilinear> verrà sostituito con <xref:System.Windows.Media.BitmapScalingMode.Fant>.</span><span class="sxs-lookup"><span data-stu-id="70606-175">If a <xref:System.Windows.Interop.D3DImage> is displayed at a resolution other than its native size, it is scaled according to the current <xref:System.Windows.Media.RenderOptions.BitmapScalingMode%2A>, except that <xref:System.Windows.Media.Effects.SamplingMode.Bilinear> is substituted for <xref:System.Windows.Media.BitmapScalingMode.Fant>.</span></span>  
  
 <span data-ttu-id="70606-176">Se è necessaria fedeli, è necessario creare un nuovo superficie quando il contenitore di <xref:System.Windows.Interop.D3DImage> Modifica dimensione.</span><span class="sxs-lookup"><span data-stu-id="70606-176">If you require higher fidelity, you must create a new surface when the container of the <xref:System.Windows.Interop.D3DImage> changes size.</span></span>  
  
 <span data-ttu-id="70606-177">Esistono tre possibili approcci per gestire il ridimensionamento.</span><span class="sxs-lookup"><span data-stu-id="70606-177">There are three possible approaches to handle resizing.</span></span>  
  
-   <span data-ttu-id="70606-178">Creare una nuova area quando cambiano le dimensioni fanno parte del sistema di layout.</span><span class="sxs-lookup"><span data-stu-id="70606-178">Participate in the layout system and create a new surface when the size changes.</span></span> <span data-ttu-id="70606-179">Non creare troppe superfici, perché non è possibile esaurire o frammentare la memoria video.</span><span class="sxs-lookup"><span data-stu-id="70606-179">Do not create too many surfaces, because you may exhaust or fragment video memory.</span></span>  
  
-   <span data-ttu-id="70606-180">Attendere un evento di ridimensionamento non è stata eseguita per un determinato periodo di tempo per creare la nuova area.</span><span class="sxs-lookup"><span data-stu-id="70606-180">Wait until a resize event has not occurred for a fixed period of time to create the new surface.</span></span>  
  
-   <span data-ttu-id="70606-181">Creare un <xref:System.Windows.Threading.DispatcherTimer> che controlla le dimensioni del contenitore varie volte al secondo.</span><span class="sxs-lookup"><span data-stu-id="70606-181">Create a <xref:System.Windows.Threading.DispatcherTimer> that checks the container dimensions several times per second.</span></span>  
  
## <a name="multi-monitor-optimization"></a><span data-ttu-id="70606-182">Ottimizzazione di più monitor</span><span class="sxs-lookup"><span data-stu-id="70606-182">Multi-monitor Optimization</span></span>  
 <span data-ttu-id="70606-183">In modo significativo calo delle prestazioni può verificarsi quando il sistema di rendering sposta un <xref:System.Windows.Interop.D3DImage> in un altro monitor.</span><span class="sxs-lookup"><span data-stu-id="70606-183">Significantly reduced performance can result when the rendering system moves a <xref:System.Windows.Interop.D3DImage> to another monitor.</span></span>  
  
 <span data-ttu-id="70606-184">In WDDM, purché i monitoraggi si trovano nello stesso video card e si utilizza `Direct3DCreate9Ex`, non vi è alcuna riduzione delle prestazioni.</span><span class="sxs-lookup"><span data-stu-id="70606-184">On WDDM, as long as the monitors are on the same video card and you use `Direct3DCreate9Ex`, there is no reduction in performance.</span></span> <span data-ttu-id="70606-185">Se i monitoraggi sono sulle schede video separate, le prestazioni sono ridotte.</span><span class="sxs-lookup"><span data-stu-id="70606-185">If the monitors are on separate video cards, performance is reduced.</span></span> <span data-ttu-id="70606-186">In Windows XP, le prestazioni sono sempre ridotte.</span><span class="sxs-lookup"><span data-stu-id="70606-186">On Windows XP, performance is always reduced.</span></span>  
  
 <span data-ttu-id="70606-187">Quando il <xref:System.Windows.Interop.D3DImage> viene spostato in un altro monitor, è possibile creare una nuova superficie nell'adattatore corrispondente per ripristinare le buone prestazioni.</span><span class="sxs-lookup"><span data-stu-id="70606-187">When the <xref:System.Windows.Interop.D3DImage> moves to another monitor, you can create a new surface on the corresponding adapter to restore good performance.</span></span>  
  
 <span data-ttu-id="70606-188">Per evitare la riduzione delle prestazioni, è possibile scrivere codice in modo specifico per il caso di più monitor.</span><span class="sxs-lookup"><span data-stu-id="70606-188">To avoid the performance penalty, write code specifically for the multi-monitor case.</span></span> <span data-ttu-id="70606-189">Nell'elenco seguente viene illustrato un modo per scrivere codice più monitor.</span><span class="sxs-lookup"><span data-stu-id="70606-189">The following list shows one way to write multi-monitor code.</span></span>  
  
1.  <span data-ttu-id="70606-190">Trovare un punto del <xref:System.Windows.Interop.D3DImage> nello spazio dello schermo con il `Visual.ProjectToScreen` metodo.</span><span class="sxs-lookup"><span data-stu-id="70606-190">Find a point of the <xref:System.Windows.Interop.D3DImage> in screen space with the `Visual.ProjectToScreen` method.</span></span>  
  
2.  <span data-ttu-id="70606-191">Utilizzare il `MonitorFromPoint` metodo GDI per trovare il monitoraggio in cui viene visualizzato il punto.</span><span class="sxs-lookup"><span data-stu-id="70606-191">Use the `MonitorFromPoint` GDI method to find the monitor that is displaying the point.</span></span>  
  
3.  <span data-ttu-id="70606-192">Utilizzare il `IDirect3D9::GetAdapterMonitor` metodo per trovare l'adattatore Direct3D9 il monitor si trova.</span><span class="sxs-lookup"><span data-stu-id="70606-192">Use the `IDirect3D9::GetAdapterMonitor` method to find which Direct3D9 adapter the monitor is on.</span></span>  
  
4.  <span data-ttu-id="70606-193">Se l'adapter non corrisponde l'adapter per il buffer nascosto, creare un nuovo buffer nascosto nel nuovo monitor e assegnarlo al <xref:System.Windows.Interop.D3DImage> buffer nascosto.</span><span class="sxs-lookup"><span data-stu-id="70606-193">If the adapter is not the same as the adapter with the back buffer, create a new back buffer on the new monitor and assign it to the <xref:System.Windows.Interop.D3DImage> back buffer.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="70606-194">Se il <xref:System.Windows.Interop.D3DImage> monitor gestisce, le prestazioni saranno lente, salvo nel caso WDDM e `IDirect3D9Ex` sulla stessa scheda.</span><span class="sxs-lookup"><span data-stu-id="70606-194">If the <xref:System.Windows.Interop.D3DImage> straddles monitors, performance will be slow, except in the case of WDDM and `IDirect3D9Ex` on the same adapter.</span></span> <span data-ttu-id="70606-195">Non è possibile migliorare le prestazioni in questa situazione.</span><span class="sxs-lookup"><span data-stu-id="70606-195">There is no way to improve performance in this situation.</span></span>  
  
 <span data-ttu-id="70606-196">Esempio di codice seguente viene illustrato come trovare il monitoraggio corrente.</span><span class="sxs-lookup"><span data-stu-id="70606-196">The following code example shows how to find the current monitor.</span></span>  
  
 [!code-cpp[System.Windows.Interop.D3DImage#RendererManager_SetAdapter](../../../../samples/snippets/cpp/VS_Snippets_Wpf/System.Windows.Interop.D3DImage/cpp/renderermanager.cpp#renderermanager_setadapter)]  
  
 <span data-ttu-id="70606-197">Aggiornare il monitoraggio quando il <xref:System.Windows.Interop.D3DImage> le modifiche apportate a dimensioni o la posizione del contenitore o l'aggiornamento del monitoraggio utilizzando un `DispatcherTimer` che aggiorna più volte al secondo.</span><span class="sxs-lookup"><span data-stu-id="70606-197">Update the monitor when the <xref:System.Windows.Interop.D3DImage> container's size or position changes, or update the monitor by using a `DispatcherTimer` that updates a few times per second.</span></span>  
  
## <a name="wpf-software-rendering"></a><span data-ttu-id="70606-198">Rendering Software WPF</span><span class="sxs-lookup"><span data-stu-id="70606-198">WPF Software Rendering</span></span>  
 <span data-ttu-id="70606-199">WPF esegue il rendering in modo sincrono sul thread dell'interfaccia utente in software nelle situazioni seguenti.</span><span class="sxs-lookup"><span data-stu-id="70606-199">WPF renders synchronously on the UI thread in software in the following situations.</span></span>  
  
-   <span data-ttu-id="70606-200">Stampa</span><span class="sxs-lookup"><span data-stu-id="70606-200">Printing</span></span>  
  
-   <xref:System.Windows.Media.Effects.BitmapEffect>  
  
-   <xref:System.Windows.Media.Imaging.RenderTargetBitmap>  
  
 <span data-ttu-id="70606-201">Quando si verifica una di queste situazioni, il rendering viene chiamato il <xref:System.Windows.Interop.D3DImage.CopyBackBuffer%2A> metodo per copiare il buffer hardware nel software.</span><span class="sxs-lookup"><span data-stu-id="70606-201">When one of these situations occurs, the rendering system calls the <xref:System.Windows.Interop.D3DImage.CopyBackBuffer%2A> method to copy the hardware buffer to software.</span></span> <span data-ttu-id="70606-202">L'implementazione predefinita chiama il `GetRenderTargetData` metodo con la superficie.</span><span class="sxs-lookup"><span data-stu-id="70606-202">The default implementation calls the `GetRenderTargetData` method with your surface.</span></span> <span data-ttu-id="70606-203">Poiché questa chiamata si trova di fuori il criterio di blocco/sblocco, potrebbe non riuscire.</span><span class="sxs-lookup"><span data-stu-id="70606-203">Because this call occurs outside of the Lock/Unlock pattern, it may fail.</span></span> <span data-ttu-id="70606-204">In questo caso, il `CopyBackBuffer` restituisce `null` e viene visualizzata alcuna immagine.</span><span class="sxs-lookup"><span data-stu-id="70606-204">In this case, the `CopyBackBuffer` method returns `null` and no image is displayed.</span></span>  
  
 <span data-ttu-id="70606-205">È possibile eseguire l'override di <xref:System.Windows.Interop.D3DImage.CopyBackBuffer%2A> metodo, chiamare l'implementazione di base, e se viene restituito `null`, è possibile restituire un segnaposto <xref:System.Windows.Media.Imaging.BitmapSource>.</span><span class="sxs-lookup"><span data-stu-id="70606-205">You can override the <xref:System.Windows.Interop.D3DImage.CopyBackBuffer%2A> method, call the base implementation, and if it returns `null`, you can return a placeholder <xref:System.Windows.Media.Imaging.BitmapSource>.</span></span>  
  
 <span data-ttu-id="70606-206">È anche possibile implementare direttamente il rendering software anziché chiamare l'implementazione di base.</span><span class="sxs-lookup"><span data-stu-id="70606-206">You can also implement your own software rendering instead of calling the base implementation.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="70606-207">Se viene eseguito il rendering completamente il software, WPF <xref:System.Windows.Interop.D3DImage> non viene visualizzato perché WPF non dispone di un front buffer.</span><span class="sxs-lookup"><span data-stu-id="70606-207">If WPF is rendering completely in software, <xref:System.Windows.Interop.D3DImage> is not shown because WPF does not have a front buffer.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="70606-208">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="70606-208">See Also</span></span>  
 <xref:System.Windows.Interop.D3DImage>  
 [<span data-ttu-id="70606-209">Considerazioni sulle prestazioni per l'interoperabilità fra Direct3D9 e WPF</span><span class="sxs-lookup"><span data-stu-id="70606-209">Performance Considerations for Direct3D9 and WPF Interoperability</span></span>](../../../../docs/framework/wpf/advanced/performance-considerations-for-direct3d9-and-wpf-interoperability.md)  
 [<span data-ttu-id="70606-210">Procedura dettagliata: Creazione di contenuto Direct3D9 per l'hosting in WPF</span><span class="sxs-lookup"><span data-stu-id="70606-210">Walkthrough: Creating Direct3D9 Content for Hosting in WPF</span></span>](../../../../docs/framework/wpf/advanced/walkthrough-creating-direct3d9-content-for-hosting-in-wpf.md)  
 [<span data-ttu-id="70606-211">Procedura dettagliata: Hosting di contenuto Direct3D9 in WPF</span><span class="sxs-lookup"><span data-stu-id="70606-211">Walkthrough: Hosting Direct3D9 Content in WPF</span></span>](../../../../docs/framework/wpf/advanced/walkthrough-hosting-direct3d9-content-in-wpf.md)
