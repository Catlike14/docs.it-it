---
title: Flussi di lavoro asincroni (F#)
description: "Informazioni sul supporto in F # linguaggio di programmazione per l'esecuzione di calcoli in modo asincrono, che vengono eseguiti senza bloccare l'esecuzione di altre operazioni."
ms.date: 05/16/2016
ms.openlocfilehash: 5f7a1a623e143e1bedf51c1a1ed477bb867b280a
ms.sourcegitcommit: 3d5d33f384eeba41b2dff79d096f47ccc8d8f03d
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 05/04/2018
ms.locfileid: "33566363"
---
# <a name="asynchronous-workflows"></a><span data-ttu-id="6d3ef-103">Flussi di lavoro asincroni</span><span class="sxs-lookup"><span data-stu-id="6d3ef-103">Asynchronous Workflows</span></span>

> [!NOTE]
<span data-ttu-id="6d3ef-104">Il collegamento al riferimento per l'API porta a MSDN.</span><span class="sxs-lookup"><span data-stu-id="6d3ef-104">The API reference link will take you to MSDN.</span></span>  <span data-ttu-id="6d3ef-105">Il riferimento all'API in Microsoft Docs (docs.microsoft.com) non è completo.</span><span class="sxs-lookup"><span data-stu-id="6d3ef-105">The docs.microsoft.com API reference is not complete.</span></span>

<span data-ttu-id="6d3ef-106">In questo argomento viene descritto il supporto in F # per l'esecuzione di calcoli in modo asincrono, ovvero, senza bloccare l'esecuzione di altre operazioni.</span><span class="sxs-lookup"><span data-stu-id="6d3ef-106">This topic describes support in F# for performing computations asynchronously, that is, without blocking execution of other work.</span></span> <span data-ttu-id="6d3ef-107">Ad esempio, i calcoli asincroni consente di scrivere applicazioni che dispongono di interfacce utente che rimangono attive per gli utenti, come l'applicazione viene eseguito altro lavoro.</span><span class="sxs-lookup"><span data-stu-id="6d3ef-107">For example, asynchronous computations can be used to write applications that have UIs that remain responsive to users as the application performs other work.</span></span>

## <a name="syntax"></a><span data-ttu-id="6d3ef-108">Sintassi</span><span class="sxs-lookup"><span data-stu-id="6d3ef-108">Syntax</span></span>

```fsharp
async { expression }
```

## <a name="remarks"></a><span data-ttu-id="6d3ef-109">Note</span><span class="sxs-lookup"><span data-stu-id="6d3ef-109">Remarks</span></span>

<span data-ttu-id="6d3ef-110">Nella sintassi precedente, il calcolo è rappresentato da `expression` è configurato per eseguire in modo asincrono, ovvero senza bloccare il thread corrente di calcolo quando vengono eseguite le operazioni di sospensione asincrona, i/o e altre operazioni asincrone.</span><span class="sxs-lookup"><span data-stu-id="6d3ef-110">In the previous syntax, the computation represented by `expression` is set up to run asynchronously, that is, without blocking the current computation thread when asynchronous sleep operations, I/O, and other asynchronous operations are performed.</span></span> <span data-ttu-id="6d3ef-111">I calcoli asincroni sono spesso avviati su un thread in background mentre l'esecuzione continua sul thread corrente.</span><span class="sxs-lookup"><span data-stu-id="6d3ef-111">Asynchronous computations are often started on a background thread while execution continues on the current thread.</span></span> <span data-ttu-id="6d3ef-112">Il tipo dell'espressione è `Async<'T>`, dove `'T` è il tipo restituito dall'espressione quando il `return` parola chiave viene utilizzata.</span><span class="sxs-lookup"><span data-stu-id="6d3ef-112">The type of the expression is `Async<'T>`, where `'T` is the type returned by the expression when the `return` keyword is used.</span></span> <span data-ttu-id="6d3ef-113">Il codice in un'espressione di questo tipo viene definito un *blocco asincrono*, o *blocco async*.</span><span class="sxs-lookup"><span data-stu-id="6d3ef-113">The code in such an expression is referred to as an *asynchronous block*, or *async block*.</span></span>

<span data-ttu-id="6d3ef-114">Esistono diversi modi di programmazione asincrona e [ `Async` ](https://msdn.microsoft.com/library/03eb4d12-a01a-4565-a077-5e83f17cf6f7) classe fornisce metodi che supportano vari scenari.</span><span class="sxs-lookup"><span data-stu-id="6d3ef-114">There are a variety of ways of programming asynchronously, and the [`Async`](https://msdn.microsoft.com/library/03eb4d12-a01a-4565-a077-5e83f17cf6f7) class provides methods that support several scenarios.</span></span> <span data-ttu-id="6d3ef-115">L'approccio generale consiste nel creare `Async` gli oggetti che rappresentano il calcolo o i calcoli che si desidera eseguire in modo asincrono e quindi avviare questi calcoli utilizzando una delle funzioni di attivazione.</span><span class="sxs-lookup"><span data-stu-id="6d3ef-115">The general approach is to create `Async` objects that represent the computation or computations that you want to run asynchronously, and then start these computations by using one of the triggering functions.</span></span> <span data-ttu-id="6d3ef-116">Le varie funzioni di attivazione forniscono diverse modalità di esecuzione di calcoli asincroni e il metodo scelto varia a seconda se si desidera utilizzare un oggetto di attività di .NET Framework, il thread corrente o un thread in background e la presenza di continuazione funzioni che deve essere eseguito quando il calcolo venga completato.</span><span class="sxs-lookup"><span data-stu-id="6d3ef-116">The various triggering functions provide different ways of running asynchronous computations, and which one you use depends on whether you want to use the current thread, a background thread, or a .NET Framework task object, and whether there are continuation functions that should run when the computation finishes.</span></span> <span data-ttu-id="6d3ef-117">Per avviare un calcolo asincrono sul thread corrente, ad esempio, è possibile utilizzare [ `Async.StartImmediate` ](https://msdn.microsoft.com/library/2f71d1cc-187f-48cf-ac66-e7fda41c46e3).</span><span class="sxs-lookup"><span data-stu-id="6d3ef-117">For example, to start an asynchronous computation on the current thread, you can use [`Async.StartImmediate`](https://msdn.microsoft.com/library/2f71d1cc-187f-48cf-ac66-e7fda41c46e3).</span></span> <span data-ttu-id="6d3ef-118">Quando si avvia un calcolo asincrono dal thread dell'interfaccia utente, il ciclo sugli eventi che elabora le azioni utente, ad esempio le sequenze di tasti e attività del mouse, in modo che rimanga reattiva l'applicazione non si blocca.</span><span class="sxs-lookup"><span data-stu-id="6d3ef-118">When you start an asynchronous computation from the UI thread, you do not block the main event loop that processes user actions such as keystrokes and mouse activity, so your application remains responsive.</span></span>

## <a name="asynchronous-binding-by-using-let"></a><span data-ttu-id="6d3ef-119">Associazione asincrona utilizzando let!</span><span class="sxs-lookup"><span data-stu-id="6d3ef-119">Asynchronous Binding by Using let!</span></span>

<span data-ttu-id="6d3ef-120">In un flusso di lavoro asincrono alcune espressioni e le operazioni sono sincrone e alcuni sono più calcoli che sono progettati per restituire un risultato in modo asincrono.</span><span class="sxs-lookup"><span data-stu-id="6d3ef-120">In an asynchronous workflow, some expressions and operations are synchronous, and some are longer computations that are designed to return a result asynchronously.</span></span> <span data-ttu-id="6d3ef-121">Quando si chiama un metodo in modo asincrono, invece di un normale `let` l'associazione, utilizzare `let!`.</span><span class="sxs-lookup"><span data-stu-id="6d3ef-121">When you call a method asynchronously, instead of an ordinary `let` binding, you use `let!`.</span></span> <span data-ttu-id="6d3ef-122">L'effetto di `let!` consiste nell'abilitare l'esecuzione di continuare in altri calcoli o thread durante l'esecuzione di calcolo.</span><span class="sxs-lookup"><span data-stu-id="6d3ef-122">The effect of `let!` is to enable execution to continue on other computations or threads as the computation is being performed.</span></span> <span data-ttu-id="6d3ef-123">Dopo la parte destra di `let!` associazione restituisce il resto del flusso di lavoro asincrono riprende l'esecuzione.</span><span class="sxs-lookup"><span data-stu-id="6d3ef-123">After the right side of the `let!` binding returns, the rest of the asynchronous workflow resumes execution.</span></span>

<span data-ttu-id="6d3ef-124">Il codice seguente mostra la differenza tra `let` e `let!`.</span><span class="sxs-lookup"><span data-stu-id="6d3ef-124">The following code shows the difference between `let` and `let!`.</span></span> <span data-ttu-id="6d3ef-125">La riga di codice che usa `let` crea solo un calcolo asincrono come un oggetto che è possibile eseguire in un secondo momento utilizzando, ad esempio, `Async.StartImmediate` o [ `Async.RunSynchronously` ](https://msdn.microsoft.com/library/0a6663a9-50f2-4d38-8bf3-cefd1a51fd6b).</span><span class="sxs-lookup"><span data-stu-id="6d3ef-125">The line of code that uses `let` just creates an asynchronous computation as an object that you can run later by using, for example, `Async.StartImmediate` or [`Async.RunSynchronously`](https://msdn.microsoft.com/library/0a6663a9-50f2-4d38-8bf3-cefd1a51fd6b).</span></span> <span data-ttu-id="6d3ef-126">La riga di codice che utilizza `let!` avvia il calcolo e quindi il thread viene sospesa fino a quando il risultato è disponibile, in quale punto di esecuzione continua.</span><span class="sxs-lookup"><span data-stu-id="6d3ef-126">The line of code that uses `let!` starts the computation, and then the thread is suspended until the result is available, at which point execution continues.</span></span>

```fsharp
// let just stores the result as an asynchronous operation.
let (result1 : Async<byte[]>) = stream.AsyncRead(bufferSize)
// let! completes the asynchronous operation and returns the data.
let! (result2 : byte[])  = stream.AsyncRead(bufferSize)
```

<span data-ttu-id="6d3ef-127">Oltre a `let!`, è possibile utilizzare `use!` per eseguire associazioni asincrone.</span><span class="sxs-lookup"><span data-stu-id="6d3ef-127">In addition to `let!`, you can use `use!` to perform asynchronous bindings.</span></span> <span data-ttu-id="6d3ef-128">La differenza tra `let!` e `use!` è analoga a quella tra `let` e `use`.</span><span class="sxs-lookup"><span data-stu-id="6d3ef-128">The difference between `let!` and `use!` is the same as the difference between `let` and `use`.</span></span> <span data-ttu-id="6d3ef-129">Per `use!`, l'oggetto viene eliminato alla chiusura dell'ambito corrente.</span><span class="sxs-lookup"><span data-stu-id="6d3ef-129">For `use!`, the object is disposed of at the close of the current scope.</span></span> <span data-ttu-id="6d3ef-130">Si noti che nella versione corrente del linguaggio F #, `use!` non consentono di essere inizializzato su null, anche se un valore `use` does.</span><span class="sxs-lookup"><span data-stu-id="6d3ef-130">Note that in the current release of the F# language, `use!` does not allow a value to be initialized to null, even though `use` does.</span></span>

## <a name="asynchronous-primitives"></a><span data-ttu-id="6d3ef-131">Primitivi asincroni</span><span class="sxs-lookup"><span data-stu-id="6d3ef-131">Asynchronous Primitives</span></span>

<span data-ttu-id="6d3ef-132">Viene chiamato un metodo che esegue una sola attività asincrona e restituisce il risultato un *primitivo asincrono*, e questi sono progettati appositamente per l'utilizzo con `let!`.</span><span class="sxs-lookup"><span data-stu-id="6d3ef-132">A method that performs a single asynchronous task and returns the result is called an *asynchronous primitive*, and these are designed specifically for use with `let!`.</span></span> <span data-ttu-id="6d3ef-133">Diversi primitivi asincroni sono definiti nella libreria di base F #.</span><span class="sxs-lookup"><span data-stu-id="6d3ef-133">Several asynchronous primitives are defined in the F# core library.</span></span> <span data-ttu-id="6d3ef-134">Due diversi metodi per le applicazioni Web sono definiti nel modulo [ `Microsoft.FSharp.Control.WebExtensions` ](https://msdn.microsoft.com/library/95ef17bc-ee3f-44ba-8a11-c90fcf4cf003): [ `WebRequest.AsyncGetResponse` ](https://msdn.microsoft.com/library/09a60c31-e6e2-4b5c-ad23-92a86e50060c) e [ `WebClient.AsyncDownloadString` ](https://msdn.microsoft.com/library/8a85a9b7-f712-4cac-a0ce-0a797f8ea32a).</span><span class="sxs-lookup"><span data-stu-id="6d3ef-134">Two such methods for Web applications are defined in the module [`Microsoft.FSharp.Control.WebExtensions`](https://msdn.microsoft.com/library/95ef17bc-ee3f-44ba-8a11-c90fcf4cf003): [`WebRequest.AsyncGetResponse`](https://msdn.microsoft.com/library/09a60c31-e6e2-4b5c-ad23-92a86e50060c) and [`WebClient.AsyncDownloadString`](https://msdn.microsoft.com/library/8a85a9b7-f712-4cac-a0ce-0a797f8ea32a).</span></span> <span data-ttu-id="6d3ef-135">Entrambe le primitive di scaricano i dati da una pagina Web, data un URL.</span><span class="sxs-lookup"><span data-stu-id="6d3ef-135">Both primitives download data from a Web page, given a URL.</span></span> <span data-ttu-id="6d3ef-136">`AsyncGetResponse` produce un `System.Net.WebResponse` oggetto, e `AsyncDownloadString` produce una stringa che rappresenta il codice HTML per una pagina Web.</span><span class="sxs-lookup"><span data-stu-id="6d3ef-136">`AsyncGetResponse` produces a `System.Net.WebResponse` object, and `AsyncDownloadString` produces a string that represents the HTML for a Web page.</span></span>

<span data-ttu-id="6d3ef-137">Sono inclusi diversi primitivi per le operazioni dei / o asincrona nel [ `Microsoft.FSharp.Control.CommonExtensions` ](https://msdn.microsoft.com/library/2edb67cb-6814-4a30-849f-b6dbdd042396) modulo.</span><span class="sxs-lookup"><span data-stu-id="6d3ef-137">Several primitives for asynchronous I/O operations are included in the [`Microsoft.FSharp.Control.CommonExtensions`](https://msdn.microsoft.com/library/2edb67cb-6814-4a30-849f-b6dbdd042396) module.</span></span> <span data-ttu-id="6d3ef-138">Questi metodi di estensione del `System.IO.Stream` classe [ `Stream.AsyncRead` ](https://msdn.microsoft.com/library/85698aaa-bdda-47e6-abed-3730f59fda5e) e [ `Stream.AsyncWrite` ](https://msdn.microsoft.com/library/1b0a2751-e42a-47e1-bd27-020224adc618).</span><span class="sxs-lookup"><span data-stu-id="6d3ef-138">These extension methods of the `System.IO.Stream` class are [`Stream.AsyncRead`](https://msdn.microsoft.com/library/85698aaa-bdda-47e6-abed-3730f59fda5e) and [`Stream.AsyncWrite`](https://msdn.microsoft.com/library/1b0a2751-e42a-47e1-bd27-020224adc618).</span></span>

<span data-ttu-id="6d3ef-139">Ulteriori primitivi asincroni sono disponibili nel [F # PowerTools](https://fsprojects.github.io/VisualFSharpPowerTools/).</span><span class="sxs-lookup"><span data-stu-id="6d3ef-139">Additional asynchronous primitives are available in the [F# PowerTools](https://fsprojects.github.io/VisualFSharpPowerTools/).</span></span> <span data-ttu-id="6d3ef-140">È anche possibile scrivere primitivi asincroni personalizzati definendo una funzione il cui corpo completo è incluso in un blocco asincrono.</span><span class="sxs-lookup"><span data-stu-id="6d3ef-140">You can also write your own asynchronous primitives by defining a function whose complete body is enclosed in an async block.</span></span>

<span data-ttu-id="6d3ef-141">Per utilizzare metodi asincroni in .NET Framework che sono progettati per altri modelli asincroni con F # modello di programmazione asincrono, si crea una funzione che restituisce un F # `Async` oggetto.</span><span class="sxs-lookup"><span data-stu-id="6d3ef-141">To use asynchronous methods in the .NET Framework that are designed for other asynchronous models with the F# asynchronous programming model, you create a function that returns an F# `Async` object.</span></span> <span data-ttu-id="6d3ef-142">La libreria F # include funzioni che rendono questa semplice.</span><span class="sxs-lookup"><span data-stu-id="6d3ef-142">The F# library has functions that make this easy to do.</span></span>

<span data-ttu-id="6d3ef-143">Un esempio di utilizzo di flussi di lavoro asincroni è incluso in questo contesto. Esistono molti altri nella documentazione per i metodi del [classe Async](https://msdn.microsoft.com/library/03eb4d12-a01a-4565-a077-5e83f17cf6f7).</span><span class="sxs-lookup"><span data-stu-id="6d3ef-143">One example of using asynchronous workflows is included here; there are many others in the documentation for the methods of the [Async class](https://msdn.microsoft.com/library/03eb4d12-a01a-4565-a077-5e83f17cf6f7).</span></span>

<span data-ttu-id="6d3ef-144">In questo esempio viene illustrato come utilizzare i flussi di lavoro asincroni per eseguire calcoli in parallelo.</span><span class="sxs-lookup"><span data-stu-id="6d3ef-144">This example shows how to use asynchronous workflows to perform computations in parallel.</span></span>

<span data-ttu-id="6d3ef-145">Nell'esempio di codice seguente, una funzione `fetchAsync` Ottiene il testo HTML restituito da una richiesta Web.</span><span class="sxs-lookup"><span data-stu-id="6d3ef-145">In the following code example, a function `fetchAsync` gets the HTML text returned from a Web request.</span></span> <span data-ttu-id="6d3ef-146">Il `fetchAsync` funzione contiene un blocco di codice asincrono.</span><span class="sxs-lookup"><span data-stu-id="6d3ef-146">The `fetchAsync` function contains an asynchronous block of code.</span></span> <span data-ttu-id="6d3ef-147">Quando viene eseguita un'associazione al risultato di una primitiva asincrona, in questo caso [ `AsyncDownloadString` ](https://msdn.microsoft.com/library/8a85a9b7-f712-4cac-a0ce-0a797f8ea32a), let!</span><span class="sxs-lookup"><span data-stu-id="6d3ef-147">When a binding is made to the result of an asynchronous primitive, in this case [`AsyncDownloadString`](https://msdn.microsoft.com/library/8a85a9b7-f712-4cac-a0ce-0a797f8ea32a), let!</span></span> <span data-ttu-id="6d3ef-148">viene utilizzata invece consentono.</span><span class="sxs-lookup"><span data-stu-id="6d3ef-148">is used instead of let.</span></span>

<span data-ttu-id="6d3ef-149">Utilizzare la funzione [ `Async.RunSynchronously` ](https://msdn.microsoft.com/library/0a6663a9-50f2-4d38-8bf3-cefd1a51fd6b) per eseguire un'operazione asincrona e attendere il risultato.</span><span class="sxs-lookup"><span data-stu-id="6d3ef-149">You use the function [`Async.RunSynchronously`](https://msdn.microsoft.com/library/0a6663a9-50f2-4d38-8bf3-cefd1a51fd6b) to execute an asynchronous operation and wait for its result.</span></span> <span data-ttu-id="6d3ef-150">Ad esempio, è possibile eseguire più operazioni asincrone in parallelo tramite il [ `Async.Parallel` ](https://msdn.microsoft.com/library/aa9b0355-2d55-4858-b943-cbe428de9dc4) funzione con il `Async.RunSynchronously` (funzione).</span><span class="sxs-lookup"><span data-stu-id="6d3ef-150">As an example, you can execute multiple asynchronous operations in parallel by using the [`Async.Parallel`](https://msdn.microsoft.com/library/aa9b0355-2d55-4858-b943-cbe428de9dc4) function together with the `Async.RunSynchronously` function.</span></span> <span data-ttu-id="6d3ef-151">Il `Async.Parallel` funzione accetta un elenco di `Async` gli oggetti, imposta il codice per ogni `Async` oggetto attività per l'esecuzione in parallelo e restituisce un `Async` oggetto che rappresenta il calcolo parallelo.</span><span class="sxs-lookup"><span data-stu-id="6d3ef-151">The `Async.Parallel` function takes a list of the `Async` objects, sets up the code for each `Async` task object to run in parallel, and returns an `Async` object that represents the parallel computation.</span></span> <span data-ttu-id="6d3ef-152">Come per una singola operazione, si chiama `Async.RunSynchronously` per avviare l'esecuzione.</span><span class="sxs-lookup"><span data-stu-id="6d3ef-152">Just as for a single operation, you call `Async.RunSynchronously` to start the execution.</span></span>

<span data-ttu-id="6d3ef-153">Il `runAll` funzione avvia tre flussi di lavoro asincroni in parallelo e attende il completamento.</span><span class="sxs-lookup"><span data-stu-id="6d3ef-153">The `runAll` function launches three asynchronous workflows in parallel and waits until they have all completed.</span></span>

[!code-fsharp[Main](../../../samples/snippets/fsharp/lang-ref-2/snippet8003.fs)]

## <a name="see-also"></a><span data-ttu-id="6d3ef-154">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="6d3ef-154">See Also</span></span>

[<span data-ttu-id="6d3ef-155">Riferimenti per il linguaggio F#</span><span class="sxs-lookup"><span data-stu-id="6d3ef-155">F# Language Reference</span></span>](index.md)

[<span data-ttu-id="6d3ef-156">Espressioni di calcolo</span><span class="sxs-lookup"><span data-stu-id="6d3ef-156">Computation Expressions</span></span>](computation-expressions.md)

[<span data-ttu-id="6d3ef-157">Classe Control. Async</span><span class="sxs-lookup"><span data-stu-id="6d3ef-157">Control.Async Class</span></span>](https://msdn.microsoft.com/visualfsharpdocs/conceptual/control.async-class-%5bfsharp%5d)
