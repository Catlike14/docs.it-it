---
title: Distribuzione di applicazioni Web .NET Core basate su singolo contenitore in host di Linux o Windows Nano Server
description: Architettura di microservizi .NET per le applicazioni .NET incluse in contenitori | Distribuzione di applicazioni Web .NET Core basate su singolo contenitore in host di Linux o Windows Nano Server
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 06/27/2018
ms.openlocfilehash: 45be99a86a52ed450b795ca5f91c01ab82c7da47
ms.sourcegitcommit: 3c1c3ba79895335ff3737934e39372555ca7d6d0
ms.translationtype: HT
ms.contentlocale: it-IT
ms.lasthandoff: 09/05/2018
ms.locfileid: "43778003"
---
# <a name="deploying-single-container-based-net-core-web-applications-on-linux-or-windows-nano-server-hosts"></a><span data-ttu-id="2bb80-103">Distribuzione di applicazioni Web .NET Core basate su singolo contenitore in host di Linux o Windows Nano Server</span><span class="sxs-lookup"><span data-stu-id="2bb80-103">Deploying Single-Container-Based .NET Core Web Applications on Linux or Windows Nano Server Hosts</span></span>

<span data-ttu-id="2bb80-104">_È possibile usare i contenitori Docker per la distribuzione monolitica delle applicazioni Web più semplici. Ciò migliora le pipeline di integrazione continua e distribuzione continua e consente di ottenere risultati ottimali dalla distribuzione alla produzione, evitando situazioni in cui quello che funziona in un singolo computer non funziona più nell'ambiente di produzione._</span><span class="sxs-lookup"><span data-stu-id="2bb80-104">_You can use Docker containers for monolithic deployment of simpler web applications. This improves continuous integration and continuous deployment pipelines and helps achieve deployment-to-production success. No more “It works in my machine, why does it not work in production?”_</span></span>

<span data-ttu-id="2bb80-105">Un'architettura basata su microservizi offre numerosi vantaggi, ma al costo di una maggiore complessità.</span><span class="sxs-lookup"><span data-stu-id="2bb80-105">A microservices-based architecture has many benefits, but those benefits come at a cost of increased complexity.</span></span> <span data-ttu-id="2bb80-106">In alcuni casi i costi superano i vantaggi e un'applicazione con distribuzione monolitica in esecuzione in un unico contenitore o in pochi contenitori rappresenta un'opzione migliore.</span><span class="sxs-lookup"><span data-stu-id="2bb80-106">In some cases, the costs outweigh the benefits and a monolithic deployment application running in one or a few containers is a better option.</span></span>

<span data-ttu-id="2bb80-107">Un'applicazione monolitica potrebbe non essere facilmente scomponibile in microservizi ben distinti.</span><span class="sxs-lookup"><span data-stu-id="2bb80-107">A monolithic application might not be easily decomposable into well-separated microservices.</span></span> <span data-ttu-id="2bb80-108">Si è appreso che questi microservizi devono essere partizionati in base alla funzione e dovrebbero funzionare indipendentemente uno dall'altro per garantire un'applicazione più resiliente.</span><span class="sxs-lookup"><span data-stu-id="2bb80-108">You've learned that these microservices should be partitioned by function: they should work independently of each other to provide a more resilient application.</span></span> <span data-ttu-id="2bb80-109">Se non è possibile fornire sezioni di funzionalità per l'applicazione, una separazione aggiunge solo complessità.</span><span class="sxs-lookup"><span data-stu-id="2bb80-109">If you can't deliver feature slices of the application, separating it only adds complexity.</span></span>

<span data-ttu-id="2bb80-110">Per un'applicazione potrebbe non essere necessaria la scalabilità delle funzionalità in modo indipendente.</span><span class="sxs-lookup"><span data-stu-id="2bb80-110">An application might not yet need to scale features independently.</span></span> <span data-ttu-id="2bb80-111">Si supponga che nelle prime fasi del ciclo di vita dell'applicazione di riferimento `eShopOnContainers` il traffico non abbia giustificato la separazione delle funzionalità in microservizi diversi.</span><span class="sxs-lookup"><span data-stu-id="2bb80-111">Let’s suppose that in the early stages of the `eShopOnContainers` reference application, the traffic didn't justify separating features into different microservices.</span></span> <span data-ttu-id="2bb80-112">Il traffico è sufficientemente ridotto cosicché aggiungere risorse a un servizio significa aggiungere risorse a tutti i servizi.</span><span class="sxs-lookup"><span data-stu-id="2bb80-112">Traffic was small enough that adding resources to one service typically meant adding resources to all services.</span></span> <span data-ttu-id="2bb80-113">Il lavoro aggiuntivo richiesto per separare l'applicazione in servizi distinti implica un vantaggio minimo.</span><span class="sxs-lookup"><span data-stu-id="2bb80-113">The additional work to separate the application into discrete services provided minimal benefit.</span></span>

<span data-ttu-id="2bb80-114">Inoltre, nelle prime fasi di sviluppo di un'applicazione i limiti funzionali naturali potrebbero non essere ancora chiari.</span><span class="sxs-lookup"><span data-stu-id="2bb80-114">Also, early in the development of an application you might not have a clear idea where the natural functional boundaries are.</span></span> <span data-ttu-id="2bb80-115">Durante lo sviluppo di un prodotto valido minimo, la separazione naturale potrebbe non essere ancora emersa.</span><span class="sxs-lookup"><span data-stu-id="2bb80-115">As you develop a minimum viable product, the natural separation might not yet have emerged.</span></span>

<span data-ttu-id="2bb80-116">Alcune di queste condizioni potrebbero essere temporanee.</span><span class="sxs-lookup"><span data-stu-id="2bb80-116">Some of these conditions might be temporary.</span></span> <span data-ttu-id="2bb80-117">Si potrebbe iniziare creando un'applicazione monolitica e successivamente separare alcune funzionalità da sviluppare e distribuire come microservizi.</span><span class="sxs-lookup"><span data-stu-id="2bb80-117">You might start by creating a monolithic application, and later separate some features to be developed and deployed as microservices.</span></span> <span data-ttu-id="2bb80-118">Altre condizioni potrebbero essere essenziali per i problemi dell'applicazione, vale a dire che l'applicazione potrebbe non essere mai suddivisa in più microservizi.</span><span class="sxs-lookup"><span data-stu-id="2bb80-118">Other conditions might be essential to the application’s problem space, meaning that the application might never be broken into multiple microservices.</span></span>

<span data-ttu-id="2bb80-119">La separazione di un'applicazione in più processi distinti presenta anche il problema del sovraccarico.</span><span class="sxs-lookup"><span data-stu-id="2bb80-119">Separating an application into many discrete processes also introduces overhead.</span></span> <span data-ttu-id="2bb80-120">La separazione delle funzionalità in processi diversi aumenta la complessità.</span><span class="sxs-lookup"><span data-stu-id="2bb80-120">There's more complexity in separating features into different processes.</span></span> <span data-ttu-id="2bb80-121">I protocolli di comunicazione diventano più complessi.</span><span class="sxs-lookup"><span data-stu-id="2bb80-121">The communication protocols become more complex.</span></span> <span data-ttu-id="2bb80-122">Invece delle chiamate ai metodi, è necessario usare comunicazioni asincrone tra i servizi.</span><span class="sxs-lookup"><span data-stu-id="2bb80-122">Instead of method calls, you must use asynchronous communications between services.</span></span> <span data-ttu-id="2bb80-123">Quando si passa a un'architettura di microservizi, è necessario aggiungere molti dei blocchi predefiniti implementati nella versione dei microservizi dell'applicazione `eShopOnContainers`: gestione del bus di eventi, resilienza dei messaggi e nuovi tentativi, coerenza futura e altro ancora.</span><span class="sxs-lookup"><span data-stu-id="2bb80-123">As you move to a microservices architecture, you need to add many of the building blocks implemented in the microservices version of the `eShopOnContainers` application: event bus handling, message resiliency and retries, eventual consistency, and more.</span></span>

<span data-ttu-id="2bb80-124">Una versione molto semplificata di eShopOnContainers (denominata [eShopWeb](https://github.com/dotnet-architecture/eShopOnContainers/tree/master/src/Web/WebMonolithic) e inclusa nello stesso repository GitHub) viene eseguita come applicazione MVC monolitica.</span><span class="sxs-lookup"><span data-stu-id="2bb80-124">A much-simplified version of eShopOnContainers (named [eShopWeb](https://github.com/dotnet-architecture/eShopOnContainers/tree/master/src/Web/WebMonolithic) and included in the same GitHub repository) runs as a monolithic MVC application.</span></span> <span data-ttu-id="2bb80-125">Come descritto, questa scelta di progettazione offre alcuni vantaggi.</span><span class="sxs-lookup"><span data-stu-id="2bb80-125">As described, there are advantages offered by that design choice.</span></span> <span data-ttu-id="2bb80-126">È possibile scaricare l'origine per questa applicazione da GitHub ed eseguirla in locale.</span><span class="sxs-lookup"><span data-stu-id="2bb80-126">You can download the source for this application from GitHub and run it locally.</span></span> <span data-ttu-id="2bb80-127">Anche questa applicazione monolitica trae vantaggio dalla distribuzione in un ambiente basato su contenitori.</span><span class="sxs-lookup"><span data-stu-id="2bb80-127">Even this monolithic application benefits from being deployed in a container environment.</span></span>

<span data-ttu-id="2bb80-128">Da una parte, la distribuzione in contenitori significa che ogni istanza dell'applicazione è eseguita nello stesso ambiente.</span><span class="sxs-lookup"><span data-stu-id="2bb80-128">For one, the containerized deployment means that every instance of the application runs in the same environment.</span></span> <span data-ttu-id="2bb80-129">Ciò include l'ambiente di sviluppo in cui hanno luogo le fasi di test preliminare e di sviluppo.</span><span class="sxs-lookup"><span data-stu-id="2bb80-129">This includes the developer environment where early testing and development take place.</span></span> <span data-ttu-id="2bb80-130">Il team di sviluppo può eseguire l'applicazione in un ambiente basato su contenitori corrispondente all'ambiente di produzione.</span><span class="sxs-lookup"><span data-stu-id="2bb80-130">The development team can run the application in a containerized environment that matches the production environment.</span></span>

<span data-ttu-id="2bb80-131">Inoltre, la scalabilità orizzontale delle applicazioni incluse in contenitori è garantita a costi inferiori.</span><span class="sxs-lookup"><span data-stu-id="2bb80-131">Also, containerized applications scale out at lower cost.</span></span> <span data-ttu-id="2bb80-132">Come illustrato in precedenza, un ambiente basato su contenitori consente una maggiore condivisione di risorse rispetto agli ambienti di macchine virtuali tradizionali.</span><span class="sxs-lookup"><span data-stu-id="2bb80-132">As you saw earlier, the container environment enables greater resource sharing than traditional VM environments.</span></span>

<span data-ttu-id="2bb80-133">Infine, l'inserimento dell'applicazione in contenitori impone una separazione tra la logica di business e il server di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="2bb80-133">Finally, containerizing the application forces a separation between the business logic and the storage server.</span></span> <span data-ttu-id="2bb80-134">Di pari passo con la scalabilità orizzontale dell'applicazione, i vari contenitori si baseranno tutti su un singolo supporto di archiviazione fisica,</span><span class="sxs-lookup"><span data-stu-id="2bb80-134">As the application scales out, the various containers will all rely on a single physical storage medium.</span></span> <span data-ttu-id="2bb80-135">che sarà in genere un server a disponibilità elevata che esegue un database di SQL Server.</span><span class="sxs-lookup"><span data-stu-id="2bb80-135">This storage would typically be a high-availability server running a SQL Server database.</span></span>

## <a name="application-tour"></a><span data-ttu-id="2bb80-136">Presentazione dell'applicazione</span><span class="sxs-lookup"><span data-stu-id="2bb80-136">Application tour</span></span>

<span data-ttu-id="2bb80-137">L'applicazione [eShopWeb](https://github.com/dotnet-architecture/eShopOnContainers/tree/master/src/Web/WebMonolithic) rappresenta una parte dell'applicazione eShopOnContainers in esecuzione come applicazione monolitica, ovvero un'applicazione ASP.NET Core MVC in esecuzione in .NET Core.</span><span class="sxs-lookup"><span data-stu-id="2bb80-137">The [eShopWeb](https://github.com/dotnet-architecture/eShopOnContainers/tree/master/src/Web/WebMonolithic) application represents some of the eShopOnContainers application running as a monolithic application — an ASP.NET Core MVC-based application running on .NET Core.</span></span> <span data-ttu-id="2bb80-138">Fornisce principalmente le funzionalità di esplorazione del catalogo descritte nelle sezioni precedenti.</span><span class="sxs-lookup"><span data-stu-id="2bb80-138">It mainly provides the catalog browsing capabilities as described in earlier sections.</span></span>

<span data-ttu-id="2bb80-139">L'applicazione usa un database di SQL Server per l'archiviazione del catalogo.</span><span class="sxs-lookup"><span data-stu-id="2bb80-139">The application uses a SQL Server database for the catalog storage.</span></span> <span data-ttu-id="2bb80-140">Nelle distribuzioni basate su contenitori questa applicazione monolitica può accedere allo stesso archivio dati dell'applicazione basata su microservizi.</span><span class="sxs-lookup"><span data-stu-id="2bb80-140">In container-based deployments, this monolithic application can access the same data store as the microservices-based application.</span></span> <span data-ttu-id="2bb80-141">L'applicazione è configurata per l'esecuzione di SQL Server in un contenitore insieme all'applicazione monolitica.</span><span class="sxs-lookup"><span data-stu-id="2bb80-141">The application is configured to run SQL Server in a container alongside the monolithic application.</span></span> <span data-ttu-id="2bb80-142">In un ambiente di produzione SQL Server sarebbe eseguito in un computer a disponibilità elevata, all'esterno dell'host Docker.</span><span class="sxs-lookup"><span data-stu-id="2bb80-142">In a production environment, SQL Server would run on a high-availability machine, outside of the Docker host.</span></span> <span data-ttu-id="2bb80-143">Per praticità, in un ambiente di sviluppo o di test è consigliabile eseguire SQL Server nel relativo contenitore.</span><span class="sxs-lookup"><span data-stu-id="2bb80-143">For convenience, in a development or test environment, running SQL Server in its own container is recommended.</span></span>

<span data-ttu-id="2bb80-144">Il set di funzionalità iniziale consente solo l'esplorazione del catalogo.</span><span class="sxs-lookup"><span data-stu-id="2bb80-144">The initial feature set only enables browsing the catalog.</span></span> <span data-ttu-id="2bb80-145">Gli aggiornamenti garantiscono il set di funzionalità completo dell'applicazione inserita nel contenitore.</span><span class="sxs-lookup"><span data-stu-id="2bb80-145">Updates would enable the full feature set of the containerized application.</span></span> <span data-ttu-id="2bb80-146">Un'architettura di applicazioni Web monolitiche più avanzata è descritta nell'e-book [ASP.NET Web Application architecture practices](https://aka.ms/webappebook) (Pratiche relative all'architettura dell'applicazione Web ASP.NET) e nella pagina dell'[applicazione di esempio eShopOnWeb](https://aka.ms/WebAppArchitecture) correlata.</span><span class="sxs-lookup"><span data-stu-id="2bb80-146">A more advanced monolithic web application architecture is described in the [ASP.NET Web Application architecture practices](https://aka.ms/webappebook) e-book and related [eShopOnWeb sample application](https://aka.ms/WebAppArchitecture).</span></span>

## <a name="docker-support"></a><span data-ttu-id="2bb80-147">Supporto per Docker</span><span class="sxs-lookup"><span data-stu-id="2bb80-147">Docker support</span></span>

<span data-ttu-id="2bb80-148">Il progetto eShopOnWeb viene eseguito in .NET Core.</span><span class="sxs-lookup"><span data-stu-id="2bb80-148">The eShopOnWeb project runs on .NET Core.</span></span> <span data-ttu-id="2bb80-149">Può essere eseguito sia in contenitori basati su Linux che in contenitori basati su Windows.</span><span class="sxs-lookup"><span data-stu-id="2bb80-149">That means it can run in either Linux-based or Windows-based containers.</span></span> <span data-ttu-id="2bb80-150">Si noti che per la distribuzione di Docker viene usato lo stesso tipo di host per SQL Server.</span><span class="sxs-lookup"><span data-stu-id="2bb80-150">Note that for Docker deployment, you want to use the same host type for SQL Server.</span></span> <span data-ttu-id="2bb80-151">I contenitori basati su Linux consentono un footprint minore e sono preferibili.</span><span class="sxs-lookup"><span data-stu-id="2bb80-151">Linux-based containers allow a smaller footprint and are preferred.</span></span>

<span data-ttu-id="2bb80-152">Visual Studio offre un modello di progetto che aggiunge il supporto per Docker a una soluzione.</span><span class="sxs-lookup"><span data-stu-id="2bb80-152">Visual Studio provides a project template that adds support for Docker to a solution.</span></span> <span data-ttu-id="2bb80-153">Fare clic con il pulsante destro del mouse sul progetto, fare clic su **Aggiungi** e quindi su **Supporto Docker**.</span><span class="sxs-lookup"><span data-stu-id="2bb80-153">You right-click the project, click **Add** followed by **Docker Support**.</span></span> <span data-ttu-id="2bb80-154">Il modello aggiunge un file Docker al progetto e un nuovo progetto **docker-compose** che fornisce un file *docker-compose.yml* di avvio.</span><span class="sxs-lookup"><span data-stu-id="2bb80-154">The template adds a Dockerfile to your project, and a new **docker-compose** project that provides a starter *docker-compose.yml* file.</span></span> <span data-ttu-id="2bb80-155">Questo passaggio è già stato eseguito nel progetto eShopOnWeb scaricato da GitHub.</span><span class="sxs-lookup"><span data-stu-id="2bb80-155">This step has already been done in the eShopOnWeb project downloaded from GitHub.</span></span> <span data-ttu-id="2bb80-156">Si noterà che la soluzione contiene il progetto **eShopOnWeb** e il progetto **docker-compose**, come mostrato nella figura 6-1.</span><span class="sxs-lookup"><span data-stu-id="2bb80-156">You can see that the solution contains the **eShopOnWeb** project and the **docker-compose** project as shown in Figure 6-1.</span></span>

![](./media/image1.png)

<span data-ttu-id="2bb80-157">**Figura 6-1**.</span><span class="sxs-lookup"><span data-stu-id="2bb80-157">**Figure 6-1**.</span></span> <span data-ttu-id="2bb80-158">Progetto **docker-compose** in un'applicazione Web a un solo contenitore</span><span class="sxs-lookup"><span data-stu-id="2bb80-158">The **docker-compose** project in a single-container web application</span></span>

<span data-ttu-id="2bb80-159">Questi file sono file docker-compose standard, coerenti con qualsiasi progetto Docker.</span><span class="sxs-lookup"><span data-stu-id="2bb80-159">These files are standard docker-compose files, consistent with any Docker project.</span></span> <span data-ttu-id="2bb80-160">Possono essere usati con Visual Studio o dalla riga di comando.</span><span class="sxs-lookup"><span data-stu-id="2bb80-160">You can use them with Visual Studio or from the command line.</span></span> <span data-ttu-id="2bb80-161">Questa applicazione viene eseguita in .NET Core e usa contenitori Linux.</span><span class="sxs-lookup"><span data-stu-id="2bb80-161">This application runs on .NET Core and uses Linux containers.</span></span> <span data-ttu-id="2bb80-162">Pertanto, è anche possibile codificarla, compilarla ed eseguirla in un computer Mac o Linux.</span><span class="sxs-lookup"><span data-stu-id="2bb80-162">So, you can also code, build, and run it on a Mac or on a Linux machine.</span></span>

<span data-ttu-id="2bb80-163">Il file *docker-compose.yml* contiene informazioni sulle immagini da compilare e i contenitori da avviare.</span><span class="sxs-lookup"><span data-stu-id="2bb80-163">The *docker-compose.yml* file contains information about what images to build and what containers to launch.</span></span> <span data-ttu-id="2bb80-164">I modelli specificano come compilare l'immagine `eshopweb` e avviare i contenitori dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="2bb80-164">The templates specify how to build the `eshopweb` image and launch the application’s containers.</span></span> <span data-ttu-id="2bb80-165">È necessario aggiungere la dipendenza da SQL Server includendo la relativa immagine (ad esempio `mssql-server-linux`) e un servizio per l'immagine sql.data per Docker per compilare e avviare tale contenitore.</span><span class="sxs-lookup"><span data-stu-id="2bb80-165">You need to add the dependency on SQL Server by including an image for it (for example, `mssql-server-linux`), and a service for the sql.data image for Docker to build and launch that container.</span></span> <span data-ttu-id="2bb80-166">Queste impostazioni sono mostrate nell'esempio seguente:</span><span class="sxs-lookup"><span data-stu-id="2bb80-166">These settings are shown in the following example:</span></span>

```yml
version: '2'

services:
  eshopweb:
    image: eshop/web
    build:
    context: ./eShopWeb
    dockerfile: Dockerfile
    depends_on:
      - sql.data

  sql.data:
    image: microsoft/mssql-server-linux
```

<span data-ttu-id="2bb80-167">La direttiva `depends_on` indica a Docker che l'immagine eShopWeb dipende dall'immagine sql.data.</span><span class="sxs-lookup"><span data-stu-id="2bb80-167">The `depends_on` directive tells Docker that the eShopWeb image depends on the sql.data image.</span></span> <span data-ttu-id="2bb80-168">Le righe al di sotto di `depends_on` sono le istruzioni per compilare un'immagine con tag `sql.data` usando l'immagine `microsoft/mssql-server-linux`.</span><span class="sxs-lookup"><span data-stu-id="2bb80-168">The lines below `depends_on` are the instructions to build an image tagged `sql.data` using the `microsoft/mssql-server-linux` image.</span></span>

<span data-ttu-id="2bb80-169">Il progetto **docker-compose** visualizza gli altri file docker-compose sotto il nodo *docker-compose.yml* principale per fornire un'indicazione visiva che questi file sono correlati.</span><span class="sxs-lookup"><span data-stu-id="2bb80-169">The **docker-compose** project displays the other docker-compose files under the main *docker-compose.yml* node to provide a visual indication that these files are related.</span></span> <span data-ttu-id="2bb80-170">Il file *docker-compose-override.yml* contiene le impostazioni per entrambi i servizi, come le stringhe di connessione e altre impostazioni dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="2bb80-170">The *docker-compose-override.yml* file contains settings for both services, such as connection strings and other application settings.</span></span>

<span data-ttu-id="2bb80-171">L'esempio seguente mostra il file *docker-compose.vs.debug.yml*, che contiene le impostazioni usate per il debug in Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="2bb80-171">The following example shows the *docker-compose.vs.debug.yml* file, which contains settings used for debugging in Visual Studio.</span></span> <span data-ttu-id="2bb80-172">In tale file all'immagine eshopweb è accodato il tag dev.</span><span class="sxs-lookup"><span data-stu-id="2bb80-172">In that file, the eshopweb image has the dev tag appended to it.</span></span> <span data-ttu-id="2bb80-173">Ciò consente di separare le immagini di debug da quelle della versione, in modo che le informazioni di debug non vengano distribuite accidentalmente in un ambiente di produzione:</span><span class="sxs-lookup"><span data-stu-id="2bb80-173">That helps separate debug from release images so that you don't accidentally deploy the debug information to a production environment:</span></span>

```yml
version: '2'

services:
  eshopweb:
    image: eshop/web:dev
    build:
    args:
    source: ${DOCKER_BUILD_SOURCE}
    environment:
      - DOTNET_USE_POLLING_FILE_WATCHER=1
    volumes:
      - ./eShopWeb:/app
      - ~/.nuget/packages:/root/.nuget/packages:ro
      - ~/clrdbg:/clrdbg:ro
    entrypoint: tail -f /dev/null
    labels:
      - "com.microsoft.visualstudio.targetoperatingsystem=linux"
```

<span data-ttu-id="2bb80-174">L'ultimo file aggiunto è *docker-compose.ci.build.yml*,</span><span class="sxs-lookup"><span data-stu-id="2bb80-174">The last file added is *docker-compose.ci.build.yml*.</span></span> <span data-ttu-id="2bb80-175">che potrebbe essere usato dalla riga di comando per compilare il progetto da un server CI.</span><span class="sxs-lookup"><span data-stu-id="2bb80-175">This file would be used from the command line to build the project from a CI server.</span></span> <span data-ttu-id="2bb80-176">Questo file compose avvia un contenitore Docker che compila le immagini necessarie per l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="2bb80-176">This compose file starts a Docker container that builds the images needed for your application.</span></span> <span data-ttu-id="2bb80-177">L'esempio seguente mostra il contenuto del file *docker-compose.ci.build.yml*:</span><span class="sxs-lookup"><span data-stu-id="2bb80-177">The following example shows the contents of the *docker-compose.ci.build.yml* file:</span></span>

```yml
version: '2'

services:
  ci-build:
    image: microsoft/aspnetcore-build:latest
    volumes:
      - .:/src
    working_dir: /src
  command: /bin/bash -c "dotnet restore ./eShopWeb.sln && dotnet publish  ./eShopWeb.sln -c Release -o ./obj/Docker/publish"
```

> [!NOTE]
> <span data-ttu-id="2bb80-178">A partire da .NET Core SDK 2.0, il comando [dotnet restore](../../../core/tools/dotnet-restore.md) viene eseguito automaticamente quando si esegue [dotnet publish](../../../core/tools/dotnet-publish.md).</span><span class="sxs-lookup"><span data-stu-id="2bb80-178">Starting with .NET Core SDK 2.0, the [dotnet restore](../../../core/tools/dotnet-restore.md) command executes automatically when [dotnet publish](../../../core/tools/dotnet-publish.md) is executed.</span></span>

<span data-ttu-id="2bb80-179">Si noti che l'immagine è un'immagine di compilazione ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="2bb80-179">Notice that the image is an ASP.NET Core build image.</span></span> <span data-ttu-id="2bb80-180">L'immagine include gli strumenti SDK e per la compilazione per compilare l'applicazione e creare le immagini necessarie.</span><span class="sxs-lookup"><span data-stu-id="2bb80-180">That image includes the SDK and build tools to build your application and create the required images.</span></span> <span data-ttu-id="2bb80-181">L'esecuzione del progetto **docker-compose** tramite questo file avvia il contenitore della build dall'immagine, quindi compila l'immagine dell'applicazione in tale contenitore.</span><span class="sxs-lookup"><span data-stu-id="2bb80-181">Running the **docker-compose** project using this file starts the build container from the image, then builds your application’s image in that container.</span></span> <span data-ttu-id="2bb80-182">È necessario specificare tale file *docker-compose* come parte della riga di comando per compilare l'applicazione in un contenitore Docker, quindi avviarla.</span><span class="sxs-lookup"><span data-stu-id="2bb80-182">You specify that *docker-compose* file as part of the command line to build your application in a Docker container, then launch it.</span></span>

<span data-ttu-id="2bb80-183">In Visual Studio è possibile eseguire l'applicazione in contenitori Docker selezionando il progetto **docker-compose** come progetto di avvio e quindi premendo CTRL+F5 (F5 per eseguire il debug), come con qualsiasi altra applicazione.</span><span class="sxs-lookup"><span data-stu-id="2bb80-183">In Visual Studio, you can run your application in Docker containers by selecting the **docker-compose** project as the startup project, and then pressing Ctrl+F5 (F5 to debug), as you can with any other application.</span></span> <span data-ttu-id="2bb80-184">Quando si avvia il progetto **docker-compose**, Visual Studio esegue **docker-compose** usando il file *docker-compose.yml*, il file *docker-compose.override.yml* e uno dei file docker-compose.vs\*.</span><span class="sxs-lookup"><span data-stu-id="2bb80-184">When you start the **docker-compose** project, Visual Studio runs **docker-compose** using the *docker-compose.yml* file, the *docker-compose.override.yml* file, and one of the docker-compose.vs.\* files.</span></span> <span data-ttu-id="2bb80-185">Dopo che l'applicazione è stata avviata, il browser si avvia automaticamente in Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="2bb80-185">Once the application has started, Visual Studio launches the browser for you.</span></span>

<span data-ttu-id="2bb80-186">Se si avvia l'applicazione nel debugger, Visual Studio si collega all'applicazione in esecuzione in Docker.</span><span class="sxs-lookup"><span data-stu-id="2bb80-186">If you launch the application in the debugger, Visual Studio attaches to the running application in Docker.</span></span>

## <a name="troubleshooting"></a><span data-ttu-id="2bb80-187">Risoluzione dei problemi</span><span class="sxs-lookup"><span data-stu-id="2bb80-187">Troubleshooting</span></span>

<span data-ttu-id="2bb80-188">Questa sezione descrive alcuni problemi che potrebbero verificarsi durante l'esecuzione dei contenitori in locale e presenta alcune correzioni.</span><span class="sxs-lookup"><span data-stu-id="2bb80-188">This section describes a few issues that might arise when your run containers locally and suggests some fixes.</span></span>

### <a name="stop-docker-containers"></a><span data-ttu-id="2bb80-189">Arresto di contenitori Docker</span><span class="sxs-lookup"><span data-stu-id="2bb80-189">Stop Docker containers</span></span>

<span data-ttu-id="2bb80-190">Dopo avere avviato l'applicazione inclusa nei contenitori, i contenitori continuano a essere eseguiti, anche dopo che è stato interrotto il debug.</span><span class="sxs-lookup"><span data-stu-id="2bb80-190">After you launch the containerized application, the containers continue to run, even after you have stopped debugging.</span></span> <span data-ttu-id="2bb80-191">È possibile eseguire il comando `docker ps` dalla riga di comando per visualizzare i contenitori in esecuzione.</span><span class="sxs-lookup"><span data-stu-id="2bb80-191">You can run the `docker ps` command from the command line to see which containers are running.</span></span> <span data-ttu-id="2bb80-192">Il comando `docker stop` arresta un contenitore in esecuzione, come illustrato nella figura 6-2.</span><span class="sxs-lookup"><span data-stu-id="2bb80-192">The `docker stop` command stops a running container, as shown in Figure 6-2.</span></span>

![](./media/image2.png)

<span data-ttu-id="2bb80-193">**Figura 6-2**.</span><span class="sxs-lookup"><span data-stu-id="2bb80-193">**Figure 6-2**.</span></span> <span data-ttu-id="2bb80-194">Elenco e arresto di contenitori con i comandi dell'interfaccia della riga di comando docker ps e docker stop</span><span class="sxs-lookup"><span data-stu-id="2bb80-194">Listing and stopping containers with the docker ps and docker stop CLI commands</span></span>

<span data-ttu-id="2bb80-195">Potrebbe essere necessario arrestare i processi in esecuzione quando si passa da una configurazione all'altra.</span><span class="sxs-lookup"><span data-stu-id="2bb80-195">You might need to stop running processes when you switch between different configurations.</span></span> <span data-ttu-id="2bb80-196">In caso contrario, il contenitore che esegue l'applicazione Web usa la porta per l'applicazione (5106 in questo esempio).</span><span class="sxs-lookup"><span data-stu-id="2bb80-196">Otherwise, the container that is running the web application is using the port for your application (5106 in this example).</span></span>

### <a name="add-docker-to-your-projects"></a><span data-ttu-id="2bb80-197">Aggiunta di Docker ai progetti</span><span class="sxs-lookup"><span data-stu-id="2bb80-197">Add Docker to your projects</span></span>

<span data-ttu-id="2bb80-198">La procedura guidata che aggiunge il supporto per Docker comunica con il processo Docker in esecuzione.</span><span class="sxs-lookup"><span data-stu-id="2bb80-198">The wizard that adds Docker support communicates with the running Docker process.</span></span> <span data-ttu-id="2bb80-199">La procedura guidata non verrà eseguita correttamente se Docker non è in esecuzione quando si avvia la procedura guidata.</span><span class="sxs-lookup"><span data-stu-id="2bb80-199">If Docker isn't running when you start the wizard, the wizard won't run correctly.</span></span> <span data-ttu-id="2bb80-200">La procedura guidata esamina la scelta del contenitore corrente per aggiungere il supporto per Docker corretto.</span><span class="sxs-lookup"><span data-stu-id="2bb80-200">The wizard examines your current container choice to add the correct Docker support.</span></span> <span data-ttu-id="2bb80-201">Per aggiungere il supporto per i contenitori Windows, eseguire la procedura guidata mentre Docker è in esecuzione con i contenitori Windows configurati.</span><span class="sxs-lookup"><span data-stu-id="2bb80-201">To add support for Windows Containers, run the wizard while you have Docker running with Windows Containers configured.</span></span> <span data-ttu-id="2bb80-202">Per aggiungere il supporto per i contenitori Linux, eseguire la procedura guidata mentre Docker è in esecuzione con i contenitori Linux configurati.</span><span class="sxs-lookup"><span data-stu-id="2bb80-202">To add support for Linux containers, run the wizard while you have Docker running with Linux containers configured.</span></span>

>[!div class="step-by-step"]
<span data-ttu-id="2bb80-203">[Precedente](../docker-application-development-process/docker-app-development-workflow.md)
[Successivo](../containerize-net-framework-applications/index.md)</span><span class="sxs-lookup"><span data-stu-id="2bb80-203">[Previous](../docker-application-development-process/docker-app-development-workflow.md)
[Next](../containerize-net-framework-applications/index.md)</span></span>
