---
title: Migrazione di applicazioni monolitiche .NET Framework legacy nei contenitori di Windows
description: Architettura di microservizi .NET per le applicazioni .NET incluse in contenitori | Migrazione di applicazioni monolitiche .NET Framework legacy nei contenitori di Windows
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 05/26/2017
ms.openlocfilehash: 01b84d29a559bde02ebd30535488c272d5208167
ms.sourcegitcommit: 979597cd8055534b63d2c6ee8322938a27d0c87b
ms.translationtype: HT
ms.contentlocale: it-IT
ms.lasthandoff: 06/29/2018
ms.locfileid: "37106515"
---
# <a name="migrating-legacy-monolithic-net-framework-applications-to-windows-containers"></a><span data-ttu-id="c1bba-103">Migrazione di applicazioni monolitiche .NET Framework legacy nei contenitori di Windows</span><span class="sxs-lookup"><span data-stu-id="c1bba-103">Migrating Legacy Monolithic .NET Framework Applications to Windows Containers</span></span>

<span data-ttu-id="c1bba-104">*I contenitori Windows possono essere usati per migliorare gli ambienti di sviluppo e test e per distribuire applicazioni basate su tecnologie .NET Framework legacy come i Web* *Form. Questa modalità di utilizzo dei contenitori per le applicazioni legacy viene definita scenario "lift-and-shift".*</span><span class="sxs-lookup"><span data-stu-id="c1bba-104">*Windows Containers can be used as a way to improve development and test environments, and to deploy applications that are based on legacy .NET Framework technologies like Web* *Forms. Using containers for legacy applications in this way is referred to as a “lift and shift” scenario.*</span></span>

<span data-ttu-id="c1bba-105">Nelle sezioni precedenti di questa guida è stata illustrata un'architettura di microservizi in cui le applicazioni aziendali sono distribuite tra contenitori diversi, ognuno dei quali esegue un servizio limitato ma mirato.</span><span class="sxs-lookup"><span data-stu-id="c1bba-105">Earlier sections of this guide have championed a microservices architecture where business applications are distributed among different containers, each running a small, focused service.</span></span> <span data-ttu-id="c1bba-106">Tale obiettivo offre numerosi vantaggi.</span><span class="sxs-lookup"><span data-stu-id="c1bba-106">That goal has many benefits.</span></span> <span data-ttu-id="c1bba-107">In un nuovo sviluppo questo approccio è fortemente consigliato.</span><span class="sxs-lookup"><span data-stu-id="c1bba-107">In new development, that approach is strongly recommended.</span></span> <span data-ttu-id="c1bba-108">Anche le applicazioni aziendali critiche trarranno un vantaggio tale da giustificare il costo di una nuova architettura e di una reimplementazione.</span><span class="sxs-lookup"><span data-stu-id="c1bba-108">Enterprise-critical applications will also benefit enough to justify the cost of a rearchitecture and reimplementation.</span></span>

<span data-ttu-id="c1bba-109">Ma non tutte le applicazioni godranno di vantaggi sufficienti per giustificare il costo.</span><span class="sxs-lookup"><span data-stu-id="c1bba-109">But not every application will benefit enough to justify the cost.</span></span> <span data-ttu-id="c1bba-110">Questo non vuol dire che tali applicazioni non possano essere usate in scenari basati su contenitori.</span><span class="sxs-lookup"><span data-stu-id="c1bba-110">That does not mean that those applications cannot be used in container scenarios.</span></span>

<span data-ttu-id="c1bba-111">In questa sezione verrà presa in esame un'applicazione per eShopOnContainers, illustrata nella figura 7-1,</span><span class="sxs-lookup"><span data-stu-id="c1bba-111">In this section, we will explore an application for eShopOnContainers, shown in Figure 7-1.</span></span> <span data-ttu-id="c1bba-112">che potrà essere usata dai membri del team aziendale di eShopOnContainers per visualizzare e modificare il catalogo dei prodotti.</span><span class="sxs-lookup"><span data-stu-id="c1bba-112">This application would be used by members of the eShopOnContainers enterprise team to view and edit the product catalog.</span></span>

![](./media/image1.png)

<span data-ttu-id="c1bba-113">**Figura 7-1**.</span><span class="sxs-lookup"><span data-stu-id="c1bba-113">**Figure 7-1**.</span></span> <span data-ttu-id="c1bba-114">Applicazione Web Form ASP.NET (tecnologia legacy) in un contenitore Windows</span><span class="sxs-lookup"><span data-stu-id="c1bba-114">ASP.NET Web Forms application (legacy technology) on a Windows Container</span></span>

<span data-ttu-id="c1bba-115">Si tratta di un'applicazione Web Form usata per esplorare e modificare le voci di catalogo.</span><span class="sxs-lookup"><span data-stu-id="c1bba-115">This is a Web Forms application that is used to browse and modify the catalog entries.</span></span> <span data-ttu-id="c1bba-116">La dipendenza da Web Form significa che questa applicazione non verrà eseguita in .NET Core a meno che non sia riscritta senza Web Form e usi invece ASP.NET Core MVC.</span><span class="sxs-lookup"><span data-stu-id="c1bba-116">The Web Forms dependency means this application will not run on .NET Core unless it is rewritten without Web Forms and instead uses ASP.NET Core MVC.</span></span> <span data-ttu-id="c1bba-117">Verrà spiegato come eseguire applicazioni come queste in contenitori senza modifiche.</span><span class="sxs-lookup"><span data-stu-id="c1bba-117">You will see how you can run applications like these in containers without changes.</span></span> <span data-ttu-id="c1bba-118">Si comprenderà inoltre come apportare modifiche minime al lavoro in una modalità ibrida in cui alcune funzionalità sono state spostate in un microservizio separato, mentre la maggior parte di esse rimane nell'applicazione monolitica.</span><span class="sxs-lookup"><span data-stu-id="c1bba-118">You will also see how you can make minimal changes to work in a hybrid mode where some functionality has been moved into a separate microservice, but most functionality remains in the monolithic application.</span></span>

## <a name="benefits-of-containerizing-a-monolithic-application"></a><span data-ttu-id="c1bba-119">Vantaggi dell'inserimento di un'applicazione monolitica in un contenitore</span><span class="sxs-lookup"><span data-stu-id="c1bba-119">Benefits of containerizing a monolithic application</span></span>

<span data-ttu-id="c1bba-120">L'applicazione Catalog.WebForms è disponibile nel repository GitHub eShopOnContainers (<https://github.com/dotnet/eShopOnContainers>).</span><span class="sxs-lookup"><span data-stu-id="c1bba-120">The Catalog.WebForms application is available in the eShopOnContainers GitHub repository (<https://github.com/dotnet/eShopOnContainers>).</span></span> <span data-ttu-id="c1bba-121">Questa applicazione è un'applicazione Web autonoma che accede a un archivio dati a disponibilità elevata.</span><span class="sxs-lookup"><span data-stu-id="c1bba-121">This application is a standalone web application accessing a high-availability data store.</span></span> <span data-ttu-id="c1bba-122">Anche in questo caso l'esecuzione dell'applicazione in un contenitore presenta alcuni vantaggi.</span><span class="sxs-lookup"><span data-stu-id="c1bba-122">Even so, there are advantages to running the application in a container.</span></span> <span data-ttu-id="c1bba-123">Viene creata un'immagine per l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="c1bba-123">You create an image for the application.</span></span> <span data-ttu-id="c1bba-124">Da quel punto in avanti, ogni distribuzione viene eseguita nello stesso ambiente.</span><span class="sxs-lookup"><span data-stu-id="c1bba-124">From that point forward, every deployment runs in the same environment.</span></span> <span data-ttu-id="c1bba-125">Ogni contenitore usa la stessa versione del sistema operativo, ha la stessa versione di dipendenze installata, usa lo stesso framework ed è compilato con lo stesso processo.</span><span class="sxs-lookup"><span data-stu-id="c1bba-125">Every container uses the same OS version, has the same version of dependencies installed, uses the same framework, and is built using the same process.</span></span> <span data-ttu-id="c1bba-126">È possibile visualizzare l'applicazione caricata in Visual Studio 2017 nella figura 7-2.</span><span class="sxs-lookup"><span data-stu-id="c1bba-126">You can see the application loaded in Visual Studio 2017 in Figure 7-2.</span></span>

![](./media/image2.png)

<span data-ttu-id="c1bba-127">**Figura 7-2**.</span><span class="sxs-lookup"><span data-stu-id="c1bba-127">**Figure 7-2**.</span></span> <span data-ttu-id="c1bba-128">Applicazione Web Form per la gestione del catalogo in Visual Studio 2017</span><span class="sxs-lookup"><span data-stu-id="c1bba-128">Catalog management Web Forms application in Visual Studio 2017</span></span>

<span data-ttu-id="c1bba-129">Inoltre, gli sviluppatori possono eseguire tutti l'applicazione in questo ambiente coerente.</span><span class="sxs-lookup"><span data-stu-id="c1bba-129">In addition, developers can all run the application in this consistent environment.</span></span> <span data-ttu-id="c1bba-130">I problemi che si verificano solo con determinate versioni verranno riscontrati immediatamente dagli sviluppatori, anziché emergere in un ambiente di gestione temporanea o di produzione.</span><span class="sxs-lookup"><span data-stu-id="c1bba-130">Issues that only appear with certain versions will appear immediately for developers rather than surfacing in a staging or production environment.</span></span> <span data-ttu-id="c1bba-131">Le differenze tra gli ambienti di sviluppo all'interno del team di sviluppo sono meno rilevanti quando le applicazioni sono eseguite in contenitori.</span><span class="sxs-lookup"><span data-stu-id="c1bba-131">Differences between the development environments among the development team matter less once applications run in containers.</span></span>

<span data-ttu-id="c1bba-132">Infine, per le applicazioni incluse in contenitori la curva di scalabilità orizzontale si appiattisce.</span><span class="sxs-lookup"><span data-stu-id="c1bba-132">Finally, containerized applications have a flatter scale-out curve.</span></span> <span data-ttu-id="c1bba-133">Si è appreso in che modo le app incluse in contenitori abilitino più contenitori in una macchina virtuale o più contenitori in un computer fisico.</span><span class="sxs-lookup"><span data-stu-id="c1bba-133">You have learned how containerized apps enable more containers in a VM or more containers in a physical machine.</span></span> <span data-ttu-id="c1bba-134">Questo si traduce in maggiore densità e meno risorse richieste.</span><span class="sxs-lookup"><span data-stu-id="c1bba-134">This translates to higher density and fewer required resources.</span></span>

<span data-ttu-id="c1bba-135">Per tutti questi motivi, prendere in considerazione l'esecuzione di app monolitiche legacy in un contenitore Docker usando un'operazione di "lift-and-shift".</span><span class="sxs-lookup"><span data-stu-id="c1bba-135">For all these reasons, consider running legacy monolithic apps in a Docker container using a “lift-and-shift” operation.</span></span> <span data-ttu-id="c1bba-136">L'espressione "lift-and-shift" descrive l'ambito dell'attività: si *solleva* l'intera applicazione da un computer fisico o da una macchina virtuale e la si *sposta* in un contenitore.</span><span class="sxs-lookup"><span data-stu-id="c1bba-136">The phrase “lift and shift” describes the scope of the task: you *lift* the entire application from a physical or virtual machine, and *shift* it into a container.</span></span> <span data-ttu-id="c1bba-137">In situazioni ideali non è necessario apportare modifiche al codice dell'applicazione per eseguirla in un contenitore.</span><span class="sxs-lookup"><span data-stu-id="c1bba-137">In ideal situations, you do not need to make any changes to the application code to run it in a container.</span></span>

## <a name="possible-migration-paths"></a><span data-ttu-id="c1bba-138">Percorsi di migrazione possibili</span><span class="sxs-lookup"><span data-stu-id="c1bba-138">Possible migration paths</span></span>

<span data-ttu-id="c1bba-139">Come applicazione monolitica, l'applicazione Catalog.Webforms è un'applicazione Web contenente tutto il codice, incluse le librerie di accesso ai dati.</span><span class="sxs-lookup"><span data-stu-id="c1bba-139">As a monolithic application, the Catalog.Webforms application is one web application containing all the code, including the data access libraries.</span></span> <span data-ttu-id="c1bba-140">Il database viene eseguito in un computer a disponibilità elevata distinto.</span><span class="sxs-lookup"><span data-stu-id="c1bba-140">The database runs on a separate high-availability machine.</span></span> <span data-ttu-id="c1bba-141">Tale configurazione viene simulata nel codice di esempio tramite un servizio catalogo fittizio: è possibile eseguire l'applicazione Catalog.WebForms in base a tali dati falsi per simulare uno scenario lift-and-shift puro.</span><span class="sxs-lookup"><span data-stu-id="c1bba-141">That configuration is simulated in the sample code by using a mock catalog service: you can run the Catalog.WebForms application against that fake data to simulate a pure lift-and-shift scenario.</span></span> <span data-ttu-id="c1bba-142">Ciò dimostra il percorso di migrazione più semplice, in cui le risorse esistenti vengono spostate per l'esecuzione in un contenitore senza alcuna modifica al codice.</span><span class="sxs-lookup"><span data-stu-id="c1bba-142">This demonstrates the simplest migration path, where you move existing assets to run in a container without any code changes at all.</span></span> <span data-ttu-id="c1bba-143">Questo percorso è appropriato per le applicazioni complete che hanno un'interazione minima con le funzionalità che si spostano nei microservizi.</span><span class="sxs-lookup"><span data-stu-id="c1bba-143">This path is appropriate for applications that are complete and that have minimal interaction with functionality that you are moving to microservices.</span></span>

<span data-ttu-id="c1bba-144">Tuttavia, il sito Web eShopOnContainers accede già all'archivio dati usando i microservizi per scenari diversi.</span><span class="sxs-lookup"><span data-stu-id="c1bba-144">However, the eShopOnContainers website is already accessing the data storage using microservices for different scenarios.</span></span> <span data-ttu-id="c1bba-145">È possibile apportare alcune piccole modifiche aggiuntive all'editor del catalogo per sfruttare il microservizio catalogo anziché accedere direttamente all'archivio dati del catalogo.</span><span class="sxs-lookup"><span data-stu-id="c1bba-145">Some small additional changes can be made to the catalog editor to leverage the catalog microservice instead of accessing the catalog data storage directly.</span></span>

<span data-ttu-id="c1bba-146">Queste modifiche dimostrano la continuità per le applicazioni in uso.</span><span class="sxs-lookup"><span data-stu-id="c1bba-146">These changes demonstrate the continuum for your own applications.</span></span> <span data-ttu-id="c1bba-147">È possibile eseguire qualsiasi operazione, dallo spostamento di un'applicazione esistente senza modifiche nei contenitori, all'attuazione di piccole modifiche che consentono alle applicazioni esistenti di accedere ad alcuni dei nuovi microservizi, fino alla riscrittura completa di un'applicazione per partecipare pienamente in una nuova architettura basata su microservizi.</span><span class="sxs-lookup"><span data-stu-id="c1bba-147">You can do anything from moving an existing application without change into containers, to making small changes that enable existing applications to access some of the new microservices, to completely rewriting an application to fully participate in a new microservice-based architecture.</span></span> <span data-ttu-id="c1bba-148">Il percorso più adeguato dipende sia dal costo della migrazione che dai vantaggi di qualsiasi migrazione.</span><span class="sxs-lookup"><span data-stu-id="c1bba-148">The right path depends on both the cost of the migration and the benefits from any migration.</span></span>

## <a name="application-tour"></a><span data-ttu-id="c1bba-149">Presentazione dell'applicazione</span><span class="sxs-lookup"><span data-stu-id="c1bba-149">Application tour</span></span>

<span data-ttu-id="c1bba-150">È possibile caricare la soluzione Catalog.WebForms ed eseguire l'applicazione come applicazione autonoma.</span><span class="sxs-lookup"><span data-stu-id="c1bba-150">You can load the Catalog.WebForms solution and run the application as a standalone application.</span></span> <span data-ttu-id="c1bba-151">In questa configurazione, invece di un database dell'archivio permanente, l'applicazione usa un servizio fittizio per restituire i dati.</span><span class="sxs-lookup"><span data-stu-id="c1bba-151">In this configuration, instead of a persistent storage database, the application uses a fake service to return data.</span></span> <span data-ttu-id="c1bba-152">L'applicazione usa Autofac (<https://autofac.org/>) come un'inversione del contenitore del controllo (IOC).</span><span class="sxs-lookup"><span data-stu-id="c1bba-152">The application uses Autofac (<https://autofac.org/>) as an inversion of control (IOC) container.</span></span> <span data-ttu-id="c1bba-153">Tramite l'inserimento delle dipendenze, è possibile configurare l'applicazione in modo da usare i dati falsi o il servizio dati del catalogo in tempo reale</span><span class="sxs-lookup"><span data-stu-id="c1bba-153">Using Dependency Injection (DI), you can configure the application to use the fake data or the live catalog data service.</span></span> <span data-ttu-id="c1bba-154">(a breve verranno forniti ulteriori dettagli sull'inserimento delle dipendenze). Il codice di avvio legge un'impostazione useFake dai file web.config e configura il contenitore Autofac per inserire il servizio dati fittizio o il servizio catalogo in tempo reale.</span><span class="sxs-lookup"><span data-stu-id="c1bba-154">(We will explain more about DI shortly.) The startup code reads a useFake setting from the web.config files, and configures the Autofac container to inject either the fake data service or the live catalog service.</span></span> <span data-ttu-id="c1bba-155">Se si esegue l'applicazione con useFake impostato su false nel file web.config, verrà visualizzata l'applicazione Web Form con i dati del catalogo.</span><span class="sxs-lookup"><span data-stu-id="c1bba-155">If you run the application with useFake set to false in the web.config file, you see the Web Forms application displaying the catalog data.</span></span>

<span data-ttu-id="c1bba-156">La maggior parte delle tecniche usate in questa applicazione dovrebbe risultare estremamente familiare per chiunque abbia usato i Web Form.</span><span class="sxs-lookup"><span data-stu-id="c1bba-156">Most of the techniques used in this application should be very familiar to anyone who has used Web Forms.</span></span> <span data-ttu-id="c1bba-157">Tuttavia, il microservizio catalogo introduce due tecniche che potrebbero essere meno note: l'inserimento delle dipendenze, menzionato in precedenza, e l'uso di archivi dati asincroni nei Web Form.</span><span class="sxs-lookup"><span data-stu-id="c1bba-157">However, the catalog microservice introduces two techniques that might be unfamiliar: Dependency Injection (DI), which was mentioned earlier, and working with asynchronous data stores in Web Forms.</span></span>

<span data-ttu-id="c1bba-158">L'inserimento delle dipendenze inverte la strategia orientata a oggetti tipica della scrittura di classi che allocano tutte le risorse necessarie.</span><span class="sxs-lookup"><span data-stu-id="c1bba-158">DI inverts the typical object-oriented strategy of writing classes that allocate all needed resources.</span></span> <span data-ttu-id="c1bba-159">Al contrario, le classi richiedono le relative dipendenze da un contenitore del servizio.</span><span class="sxs-lookup"><span data-stu-id="c1bba-159">Instead, classes request their dependencies from a service container.</span></span> <span data-ttu-id="c1bba-160">Il vantaggio dell'inserimento delle dipendenze consiste nella possibilità di sostituire i servizi esterni con oggetti fittizi (simulazioni) per supportare ambienti di test o di altro tipo.</span><span class="sxs-lookup"><span data-stu-id="c1bba-160">The advantage of DI is that you can replace external services with fakes (mocks) to support testing or other environments.</span></span>

<span data-ttu-id="c1bba-161">Il contenitore di inserimento delle dipendenze usa la configurazione appSettings di web.config per controllare se usare i dati del catalogo fittizio o i dati in tempo reale dal servizio in esecuzione.</span><span class="sxs-lookup"><span data-stu-id="c1bba-161">The DI container uses the web.config appSettings configuration to control whether to use the fake catalog data or the live data from the running service.</span></span> <span data-ttu-id="c1bba-162">L'applicazione registra un oggetto HttpModule che crea il contenitore e registra un gestore di pre-richiesta per l'inserimento delle dipendenze.</span><span class="sxs-lookup"><span data-stu-id="c1bba-162">The application registers an HttpModule object that builds the container and registers a pre-request handler to inject dependencies.</span></span> <span data-ttu-id="c1bba-163">Tale codice può essere visualizzato nel file Modules/AutoFacHttpModule.cs, che presenta un aspetto analogo al seguente:</span><span class="sxs-lookup"><span data-stu-id="c1bba-163">You can see that code in the Modules/AutoFacHttpModule.cs file, which looks like the following example:</span></span>

```cs
private static IContainer CreateContainer()
{
  // Configure AutoFac:
  // Register Containers:

  var settings = WebConfigurationManager.AppSettings;
  var useFake = settings["usefake"];
  bool fake = useFake == "true";
  var builder = new ContainerBuilder();

  if (fake)
  {
    builder.RegisterType<CatalogMockService>()
    .As<ICatalogService>();
  }
  else
  {
    builder.RegisterType<CatalogService>()
    .As<ICatalogService>();
    builder.RegisterType<RequestProvider>()
    .As<IRequestProvider>();
  }

  var container = builder.Build();
  return container;
}

private void InjectDependencies()
{
  if (HttpContext.Current.CurrentHandler is Page page)
  {
    // Get the code-behind class that we may have written
    var pageType = page.GetType().BaseType;

    // Determine if there is a constructor to inject, and grab it
    var ctor = (from c in pageType.GetConstructors()
                where c.GetParameters().Length > 0
                select c).FirstOrDefault();

    if (ctor != null)
    {
      // Resolve the parameters for the constructor
      var args = (from parm in ctor.GetParameters()
                  select Container.Resolve(parm.ParameterType))
                  .ToArray();

      // Execute the constructor method with the arguments resolved
      ctor.Invoke(page, args);
    }

    // Use the Autofac method to inject any
    // properties that can be filled by Autofac
    Container.InjectProperties(page);
  }
}
```

<span data-ttu-id="c1bba-164">Le pagine dell'applicazione (Default.aspx.cs e EditPage.aspx.cs) definiscono costruttori che accettano queste dipendenze.</span><span class="sxs-lookup"><span data-stu-id="c1bba-164">The application’s pages (Default.aspx.cs and EditPage.aspx.cs) define constructors that take these dependencies.</span></span> <span data-ttu-id="c1bba-165">Il costruttore predefinito è ancora presente e accessibile.</span><span class="sxs-lookup"><span data-stu-id="c1bba-165">Note that the default constructor is still present and accessible.</span></span> <span data-ttu-id="c1bba-166">L'infrastruttura necessita del codice seguente.</span><span class="sxs-lookup"><span data-stu-id="c1bba-166">The infrastructure needs the following code.</span></span>

```cs
protected _Default() { }

public _Default(ICatalogService catalog) => this.catalog = catalog;
```

<span data-ttu-id="c1bba-167">Le API del catalogo sono tutte metodi asincroni.</span><span class="sxs-lookup"><span data-stu-id="c1bba-167">The catalog APIs are all asynchronous methods.</span></span> <span data-ttu-id="c1bba-168">I Web Form ora le supportano per tutti i controlli dati.</span><span class="sxs-lookup"><span data-stu-id="c1bba-168">Web Forms now supports these for all data controls.</span></span> <span data-ttu-id="c1bba-169">L'applicazione Catalog.WebForms usa l'associazione di modelli per le pagine di elenco e modifica; i controlli nelle pagine definiscono le proprietà SelectMethod, UpdateMethod, InsertMethod e DeleteMethod che specificano le operazioni asincrone che restituiscono un'attività.</span><span class="sxs-lookup"><span data-stu-id="c1bba-169">The Catalog.WebForms application uses model binding for the list and edit pages; controls on the pages define SelectMethod, UpdateMethod, InsertMethod, and DeleteMethod properties that specify Task-returning asynchronous operations.</span></span> <span data-ttu-id="c1bba-170">I controlli Web Form comprendono quando i metodi associati a un controllo sono asincroni.</span><span class="sxs-lookup"><span data-stu-id="c1bba-170">Web Forms controls understand when the methods bound to a control are asynchronous.</span></span> <span data-ttu-id="c1bba-171">L'unica limitazione che si riscontra quando si usano metodi di selezione asincroni è che non è possibile supportare il paging.</span><span class="sxs-lookup"><span data-stu-id="c1bba-171">The only restriction you encounter when using asynchronous select methods is that you cannot support paging.</span></span> <span data-ttu-id="c1bba-172">La firma di paging richiede un parametro out e i metodi asincroni non possono avere parametri out.</span><span class="sxs-lookup"><span data-stu-id="c1bba-172">The paging signature requires an out parameter, and asynchronous methods cannot have out parameters.</span></span> <span data-ttu-id="c1bba-173">Questa stessa tecnica viene usata in altre pagine che richiedono dati dal servizio catalogo.</span><span class="sxs-lookup"><span data-stu-id="c1bba-173">This same technique is used on other pages that require data from the catalog service.</span></span>

<span data-ttu-id="c1bba-174">La configurazione predefinita per l'applicazione Web Form del catalogo usa un'implementazione fittizia del servizio catalog.api.</span><span class="sxs-lookup"><span data-stu-id="c1bba-174">The default configuration for the catalog Web Forms application uses a mock implementation of the catalog.api service.</span></span> <span data-ttu-id="c1bba-175">Questa simulazione usa un set di dati hardcoded per i dati, che consente di semplificare alcune attività rimuovendo la dipendenza dal servizio catalog.api negli ambienti di sviluppo.</span><span class="sxs-lookup"><span data-stu-id="c1bba-175">This mock uses a hard-coded dataset for its data, which simplifies some tasks by removing the dependency on the catalog.api service in development environments.</span></span>

## <a name="lifting-and-shifting"></a><span data-ttu-id="c1bba-176">Lift-and-shift</span><span class="sxs-lookup"><span data-stu-id="c1bba-176">Lifting and shifting</span></span>

<span data-ttu-id="c1bba-177">Visual Studio garantisce un supporto ottimale per l'inserimento di un'applicazione nei contenitori.</span><span class="sxs-lookup"><span data-stu-id="c1bba-177">Visual Studio provides great support for containerizing an application.</span></span> <span data-ttu-id="c1bba-178">Fare clic con il pulsante destro del mouse sul nodo di progetto e quindi selezionare **Aggiungi** e **Supporto Docker**.</span><span class="sxs-lookup"><span data-stu-id="c1bba-178">You right-click the project node and then select **Add** and **Docker Support**.</span></span> <span data-ttu-id="c1bba-179">Il modello di progetto Docker aggiunge un nuovo progetto alla soluzione denominata **docker-compose**.</span><span class="sxs-lookup"><span data-stu-id="c1bba-179">The Docker project template adds a new project to the solution called **docker-compose**.</span></span> <span data-ttu-id="c1bba-180">Il progetto contiene le risorse Docker che compongono (o compilano) le immagini necessarie e viene avviato eseguendo i contenitori necessari, come illustrato nella figura 7-3.</span><span class="sxs-lookup"><span data-stu-id="c1bba-180">The project contains the Docker assets that compose (or build) the images you need, and starts running the necessary containers, as shown in Figure 7-3.</span></span>

<span data-ttu-id="c1bba-181">Negli scenari lift-and-shift più semplici l'applicazione sarà il servizio singolo usato per l'applicazione Web Form.</span><span class="sxs-lookup"><span data-stu-id="c1bba-181">In the simplest lift-and-shift scenarios, the application will be the single service that you use for the Web Forms application.</span></span> <span data-ttu-id="c1bba-182">Il modello modifica anche il progetto di avvio in modo che punti al progetto **docker-compose**.</span><span class="sxs-lookup"><span data-stu-id="c1bba-182">The template also changes your startup project to point to the **docker-compose** project.</span></span> <span data-ttu-id="c1bba-183">Premendo CTRL+F5 o F5, verrà creata l'immagine Docker e sarà avviato il contenitore Docker.</span><span class="sxs-lookup"><span data-stu-id="c1bba-183">Pressing Ctrl+F5 or F5 now creates the Docker image and launches the Docker container.</span></span>

![](./media/image3.png)

<span data-ttu-id="c1bba-184">**Figura 7-3**.</span><span class="sxs-lookup"><span data-stu-id="c1bba-184">**Figure 7-3**.</span></span> <span data-ttu-id="c1bba-185">Progetto **docker-compose** nella soluzione Web Form</span><span class="sxs-lookup"><span data-stu-id="c1bba-185">The **docker-compose** project in the Web Forms solution</span></span>

<span data-ttu-id="c1bba-186">Prima di eseguire la soluzione, è necessario assicurarsi di configurare Docker per l'uso dei contenitori Windows.</span><span class="sxs-lookup"><span data-stu-id="c1bba-186">Before you run the solution, you must make sure that you configure Docker to use Windows Containers.</span></span> <span data-ttu-id="c1bba-187">A tale scopo, fare clic con il pulsante destro del mouse sull'icona Docker della barra delle applicazioni in Windows e selezionare **Switch to Windows Containers** (Passa ai contenitori Windows), come illustrato nella figura 7-4.</span><span class="sxs-lookup"><span data-stu-id="c1bba-187">To do that, you right-click the Docker taskbar icon in Windows and select **Switch to Windows Containers**, as shown in Figure 7-4.</span></span>

![](./media/image4.png)

<span data-ttu-id="c1bba-188">**Figura 7-4**.</span><span class="sxs-lookup"><span data-stu-id="c1bba-188">**Figure 7-4**.</span></span> <span data-ttu-id="c1bba-189">Passaggio ai contenitori Windows dall'icona Docker della barra delle applicazioni in Windows</span><span class="sxs-lookup"><span data-stu-id="c1bba-189">Switching to Windows Containers from the Docker taskbar icon in Windows</span></span>

<span data-ttu-id="c1bba-190">Se la voce di menu visualizzata è **Switch to Linux containers** (Passa ai contenitori Linux), Docker è già in esecuzione con i contenitori Windows.</span><span class="sxs-lookup"><span data-stu-id="c1bba-190">If the menu item says **Switch to Linux containers**, you are already running Docker with Windows Containers.</span></span>

<span data-ttu-id="c1bba-191">L'esecuzione della soluzione riavvia l'host Docker.</span><span class="sxs-lookup"><span data-stu-id="c1bba-191">Running the solution restarts the Docker host.</span></span> <span data-ttu-id="c1bba-192">Durante la compilazione, vengono compilate l'applicazione e l'immagine Docker per il progetto Web Form.</span><span class="sxs-lookup"><span data-stu-id="c1bba-192">When you build, you build the application and the Docker image for the Web Forms project.</span></span> <span data-ttu-id="c1bba-193">La prima volta che si esegue questa operazione, è richiesto molto tempo.</span><span class="sxs-lookup"><span data-stu-id="c1bba-193">The first time you do this, it takes considerable time.</span></span> <span data-ttu-id="c1bba-194">Ciò accade perché il processo di compilazione estrae l'immagine base di Windows Server e l'immagine aggiuntiva per ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="c1bba-194">This is because the build process pulls down the base Windows Server image and the additional image for ASP.NET.</span></span> <span data-ttu-id="c1bba-195">I cicli di compilazione ed esecuzione successivi saranno molto più veloci.</span><span class="sxs-lookup"><span data-stu-id="c1bba-195">Subsequent build and run cycles will be much faster.</span></span>

<span data-ttu-id="c1bba-196">Verranno ora esaminati in maniera più approfondita i file aggiunti dal modello di progetto Docker.</span><span class="sxs-lookup"><span data-stu-id="c1bba-196">Let’s take a deeper look at the files added by the Docker project template.</span></span> <span data-ttu-id="c1bba-197">Diversi file sono stati creati automaticamente.</span><span class="sxs-lookup"><span data-stu-id="c1bba-197">It created several files for you.</span></span> <span data-ttu-id="c1bba-198">Visual Studio usa questi file per creare l'immagine Docker e avviare un contenitore.</span><span class="sxs-lookup"><span data-stu-id="c1bba-198">Visual Studio uses these files to create the Docker image and launch a container.</span></span> <span data-ttu-id="c1bba-199">È possibile usare gli stessi file dall'interfaccia della riga di comando per eseguire manualmente i comandi di Docker.</span><span class="sxs-lookup"><span data-stu-id="c1bba-199">You can use the same files from the CLI to run Docker commands manually.</span></span>

<span data-ttu-id="c1bba-200">L'esempio di Dockerfile seguente mostra le impostazioni di base per la compilazione di un'immagine Docker basata sull'immagine Windows ASP.NET che esegue un sito ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="c1bba-200">The following Dockerfile example shows the basic settings for building a Docker image based on the Windows ASP.NET image that runs an ASP.NET site.</span></span>

```
FROM microsoft/aspnet

ARG source

WORKDIR /inetpub/wwwroot

COPY ${source:-obj/Docker/publish} .
```

<span data-ttu-id="c1bba-201">Questo Dockerfile avrà un aspetto molto simile ai file creati per l'esecuzione di un'applicazione ASP.NET Core nei contenitori Linux.</span><span class="sxs-lookup"><span data-stu-id="c1bba-201">This Dockerfile will look very similar to those created for running an ASP.NET Core application in Linux containers.</span></span> <span data-ttu-id="c1bba-202">Esistono tuttavia alcune importanti differenze.</span><span class="sxs-lookup"><span data-stu-id="c1bba-202">However, there are a few important differences.</span></span> <span data-ttu-id="c1bba-203">La differenza più rilevante è che l'immagine di base è microsoft/aspnet, ovvero l'immagine corrente di Windows Server che include .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="c1bba-203">The most important difference is that the base image is microsoft/aspnet, which is the current Windows Server image that includes the .NET Framework.</span></span> <span data-ttu-id="c1bba-204">Altre differenze sono che le directory copiate dalla directory di origine sono diverse.</span><span class="sxs-lookup"><span data-stu-id="c1bba-204">Other differences are that the directories copied from your source directory are different.</span></span>

<span data-ttu-id="c1bba-205">Gli altri file nel progetto **docker-compose** sono le risorse Docker necessarie per compilare e configurare i contenitori.</span><span class="sxs-lookup"><span data-stu-id="c1bba-205">The other files in the **docker-compose** project are the Docker assets needed to build and configure the containers.</span></span> <span data-ttu-id="c1bba-206">Visual Studio inserisce i vari file docker-compose.yml in un nodo per evidenziarne le modalità di utilizzo.</span><span class="sxs-lookup"><span data-stu-id="c1bba-206">Visual Studio puts the various docker-compose.yml files under one node to highlight how they are used.</span></span> <span data-ttu-id="c1bba-207">Il file di base docker-compose contiene le direttive comuni a tutte le configurazioni.</span><span class="sxs-lookup"><span data-stu-id="c1bba-207">The base docker-compose file contains the directives that are common to all configurations.</span></span> <span data-ttu-id="c1bba-208">Il file docker-compose.override.yml contiene le variabili di ambiente e gli override correlati per una configurazione per sviluppatori.</span><span class="sxs-lookup"><span data-stu-id="c1bba-208">The docker-compose.override.yml file contains environment variables and related overrides for a developer configuration.</span></span> <span data-ttu-id="c1bba-209">Le varianti con .vs.debug e .vs.release forniscono le impostazioni dell'ambiente che consentono a Visual Studio di connettersi al contenitore in esecuzione e gestirlo.</span><span class="sxs-lookup"><span data-stu-id="c1bba-209">The variants with .vs.debug and .vs.release provide environment settings that enable Visual Studio to attach to and manage the running container.</span></span>

<span data-ttu-id="c1bba-210">Mentre l'integrazione con Visual Studio rientra nell'aggiunta del supporto per Docker alla soluzione in uso, è anche possibile compilare ed eseguire dalla riga di comando usando il comando docker-compose up, come illustrato nelle sezioni precedenti.</span><span class="sxs-lookup"><span data-stu-id="c1bba-210">While Visual Studio integration is part of adding Docker support to your solution, you can also build and run from the command line, using the docker-compose up command, as you saw in previous sections.</span></span>

## <a name="getting-data-from-the-existing-catalog-net-core-microservice"></a><span data-ttu-id="c1bba-211">Recupero di dati dal microservizio .NET Core del catalogo esistente</span><span class="sxs-lookup"><span data-stu-id="c1bba-211">Getting data from the existing catalog .NET Core microservice</span></span>

<span data-ttu-id="c1bba-212">È possibile configurare l'applicazione Web Form in modo da usare il microservizio catalogo eShopOnContainers per recuperare i dati anziché usare dati falsi.</span><span class="sxs-lookup"><span data-stu-id="c1bba-212">You can configure the Web Forms application to use the eShopOnContainers catalog microservice to get data instead of using fake data.</span></span> <span data-ttu-id="c1bba-213">A tale scopo, è necessario modificare il file web.config e impostare il valore della chiave useFake su false.</span><span class="sxs-lookup"><span data-stu-id="c1bba-213">To do this, you edit the web.config file and set the value of the useFake key to false.</span></span> <span data-ttu-id="c1bba-214">Il contenitore di inserimento delle dipendenze userà la classe che accede al microservizio catalogo in tempo reale invece di quella che restituisce i dati hardcoded.</span><span class="sxs-lookup"><span data-stu-id="c1bba-214">The DI container will use the class that accesses the live catalog microservice instead of the class that returns the hard-coded data.</span></span> <span data-ttu-id="c1bba-215">Non sono necessarie altre modifiche al codice.</span><span class="sxs-lookup"><span data-stu-id="c1bba-215">No other code changes are needed.</span></span>

<span data-ttu-id="c1bba-216">L'accesso al servizio catalogo in tempo reale implica la necessità di aggiornare il progetto **docker-compose** per compilare l'immagine del servizio catalogo e avviare il contenitore del servizio catalogo.</span><span class="sxs-lookup"><span data-stu-id="c1bba-216">Accessing the live catalog service does mean you need to update the **docker-compose** project to build the catalog service image and launch the catalog service container.</span></span> <span data-ttu-id="c1bba-217">Docker CE per Windows supporta sia i contenitori Linux che quelli Windows, ma non contemporaneamente.</span><span class="sxs-lookup"><span data-stu-id="c1bba-217">Docker CE for Windows supports both Linux containers and Windows Containers, but not at the same time.</span></span> <span data-ttu-id="c1bba-218">Per eseguire il microservizio catalogo, è necessario compilare un'immagine per l'esecuzione del microservizio catalogo sulla base di un contenitore Windows.</span><span class="sxs-lookup"><span data-stu-id="c1bba-218">To run the catalog microservice, you need to build an image that runs the catalog microservice on top of a Windows-based container.</span></span> <span data-ttu-id="c1bba-219">Questo approccio richiede un Dockerfile diverso per il progetto dei microservizi che è stato illustrato nelle sezioni precedenti.</span><span class="sxs-lookup"><span data-stu-id="c1bba-219">This approach requires a different Dockerfile for the microservices project than you have seen in earlier sections.</span></span> <span data-ttu-id="c1bba-220">Il file Dockerfile.windows contiene le impostazioni di configurazione per creare l'immagine del contenitore dell'API del catalogo in modo che l'esecuzione sia basata su un contenitore Windows, ad esempio per usare un'immagine Docker Windows Nano.</span><span class="sxs-lookup"><span data-stu-id="c1bba-220">The Dockerfile.windows file contains the configuration settings to build the catalog API container image so that it runs on a Windows container—for example, to use a Windows Nano Docker image.</span></span>

<span data-ttu-id="c1bba-221">Il microservizio catalogo si basa sul database di SQL Server.</span><span class="sxs-lookup"><span data-stu-id="c1bba-221">The catalog microservice relies on the SQL Server database.</span></span> <span data-ttu-id="c1bba-222">Pertanto, è necessario usare anche un'immagine Docker di SQL Server basata su Windows.</span><span class="sxs-lookup"><span data-stu-id="c1bba-222">Therefore, you need to use a Windows-based SQL Server Docker image as well.</span></span>

<span data-ttu-id="c1bba-223">Dopo che sono state apportate queste modifiche, il progetto docker-compose non si limita ad avviare l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="c1bba-223">After these changes, the docker-compose project does more to start the application.</span></span> <span data-ttu-id="c1bba-224">Il progetto avvia ora SQL Server usando l'immagine di SQL Server basata su Windows.</span><span class="sxs-lookup"><span data-stu-id="c1bba-224">The project now starts the SQL Server using the Windows based SQL Server image.</span></span> <span data-ttu-id="c1bba-225">Avvia il microservizio catalogo in un contenitore Windows.</span><span class="sxs-lookup"><span data-stu-id="c1bba-225">It starts the catalog microservice in a Windows container.</span></span> <span data-ttu-id="c1bba-226">E avvia il contenitore dell'editor del catalogo Web Form, anch'esso in un contenitore Windows.</span><span class="sxs-lookup"><span data-stu-id="c1bba-226">And it starts the Web Forms catalog editor container, also in a Windows container.</span></span> <span data-ttu-id="c1bba-227">Se necessario, per prima cosa vengono create le immagini.</span><span class="sxs-lookup"><span data-stu-id="c1bba-227">If any of the images need building, the images are created first.</span></span>

## <a name="development-and-production-environments"></a><span data-ttu-id="c1bba-228">Ambienti di sviluppo e produzione</span><span class="sxs-lookup"><span data-stu-id="c1bba-228">Development and production environments</span></span>

<span data-ttu-id="c1bba-229">Esistono alcune differenze tra una configurazione di sviluppo e una di produzione.</span><span class="sxs-lookup"><span data-stu-id="c1bba-229">There are a couple of differences between the development configuration and a production configuration.</span></span> <span data-ttu-id="c1bba-230">Nell'ambiente di sviluppo si esegue l'applicazione Web Form, il microservizio catalogo e SQL Server in contenitori Windows, nell'ambito dello stesso host Docker.</span><span class="sxs-lookup"><span data-stu-id="c1bba-230">In the development environment, you run the Web Forms application, the catalog microservice, and SQL Server in Windows Containers, as part of the same Docker host.</span></span> <span data-ttu-id="c1bba-231">Nelle sezioni precedenti sono state menzionate le immagini di SQL Server distribuite nello stesso host Docker come gli altri servizi basati su .NET Core in un host Docker basato su Linux.</span><span class="sxs-lookup"><span data-stu-id="c1bba-231">In earlier sections, we mentioned SQL Server images deployed in the same Docker host as the other .NET Core-based services on a Linux-based Docker host.</span></span> <span data-ttu-id="c1bba-232">Il vantaggio di eseguire più microservizi nello stesso host Docker (o cluster) è che la comunicazione di rete è inferiore e la comunicazione tra i contenitori ha una latenza più bassa.</span><span class="sxs-lookup"><span data-stu-id="c1bba-232">The advantage of running the multiple microservices in the same Docker host (or cluster) is that there is less network communication and the communication between containers has lower latency.</span></span>

<span data-ttu-id="c1bba-233">Nell'ambiente di sviluppo è necessario eseguire tutti i contenitori nello stesso sistema operativo.</span><span class="sxs-lookup"><span data-stu-id="c1bba-233">In the development environment, you must run all the containers in the same OS.</span></span> <span data-ttu-id="c1bba-234">Docker CE per Windows non supporta l'esecuzione di contenitori basati su Windows e Linux contemporaneamente.</span><span class="sxs-lookup"><span data-stu-id="c1bba-234">Docker CE for Windows does not support running Windows- and Linux-based containers at the same time.</span></span> <span data-ttu-id="c1bba-235">In produzione è possibile decidere se si vuole eseguire il microservizio catalogo in un contenitore Windows in un singolo host Docker (o cluster) o fare in modo che l'applicazione Web Form comunichi con un'istanza del microservizio catalogo in esecuzione in un contenitore Linux in un altro host Docker.</span><span class="sxs-lookup"><span data-stu-id="c1bba-235">In production, you can decide if you want to run the catalog microservice in a Windows container in a single Docker host (or cluster), or have the Web Forms application communicate with an instance of the catalog microservice running in a Linux container on a different Docker host.</span></span> <span data-ttu-id="c1bba-236">Dipende dalla modalità di ottimizzazione prescelta per la latenza di rete.</span><span class="sxs-lookup"><span data-stu-id="c1bba-236">It depends on how you want to optimize for network latency.</span></span> <span data-ttu-id="c1bba-237">Nella maggior parte dei casi si specifica che i microservizi da cui dipendono le applicazioni siano eseguiti nello stesso host Docker (o swarm) per una maggiore facilità di distribuzione e una minore latenza di comunicazione.</span><span class="sxs-lookup"><span data-stu-id="c1bba-237">In most cases, you want the microservices that your applications depend on running in the same Docker host (or swarm) for ease of deployment and lower communication latency.</span></span> <span data-ttu-id="c1bba-238">In tali configurazioni le uniche comunicazioni costose sono quelle tra le istanze del microservizio e i server a disponibilità elevata per l'archivio dati permanente.</span><span class="sxs-lookup"><span data-stu-id="c1bba-238">In those configurations, the only costly communications is between the microservice instances and the high-availability servers for the persistent data storage.</span></span>

>[!div class="step-by-step"]
<span data-ttu-id="c1bba-239">[Precedente](../net-core-single-containers-linux-windows-server-hosts/index.md)
[Successivo](../multi-container-microservice-net-applications/index.md)</span><span class="sxs-lookup"><span data-stu-id="c1bba-239">[Previous](../net-core-single-containers-linux-windows-server-hosts/index.md)
[Next](../multi-container-microservice-net-applications/index.md)</span></span>
