---
title: Approcci CQRS l'applicazione e CQS in un microservizio DDD in eShopOnContainers
description: Architettura di Microservizi .NET per le applicazioni nei contenitori .NET | Approcci CQRS l'applicazione e CQS in un microservizio DDD in eShopOnContainers
keywords: Docker, microservizi, ASP.NET, contenitore
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 05/26/2017
ms.prod: .net-core
ms.technology: dotnet-docker
ms.topic: article
ms.openlocfilehash: a2c4429a75ca47d4fbcde868b95e76bc65ea2bef
ms.sourcegitcommit: bd1ef61f4bb794b25383d3d72e71041a5ced172e
ms.translationtype: HT
ms.contentlocale: it-IT
ms.lasthandoff: 10/18/2017
---
# <a name="applying-cqrs-and-cqs-approaches-in-a-ddd-microservice-in-eshoponcontainers"></a><span data-ttu-id="a416b-104">Approcci CQRS l'applicazione e CQS in un microservizio DDD in eShopOnContainers</span><span class="sxs-lookup"><span data-stu-id="a416b-104">Applying CQRS and CQS approaches in a DDD microservice in eShopOnContainers</span></span>

<span data-ttu-id="a416b-105">La progettazione dell'ordinamento microservizio l'applicazione di riferimento eShopOnContainers si basa sui principi CQRS.</span><span class="sxs-lookup"><span data-stu-id="a416b-105">The design of the ordering microservice at the eShopOnContainers reference application is based on CQRS principles.</span></span> <span data-ttu-id="a416b-106">Tuttavia, utilizza l'approccio più semplice, che è sufficiente che separa le query dei comandi e utilizzando lo stesso database per le azioni.</span><span class="sxs-lookup"><span data-stu-id="a416b-106">However, it uses the simplest approach, which is just separating the queries from the commands and using the same database for both actions.</span></span>

<span data-ttu-id="a416b-107">Le tracce di tali modelli e in questo caso, l'aspetto importante sono che le query sono idempotenti: indipendentemente da quante volte si esegue un sistema, lo stato del sistema di una query non verranno modificato è anche possibile usare un modello di dati diverso "lettura" più la logica transazionale "scrittura" modello di dominio, anche se l'ordinamento microservizi utilizza lo stesso database.</span><span class="sxs-lookup"><span data-stu-id="a416b-107">The essence of those patterns, and the important point here, is that queries are idempotent: no matter how many times you query a system, the state of that system will not change You could even use a different “reads” data model than the transactional logic “writes” domain model, although the ordering microservices is using the same database.</span></span> <span data-ttu-id="a416b-108">Pertanto, questo è un approccio CQRS semplificato.</span><span class="sxs-lookup"><span data-stu-id="a416b-108">Hence this is a simplified CQRS approach.</span></span>

<span data-ttu-id="a416b-109">D'altra parte, comandi, attivano le transazioni e gli aggiornamenti dei dati, modificano lo stato del sistema.</span><span class="sxs-lookup"><span data-stu-id="a416b-109">On the other hand, commands, which trigger transactions and data updates, change state in the system.</span></span> <span data-ttu-id="a416b-110">Con i comandi, è necessario prestare attenzione quando relative complessità e le regole di business in continua evoluzione.</span><span class="sxs-lookup"><span data-stu-id="a416b-110">With commands, you need to be careful when dealing with complexity and ever-changing business rules.</span></span> <span data-ttu-id="a416b-111">Questa è la posizione in cui si desidera applicare le tecniche DDD per disporre di un sistema modellato meglio.</span><span class="sxs-lookup"><span data-stu-id="a416b-111">This is the where you want to apply DDD techniques to have a better modeled system.</span></span>

<span data-ttu-id="a416b-112">I modelli DDD presentati in questa Guida non devono essere applicati universalmente.</span><span class="sxs-lookup"><span data-stu-id="a416b-112">The DDD patterns presented in this guide should not be applied universally.</span></span> <span data-ttu-id="a416b-113">Introducono vincoli alla progettazione.</span><span class="sxs-lookup"><span data-stu-id="a416b-113">They introduce constraints on your design.</span></span> <span data-ttu-id="a416b-114">Tali vincoli offrono vantaggi, ad esempio una qualità più elevata nel tempo, soprattutto in comandi e altro codice che modifica lo stato del sistema.</span><span class="sxs-lookup"><span data-stu-id="a416b-114">Those constraints provide benefits such as higher quality over time, especially in commands and other code that modifies system state.</span></span> <span data-ttu-id="a416b-115">Tuttavia, tali vincoli aggiungono complessità con meno vantaggi per la lettura e di eseguire query sui dati.</span><span class="sxs-lookup"><span data-stu-id="a416b-115">However, those constraints add complexity with fewer benefits for reading and querying data.</span></span>

<span data-ttu-id="a416b-116">Un modello di questo tipo è il modello di aggregazione, che verranno esaminati più nelle sezioni successive.</span><span class="sxs-lookup"><span data-stu-id="a416b-116">One such pattern is the Aggregate pattern, which we examine more in later sections.</span></span> <span data-ttu-id="a416b-117">In breve, nel modello di aggregazione, si considerano molti oggetti di dominio come una singola unità come risultato la relazione del dominio.</span><span class="sxs-lookup"><span data-stu-id="a416b-117">Briefly, in the Aggregate pattern, you treat many domain objects as a single unit as a result of their relationship in the domain.</span></span> <span data-ttu-id="a416b-118">È possibile che non sempre vantaggi da questo modello di query. è possibile aumentare la complessità della logica di query.</span><span class="sxs-lookup"><span data-stu-id="a416b-118">You might not always gain advantages from this pattern in queries; it can increase the complexity of query logic.</span></span> <span data-ttu-id="a416b-119">Per le query di sola lettura, non è possibile ottenere i vantaggi di gestione di più oggetti come una singola funzione di aggregazione.</span><span class="sxs-lookup"><span data-stu-id="a416b-119">For read-only queries, you do not get the advantages of treating multiple objects as a single Aggregate.</span></span> <span data-ttu-id="a416b-120">Si ottiene solo la complessità.</span><span class="sxs-lookup"><span data-stu-id="a416b-120">You only get the complexity.</span></span>

<span data-ttu-id="a416b-121">Come illustrato nella figura 9-2, è consigliabile in base a modelli DDD solo nell'area transazionale, aggiornamenti del microservizio (vale a dire come attivata da comandi).</span><span class="sxs-lookup"><span data-stu-id="a416b-121">As shown in Figure 9-2, this guide suggests using DDD patterns only in the transactional/updates area of your microservice (that is, as triggered by commands).</span></span> <span data-ttu-id="a416b-122">Le query possono seguire un approccio più semplice e devono essere separate da comandi, adotta un approccio CQRS.</span><span class="sxs-lookup"><span data-stu-id="a416b-122">Queries can follow a simpler approach and should be separated from commands, following a CQRS approach.</span></span>

<span data-ttu-id="a416b-123">Per implementare il lato"query", è possibile scegliere tra molti approcci, tra l'autentico ORM come Core EF AutoMapper proiezioni o stored procedure, viste, viste materializzate una ORM micro.</span><span class="sxs-lookup"><span data-stu-id="a416b-123">For implementing the “queries side”, you can choose between many approaches, from your full-blown ORM like EF Core, AutoMapper projections, stored procedures, views, materialized views or a micro ORM.</span></span>

<span data-ttu-id="a416b-124">In questa Guida e in eShopOnContainers (in particolare l'ordinamento microservizio) è stato scelto di implementare semplici query utilizzando un micro ORM come [Dapper](https://github.com/StackExchange/dapper-dot-net).</span><span class="sxs-lookup"><span data-stu-id="a416b-124">In this guide and in eShopOnContainers (specifically the ordering microservice) we chose to implement straight queries using a micro ORM like [Dapper](https://github.com/StackExchange/dapper-dot-net).</span></span> <span data-ttu-id="a416b-125">Ciò consente di implementare qualsiasi query in base alle istruzioni SQL per ottenere prestazioni ottimali, grazie a un framework chiaro con un overhead minimo.</span><span class="sxs-lookup"><span data-stu-id="a416b-125">This lets you implement any query based on SQL statements to get the best performance, thanks to a light framework with very little overhead.</span></span>

<span data-ttu-id="a416b-126">Si noti che, quando si utilizza questo approccio, tutti gli aggiornamenti al modello che influiscono su come le entità vengono resi persistenti in un database SQL necessario anche aggiornamenti separati in query SQL utilizzate da Dapper o eventuali altri approcci (non EF) separati per l'esecuzione di query.</span><span class="sxs-lookup"><span data-stu-id="a416b-126">Note that when you use this approach, any updates to your model that impact how entities are persisted to a SQL database also need separate updates to SQL queries used by Dapper or any other separate (non-EF) approaches to querying.</span></span>

## <a name="cqrs-and-ddd-patterns-are-not-top-level-architectures"></a><span data-ttu-id="a416b-127">I modelli CQRS e DDD non sono le architetture di livello superiore</span><span class="sxs-lookup"><span data-stu-id="a416b-127">CQRS and DDD patterns are not top-level architectures</span></span>

<span data-ttu-id="a416b-128">È importante comprendere che CQRS e la maggior parte dei modelli DDD (come livelli DDD o un modello di dominio con funzioni di aggregazione) non sono gli stili dell'architettura, ma solo i modelli di architettura.</span><span class="sxs-lookup"><span data-stu-id="a416b-128">It important to understand that CQRS and most DDD patterns (like DDD layers or a domain model with aggregates) are not architectural styles, but only architecture patterns.</span></span> <span data-ttu-id="a416b-129">Microservizi, SOA e architettura basata su eventi (EDA) sono esempi di stili dell'architettura.</span><span class="sxs-lookup"><span data-stu-id="a416b-129">Microservices, SOA, and event-driven architecture (EDA) are examples of architectural styles.</span></span> <span data-ttu-id="a416b-130">Descrivono un sistema di molti componenti, ad esempio microservizi molti.</span><span class="sxs-lookup"><span data-stu-id="a416b-130">They describe a system of many components, such as many microservices.</span></span> <span data-ttu-id="a416b-131">Modelli di CQRS e DDD descrivono un aspetto all'interno di un unico sistema o un componente. In questo caso, oggetto all'interno di un microservizio.</span><span class="sxs-lookup"><span data-stu-id="a416b-131">CQRS and DDD patterns describe something inside a single system or component; in this case, something inside a microservice.</span></span>

<span data-ttu-id="a416b-132">Contesti diversi delimitata (BCs) verranno impiegati modelli diversi.</span><span class="sxs-lookup"><span data-stu-id="a416b-132">Different Bounded Contexts (BCs) will employ different patterns.</span></span> <span data-ttu-id="a416b-133">Responsabilità diverse e che comporta diverse soluzioni.</span><span class="sxs-lookup"><span data-stu-id="a416b-133">They have different responsibilities, and that leads to different solutions.</span></span> <span data-ttu-id="a416b-134">È la pena sottolineare che imporre lo stesso modello che Everywhere provoca un errore.</span><span class="sxs-lookup"><span data-stu-id="a416b-134">It is worth emphasizing that forcing the same pattern everywhere leads to failure.</span></span> <span data-ttu-id="a416b-135">Non utilizzare modelli di CQRS e DDD ovunque.</span><span class="sxs-lookup"><span data-stu-id="a416b-135">Do not use CQRS and DDD patterns everywhere.</span></span> <span data-ttu-id="a416b-136">Molti dei sottosistemi, BCs o microservizi sono più semplici e possono essere implementato più facilmente utilizzando servizi CRUD semplici o un altro approccio.</span><span class="sxs-lookup"><span data-stu-id="a416b-136">Many subsystems, BCs, or microservices are simpler and can be implemented more easily using simple CRUD services or using another approach.</span></span>

<span data-ttu-id="a416b-137">Vi è solo un'applicazione architettura: l'architettura dell'applicazione end-to-end o di sistema si progettano (ad esempio, l'architettura di microservizi).</span><span class="sxs-lookup"><span data-stu-id="a416b-137">There is only one application architecture: the architecture of the system or end-to-end application you are designing (for example, the microservices architecture).</span></span> <span data-ttu-id="a416b-138">Tuttavia, la struttura di ogni contesto delimitata o microservizio all'interno di tale applicazione riflette il proprio compromessi e le decisioni di progettazione interna a livello di modelli di architettura.</span><span class="sxs-lookup"><span data-stu-id="a416b-138">However, the design of each Bounded Context or microservice within that application reflects its own tradeoffs and internal design decisions at an architecture patterns level.</span></span> <span data-ttu-id="a416b-139">Non tentare di applicare gli stessi dell'architettura modelli come CQRS o DDD ovunque.</span><span class="sxs-lookup"><span data-stu-id="a416b-139">Do not try to apply the same architectural patterns like CQRS or DDD everywhere.</span></span>

####  <a name="additional-resources"></a><span data-ttu-id="a416b-140">Risorse aggiuntive</span><span class="sxs-lookup"><span data-stu-id="a416b-140">Additional resources</span></span>

-   <span data-ttu-id="a416b-141">**Martin Fowler. CQRS**
    [*https://martinfowler.com/bliki/CQRS.html*](https://martinfowler.com/bliki/CQRS.html)</span><span class="sxs-lookup"><span data-stu-id="a416b-141">**Martin Fowler. CQRS**
[*https://martinfowler.com/bliki/CQRS.html*](https://martinfowler.com/bliki/CQRS.html)</span></span>

-   <span data-ttu-id="a416b-142">**Greg Young. Visual Studio CQS. CQRS**
    [*http://codebetter.com/gregyoung/2009/08/13/command-query-separation/*](http://codebetter.com/gregyoung/2009/08/13/command-query-separation/)</span><span class="sxs-lookup"><span data-stu-id="a416b-142">**Greg Young. CQS vs. CQRS**
[*http://codebetter.com/gregyoung/2009/08/13/command-query-separation/*](http://codebetter.com/gregyoung/2009/08/13/command-query-separation/)</span></span>

-   <span data-ttu-id="a416b-143">**Greg Young. Documenti CQRS**
    [*https://cqrs.files.wordpress.com/2010/11/cqrs\_documents.pdf*](https://cqrs.files.wordpress.com/2010/11/cqrs_documents.pdf)</span><span class="sxs-lookup"><span data-stu-id="a416b-143">**Greg Young. CQRS Documents**
[*https://cqrs.files.wordpress.com/2010/11/cqrs\_documents.pdf*](https://cqrs.files.wordpress.com/2010/11/cqrs_documents.pdf)</span></span>

-   <span data-ttu-id="a416b-144">**Greg Young. Attività di CQRS, basato su interfacce utente e determinazione dell'origine evento**
    [*http://codebetter.com/gregyoung/2010/02/16/cqrs-task-based-uis-event-sourcing-agh/*](http://codebetter.com/gregyoung/2010/02/16/cqrs-task-based-uis-event-sourcing-agh/)</span><span class="sxs-lookup"><span data-stu-id="a416b-144">**Greg Young. CQRS, Task Based UIs and Event Sourcing**
[*http://codebetter.com/gregyoung/2010/02/16/cqrs-task-based-uis-event-sourcing-agh/*](http://codebetter.com/gregyoung/2010/02/16/cqrs-task-based-uis-event-sourcing-agh/)</span></span>

-   <span data-ttu-id="a416b-145">**udi Dahan. È stato chiarito CQRS**
    [*http://udidahan.com/2009/12/09/clarified-cqrs/*](http://udidahan.com/2009/12/09/clarified-cqrs/)</span><span class="sxs-lookup"><span data-stu-id="a416b-145">**Udi Dahan. Clarified CQRS**
[*http://udidahan.com/2009/12/09/clarified-cqrs/*](http://udidahan.com/2009/12/09/clarified-cqrs/)</span></span>

-   <span data-ttu-id="a416b-146">**CQRS**
    [*http://udidahan.com/2009/12/09/clarified-cqrs/*](http://udidahan.com/2009/12/09/clarified-cqrs/)</span><span class="sxs-lookup"><span data-stu-id="a416b-146">**CQRS**
[*http://udidahan.com/2009/12/09/clarified-cqrs/*](http://udidahan.com/2009/12/09/clarified-cqrs/)</span></span>

-   <span data-ttu-id="a416b-147">**Evento-Sourcing (ES)**
    [*http://codebetter.com/gregyoung/2010/02/20/why-use-event-sourcing/*](http://codebetter.com/gregyoung/2010/02/20/why-use-event-sourcing/)</span><span class="sxs-lookup"><span data-stu-id="a416b-147">**Event-Sourcing (ES)**
[*http://codebetter.com/gregyoung/2010/02/20/why-use-event-sourcing/*](http://codebetter.com/gregyoung/2010/02/20/why-use-event-sourcing/)</span></span>


>[!div class="step-by-step"]
<span data-ttu-id="a416b-148">[Precedente] [Avanti] (cqrs-microservizio-reads.md) (apply-simplified-microservice-cqrs-ddd-patterns.md)</span><span class="sxs-lookup"><span data-stu-id="a416b-148">[Previous] (apply-simplified-microservice-cqrs-ddd-patterns.md) [Next] (cqrs-microservice-reads.md)</span></span>
