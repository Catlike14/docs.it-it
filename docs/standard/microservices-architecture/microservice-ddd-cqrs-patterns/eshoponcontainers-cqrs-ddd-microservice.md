---
title: Applicazione degli approcci CQRS e CQS in un microservizio DDD in eShopOnContainers
description: Architettura di microservizi .NET per applicazioni .NET in contenitori | Applicazione degli approcci CQRS e CQS in un microservizio DDD in eShopOnContainers
keywords: Docker, microservizi, ASP.NET, contenitore
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 05/26/2017
ms.prod: .net-core
ms.technology: dotnet-docker
ms.topic: article
ms.workload:
- dotnet
- dotnetcore
ms.openlocfilehash: 63e61a93aa2a162d7b48e0d423dab99dcea9d020
ms.sourcegitcommit: e7f04439d78909229506b56935a1105a4149ff3d
ms.translationtype: HT
ms.contentlocale: it-IT
ms.lasthandoff: 12/23/2017
---
# <a name="applying-cqrs-and-cqs-approaches-in-a-ddd-microservice-in-eshoponcontainers"></a><span data-ttu-id="b6a46-104">Applicazione degli approcci CQRS e CQS in un microservizio DDD in eShopOnContainers</span><span class="sxs-lookup"><span data-stu-id="b6a46-104">Applying CQRS and CQS approaches in a DDD microservice in eShopOnContainers</span></span>

<span data-ttu-id="b6a46-105">La progettazione del microservizio per gli ordini nell'applicazione di riferimento eShopOnContainers è basata sui principi del modello CQRS.</span><span class="sxs-lookup"><span data-stu-id="b6a46-105">The design of the ordering microservice at the eShopOnContainers reference application is based on CQRS principles.</span></span> <span data-ttu-id="b6a46-106">Tuttavia, usa l'approccio più semplice che consiste nella separazione delle query dai comandi e nell'uso dello stesso database per entrambe le azioni.</span><span class="sxs-lookup"><span data-stu-id="b6a46-106">However, it uses the simplest approach, which is just separating the queries from the commands and using the same database for both actions.</span></span>

<span data-ttu-id="b6a46-107">La sostanza di questi schemi e il punto importante stanno nel fatto che le query sono idempotenti: indipendentemente dal numero di query inviate al sistema, lo stato del sistema non cambia. È anche possibile usare un modello di dati per le "letture" diverso dal modello di dominio per le "scritture" della logica transazionale, sebbene il microservizio degli ordini usi lo stesso database.</span><span class="sxs-lookup"><span data-stu-id="b6a46-107">The essence of those patterns, and the important point here, is that queries are idempotent: no matter how many times you query a system, the state of that system will not change You could even use a different “reads” data model than the transactional logic “writes” domain model, although the ordering microservices is using the same database.</span></span> <span data-ttu-id="b6a46-108">Ecco perché questo è un approccio CQRS semplificato.</span><span class="sxs-lookup"><span data-stu-id="b6a46-108">Hence this is a simplified CQRS approach.</span></span>

<span data-ttu-id="b6a46-109">D'altra parte, lo stato dei comandi che attivano le transazioni e gli aggiornamenti dei dati cambia nel sistema.</span><span class="sxs-lookup"><span data-stu-id="b6a46-109">On the other hand, commands, which trigger transactions and data updates, change state in the system.</span></span> <span data-ttu-id="b6a46-110">Con i comandi, occorre prestare attenzione quando si affrontano scenari complessi e regole aziendali in continua evoluzione.</span><span class="sxs-lookup"><span data-stu-id="b6a46-110">With commands, you need to be careful when dealing with complexity and ever-changing business rules.</span></span> <span data-ttu-id="b6a46-111">Ecco perché le tecniche di progettazione DDD consentono di ottenere un sistema con una modellazione ottimale.</span><span class="sxs-lookup"><span data-stu-id="b6a46-111">This is the where you want to apply DDD techniques to have a better modeled system.</span></span>

<span data-ttu-id="b6a46-112">Gli schemi DDD presentati in questa guida non devono essere applicati a livello universale,</span><span class="sxs-lookup"><span data-stu-id="b6a46-112">The DDD patterns presented in this guide should not be applied universally.</span></span> <span data-ttu-id="b6a46-113">perché introducono vincoli nella progettazione.</span><span class="sxs-lookup"><span data-stu-id="b6a46-113">They introduce constraints on your design.</span></span> <span data-ttu-id="b6a46-114">Questi vincoli offrono vantaggi come una migliore qualità nel tempo, in particolare per i comandi e il codice che modifica lo stato del sistema.</span><span class="sxs-lookup"><span data-stu-id="b6a46-114">Those constraints provide benefits such as higher quality over time, especially in commands and other code that modifies system state.</span></span> <span data-ttu-id="b6a46-115">Tuttavia, questi vincoli aggiungono complessità con vantaggi ridotti per la lettura e le query sui dati.</span><span class="sxs-lookup"><span data-stu-id="b6a46-115">However, those constraints add complexity with fewer benefits for reading and querying data.</span></span>

<span data-ttu-id="b6a46-116">Uno di questi schemi è lo schema Aggregate che verrà esaminato più in dettaglio nelle sezioni successive.</span><span class="sxs-lookup"><span data-stu-id="b6a46-116">One such pattern is the Aggregate pattern, which we examine more in later sections.</span></span> <span data-ttu-id="b6a46-117">In breve, nello schema Aggregate, gli oggetti di dominio vengono considerati come una singola unità in virtù della relativa relazione nel dominio.</span><span class="sxs-lookup"><span data-stu-id="b6a46-117">Briefly, in the Aggregate pattern, you treat many domain objects as a single unit as a result of their relationship in the domain.</span></span> <span data-ttu-id="b6a46-118">Non sempre questo schema genera vantaggi nelle query, in quanto può aumentare la complessità della logica di query.</span><span class="sxs-lookup"><span data-stu-id="b6a46-118">You might not always gain advantages from this pattern in queries; it can increase the complexity of query logic.</span></span> <span data-ttu-id="b6a46-119">Per le query di sola lettura non è vantaggioso considerare più oggetti come una singola aggregazione.</span><span class="sxs-lookup"><span data-stu-id="b6a46-119">For read-only queries, you do not get the advantages of treating multiple objects as a single Aggregate.</span></span> <span data-ttu-id="b6a46-120">Aumenta solo la complessità.</span><span class="sxs-lookup"><span data-stu-id="b6a46-120">You only get the complexity.</span></span>

<span data-ttu-id="b6a46-121">Come illustrato nella figura 9-2, questa guida suggerisce l'uso di schemi di progettazione DDD solo nell'area transazionale e degli aggiornamenti del microservizio, ovvero quella attivata dai comandi.</span><span class="sxs-lookup"><span data-stu-id="b6a46-121">As shown in Figure 9-2, this guide suggests using DDD patterns only in the transactional/updates area of your microservice (that is, as triggered by commands).</span></span> <span data-ttu-id="b6a46-122">Le query possono seguire un approccio più semplice e devono essere separate dai comandi, secondo quanto previsto dall'approccio CQRS.</span><span class="sxs-lookup"><span data-stu-id="b6a46-122">Queries can follow a simpler approach and should be separated from commands, following a CQRS approach.</span></span>

<span data-ttu-id="b6a46-123">Per implementare il "lato query" è possibile scegliere tra numerosi approcci, ad esempio uno basato su ORM (Object-Relational Mapping), come EF Core, proiezioni di AutoMapper, stored procedure, viste, viste materializzate o micro ORM.</span><span class="sxs-lookup"><span data-stu-id="b6a46-123">For implementing the “queries side”, you can choose between many approaches, from your full-blown ORM like EF Core, AutoMapper projections, stored procedures, views, materialized views or a micro ORM.</span></span>

<span data-ttu-id="b6a46-124">In questa guida e in eShopOnContainers, in particolare nel microservizio degli ordini, è stato scelto di implementare query lineari tramite un micro ORM come [Dapper](https://github.com/StackExchange/dapper-dot-net).</span><span class="sxs-lookup"><span data-stu-id="b6a46-124">In this guide and in eShopOnContainers (specifically the ordering microservice) we chose to implement straight queries using a micro ORM like [Dapper](https://github.com/StackExchange/dapper-dot-net).</span></span> <span data-ttu-id="b6a46-125">In questo modo è possibile implementare qualsiasi query basata su istruzioni SQL per ottenere le prestazioni migliori, grazie a un framework leggero con un sovraccarico ridotto.</span><span class="sxs-lookup"><span data-stu-id="b6a46-125">This lets you implement any query based on SQL statements to get the best performance, thanks to a light framework with very little overhead.</span></span>

<span data-ttu-id="b6a46-126">Si noti che quando si usa questo approccio, gli aggiornamenti al modello che influiscono sul modo in cui le entità vengono salvate in modo permanente in un database SQL devono separare gli aggiornamenti alle query SQL usate da Dapper o da qualsiasi altro approccio separato (non EF) all'esecuzione di query.</span><span class="sxs-lookup"><span data-stu-id="b6a46-126">Note that when you use this approach, any updates to your model that impact how entities are persisted to a SQL database also need separate updates to SQL queries used by Dapper or any other separate (non-EF) approaches to querying.</span></span>

## <a name="cqrs-and-ddd-patterns-are-not-top-level-architectures"></a><span data-ttu-id="b6a46-127">Gli schemi CQRS e DDD non sono architetture di primo livello</span><span class="sxs-lookup"><span data-stu-id="b6a46-127">CQRS and DDD patterns are not top-level architectures</span></span>

<span data-ttu-id="b6a46-128">È importante comprendere che gli schemi CQRS e la maggior parte degli schemi DDD, come i livelli DDD o un modello di dominio con aggregazioni, non sono stili architetturali, ma solo schemi di architetture.</span><span class="sxs-lookup"><span data-stu-id="b6a46-128">It important to understand that CQRS and most DDD patterns (like DDD layers or a domain model with aggregates) are not architectural styles, but only architecture patterns.</span></span> <span data-ttu-id="b6a46-129">I microservizi, l'architettura orientata ai servizi (SOA) e l'architettura basata su eventi (EDA) sono esempi di stili architetturali.</span><span class="sxs-lookup"><span data-stu-id="b6a46-129">Microservices, SOA, and event-driven architecture (EDA) are examples of architectural styles.</span></span> <span data-ttu-id="b6a46-130">Descrivono un sistema costituito da molti componenti, ad esempio vari microservizi.</span><span class="sxs-lookup"><span data-stu-id="b6a46-130">They describe a system of many components, such as many microservices.</span></span> <span data-ttu-id="b6a46-131">Gli schemi CQRS e DDD descrivono un aspetto all'interno di un singolo sistema o componente. In questo caso, all'interno di un microservizio.</span><span class="sxs-lookup"><span data-stu-id="b6a46-131">CQRS and DDD patterns describe something inside a single system or component; in this case, something inside a microservice.</span></span>

<span data-ttu-id="b6a46-132">Diversi contesti delimitati useranno schemi differenti.</span><span class="sxs-lookup"><span data-stu-id="b6a46-132">Different Bounded Contexts (BCs) will employ different patterns.</span></span> <span data-ttu-id="b6a46-133">Poiché hanno responsabilità diverse, verranno impiegate soluzioni differenziate.</span><span class="sxs-lookup"><span data-stu-id="b6a46-133">They have different responsibilities, and that leads to different solutions.</span></span> <span data-ttu-id="b6a46-134">Tenere presente che forzare lo stesso schema ovunque può generare errori.</span><span class="sxs-lookup"><span data-stu-id="b6a46-134">It is worth emphasizing that forcing the same pattern everywhere leads to failure.</span></span> <span data-ttu-id="b6a46-135">Non usare gli schemi CQRS e DDD ovunque.</span><span class="sxs-lookup"><span data-stu-id="b6a46-135">Do not use CQRS and DDD patterns everywhere.</span></span> <span data-ttu-id="b6a46-136">Molti sottosistemi, contesti delimitati o microservizi sono più semplici e possono essere implementati facilmente con servizi CRUD o altri approcci.</span><span class="sxs-lookup"><span data-stu-id="b6a46-136">Many subsystems, BCs, or microservices are simpler and can be implemented more easily using simple CRUD services or using another approach.</span></span>

<span data-ttu-id="b6a46-137">Esiste una sola architettura dell'applicazione: l'architettura del sistema o dell'applicazione end-to-end che si sta progettando, ad esempio l'architettura di microservizi.</span><span class="sxs-lookup"><span data-stu-id="b6a46-137">There is only one application architecture: the architecture of the system or end-to-end application you are designing (for example, the microservices architecture).</span></span> <span data-ttu-id="b6a46-138">Tuttavia la progettazione di ogni contesto delimitato o microservizio all'interno dell'applicazione riflette i compromessi e le decisioni di progettazione interne al livello degli schemi di architettura.</span><span class="sxs-lookup"><span data-stu-id="b6a46-138">However, the design of each Bounded Context or microservice within that application reflects its own tradeoffs and internal design decisions at an architecture patterns level.</span></span> <span data-ttu-id="b6a46-139">Non provare ad applicare gli stessi schemi architetturali, come CQRS o DDD, ovunque.</span><span class="sxs-lookup"><span data-stu-id="b6a46-139">Do not try to apply the same architectural patterns like CQRS or DDD everywhere.</span></span>

####  <a name="additional-resources"></a><span data-ttu-id="b6a46-140">Risorse aggiuntive</span><span class="sxs-lookup"><span data-stu-id="b6a46-140">Additional resources</span></span>

-   <span data-ttu-id="b6a46-141">**Martin Fowler. CQRS**
    [*https://martinfowler.com/bliki/CQRS.html*](https://martinfowler.com/bliki/CQRS.html)</span><span class="sxs-lookup"><span data-stu-id="b6a46-141">**Martin Fowler. CQRS**
[*https://martinfowler.com/bliki/CQRS.html*](https://martinfowler.com/bliki/CQRS.html)</span></span>

-   <span data-ttu-id="b6a46-142">**Greg Young. CQS e CQRS**
    [*http://codebetter.com/gregyoung/2009/08/13/command-query-separation/*](http://codebetter.com/gregyoung/2009/08/13/command-query-separation/)</span><span class="sxs-lookup"><span data-stu-id="b6a46-142">**Greg Young. CQS vs. CQRS**
[*http://codebetter.com/gregyoung/2009/08/13/command-query-separation/*](http://codebetter.com/gregyoung/2009/08/13/command-query-separation/)</span></span>

-   <span data-ttu-id="b6a46-143">**Greg Young. Documentazione per l'approccio CQRS**
    [*https://cqrs.files.wordpress.com/2010/11/cqrs\_documents.pdf*](https://cqrs.files.wordpress.com/2010/11/cqrs_documents.pdf)</span><span class="sxs-lookup"><span data-stu-id="b6a46-143">**Greg Young. CQRS Documents**
[*https://cqrs.files.wordpress.com/2010/11/cqrs\_documents.pdf*](https://cqrs.files.wordpress.com/2010/11/cqrs_documents.pdf)</span></span>

-   <span data-ttu-id="b6a46-144">**Greg Young. CQRS, Task Based UIs and Event Sourcing (CQRS, interfacce utente basate su attività ed Event Sourcing)**
    [*http://codebetter.com/gregyoung/2010/02/16/cqrs-task-based-uis-event-sourcing-agh/*](http://codebetter.com/gregyoung/2010/02/16/cqrs-task-based-uis-event-sourcing-agh/)</span><span class="sxs-lookup"><span data-stu-id="b6a46-144">**Greg Young. CQRS, Task Based UIs and Event Sourcing**
[*http://codebetter.com/gregyoung/2010/02/16/cqrs-task-based-uis-event-sourcing-agh/*](http://codebetter.com/gregyoung/2010/02/16/cqrs-task-based-uis-event-sourcing-agh/)</span></span>

-   <span data-ttu-id="b6a46-145">**Udi Dahan. Clarified CQRS**
    [*http://udidahan.com/2009/12/09/clarified-cqrs/*](http://udidahan.com/2009/12/09/clarified-cqrs/)</span><span class="sxs-lookup"><span data-stu-id="b6a46-145">**Udi Dahan. Clarified CQRS**
[*http://udidahan.com/2009/12/09/clarified-cqrs/*](http://udidahan.com/2009/12/09/clarified-cqrs/)</span></span>

-   <span data-ttu-id="b6a46-146">**CQRS**
    [*http://udidahan.com/2009/12/09/clarified-cqrs/*](http://udidahan.com/2009/12/09/clarified-cqrs/)</span><span class="sxs-lookup"><span data-stu-id="b6a46-146">**CQRS**
[*http://udidahan.com/2009/12/09/clarified-cqrs/*](http://udidahan.com/2009/12/09/clarified-cqrs/)</span></span>

-   <span data-ttu-id="b6a46-147">**Event-Sourcing (ES)**
    [*http://codebetter.com/gregyoung/2010/02/20/why-use-event-sourcing/*](http://codebetter.com/gregyoung/2010/02/20/why-use-event-sourcing/)</span><span class="sxs-lookup"><span data-stu-id="b6a46-147">**Event-Sourcing (ES)**
[*http://codebetter.com/gregyoung/2010/02/20/why-use-event-sourcing/*](http://codebetter.com/gregyoung/2010/02/20/why-use-event-sourcing/)</span></span>


>[!div class="step-by-step"]
<span data-ttu-id="b6a46-148">[Indietro] (apply-simplified-microservice-cqrs-ddd-patterns.md) [Avanti] (cqrs-microservice-reads.md)</span><span class="sxs-lookup"><span data-stu-id="b6a46-148">[Previous] (apply-simplified-microservice-cqrs-ddd-patterns.md) [Next] (cqrs-microservice-reads.md)</span></span>
