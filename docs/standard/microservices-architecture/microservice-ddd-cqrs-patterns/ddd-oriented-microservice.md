---
title: Progettazione di un microservizio orientata ai servizi DDD
description: Architettura di Microservizi .NET per le applicazioni nei contenitori .NET | Progettazione di un microservizio orientata ai servizi DDD
keywords: Docker, microservizi, ASP.NET, contenitore
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 05/26/2017
ms.prod: .net-core
ms.technology: dotnet-docker
ms.topic: article
ms.openlocfilehash: df45441089fd59d5e0e52b4bcec409adcc11fb71
ms.sourcegitcommit: bd1ef61f4bb794b25383d3d72e71041a5ced172e
ms.translationtype: HT
ms.contentlocale: it-IT
ms.lasthandoff: 10/18/2017
---
# <a name="designing-a-ddd-oriented-microservice"></a><span data-ttu-id="a42a6-104">Progettazione di un microservizio orientata ai servizi DDD</span><span class="sxs-lookup"><span data-stu-id="a42a6-104">Designing a DDD-oriented microservice</span></span>

<span data-ttu-id="a42a6-105">Progettazione basati su dominio (DDD) sostiene modellazione dipende in realtà di business come rilevanti per i casi di utilizzo.</span><span class="sxs-lookup"><span data-stu-id="a42a6-105">Domain-driven design (DDD) advocates modeling based on the reality of business as relevant to your use cases.</span></span> <span data-ttu-id="a42a6-106">Nel contesto di compilazione di applicazioni, DDD parla problemi come domini.</span><span class="sxs-lookup"><span data-stu-id="a42a6-106">In the context of building applications, DDD talks about problems as domains.</span></span> <span data-ttu-id="a42a6-107">Vengono descritti problemi indipendente come delimitata contesti (ogni contesto delimitata è correlata a un microservizio), evidenziare un linguaggio comune per comunicare su questi problemi.</span><span class="sxs-lookup"><span data-stu-id="a42a6-107">It describes independent problem areas as Bounded Contexts (each Bounded Context correlates to a microservice), and emphasizes a common language to talk about these problems.</span></span> <span data-ttu-id="a42a6-108">Si consiglia inoltre di numerosi concetti tecnici e i modelli, analogamente alle entità di dominio con i modelli avanzati (nessun [anemic dominio modello](https://martinfowler.com/bliki/AnemicDomainModel.html)), valore oggetti, le aggregazioni e radice di aggregazione (o entità radice), le regole per supportare l'implementazione interna.</span><span class="sxs-lookup"><span data-stu-id="a42a6-108">It also suggests many technical concepts and patterns, like domain entities with rich models (no [anemic-domain model](https://martinfowler.com/bliki/AnemicDomainModel.html)), value objects, aggregates and aggregate root (or root entity) rules to support the internal implementation.</span></span> <span data-ttu-id="a42a6-109">Questa sezione presenta la progettazione e implementazione di tali modelli interni.</span><span class="sxs-lookup"><span data-stu-id="a42a6-109">This section introduces the design and implementation of those internal patterns.</span></span>

<span data-ttu-id="a42a6-110">A volte queste regole tecniche DDD e modelli vengono considerati ostacoli che una curva di apprendimento profonda per l'implementazione DDD approcci.</span><span class="sxs-lookup"><span data-stu-id="a42a6-110">Sometimes these DDD technical rules and patterns are perceived as obstacles that have a steep learning curve for implementing DDD approaches.</span></span> <span data-ttu-id="a42a6-111">Ma la parte importante è non di modelli, ma organizzazione del codice in modo che sia allineato ai problemi aziendali e utilizzando gli stessi termini di business (linguaggio universale).</span><span class="sxs-lookup"><span data-stu-id="a42a6-111">But the important part is not the patterns themselves, but organizing the code so it is aligned to the business problems, and using the same business terms (ubiquitous language).</span></span> <span data-ttu-id="a42a6-112">Inoltre, gli approcci DDD devono essere applicati solo se si siano implementando microservizi complesso con regole di business significativo.</span><span class="sxs-lookup"><span data-stu-id="a42a6-112">In addition, DDD approaches should be applied only if you are implementing complex microservices with significant business rules.</span></span> <span data-ttu-id="a42a6-113">Responsabilità più semplice, come un servizio CRUD, possono essere gestite con gli approcci più semplici.</span><span class="sxs-lookup"><span data-stu-id="a42a6-113">Simpler responsibilities, like a CRUD service, can be managed with simpler approaches.</span></span>

<span data-ttu-id="a42a6-114">Punto in cui disegnare i limiti è l'attività chiave durante la progettazione e la definizione di un microservizio.</span><span class="sxs-lookup"><span data-stu-id="a42a6-114">Where to draw the boundaries is the key task when designing and defining a microservice.</span></span> <span data-ttu-id="a42a6-115">DDD criteri consentono di comprendere la complessità del dominio.</span><span class="sxs-lookup"><span data-stu-id="a42a6-115">DDD patterns help you understand the complexity in the domain.</span></span> <span data-ttu-id="a42a6-116">Per il modello di dominio per ogni contesto delimitata identificare e definire aggregazioni che il dominio del modello, entità e oggetti.</span><span class="sxs-lookup"><span data-stu-id="a42a6-116">For the domain model for each Bounded Context, you identify and define the entities, value objects, and aggregates that model your domain.</span></span> <span data-ttu-id="a42a6-117">Compilare e modificare un modello di dominio all'interno di un limite che definisce il contesto.</span><span class="sxs-lookup"><span data-stu-id="a42a6-117">You build and refine a domain model that is contained within a boundary that defines your context.</span></span> <span data-ttu-id="a42a6-118">E che è molto esplicite sotto forma di un microservizio.</span><span class="sxs-lookup"><span data-stu-id="a42a6-118">And that is very explicit in the form of a microservice.</span></span> <span data-ttu-id="a42a6-119">I componenti all'interno di tali limiti finire dal microservizi, anche se in alcuni casi un BC o microservizi business possono essere costituito da diversi servizi fisici.</span><span class="sxs-lookup"><span data-stu-id="a42a6-119">The components within those boundaries end up being your microservices, although in some cases a BC or business microservices can be composed of several physical services.</span></span> <span data-ttu-id="a42a6-120">DDD è sui limiti e quindi microservizi.</span><span class="sxs-lookup"><span data-stu-id="a42a6-120">DDD is about boundaries and so are microservices.</span></span>

## <a name="keep-the-microservice-context-boundaries-relatively-small"></a><span data-ttu-id="a42a6-121">Mantenere relativamente piccolo i limiti del contesto di microservizio</span><span class="sxs-lookup"><span data-stu-id="a42a6-121">Keep the microservice context boundaries relatively small</span></span>

<span data-ttu-id="a42a6-122">Determinare dove posizionare i confini tra contesti delimitata saldi due obiettivi principali concorrenti.</span><span class="sxs-lookup"><span data-stu-id="a42a6-122">Determining where to place boundaries between Bounded Contexts balances two competing goals.</span></span> <span data-ttu-id="a42a6-123">In primo luogo, si desidera creare inizialmente il più piccolo possibile microservizi, sebbene che non deve essere il driver principale; è necessario creare un limite attorno necessario coesione aspetti.</span><span class="sxs-lookup"><span data-stu-id="a42a6-123">First, you want to initially create the smallest possible microservices, although that should not be the main driver; you should create a boundary around things that need cohesion.</span></span> <span data-ttu-id="a42a6-124">In secondo luogo, si desidera evitare le comunicazioni "frammentate" tra microservizi.</span><span class="sxs-lookup"><span data-stu-id="a42a6-124">Second, you want to avoid chatty communications between microservices.</span></span> <span data-ttu-id="a42a6-125">Questi obiettivi possano che siano in contraddizione tra loro.</span><span class="sxs-lookup"><span data-stu-id="a42a6-125">These goals can contradict one another.</span></span> <span data-ttu-id="a42a6-126">È consigliabile valutare tali scomponendo il sistema in tanti microservizi piccoli possibile finché non vengono visualizzati i limiti di comunicazione in rapida crescita con ogni tentativo aggiuntiva per separare un nuovo contesto limitato.</span><span class="sxs-lookup"><span data-stu-id="a42a6-126">You should balance them by decomposing the system into as many small microservices as you can until you see communication boundaries growing quickly with each additional attempt to separate a new Bounded Context.</span></span> <span data-ttu-id="a42a6-127">Coesione è chiave all'interno di un solo contesto associato.</span><span class="sxs-lookup"><span data-stu-id="a42a6-127">Cohesion is key within a single bounded context.</span></span>

<span data-ttu-id="a42a6-128">È simile al [odore codice riservatezza inappropriato](https://sourcemaking.com/refactoring/smells/inappropriate-intimacy) nell'implementazione delle classi.</span><span class="sxs-lookup"><span data-stu-id="a42a6-128">It is similar to the [Inappropriate Intimacy code smell](https://sourcemaking.com/refactoring/smells/inappropriate-intimacy) when implementing classes.</span></span> <span data-ttu-id="a42a6-129">Se due microservizi necessario molto collaborano tra loro, dovrebbero essere probabilmente la stessa microservizio.</span><span class="sxs-lookup"><span data-stu-id="a42a6-129">If two microservices need to collaborate a lot with each other, they should probably be the same microservice.</span></span>

<span data-ttu-id="a42a6-130">A questo aspetto è autonomia.</span><span class="sxs-lookup"><span data-stu-id="a42a6-130">Another way to look at this is autonomy.</span></span> <span data-ttu-id="a42a6-131">Se un microservizio deve basarsi su un altro servizio per una richiesta di servizio direttamente, non è realmente autonomo.</span><span class="sxs-lookup"><span data-stu-id="a42a6-131">If a microservice must rely on another service to directly service a request, it is not truly autonomous.</span></span>

## <a name="layers-in-ddd-microservices"></a><span data-ttu-id="a42a6-132">Livelli DDD microservizi</span><span class="sxs-lookup"><span data-stu-id="a42a6-132">Layers in DDD microservices</span></span>

<span data-ttu-id="a42a6-133">La maggior parte delle applicazioni aziendali con business significativi e complessità tecnica sono definite da più livelli.</span><span class="sxs-lookup"><span data-stu-id="a42a6-133">Most enterprise applications with significant business and technical complexity are defined by multiple layers.</span></span> <span data-ttu-id="a42a6-134">I livelli sono un elemento logico e non sono correlati alla distribuzione del servizio.</span><span class="sxs-lookup"><span data-stu-id="a42a6-134">The layers are a logical artifact, and are not related to the deployment of the service.</span></span> <span data-ttu-id="a42a6-135">Essi consentono agli sviluppatori di gestire la complessità del codice.</span><span class="sxs-lookup"><span data-stu-id="a42a6-135">They exist to help developers manage the complexity in the code.</span></span> <span data-ttu-id="a42a6-136">Livelli diversi (ad esempio, il livello del modello di dominio e il livello di presentazione e così via) potrebbero essere tipi diversi, che impone l'utilizzo di conversioni tra questi tipi.</span><span class="sxs-lookup"><span data-stu-id="a42a6-136">Different layers (like the domain model layer versus the presentation layer, etc.) might have different types, which mandates translations between those types.</span></span>

<span data-ttu-id="a42a6-137">Ad esempio, è stato possibile caricare un'entità dal database.</span><span class="sxs-lookup"><span data-stu-id="a42a6-137">For example, an entity could be loaded from the database.</span></span> <span data-ttu-id="a42a6-138">Parte di tali informazioni o di un'aggregazione di informazioni tra i dati aggiuntivi da altre entità, possa quindi essere inviato al client dell'interfaccia utente mediante un'API Web REST.</span><span class="sxs-lookup"><span data-stu-id="a42a6-138">Then part of that information, or an aggregation of information including additional data from other entities, can be sent to the client UI through a REST Web API.</span></span> <span data-ttu-id="a42a6-139">Il punto è che l'entità di dominio è contenuto all'interno del livello di modello di dominio e non deve essere propagata ad altre aree che non appartiene a, ad esempio al livello di presentazione.</span><span class="sxs-lookup"><span data-stu-id="a42a6-139">The point here is that the domain entity is contained within the domain model layer and should not be propagated to other areas that it does not belong to, like to the presentation layer.</span></span>

<span data-ttu-id="a42a6-140">Inoltre, è necessario disporre sempre valido entità (vedere il [progettazione convalide nel livello del modello di dominio](#designing-validations-in-the-domain-model-layer) sezione) controllata da radici di aggregazione (entità radice).</span><span class="sxs-lookup"><span data-stu-id="a42a6-140">Additionally, you need to have always-valid entities (see the [Designing validations in the domain model layer](#designing-validations-in-the-domain-model-layer) section) controlled by aggregate roots (root entities).</span></span> <span data-ttu-id="a42a6-141">Pertanto, le entità non devono essere associate a viste di client, perché a livello di interfaccia utente alcuni dati potrebbero comunque non è possibile convalidare.</span><span class="sxs-lookup"><span data-stu-id="a42a6-141">Therefore, entities should not be bound to client views, because at the UI level some data might still not be validated.</span></span> <span data-ttu-id="a42a6-142">Questo è ciò che è il ViewModel per.</span><span class="sxs-lookup"><span data-stu-id="a42a6-142">This is what the ViewModel is for.</span></span> <span data-ttu-id="a42a6-143">L'elemento ViewModel è un modello di dati esclusivamente per i requisiti di livello presentazione.</span><span class="sxs-lookup"><span data-stu-id="a42a6-143">The ViewModel is a data model exclusively for presentation layer needs.</span></span> <span data-ttu-id="a42a6-144">Le entità di dominio non appartengono direttamente per l'elemento ViewModel.</span><span class="sxs-lookup"><span data-stu-id="a42a6-144">The domain entities do not belong directly to the ViewModel.</span></span> <span data-ttu-id="a42a6-145">In alternativa, è necessario convertire tra entità ViewModel e il dominio e viceversa.</span><span class="sxs-lookup"><span data-stu-id="a42a6-145">Instead, you need to translate between ViewModels and domain entities and vice versa.</span></span>

<span data-ttu-id="a42a6-146">Quando la complessità di gestione, è importante disporre di un modello di dominio controllato dall'aggregazione radici (si entra in questo in modo più dettagliato più avanti) che assicurarsi che tutte le invarianti e le regole relative al gruppo di entità (aggregazione) vengono eseguite tramite una singola voce il punto o controllo, la radice di aggregazione.</span><span class="sxs-lookup"><span data-stu-id="a42a6-146">When tackling complexity, it is important to have a domain model controlled by aggregate roots (we go into this in more detail later) that make sure that all the invariants and rules related to that group of entities (aggregate) are performed through a single entry point or gate, the aggregate root.</span></span>

<span data-ttu-id="a42a6-147">Nella figura 9-5 di seguito viene illustrata una progettazione a più livelli dell'applicazione eShopOnContainers.</span><span class="sxs-lookup"><span data-stu-id="a42a6-147">Figure 9-5 shows how a layered design is implemented in the eShopOnContainers application.</span></span>

![](./media/image6.png)

<span data-ttu-id="a42a6-148">**Nella figura 9-5**.</span><span class="sxs-lookup"><span data-stu-id="a42a6-148">**Figure 9-5**.</span></span> <span data-ttu-id="a42a6-149">Livelli DDD l'ordinamento microservizio in eShopOnContainers</span><span class="sxs-lookup"><span data-stu-id="a42a6-149">DDD layers in the ordering microservice in eShopOnContainers</span></span>

<span data-ttu-id="a42a6-150">Si desidera progettare il sistema in modo che ogni livello comunica solo con alcuni altri livelli.</span><span class="sxs-lookup"><span data-stu-id="a42a6-150">You want to design the system so that each layer communicates only with certain other layers.</span></span> <span data-ttu-id="a42a6-151">Che può risultare più semplice applicare in caso di livelli vengono implementati come librerie di classi diverse, in quanto è possibile identificare chiaramente quali le dipendenze siano impostate tra le librerie.</span><span class="sxs-lookup"><span data-stu-id="a42a6-151">That may be easier to enforce if layers are implemented as different class libraries, because you can clearly identify what dependencies are set between libraries.</span></span> <span data-ttu-id="a42a6-152">Ad esempio, il livello del modello di dominio non deve accettare una dipendenza su qualsiasi altro livello (le classi di modello di dominio devono essere Plain Old CLR Object, o [POCO](https://en.wikipedia.org/wiki/Plain_Old_CLR_Object), classi).</span><span class="sxs-lookup"><span data-stu-id="a42a6-152">For instance, the domain model layer should not take a dependency on any other layer (the domain model classes should be Plain Old CLR Objects, or [POCO](https://en.wikipedia.org/wiki/Plain_Old_CLR_Object), classes).</span></span> <span data-ttu-id="a42a6-153">Come illustrato nella figura 9-6, il **Ordering.Domain** libreria layer dipendenze solo nelle librerie di .NET Core, ma non su qualsiasi altra libreria personalizzata (raccolta di dati, libreria di persistenza e così via).</span><span class="sxs-lookup"><span data-stu-id="a42a6-153">As shown in Figure 9-6, the **Ordering.Domain** layer library has dependencies only on the .NET Core libraries but not on any other custom library (data library, persistence library, etc.).</span></span>

![](./media/image7.PNG)

<span data-ttu-id="a42a6-154">**Figura 9-6**.</span><span class="sxs-lookup"><span data-stu-id="a42a6-154">**Figure 9-6**.</span></span> <span data-ttu-id="a42a6-155">Implementato come librerie consentono un migliore controllo delle dipendenze tra i livelli di livelli</span><span class="sxs-lookup"><span data-stu-id="a42a6-155">Layers implemented as libraries allow better control of dependencies between layers</span></span>

### <a name="the-domain-model-layer"></a><span data-ttu-id="a42a6-156">Il livello del modello di dominio</span><span class="sxs-lookup"><span data-stu-id="a42a6-156">The domain model layer</span></span>

<span data-ttu-id="a42a6-157">Libro eccellente di Eric Evans [progettazione basata su domini](http://domainlanguage.com/ddd/) il messaggio seguente sul livello del modello di dominio e il livello di applicazione.</span><span class="sxs-lookup"><span data-stu-id="a42a6-157">Eric Evans's excellent book [Domain Driven Design](http://domainlanguage.com/ddd/) says the following about the domain model layer and the application layer.</span></span>

<span data-ttu-id="a42a6-158">**Livello del modello di dominio**: responsabile per la rappresentazione di concetti di business, le informazioni sulla situazione aziendale e le regole di business.</span><span class="sxs-lookup"><span data-stu-id="a42a6-158">**Domain Model Layer**: Responsible for representing concepts of the business, information about the business situation, and business rules.</span></span> <span data-ttu-id="a42a6-159">Stato che riflette la situazione di business è controllato e usato in questo caso, anche se i dettagli tecnici di archiviare i dati vengono delegati all'infrastruttura.</span><span class="sxs-lookup"><span data-stu-id="a42a6-159">State that reflects the business situation is controlled and used here, even though the technical details of storing it are delegated to the infrastructure.</span></span> <span data-ttu-id="a42a6-160">Questo livello è il cuore del software di business.</span><span class="sxs-lookup"><span data-stu-id="a42a6-160">This layer is the heart of business software.</span></span>

<span data-ttu-id="a42a6-161">Il livello del modello di dominio è in cui viene espresso il business.</span><span class="sxs-lookup"><span data-stu-id="a42a6-161">The domain model layer is where the business is expressed.</span></span> <span data-ttu-id="a42a6-162">Quando si implementa un livello del modello di dominio microservizio in .NET, tale livello viene codificato come una libreria di classi con le entità di dominio che consentono di acquisire i dati più comportamento (metodi con logica).</span><span class="sxs-lookup"><span data-stu-id="a42a6-162">When you implement a microservice domain model layer in .NET, that layer is coded as a class library with the domain entities that capture data plus behavior (methods with logic).</span></span>

<span data-ttu-id="a42a6-163">Dopo il [mancato riconoscimento della persistenza](http://deviq.com/persistence-ignorance/) e [mancato riconoscimento di infrastruttura](https://ayende.com/blog/3137/infrastructure-ignorance) principi, questo livello completamente devono ignorare i dettagli di persistenza di dati.</span><span class="sxs-lookup"><span data-stu-id="a42a6-163">Following the [Persistence Ignorance](http://deviq.com/persistence-ignorance/) and the [Infrastructure Ignorance](https://ayende.com/blog/3137/infrastructure-ignorance) principles, this layer must completely ignore data persistence details.</span></span> <span data-ttu-id="a42a6-164">Queste operazioni di persistenza devono essere eseguite dal livello di infrastruttura.</span><span class="sxs-lookup"><span data-stu-id="a42a6-164">These persistence tasks should be performed by the infrastructure layer.</span></span> <span data-ttu-id="a42a6-165">Pertanto, questo livello non deve richiedere dipendenze dirette sull'infrastruttura, che significa che una regola importante è che le classi di entità del modello di dominio devono essere [POCO](https://en.wikipedia.org/wiki/Plain_Old_CLR_Object)s.</span><span class="sxs-lookup"><span data-stu-id="a42a6-165">Therefore, this layer should not take direct dependencies on the infrastructure, which means that an important rule is that your domain model entity classes should be [POCO](https://en.wikipedia.org/wiki/Plain_Old_CLR_Object)s.</span></span>

<span data-ttu-id="a42a6-166">Entità di dominio non deve essere qualsiasi dipendenza diretta (ad esempio, la derivazione da una classe di base) in qualsiasi framework di infrastruttura di accesso dati Entity Framework o NHibernate.</span><span class="sxs-lookup"><span data-stu-id="a42a6-166">Domain entities should not have any direct dependency (like deriving from a base class) on any data access infrastructure framework like Entity Framework or NHibernate.</span></span> <span data-ttu-id="a42a6-167">In teoria, le entità di dominio non devono derivare da o implementare qualsiasi tipo definito in qualsiasi framework di infrastruttura.</span><span class="sxs-lookup"><span data-stu-id="a42a6-167">Ideally, your domain entities should not derive from or implement any type defined in any infrastructure framework.</span></span>

<span data-ttu-id="a42a6-168">Framework più recenti di ORM come Entity Framework Core consente questo approccio, in modo che le classi di modello di dominio non sono collegate all'infrastruttura.</span><span class="sxs-lookup"><span data-stu-id="a42a6-168">Most modern ORM frameworks like Entity Framework Core allow this approach, so that your domain model classes are not coupled to the infrastructure.</span></span> <span data-ttu-id="a42a6-169">Tuttavia, con le entità POCO non è sempre possibile quando si utilizzano determinati database NoSQL e Framework, come gli attori e le raccolte affidabile in Azure Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="a42a6-169">However, having POCO entities is not always possible when using certain NoSQL databases and frameworks, like Actors and Reliable Collections in Azure Service Fabric.</span></span>

<span data-ttu-id="a42a6-170">Anche quando è importante seguire il principio di mancato riconoscimento della persistenza è modello di dominio, non è consigliabile ignorare i problemi di persistenza.</span><span class="sxs-lookup"><span data-stu-id="a42a6-170">Even when it is important to follow the Persistence Ignorance principle for you Domain model, you should not ignore persistence concerns.</span></span> <span data-ttu-id="a42a6-171">È comunque importante comprendere il modello di dati fisici e come viene eseguito il mapping del modello a oggetti entità.</span><span class="sxs-lookup"><span data-stu-id="a42a6-171">It is still very important to understand the physical data model and how it maps to your entity object model.</span></span> <span data-ttu-id="a42a6-172">In caso contrario è possibile creare progettazioni Impossibile.</span><span class="sxs-lookup"><span data-stu-id="a42a6-172">Otherwise you can create impossible designs.</span></span>

<span data-ttu-id="a42a6-173">Inoltre, questo non significa è possibile richiedere un modello progettato per un database relazionale e spostarlo direttamente al database orientato ai documenti o NoSQL.</span><span class="sxs-lookup"><span data-stu-id="a42a6-173">Also, this does not mean you can take a model designed for a relational database and directly move it to a NoSQL or document-oriented database.</span></span> <span data-ttu-id="a42a6-174">In alcuni modelli di entità, potrebbe essere adatta il modello, ma in genere non è presente.</span><span class="sxs-lookup"><span data-stu-id="a42a6-174">In some entity models, the model might fit, but usually it does not.</span></span> <span data-ttu-id="a42a6-175">I vincoli che il modello di entità deve essere conformi alle, basata sulla tecnologia di archiviazione e la tecnologia ORM sono ancora presenti.</span><span class="sxs-lookup"><span data-stu-id="a42a6-175">There are still constraints that your entity model must adhere to, based both on the storage technology and ORM technology.</span></span>

### <a name="the-application-layer"></a><span data-ttu-id="a42a6-176">Il livello di applicazione</span><span class="sxs-lookup"><span data-stu-id="a42a6-176">The application layer</span></span>

<span data-ttu-id="a42a6-177">Passare al livello dell'applicazione, è possibile riportare nuovamente Rubrica di Eric Evans [progettazione basata su domini](http://domainlanguage.com/ddd/):</span><span class="sxs-lookup"><span data-stu-id="a42a6-177">Moving on to the application layer, we can again cite Eric Evans's book [Domain Driven Design](http://domainlanguage.com/ddd/):</span></span>

<span data-ttu-id="a42a6-178">**Livello di applicazione:** definisce i processi, il software dovrà per eseguire e ti indica gli oggetti dominio espressivo tenta di risolvere i problemi.</span><span class="sxs-lookup"><span data-stu-id="a42a6-178">**Application Layer:** Defines the jobs the software is supposed to do and directs the expressive domain objects to work out problems.</span></span> <span data-ttu-id="a42a6-179">Le attività che è responsabile per questo livello sono significative all'azienda o necessarie per l'interazione con i livelli di applicazione di altri sistemi.</span><span class="sxs-lookup"><span data-stu-id="a42a6-179">The tasks this layer is responsible for are meaningful to the business or necessary for interaction with the application layers of other systems.</span></span> <span data-ttu-id="a42a6-180">Questo livello viene mantenuto thin.</span><span class="sxs-lookup"><span data-stu-id="a42a6-180">This layer is kept thin.</span></span> <span data-ttu-id="a42a6-181">Non contiene regole business o Knowledge Base, ma solo i delegati e le coordinate attività lavoro collaborazioni di oggetti dominio nel livello successivo verso il basso.</span><span class="sxs-lookup"><span data-stu-id="a42a6-181">It does not contain business rules or knowledge, but only coordinates tasks and delegates work to collaborations of domain objects in the next layer down.</span></span> <span data-ttu-id="a42a6-182">Non è stato che riflettono la situazione di business, ma può avere lo stato che riflette lo stato di avanzamento di un'attività per l'utente o il programma.</span><span class="sxs-lookup"><span data-stu-id="a42a6-182">It does not have state reflecting the business situation, but it can have state that reflects the progress of a task for the user or the program.</span></span>

<span data-ttu-id="a42a6-183">Livello di applicazione di un microservizio in .NET in genere viene codificato come un progetto di API Web di ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="a42a6-183">A microservice’s application layer in .NET is commonly coded as an ASP.NET Core Web API project.</span></span> <span data-ttu-id="a42a6-184">Il progetto implementa l'interazione del microservizio, accesso remoto alla rete e le API Web esterni utilizzati dalle App client o dell'interfaccia utente.</span><span class="sxs-lookup"><span data-stu-id="a42a6-184">The project implements the microservice’s interaction, remote network access, and the external Web APIs used from the UI or client apps.</span></span> <span data-ttu-id="a42a6-185">Include le query se utilizzando un CQRS approccio comandi accettati, in quanto il microservizio anche la comunicazione tra microservizi (eventi di integrazione) basato su eventi.</span><span class="sxs-lookup"><span data-stu-id="a42a6-185">It includes queries if using a CQRS approach, commands accepted by the microservice, and even the event-driven communication between microservices (integration events).</span></span> <span data-ttu-id="a42a6-186">L'API Web di ASP.NET Core che rappresenta il livello di applicazione non può contenere regole business o le informazioni di dominio (in particolare regole di dominio per le transazioni o aggiornamenti); questi devono essere di proprietà dalla libreria di classi di modello di dominio.</span><span class="sxs-lookup"><span data-stu-id="a42a6-186">The ASP.NET Core Web API that represents the application layer must not contain business rules or domain knowledge (especially domain rules for transactions or updates); these should be owned by the domain model class library.</span></span> <span data-ttu-id="a42a6-187">La coordinata di applicazione livello deve solo attività e non deve contenere o definire uno stato di dominio (modello di dominio).</span><span class="sxs-lookup"><span data-stu-id="a42a6-187">The application layer must only coordinate tasks and must not hold or define any domain state (domain model).</span></span> <span data-ttu-id="a42a6-188">Delega l'esecuzione delle regole di business per le classi di modello dominio stessi (radici di aggregazione e le entità di dominio), che in ultima analisi per aggiornare i dati all'interno di tali entità di dominio.</span><span class="sxs-lookup"><span data-stu-id="a42a6-188">It delegates the execution of business rules to the domain model classes themselves (aggregate roots and domain entities), which will ultimately update the data within those domain entities.</span></span>

<span data-ttu-id="a42a6-189">In pratica, la logica dell'applicazione è in cui si implementano tutti i casi di utilizzo che dipendono da un front-end specificato.</span><span class="sxs-lookup"><span data-stu-id="a42a6-189">Basically, the application logic is where you implement all use cases that depend on a given front end.</span></span> <span data-ttu-id="a42a6-190">Ad esempio, l'implementazione relative a un servizio Web API.</span><span class="sxs-lookup"><span data-stu-id="a42a6-190">For example, the implementation related to a Web API service.</span></span>

<span data-ttu-id="a42a6-191">L'obiettivo consiste nel fatto che la logica di dominio nel livello del modello di dominio, relativo invarianti, il modello di dati e regole business correlati deve essere completamente indipendente dai livelli presentazione e l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="a42a6-191">The goal is that the domain logic in the domain model layer, its invariants, the data model, and related business rules must be completely independent from the presentation and application layers.</span></span> <span data-ttu-id="a42a6-192">Per lo più, il livello del modello di dominio non direttamente dipendano qualsiasi framework di infrastruttura.</span><span class="sxs-lookup"><span data-stu-id="a42a6-192">Most of all, the domain model layer must not directly depend on any infrastructure framework.</span></span>

### <a name="the-infrastructure-layer"></a><span data-ttu-id="a42a6-193">Il livello infrastruttura</span><span class="sxs-lookup"><span data-stu-id="a42a6-193">The infrastructure layer</span></span>

<span data-ttu-id="a42a6-194">Il livello di infrastruttura è la modalità con cui i dati inizialmente contenuta in entità di dominio (in memoria) sono persistenti nel database o un altro archivio persistente.</span><span class="sxs-lookup"><span data-stu-id="a42a6-194">The infrastructure layer is how the data that is initially held in domain entities (in memory) is persisted in databases or another persistent store.</span></span> <span data-ttu-id="a42a6-195">Un esempio Usa codice di Entity Framework Core per implementare le classi di modello di Repository che usano un elemento DBContext per mantenere i dati in un database relazionale.</span><span class="sxs-lookup"><span data-stu-id="a42a6-195">An example is using Entity Framework Core code to implement the Repository pattern classes that use a DBContext to persist data in a relational database.</span></span>

<span data-ttu-id="a42a6-196">In base alle indicati in precedenza [mancato riconoscimento della persistenza](http://deviq.com/persistence-ignorance/) e [mancato riconoscimento di infrastruttura](https://ayende.com/blog/3137/infrastructure-ignorance) principi, il livello di infrastruttura necessario non "danneggiare" livello del modello di dominio.</span><span class="sxs-lookup"><span data-stu-id="a42a6-196">In accordance with the previously mentioned [Persistence Ignorance](http://deviq.com/persistence-ignorance/) and [Infrastructure Ignorance](https://ayende.com/blog/3137/infrastructure-ignorance) principles, the infrastructure layer must not “contaminate” the domain model layer.</span></span> <span data-ttu-id="a42a6-197">È necessario mantenere indipendente dal classi entità di modello di dominio dall'infrastruttura che consente di rendere persistenti i dati (Entity Framework o qualsiasi altro framework) effettuando non dipendenze rigide su Framework.</span><span class="sxs-lookup"><span data-stu-id="a42a6-197">You must keep the domain model entity classes agnostic from the infrastructure that you use to persist data (EF or any other framework) by not taking hard dependencies on frameworks.</span></span> <span data-ttu-id="a42a6-198">La libreria di classi livello di modello di dominio deve avere solo il codice di dominio appena [POCO](https://en.wikipedia.org/wiki/Plain_Old_CLR_Object) entità le classi che implementano il cuore del software e completamente separata delle tecnologie di infrastruttura.</span><span class="sxs-lookup"><span data-stu-id="a42a6-198">Your domain model layer class library should have only your domain code, just [POCO](https://en.wikipedia.org/wiki/Plain_Old_CLR_Object) entity classes implementing the heart of your software and completely decoupled from infrastructure technologies.</span></span>

<span data-ttu-id="a42a6-199">Di conseguenza, i livelli o le librerie di classi e i progetti devono dipenderà dal livello del modello di dominio (libreria), non viceversa, come illustrato nella figura 9-7.</span><span class="sxs-lookup"><span data-stu-id="a42a6-199">Thus, your layers or class libraries and projects should ultimately depend on your domain model layer (library), not vice versa, as shown in Figure 9-7.</span></span>

![](./media/image8.png)

<span data-ttu-id="a42a6-200">**Figura 9-7**.</span><span class="sxs-lookup"><span data-stu-id="a42a6-200">**Figure 9-7**.</span></span> <span data-ttu-id="a42a6-201">Dipendenze tra i livelli DDD</span><span class="sxs-lookup"><span data-stu-id="a42a6-201">Dependencies between layers in DDD</span></span>

<span data-ttu-id="a42a6-202">Questa struttura di livello deve essere indipendente per ogni microservizio.</span><span class="sxs-lookup"><span data-stu-id="a42a6-202">This layer design should be independent for each microservice.</span></span> <span data-ttu-id="a42a6-203">Come notato in precedenza, è possibile implementare il microservizi più complesso seguente modelli DDD, durante l'implementazione più semplice basato sui dati microservizi (CRUD semplice in un unico livello) in modo più semplice.</span><span class="sxs-lookup"><span data-stu-id="a42a6-203">As noted earlier, you can implement the most complex microservices following DDD patterns, while implementing simpler data-driven microservices (simple CRUD in a single layer) in a simpler way.</span></span>

#### <a name="additional-resources"></a><span data-ttu-id="a42a6-204">Risorse aggiuntive</span><span class="sxs-lookup"><span data-stu-id="a42a6-204">Additional resources</span></span>

-   <span data-ttu-id="a42a6-205">**DevIQ. Il principio di mancato riconoscimento della persistenza**
    [*http://deviq.com/persistence-ignorance/*](http://deviq.com/persistence-ignorance/)</span><span class="sxs-lookup"><span data-stu-id="a42a6-205">**DevIQ. Persistence Ignorance principle**
[*http://deviq.com/persistence-ignorance/*](http://deviq.com/persistence-ignorance/)</span></span>

-   <span data-ttu-id="a42a6-206">**Dichiarato Oren Eini. Possibilità di infrastruttura**
    [*https://ayende.com/blog/3137/infrastructure-ignorance*](https://ayende.com/blog/3137/infrastructure-ignorance)</span><span class="sxs-lookup"><span data-stu-id="a42a6-206">**Oren Eini. Infrastructure Ignorance**
[*https://ayende.com/blog/3137/infrastructure-ignorance*](https://ayende.com/blog/3137/infrastructure-ignorance)</span></span>

-   <span data-ttu-id="a42a6-207">**Angelo Lopez. A più livelli di architettura basati su dominio progettazione**
    [*https://ajlopez.wordpress.com/2008/09/12/layered-architecture-in-domain-driven-design/*](https://ajlopez.wordpress.com/2008/09/12/layered-architecture-in-domain-driven-design/)</span><span class="sxs-lookup"><span data-stu-id="a42a6-207">**Angel Lopez. Layered Architecture In Domain-Driven Design**
[*https://ajlopez.wordpress.com/2008/09/12/layered-architecture-in-domain-driven-design/*](https://ajlopez.wordpress.com/2008/09/12/layered-architecture-in-domain-driven-design/)</span></span>


>[!div class="step-by-step"]
<span data-ttu-id="a42a6-208">[Precedente] (cqrs-microservizio-reads.md) [Avanti] (microservizio-dominio-model.md)</span><span class="sxs-lookup"><span data-stu-id="a42a6-208">[Previous] (cqrs-microservice-reads.md) [Next] (microservice-domain-model.md)</span></span>
