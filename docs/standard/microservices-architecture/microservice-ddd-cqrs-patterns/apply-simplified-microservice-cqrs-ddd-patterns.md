---
title: L'applicazione di modelli CQRS e DDD semplificate in un microservizio.
description: Architettura di Microservizi .NET per le applicazioni nei contenitori .NET | L'applicazione di modelli CQRS e DDD semplificate in un microservizio.
keywords: Docker, microservizi, ASP.NET, contenitore
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 05/26/2017
ms.prod: .net-core
ms.technology: dotnet-docker
ms.topic: article
ms.openlocfilehash: 99fd7ce32039742e23f8e01aa4c33cddd7a9f698
ms.sourcegitcommit: bd1ef61f4bb794b25383d3d72e71041a5ced172e
ms.translationtype: HT
ms.contentlocale: it-IT
ms.lasthandoff: 10/18/2017
---
# <a name="applying-simplified-cqrs-and-ddd-patterns-in-a-microservice"></a><span data-ttu-id="5ebaf-104">L'applicazione di modelli CQRS e DDD semplificate in un microservizio.</span><span class="sxs-lookup"><span data-stu-id="5ebaf-104">Applying simplified CQRS and DDD patterns in a microservice</span></span>

<span data-ttu-id="5ebaf-105">CQRS è un modello architetturale che separa i modelli per la lettura e scrittura dei dati.</span><span class="sxs-lookup"><span data-stu-id="5ebaf-105">CQRS is an architectural pattern that separates the models for reading and writing data.</span></span> <span data-ttu-id="5ebaf-106">Il termine correlato [comando Query separazione (CQS)](https://martinfowler.com/bliki/CommandQuerySeparation.html) è stato originariamente definito da Bertrand Meyer nel suo libro *la costruzione dell'oggetto orientato alla Software*.</span><span class="sxs-lookup"><span data-stu-id="5ebaf-106">The related term [Command Query Separation (CQS)](https://martinfowler.com/bliki/CommandQuerySeparation.html) was originally defined by Bertrand Meyer in his book *Object Oriented Software Construction*.</span></span> <span data-ttu-id="5ebaf-107">L'idea di base è che è possibile dividere le operazioni del sistema in due categorie nettamente separate:</span><span class="sxs-lookup"><span data-stu-id="5ebaf-107">The basic idea is that you can divide a system’s operations into two sharply separated categories:</span></span>

-   <span data-ttu-id="5ebaf-108">Esegue una query.</span><span class="sxs-lookup"><span data-stu-id="5ebaf-108">Queries.</span></span> <span data-ttu-id="5ebaf-109">Questi restituiscono un risultato e non modificare lo stato del sistema e che sono liberi di effetti collaterali.</span><span class="sxs-lookup"><span data-stu-id="5ebaf-109">These return a result and do not change the state of the system, and they are free of side effects.</span></span>

-   <span data-ttu-id="5ebaf-110">I comandi.</span><span class="sxs-lookup"><span data-stu-id="5ebaf-110">Commands.</span></span> <span data-ttu-id="5ebaf-111">Questi modificare lo stato di un sistema.</span><span class="sxs-lookup"><span data-stu-id="5ebaf-111">These change the state of a system.</span></span>

<span data-ttu-id="5ebaf-112">CQS è un concetto semplice, ovvero è sui metodi all'interno dell'oggetto stesso da query o comandi.</span><span class="sxs-lookup"><span data-stu-id="5ebaf-112">CQS is a simple concept—it is about methods within the same object being either queries or commands.</span></span> <span data-ttu-id="5ebaf-113">Ogni metodo restituisce lo stato oppure viene modificato lo stato, ma non entrambi.</span><span class="sxs-lookup"><span data-stu-id="5ebaf-113">Each method either returns state or mutates state, but not both.</span></span> <span data-ttu-id="5ebaf-114">Anche un oggetto modello di repository singolo può essere conformi con CQS.</span><span class="sxs-lookup"><span data-stu-id="5ebaf-114">Even a single repository pattern object can comply with CQS.</span></span> <span data-ttu-id="5ebaf-115">CQS può essere considerato un principio fondamentale di CQRS.</span><span class="sxs-lookup"><span data-stu-id="5ebaf-115">CQS can be considered a foundational principle for CQRS.</span></span>

<span data-ttu-id="5ebaf-116">[Comando e Query Responsibility Segregation (CQRS)](https://martinfowler.com/bliki/CQRS.html) introdotto da Greg Young e fortemente innalzata di livello dal Udi Dahan e altri.</span><span class="sxs-lookup"><span data-stu-id="5ebaf-116">[Command and Query Responsibility Segregation (CQRS)](https://martinfowler.com/bliki/CQRS.html) was introduced by Greg Young and strongly promoted by Udi Dahan and others.</span></span> <span data-ttu-id="5ebaf-117">È basato sul principio CQS, sebbene più dettagliata.</span><span class="sxs-lookup"><span data-stu-id="5ebaf-117">It is based on the CQS principle, although it is more detailed.</span></span> <span data-ttu-id="5ebaf-118">Può essere considerato un modello basato sui comandi e gli eventi e facoltativamente nei messaggi asincroni.</span><span class="sxs-lookup"><span data-stu-id="5ebaf-118">It can be considered a pattern based on commands and events plus optionally on asynchronous messages.</span></span> <span data-ttu-id="5ebaf-119">In molti casi, CQRS è correlata a scenari più avanzati, ad esempio disporre di un database diverso per operazioni di lettura (query) anziché per operazioni di scrittura (aggiornamenti).</span><span class="sxs-lookup"><span data-stu-id="5ebaf-119">In many cases, CQRS is related to more advanced scenarios, like having a different physical database for reads (queries) than for writes (updates).</span></span> <span data-ttu-id="5ebaf-120">Inoltre, è possibile implementare un sistema CQRS più evoluto [evento-Sourcing (ES)](http://codebetter.com/gregyoung/2010/02/20/why-use-event-sourcing/) per il database di aggiornamenti, pertanto è sarebbe archiviare solo gli eventi nel modello di dominio anziché archiviare i dati dello stato corrente.</span><span class="sxs-lookup"><span data-stu-id="5ebaf-120">Moreover, a more evolved CQRS system might implement [Event-Sourcing (ES)](http://codebetter.com/gregyoung/2010/02/20/why-use-event-sourcing/) for your updates database, so you would only store events in the domain model instead of storing the current-state data.</span></span> <span data-ttu-id="5ebaf-121">Tuttavia, non si tratta dell'approccio utilizzato in questa Guida. viene usato l'approccio più semplice CQRS, che include solo le query la separazione dei comandi.</span><span class="sxs-lookup"><span data-stu-id="5ebaf-121">However, this is not the approach used in this guide; we are using the simplest CQRS approach, which consists of just separating the queries from the commands.</span></span>

<span data-ttu-id="5ebaf-122">L'aspetto di separazione di CQRS avviene mediante il raggruppamento di operazioni di query in un livello e i comandi in un altro livello.</span><span class="sxs-lookup"><span data-stu-id="5ebaf-122">The separation aspect of CQRS is achieved by grouping query operations in one layer and commands in another layer.</span></span> <span data-ttu-id="5ebaf-123">Ogni livello è presente un modello di dati (si noti che è ad esempio modello, non necessariamente un database diverso) e viene compilato utilizzando il proprio combinazione di modelli e le tecnologie.</span><span class="sxs-lookup"><span data-stu-id="5ebaf-123">Each layer has its own data model (note that we say model, not necessarily a different database) and is built using its own combination of patterns and technologies.</span></span> <span data-ttu-id="5ebaf-124">Ancora più importante, i due livelli possono essere entro lo stesso livello o microservizio, come illustrato nell'esempio (ordinamento microservizio) utilizzato per questa Guida.</span><span class="sxs-lookup"><span data-stu-id="5ebaf-124">More importantly, the two layers can be within the same tier or microservice, as in the example (ordering microservice) used for this guide.</span></span> <span data-ttu-id="5ebaf-125">O potrebbe essere implementati in diversi microservizi o processi in modo ottimizzati e scalabilità separatamente senza influire su un altro.</span><span class="sxs-lookup"><span data-stu-id="5ebaf-125">Or they could be implemented on different microservices or processes so they can be optimized and scaled out separately without affecting one another.</span></span>

<span data-ttu-id="5ebaf-126">CQRS, significa creare due oggetti per un'operazione di lettura/scrittura in cui in altri contesti è presente.</span><span class="sxs-lookup"><span data-stu-id="5ebaf-126">CQRS means having two objects for a read/write operation where in other contexts there is one.</span></span> <span data-ttu-id="5ebaf-127">Esistono motivi per cui dispone di un database denormalizzato letture, che è possibile acquisire informazioni nella documentazione CQRS più avanzata.</span><span class="sxs-lookup"><span data-stu-id="5ebaf-127">There are reasons to have a denormalized reads database, which you can learn about in more advanced CQRS literature.</span></span> <span data-ttu-id="5ebaf-128">Ma non vengono utilizzati in questo caso, un approccio in cui l'obiettivo è per una maggiore flessibilità nelle query invece di limitare le query con vincoli dai modelli DDD come funzioni di aggregazione.</span><span class="sxs-lookup"><span data-stu-id="5ebaf-128">But we are not using that approach here, where the goal is to have more flexibility in the queries instead of limiting the queries with constraints from DDD patterns like aggregates.</span></span>

<span data-ttu-id="5ebaf-129">Un esempio di questo tipo di servizio è l'ordinamento microservizio dall'applicazione di riferimento eShopOnContainers.</span><span class="sxs-lookup"><span data-stu-id="5ebaf-129">An example of this kind of service is the ordering microservice from the eShopOnContainers reference application.</span></span> <span data-ttu-id="5ebaf-130">Il servizio implementa un microservizio in base a un approccio CQRS semplificato.</span><span class="sxs-lookup"><span data-stu-id="5ebaf-130">This service implements a microservice based on a simplified CQRS approach.</span></span> <span data-ttu-id="5ebaf-131">Usa una singola origine dati o database, ma due modelli logici più modelli DDD per il dominio transazionale, come illustrato nella figura 9-2.</span><span class="sxs-lookup"><span data-stu-id="5ebaf-131">It uses a single data source or database, but two logical models plus DDD patterns for the transactional domain, as shown in Figure 9-2.</span></span>

![](./media/image2.png)

<span data-ttu-id="5ebaf-132">**Figura 9-2**.</span><span class="sxs-lookup"><span data-stu-id="5ebaf-132">**Figure 9-2**.</span></span> <span data-ttu-id="5ebaf-133">Semplificato basato su CQRS e DDD microservizio</span><span class="sxs-lookup"><span data-stu-id="5ebaf-133">Simplified CQRS- and DDD-based microservice</span></span>

<span data-ttu-id="5ebaf-134">Il livello di applicazione può essere la stessa interfaccia API di Web.</span><span class="sxs-lookup"><span data-stu-id="5ebaf-134">The application layer can be the Web API itself.</span></span> <span data-ttu-id="5ebaf-135">In questo caso l'aspetto importante è che il microservizio è suddiviso le query e ViewModel (modelli di data particolare creati per le applicazioni client) dal modello di dominio, i comandi e le transazioni in cui il modello CQRS.</span><span class="sxs-lookup"><span data-stu-id="5ebaf-135">The important design aspect here is that the microservice has split the queries and ViewModels (data models especially created for the client applications) from the commands, domain model, and transactions following the CQRS pattern.</span></span> <span data-ttu-id="5ebaf-136">Questo approccio consente di mantenere le query indipendente da restrizioni e i vincoli provenienti da modelli DDD che servono esclusivamente per transazioni e gli aggiornamenti, come illustrato nelle sezioni successive.</span><span class="sxs-lookup"><span data-stu-id="5ebaf-136">This approach keeps the queries independent from restrictions and constraints coming from DDD patterns that only make sense for transactions and updates, as explained in later sections.</span></span>


>[!div class="step-by-step"]
<span data-ttu-id="5ebaf-137">[Precedente] [Avanti] (eshoponcontainers cqrs-ggg microservice.md) (index.md)</span><span class="sxs-lookup"><span data-stu-id="5ebaf-137">[Previous] (index.md) [Next] (eshoponcontainers-cqrs-ddd-microservice.md)</span></span>
