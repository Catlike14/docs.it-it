---
title: Problemi e soluzioni per la gestione dei dati distribuiti
description: Architettura di microservizi .NET per applicazioni .NET in contenitori | Problemi e soluzioni per la gestione dei dati distribuiti
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 05/26/2017
ms.openlocfilehash: 7d173133ab7c803c7ab48b39c50b02ee4f3b1721
ms.sourcegitcommit: 3d5d33f384eeba41b2dff79d096f47ccc8d8f03d
ms.translationtype: HT
ms.contentlocale: it-IT
ms.lasthandoff: 05/04/2018
ms.locfileid: "33578937"
---
# <a name="challenges-and-solutions-for-distributed-data-management"></a><span data-ttu-id="92a43-103">Problemi e soluzioni per la gestione dei dati distribuiti</span><span class="sxs-lookup"><span data-stu-id="92a43-103">Challenges and solutions for distributed data management</span></span>

## <a name="challenge-1-how-to-define-the-boundaries-of-each-microservice"></a><span data-ttu-id="92a43-104">Problema \#1: Come definire i limiti di ogni microservizio</span><span class="sxs-lookup"><span data-stu-id="92a43-104">Challenge \#1: How to define the boundaries of each microservice</span></span>

<span data-ttu-id="92a43-105">La definizione dei limiti dei microservizi è probabilmente il primo problema riscontrato da tutti gli utenti.</span><span class="sxs-lookup"><span data-stu-id="92a43-105">Defining microservice boundaries is probably the first challenge anyone encounters.</span></span> <span data-ttu-id="92a43-106">Ogni microservizio deve infatti essere un componente dell'applicazione pur rimanendo autonomo, con tutti i vantaggi e problemi che questo comporta.</span><span class="sxs-lookup"><span data-stu-id="92a43-106">Each microservice has to be a piece of your application and each microservice should be autonomous with all the benefits and challenges that it conveys.</span></span> <span data-ttu-id="92a43-107">Ma come è possibile identificare questi limiti?</span><span class="sxs-lookup"><span data-stu-id="92a43-107">But how do you identify those boundaries?</span></span>

<span data-ttu-id="92a43-108">In primo luogo, è necessario concentrare l'attenzione sui modelli di dominio logici dell'applicazione e sui dati correlati.</span><span class="sxs-lookup"><span data-stu-id="92a43-108">First, you need to focus on the application’s logical domain models and related data.</span></span> <span data-ttu-id="92a43-109">È necessario provare a individuare isole scollegate di dati e contesti diversi all'interno della stessa applicazione.</span><span class="sxs-lookup"><span data-stu-id="92a43-109">You must try to identify decoupled islands of data and different contexts within the same application.</span></span> <span data-ttu-id="92a43-110">Ogni contesto potrebbe essere caratterizzato da un linguaggio aziendale diverso, ovvero termini aziendali diversi.</span><span class="sxs-lookup"><span data-stu-id="92a43-110">Each context could have a different business language (different business terms).</span></span> <span data-ttu-id="92a43-111">I contesti devono quindi essere definiti e gestiti in modo indipendente.</span><span class="sxs-lookup"><span data-stu-id="92a43-111">The contexts should be defined and managed independently.</span></span> <span data-ttu-id="92a43-112">I termini e le entità usati in questi contesti diversi potrebbero sembrare simili, ma potrebbe capitare che in un determinato contesto un concetto aziendale in un contesto venga usato per uno scopo diverso in un altro contesto e persino essere caratterizzato da un nome diverso.</span><span class="sxs-lookup"><span data-stu-id="92a43-112">The terms and entities used in those different contexts might sound similar, but you might discover that in a particular context, a business concept with one is used for a different purpose in another context, and might even have a different name.</span></span> <span data-ttu-id="92a43-113">È ad esempio possibile che si faccia riferimento al concetto di utente come utente in un contesto di identità o appartenenza, come cliente in un contesto CRM, come acquirente in un contesto di creazione ordini e così via.</span><span class="sxs-lookup"><span data-stu-id="92a43-113">For instance, a user can be referred as a user in the identity or membership context, as a customer in a CRM context, as a buyer in an ordering context, and so forth.</span></span>

<span data-ttu-id="92a43-114">Il modo in cui vengono identificati i limiti tra più contesti dell'applicazione con un dominio diverso per ogni contesto coincide con la modalità di identificazione dei limiti per ogni microservizio business e i relativi dati e modelli di dominio correlati.</span><span class="sxs-lookup"><span data-stu-id="92a43-114">The way you identify boundaries between multiple application contexts with a different domain for each context is exactly how you can identify the boundaries for each business microservice and its related domain model and data.</span></span> <span data-ttu-id="92a43-115">Si prova sempre a ridurre al minimo l'accoppiamento tra tali microservizi.</span><span class="sxs-lookup"><span data-stu-id="92a43-115">You always attempt to minimize the coupling between those microservices.</span></span> <span data-ttu-id="92a43-116">Questa guida approfondisce la struttura di questo modello di dominio e identificazione più avanti, nella sezione [Identificazione dei limiti del modello di dominio per ogni microservizio](#identifying-domain-model-boundaries-for-each-microservice).</span><span class="sxs-lookup"><span data-stu-id="92a43-116">This guide goes into more detail about this identification and domain model design in the section [Identifying domain-model boundaries for each microservice](#identifying-domain-model-boundaries-for-each-microservice) later.</span></span>

## <a name="challenge-2-how-to-create-queries-that-retrieve-data-from-several-microservices"></a><span data-ttu-id="92a43-117">Problema \#2: Come creare query che recuperano dati da più microservizi</span><span class="sxs-lookup"><span data-stu-id="92a43-117">Challenge \#2: How to create queries that retrieve data from several microservices</span></span>

<span data-ttu-id="92a43-118">Il secondo problema si pone quando si tratta di implementare query che recuperano dati di più microservizi, evitando comunicazioni frammentate con i microservizi dalle app client remote.</span><span class="sxs-lookup"><span data-stu-id="92a43-118">A second challenge is how to implement queries that retrieve data from several microservices, while avoiding chatty communication to the microservices from remote client apps.</span></span> <span data-ttu-id="92a43-119">Un esempio può essere dato da una singola schermata di un'app per dispositivi mobili che deve mostrare all'utente le informazioni appartenenti ai microservizi del carrello, del catalogo e dell'identità utente.</span><span class="sxs-lookup"><span data-stu-id="92a43-119">An example could be a single screen from a mobile app that needs to show user information that is owned by the basket, catalog, and user identity microservices.</span></span> <span data-ttu-id="92a43-120">Un altro esempio è un report complesso che include molte tabelle distribuite in più microservizi.</span><span class="sxs-lookup"><span data-stu-id="92a43-120">Another example would be a complex report involving many tables located in multiple microservices.</span></span> <span data-ttu-id="92a43-121">La soluzione giusta dipende dalla complessità delle query.</span><span class="sxs-lookup"><span data-stu-id="92a43-121">The right solution depends on the complexity of the queries.</span></span> <span data-ttu-id="92a43-122">Ma in ogni caso, è necessario elaborare un modello per aggregare le informazioni se si vuole migliorare l'efficienza nelle comunicazioni del sistema.</span><span class="sxs-lookup"><span data-stu-id="92a43-122">But in any case, you will need a way to aggregate information if you want to improve the efficiency in the communications of your system.</span></span> <span data-ttu-id="92a43-123">Le soluzioni più comuni sono le seguenti.</span><span class="sxs-lookup"><span data-stu-id="92a43-123">The most popular solutions are the following.</span></span>

<span data-ttu-id="92a43-124">**API Gateway**.</span><span class="sxs-lookup"><span data-stu-id="92a43-124">**API Gateway**.</span></span> <span data-ttu-id="92a43-125">Per la semplice aggregazione di dati da più microservizi che sono proprietari di database diversi, l'approccio consigliato è un microservizio di aggregazione noto come API Gateway.</span><span class="sxs-lookup"><span data-stu-id="92a43-125">For simple data aggregation from multiple microservices that own different databases, the recommended approach is an aggregation microservice referred to as an API Gateway.</span></span> <span data-ttu-id="92a43-126">Bisogna però prestare attenzione implementare questo schema perché può diventare un collo di bottiglia nel sistema e violare il principio di autonomia dei microservizi.</span><span class="sxs-lookup"><span data-stu-id="92a43-126">However, you need to be careful about implementing this pattern, because it can be a choke point in your system, and it can violate the principle of microservice autonomy.</span></span> <span data-ttu-id="92a43-127">Per evitare questi inconvenienti, è possibile definire più schemi API Gateway specifici, ognuno dei quali incentrato su una sezione verticale o area aziendale del sistema.</span><span class="sxs-lookup"><span data-stu-id="92a43-127">To mitigate this possibility, you can have multiple fined-grained API Gateways each one focusing on a vertical “slice” or business area of the system.</span></span> <span data-ttu-id="92a43-128">Il schema API Gateway è illustrato in dettaglio più avanti, nella sezione Uso di uno schema API Gateway.</span><span class="sxs-lookup"><span data-stu-id="92a43-128">The API Gateway pattern is explained in more detail in the section in the Using an API Gateway later.</span></span>

<span data-ttu-id="92a43-129">**CQRS con tabelle di query/letture**.</span><span class="sxs-lookup"><span data-stu-id="92a43-129">**CQRS with query/reads tables**.</span></span> <span data-ttu-id="92a43-130">Un'altra soluzione per aggregare i dati di più microservizi è lo [schema Materialized View](https://docs.microsoft.com/azure/architecture/patterns/materialized-view).</span><span class="sxs-lookup"><span data-stu-id="92a43-130">Another solution for aggregating data from multiple microservices is the [Materialized View pattern](https://docs.microsoft.com/azure/architecture/patterns/materialized-view).</span></span> <span data-ttu-id="92a43-131">In questo approccio si genera in anticipo una tabella di sola lettura con i dati appartenenti a più microservizi, ovvero si preparano i dati denormalizzati prima delle query effettive.</span><span class="sxs-lookup"><span data-stu-id="92a43-131">In this approach, you generate, in advance (prepare denormalized data before the actual queries happen), a read-only table with the data that is owned by multiple microservices.</span></span> <span data-ttu-id="92a43-132">Il formato della tabella è adatto alle esigenze dell'app client.</span><span class="sxs-lookup"><span data-stu-id="92a43-132">The table has a format suited to the client app’s needs.</span></span>

<span data-ttu-id="92a43-133">Si immagini, ad esempio, la schermata di un'app per dispositivi mobili.</span><span class="sxs-lookup"><span data-stu-id="92a43-133">Consider something like the screen for a mobile app.</span></span> <span data-ttu-id="92a43-134">Se è presente un unico database, è possibile raccogliere i dati per tale schermata usando una query SQL che esegue un join complesso che interessa più tabelle.</span><span class="sxs-lookup"><span data-stu-id="92a43-134">If you have a single database, you might pull together the data for that screen using a SQL query that performs a complex join involving multiple tables.</span></span> <span data-ttu-id="92a43-135">Se, però, sono presenti più database, ognuno dei quali appartiene a un microservizio diverso, non è possibile eseguire query su tali database e creare un join SQL.</span><span class="sxs-lookup"><span data-stu-id="92a43-135">However, when you have multiple databases, and each database is owned by a different microservice, you cannot query those databases and create a SQL join.</span></span> <span data-ttu-id="92a43-136">La query complessa diventa un problema.</span><span class="sxs-lookup"><span data-stu-id="92a43-136">Your complex query becomes a challenge.</span></span> <span data-ttu-id="92a43-137">Per risolverlo, è possibile ricorrere a un approccio CQRS, creando una tabella denormalizzata in un database diverso che viene usato solo per le query.</span><span class="sxs-lookup"><span data-stu-id="92a43-137">You can address the requirement using a CQRS approach—you create a denormalized table in a different database that is used just for queries.</span></span> <span data-ttu-id="92a43-138">La tabella può essere progettata in modo specifico per i dati necessari per la query complessa, con una relazione uno a uno tra i campi necessari per la schermata dell'applicazione e le colonne nella tabella di query.</span><span class="sxs-lookup"><span data-stu-id="92a43-138">The table can be designed specifically for the data you need for the complex query, with a one-to-one relationship between fields needed by your application’s screen and the columns in the query table.</span></span> <span data-ttu-id="92a43-139">Può anche essere usata per la creazione di report.</span><span class="sxs-lookup"><span data-stu-id="92a43-139">It could also serve for reporting purposes.</span></span>

<span data-ttu-id="92a43-140">Questo approccio consente non solo di risolvere il problema originale (come eseguire query e join tra più microservizi), ma anche di migliorare notevolmente le prestazioni rispetto a un join complesso, perché i dati necessari per l'applicazione sono già disponibili nella tabella di query.</span><span class="sxs-lookup"><span data-stu-id="92a43-140">This approach not only solves the original problem (how to query and join across microservices); it also improves performance considerably when compared with a complex join, because you already have the data that the application needs in the query table.</span></span> <span data-ttu-id="92a43-141">Naturalmente, l'uso di CQRS (Command and Query Responsibility Segregation) con le tabelle di query/letture implica un ulteriore lavoro di sviluppo, oltre alla necessità di includere la coerenza finale.</span><span class="sxs-lookup"><span data-stu-id="92a43-141">Of course, using Command and Query Responsibility Segregation (CQRS) with query/reads tables means additional development work, and you will need to embrace eventual consistency.</span></span> <span data-ttu-id="92a43-142">Nonostante questo, è nei requisiti delle prestazioni e della scalabilità elevata degli [scenari di collaborazione](http://udidahan.com/2011/10/02/why-you-should-be-using-cqrs-almost-everywhere/) (o di concorrenza, a seconda del punto di vista) che si deve applicare CQRS con più database.</span><span class="sxs-lookup"><span data-stu-id="92a43-142">Nonetheless, requirements on performance and high scalability in [collaborative scenarios](http://udidahan.com/2011/10/02/why-you-should-be-using-cqrs-almost-everywhere/) (or competitive scenarios, depending on the point of view) is where you should apply CQRS with multiple databases.</span></span>

<span data-ttu-id="92a43-143">**Dati utilizzati meno di frequente nei database centrali**.</span><span class="sxs-lookup"><span data-stu-id="92a43-143">**“Cold data” in central databases**.</span></span> <span data-ttu-id="92a43-144">Un approccio comune nel caso di report e query complesse che potrebbero non richiedere dati in tempo reale consiste nell'esportare i dati utilizzati più di frequente (dati transazionali dei microservizi) come dati utilizzati meno di frequente in database di grandi dimensioni che vengono usati solo per la creazione di report.</span><span class="sxs-lookup"><span data-stu-id="92a43-144">For complex reports and queries that might not require real-time data, a common approach is to export your “hot data” (transactional data from the microservices) as “cold data” into large databases that are used only for reporting.</span></span> <span data-ttu-id="92a43-145">Il sistema di database centrale può essere un sistema basato su Big Data, come Hadoop, un data warehouse come quello basato su Azure SQL Data Warehouse o persino un singolo database SQL usato solo per i report (se le dimensioni non costituiranno un problema).</span><span class="sxs-lookup"><span data-stu-id="92a43-145">That central database system can be a Big Data-based system, like Hadoop, a data warehouse like one based on Azure SQL Data Warehouse, or even a single SQL database used just for reports (if size will not be an issue).</span></span>

<span data-ttu-id="92a43-146">Tenere presente che questo database centralizzato verrà usato solo per query e report che non richiedono dati in tempo reale.</span><span class="sxs-lookup"><span data-stu-id="92a43-146">Keep in mind that this centralized database would be used only for queries and reports that do not need real-time data.</span></span> <span data-ttu-id="92a43-147">Gli aggiornamenti e le transazioni originali, da usare come fonte affidabile, devono essere presenti nei dati dei microservizi.</span><span class="sxs-lookup"><span data-stu-id="92a43-147">The original updates and transactions, as your source of truth, have to be in your microservices data.</span></span> <span data-ttu-id="92a43-148">Per la sincronizzazione dei dati, si può scegliere di usare la comunicazione basata su eventi (illustrata nelle sezioni successive) o altri strumenti di importazione/esportazione dell'infrastruttura di database.</span><span class="sxs-lookup"><span data-stu-id="92a43-148">The way you would synchronize data would be either by using event-driven communication (covered in the next sections) or by using other database infrastructure import/export tools.</span></span> <span data-ttu-id="92a43-149">Se si usa la comunicazione basata su eventi, il processo di integrazione sarà simile alla procedura di propagazione dei dati descritto in precedenza per le tabelle di query CQRS.</span><span class="sxs-lookup"><span data-stu-id="92a43-149">If you use event-driven communication, that integration process would be similar to the way you propagate data as described earlier for CQRS query tables.</span></span>

<span data-ttu-id="92a43-150">Se però la progettazione dell'applicazione implica l'aggregazione costante di informazioni di più microservizi per le query complesse, questo potrebbe essere un sintomo di una progettazione non appropriata, dal momento che un microservizio deve essere il più possibile isolato da altri microservizi.</span><span class="sxs-lookup"><span data-stu-id="92a43-150">However, if your application design involves constantly aggregating information from multiple microservices for complex queries, it might be a symptom of a bad design—a microservice should be as isolated as possible from other microservices.</span></span> <span data-ttu-id="92a43-151">Sono esclusi i report e le analisi, che devono sempre usare database centrali con dati utilizzati meno di frequente. Spesso questo problema potrebbe essere un valido motivo per unire i microservizi.</span><span class="sxs-lookup"><span data-stu-id="92a43-151">(This excludes reports/analytics that always should use cold-data central databases.) Having this problem often might be a reason to merge microservices.</span></span> <span data-ttu-id="92a43-152">È necessario bilanciare l'autonomia dell'evoluzione e la distribuzione di ogni microservizio con dipendenze complesse, coesione e aggregazione dei dati.</span><span class="sxs-lookup"><span data-stu-id="92a43-152">You need to balance the autonomy of evolution and deployment of each microservice with strong dependencies, cohesion, and data aggregation.</span></span>

## <a name="challenge-3-how-to-achieve-consistency-across-multiple-microservices"></a><span data-ttu-id="92a43-153">Problema \#3: Come ottenere la coerenza tra più microservizi</span><span class="sxs-lookup"><span data-stu-id="92a43-153">Challenge \#3: How to achieve consistency across multiple microservices</span></span>

<span data-ttu-id="92a43-154">Come affermato in precedenza, i dati di proprietà di ogni microservizio sono privati per il microservizio specifico ed è possibile accedervi solo usando la rispettiva API di microservizio.</span><span class="sxs-lookup"><span data-stu-id="92a43-154">As stated previously, the data owned by each microservice is private to that microservice and can only be accessed using its microservice API.</span></span> <span data-ttu-id="92a43-155">Di conseguenza uno dei problemi da affrontare è come implementare processi business end-to-end, garantendo al contempo la coerenza tra più microservizi.</span><span class="sxs-lookup"><span data-stu-id="92a43-155">Therefore, a challenge presented is how to implement end-to-end business processes while keeping consistency across multiple microservices.</span></span>

<span data-ttu-id="92a43-156">Per analizzare il problema, esaminiamo un esempio tratto dall'[applicazione di riferimento eShopOnContainers](http://aka.ms/eshoponcontainers).</span><span class="sxs-lookup"><span data-stu-id="92a43-156">To analyze this problem, let’s look at an example from the [eShopOnContainers reference application](http://aka.ms/eshoponcontainers).</span></span> <span data-ttu-id="92a43-157">Il microservizio Catalog contiene le informazioni relative a tutti i prodotti, incluso il relativo livello delle scorte.</span><span class="sxs-lookup"><span data-stu-id="92a43-157">The Catalog microservice maintains information about all the products, including their stock level.</span></span> <span data-ttu-id="92a43-158">Il microservizio Ordering gestisce gli ordini e deve verificare che un nuovo ordine non superi le scorte di prodotto disponibili nel catalogo.</span><span class="sxs-lookup"><span data-stu-id="92a43-158">The Ordering microservice manages orders and must verify that a new order does not exceed the available catalog product stock.</span></span> <span data-ttu-id="92a43-159">In alternativa, lo scenario può implicare logica che gestisce i prodotti relativi a ordini inevasi. In un'ipotetica versione monolitica di questa applicazione, il sottosistema di ordinazione potrebbe usare semplicemente una transazione ACID per controllare la disponibilità in magazzino, creare l'ordine nella tabella Orders e aggiornare le scorte disponibili nella tabella Products.</span><span class="sxs-lookup"><span data-stu-id="92a43-159">(Or the scenario might involve logic that handles backordered products.) In a hypothetical monolithic version of this application, the ordering subsystem could simply use an ACID transaction to check the available stock, create the order in the Orders table, and update the available stock in the Products table.</span></span>

<span data-ttu-id="92a43-160">In un'applicazione basata su microservizi le tabelle Order e Product appartengono ai rispettivi microservizi.</span><span class="sxs-lookup"><span data-stu-id="92a43-160">However, in a microservices- based application, the Order and Product tables are owned by their respective microservices.</span></span> <span data-ttu-id="92a43-161">Nessun microservizio deve sempre includere database di proprietà di un altro microservizio nelle proprie transazioni o query, come illustrato nella figura 4-9.</span><span class="sxs-lookup"><span data-stu-id="92a43-161">No microservice should ever include databases owned by another microservice in its own transactions or queries, as shown in Figure 4-9.</span></span>

![](./media/image9.PNG)

<span data-ttu-id="92a43-162">**Figura 4-9**.</span><span class="sxs-lookup"><span data-stu-id="92a43-162">**Figure 4-9**.</span></span> <span data-ttu-id="92a43-163">Un microservizio non può accedere direttamente a una tabella in un altro microservizio</span><span class="sxs-lookup"><span data-stu-id="92a43-163">A microservice cannot directly access a table in another microservice</span></span>

<span data-ttu-id="92a43-164">Il microservizio Ordering non deve aggiornare direttamente la tabella Products perché tale tabella è di proprietà del microservizio Catalog.</span><span class="sxs-lookup"><span data-stu-id="92a43-164">The Ordering microservice should not update the Products table directly, because the Products table is owned by the Catalog microservice.</span></span> <span data-ttu-id="92a43-165">Per eseguire un aggiornamento nel microservizio Catalog, il microservizio Ordering deve usare solo la comunicazione asincrona, ad esempio gli eventi di integrazione (comunicazione basata su messaggi ed eventi).</span><span class="sxs-lookup"><span data-stu-id="92a43-165">To make an update to the Catalog microservice, the Ordering microservice should only ever use asynchronous communication such as integration events (message and event-based communication).</span></span> <span data-ttu-id="92a43-166">Ecco come l'applicazione di riferimento [eShopOnContainers](http://aka.ms/eshoponcontainers) esegue questo tipo di aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="92a43-166">This is how the [eShopOnContainers](http://aka.ms/eshoponcontainers) reference application performs this type of update.</span></span>

<span data-ttu-id="92a43-167">Come dichiarato nel [teorema CAP](https://en.wikipedia.org/wiki/CAP_theorem), è necessario scegliere tra disponibilità e coerenza assoluta ACID.</span><span class="sxs-lookup"><span data-stu-id="92a43-167">As stated by the [CAP theorem](https://en.wikipedia.org/wiki/CAP_theorem), you need to choose between availability and ACID strong consistency.</span></span> <span data-ttu-id="92a43-168">La maggior parte degli scenari basati su microservizio richiede disponibilità e scalabilità elevata anziché la coerenza assoluta.</span><span class="sxs-lookup"><span data-stu-id="92a43-168">Most microservice-based scenarios demand availability and high scalability as opposed to strong consistency.</span></span> <span data-ttu-id="92a43-169">Le applicazioni mission-critical devono rimanere attive e in esecuzione e gli sviluppatori possono aggirare la coerenza assoluta usando tecniche per operare con la coerenza finale o debole.</span><span class="sxs-lookup"><span data-stu-id="92a43-169">Mission-critical applications must remain up and running, and developers can work around strong consistency by using techniques for working with weak or eventual consistency.</span></span> <span data-ttu-id="92a43-170">Si tratta dell'approccio adottato per la maggior parte delle architetture basate su microservizi.</span><span class="sxs-lookup"><span data-stu-id="92a43-170">This is the approach taken by most microservice-based architectures.</span></span>

<span data-ttu-id="92a43-171">Senza contare che le transazioni di commit in due fasi o di tipo ACID non sono solo contrarie ai principi dei microservizi. La maggior parte dei database NoSQL, come Azure Cosmos DB, MongoDB e così via, non supporta le transazioni di commit in due fasi.</span><span class="sxs-lookup"><span data-stu-id="92a43-171">Moreover, ACID-style or two-phase commit transactions are not just against microservices principles; most NoSQL databases (like Azure Cosmos DB, MongoDB, etc.) do not support two-phase commit transactions.</span></span> <span data-ttu-id="92a43-172">È tuttavia essenziale garantire la coerenza dei dati tra servizi e database.</span><span class="sxs-lookup"><span data-stu-id="92a43-172">However, maintaining data consistency across services and databases is essential.</span></span> <span data-ttu-id="92a43-173">Questo problema è anche correlato a quello relativo alla propagazione delle modifiche tra più microservizi quando determinati dati devono essere ridondanti, ad esempio quando il nome o la descrizione del prodotto deve essere presente sia nel microservizio Catalog che nel microservizio Basket.</span><span class="sxs-lookup"><span data-stu-id="92a43-173">This challenge is also related to the question of how to propagate changes across multiple microservices when certain data needs to be redundant—for example, when you need to have the product’s name or description in the Catalog microservice and the Basket microservice.</span></span>

<span data-ttu-id="92a43-174">Una valida soluzione per questo problema consiste nell'usare la coerenza finale tra microservizi articolati tramite la comunicazione basata su eventi e un sistema di pubblicazione e sottoscrizione.</span><span class="sxs-lookup"><span data-stu-id="92a43-174">A good solution for this problem is to use eventual consistency between microservices articulated through event-driven communication and a publish-and-subscribe system.</span></span> <span data-ttu-id="92a43-175">Questi argomenti sono trattati nella sezione [Comunicazione asincrona basata su eventi](#async_event_driven_communication) più avanti in questa guida.</span><span class="sxs-lookup"><span data-stu-id="92a43-175">These topics are covered in the section [Asynchronous event-driven communication](#async_event_driven_communication) later in this guide.</span></span>

## <a name="challenge-4-how-to-design-communication-across-microservice-boundaries"></a><span data-ttu-id="92a43-176">Problema \#4: Come progettare la comunicazione tra i limiti dei microservizi</span><span class="sxs-lookup"><span data-stu-id="92a43-176">Challenge \#4: How to design communication across microservice boundaries</span></span>

<span data-ttu-id="92a43-177">La comunicazione tra i limiti dei microservizi costituisce un vero e proprio problema.</span><span class="sxs-lookup"><span data-stu-id="92a43-177">Communicating across microservice boundaries is a real challenge.</span></span> <span data-ttu-id="92a43-178">In questo contesto la comunicazione non fa riferimento a quale protocollo usare (HTTP e REST, AMQP, messaggistica e così via),</span><span class="sxs-lookup"><span data-stu-id="92a43-178">In this context, communication does not refer to what protocol you should use (HTTP and REST, AMQP, messaging, and so on).</span></span> <span data-ttu-id="92a43-179">ma indica lo stile di comunicazione da usare e soprattutto come definire l'accoppiamento tra i microservizi.</span><span class="sxs-lookup"><span data-stu-id="92a43-179">Instead, it addresses what communication style you should use, and especially how coupled your microservices should be.</span></span> <span data-ttu-id="92a43-180">Quando si verifica un errore, l'impatto di tale errore sul sistema varia in modo significativo a seconda del livello di accoppiamento.</span><span class="sxs-lookup"><span data-stu-id="92a43-180">Depending on the level of coupling, when failure occurs, the impact of that failure on your system will vary significantly.</span></span>

<span data-ttu-id="92a43-181">In un sistema distribuito, ad esempio un'applicazione basata su microservizi, che implica l'uso di un numero elevato di artefatti e la presenza di servizi distribuiti in numerosi server o host, è inevitabile che si verifichino errori nei componenti.</span><span class="sxs-lookup"><span data-stu-id="92a43-181">In a distributed system like a microservices-based application, with so many artifacts moving around and with distributed services across many servers or hosts, components will eventually fail.</span></span> <span data-ttu-id="92a43-182">Possono verificarsi errori parziali e persino interruzioni di maggiore entità, pertanto è necessario progettare i microservizi e la comunicazione tra loro tenendo conto dei rischi comuni in questo tipo di sistema distribuito.</span><span class="sxs-lookup"><span data-stu-id="92a43-182">Partial failure and even larger outages will occur, so you need to design your microservices and the communication across them taking into account the risks common in this type of distributed system.</span></span>

<span data-ttu-id="92a43-183">Un approccio comune consiste nell'implementare microservizi basati su HTTP (REST), in virtù della loro semplicità.</span><span class="sxs-lookup"><span data-stu-id="92a43-183">A popular approach is to implement HTTP (REST)- based microservices, due to their simplicity.</span></span> <span data-ttu-id="92a43-184">Un approccio basato su HTTP è certamente accettabile. In questo caso il problema è correlato alla modalità di utilizzo.</span><span class="sxs-lookup"><span data-stu-id="92a43-184">An HTTP-based approach is perfectly acceptable; the issue here is related to how you use it.</span></span> <span data-ttu-id="92a43-185">Se si usano richieste e risposte HTTP solo per interagire con i microservizi da applicazioni client o da schemi API Gateway, non ci sono problemi.</span><span class="sxs-lookup"><span data-stu-id="92a43-185">If you use HTTP requests and responses just to interact with your microservices from client applications or from API Gateways, that is fine.</span></span> <span data-ttu-id="92a43-186">Se però si creano lunghe catene di chiamate HTTP sincrone tra i microservizi, che comunicano tra i relativi limiti, come se i microservizi fossero oggetti di un'applicazione monolitica, si verificheranno certamente problemi nell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="92a43-186">But if you create long chains of synchronous HTTP calls across microservices, communicating across their boundaries as if the microservices were objects in a monolithic application, your application will eventually run into problems.</span></span>

<span data-ttu-id="92a43-187">Si supponga che l'applicazione client effettui una chiamata API HTTP a un singolo microservizio, ad esempio il microservizio Ordering.</span><span class="sxs-lookup"><span data-stu-id="92a43-187">For instance, imagine that your client application makes an HTTP API call to an individual microservice like the Ordering microservice.</span></span> <span data-ttu-id="92a43-188">Se il microservizio Ordering chiama a sua volta altri microservizi tramite HTTP nello stesso ciclo di richiesta/risposta, si sta di fatto creando una catena di chiamate HTTP,</span><span class="sxs-lookup"><span data-stu-id="92a43-188">If the Ordering microservice in turn calls additional microservices using HTTP within the same request/response cycle, you are creating a chain of HTTP calls.</span></span> <span data-ttu-id="92a43-189">cosa che potrebbe inizialmente risultare sensata.</span><span class="sxs-lookup"><span data-stu-id="92a43-189">It might sound reasonable initially.</span></span> <span data-ttu-id="92a43-190">Ci sono però alcuni aspetti importanti da considerare quando si intraprende questo percorso:</span><span class="sxs-lookup"><span data-stu-id="92a43-190">However, there are important points to consider when going down this path:</span></span>

-   <span data-ttu-id="92a43-191">Blocchi e prestazioni ridotte.</span><span class="sxs-lookup"><span data-stu-id="92a43-191">Blocking and low performance.</span></span> <span data-ttu-id="92a43-192">A causa della natura sincrona di HTTP, la richiesta originale non riceverà una risposta fino al termine di tutte le chiamate HTTP interne.</span><span class="sxs-lookup"><span data-stu-id="92a43-192">Due to the synchronous nature of HTTP, the original request will not get a response until all the internal HTTP calls are finished.</span></span> <span data-ttu-id="92a43-193">Si supponga che il numero di queste chiamate aumenti in modo significativo e allo stesso tempo che una delle chiamate HTTP intermedie a un microservizio venga bloccata.</span><span class="sxs-lookup"><span data-stu-id="92a43-193">Imagine if the number of these calls increases significantly and at the same time one of the intermediate HTTP calls to a microservice is blocked.</span></span> <span data-ttu-id="92a43-194">Questa situazione influisce non solo sulle prestazioni, ma anche in modo esponenziale sulla scalabilità globale perché aumenta il numero di richieste HTTP aggiuntive.</span><span class="sxs-lookup"><span data-stu-id="92a43-194">The result is that performance is impacted, and the overall scalability will be exponentially affected as additional HTTP requests increase.</span></span>

-   <span data-ttu-id="92a43-195">Accoppiamento di microservizi con HTTP.</span><span class="sxs-lookup"><span data-stu-id="92a43-195">Coupling microservices with HTTP.</span></span> <span data-ttu-id="92a43-196">I microservizi aziendali non devono essere accoppiati ad altri microservizi dello stesso tipo.</span><span class="sxs-lookup"><span data-stu-id="92a43-196">Business microservices should not be coupled with other business microservices.</span></span> <span data-ttu-id="92a43-197">In teoria, i microservizi non devono essere a conoscenza dell'esistenza di altri microservizi.</span><span class="sxs-lookup"><span data-stu-id="92a43-197">Ideally, they should not “know” about the existence of other microservices.</span></span> <span data-ttu-id="92a43-198">Se l'applicazione si basa sull'accoppiamento di microservizi come illustrato nell'esempio, sarà quasi impossibile ottenere l'autonomia per singolo microservizio.</span><span class="sxs-lookup"><span data-stu-id="92a43-198">If your application relies on coupling microservices as in the example, achieving autonomy per microservice will be almost impossible.</span></span>

-   <span data-ttu-id="92a43-199">Errori in un qualsiasi microservizio.</span><span class="sxs-lookup"><span data-stu-id="92a43-199">Failure in any one microservice.</span></span> <span data-ttu-id="92a43-200">Se è stata implementata una catena di microservizi collegata tramite chiamate HTTP, in caso di errore di uno dei microservizi (situazione che si verifica inevitabilmente), si verificheranno errori nell'intera catena di microservizi.</span><span class="sxs-lookup"><span data-stu-id="92a43-200">If you implemented a chain of microservices linked by HTTP calls, when any of the microservices fails (and eventually they will fail) the whole chain of microservices will fail.</span></span> <span data-ttu-id="92a43-201">Un sistema basato su microservizi deve essere progettato in modo da continuare a funzionare nel miglior modo possibile in caso di errori parziali.</span><span class="sxs-lookup"><span data-stu-id="92a43-201">A microservice-based system should be designed to continue to work as well as possible during partial failures.</span></span> <span data-ttu-id="92a43-202">Anche se si implementa la logica client che usa tentativi con meccanismi di interruttore o backoff esponenziale, più complesse sono le catene di chiamate HTTP, più difficile sarà implementare una strategia di gestione degli errori basata su HTTP.</span><span class="sxs-lookup"><span data-stu-id="92a43-202">Even if you implement client logic that uses retries with exponential backoff or circuit breaker mechanisms, the more complex the HTTP call chains are, the more complex it is implement a failure strategy based on HTTP.</span></span>

<span data-ttu-id="92a43-203">Di fatto, se per comunicare, i microservizi interni creano catene di richieste HTTP, come descritto, potrebbe sembrare che si tratti di un'applicazione monolitica, ma basata su HTTP tra processi anziché su meccanismi di comunicazione all'interno di processi.</span><span class="sxs-lookup"><span data-stu-id="92a43-203">In fact, if your internal microservices are communicating by creating chains of HTTP requests as described, it could be argued that you have a monolithic application, but one based on HTTP between processes instead of intraprocess communication mechanisms.</span></span>

<span data-ttu-id="92a43-204">Per imporre l'autonomia dei microservizi e ottenere una migliore resilienza, è necessario ridurre al minimo l'uso di catene di comunicazione richiesta/risposta tra microservizi.</span><span class="sxs-lookup"><span data-stu-id="92a43-204">Therefore, in order to enforce microservice autonomy and have better resiliency, you should minimize the use of chains of request/response communication across microservices.</span></span> <span data-ttu-id="92a43-205">È consigliabile usare solo l'interazione asincrona per la comunicazione tra microservizi, sia tramite comunicazione asincrona basata su messaggi ed eventi che tramite il polling HTTP indipendentemente dal ciclo originale di richiesta/risposta HTTP.</span><span class="sxs-lookup"><span data-stu-id="92a43-205">It is recommended that you use only asynchronous interaction for inter-microservice communication, either by using asynchronous message- and event-based communication, or by using HTTP polling independently of the original HTTP request/response cycle.</span></span>

<span data-ttu-id="92a43-206">Per maggiori informazioni sull'uso della comunicazione asincrona, vedere le sezioni [L'integrazione di microservizi asincroni impone l'autonomia del microservizio](#asynchronous-microservice-integration-enforce-microservices-autonomy) e [Comunicazione asincrona basata su messaggi](#asynchronous-message-based-communication) più avanti in questa guida.</span><span class="sxs-lookup"><span data-stu-id="92a43-206">The use of asynchronous communication is explained with additional details later in this guide in the sections [Asynchronous microservice integration enforces microservice’s autonomy](#asynchronous-microservice-integration-enforce-microservices-autonomy) and [Asynchronous message-based communication](#asynchronous-message-based-communication).</span></span>

## <a name="additional-resources"></a><span data-ttu-id="92a43-207">Risorse aggiuntive</span><span class="sxs-lookup"><span data-stu-id="92a43-207">Additional resources</span></span>

-   <span data-ttu-id="92a43-208">**CAP Theorem**
    [*https://en.wikipedia.org/wiki/CAP\_teorema*](https://en.wikipedia.org/wiki/CAP_theorem) (Il teorema CAP)</span><span class="sxs-lookup"><span data-stu-id="92a43-208">**CAP theorem**
[*https://en.wikipedia.org/wiki/CAP\_theorem*](https://en.wikipedia.org/wiki/CAP_theorem)</span></span>

-   <span data-ttu-id="92a43-209">**Eventual Consistency**
    [*https://en.wikipedia.org/wiki/Eventual\_coerenza*](https://en.wikipedia.org/wiki/Eventual_consistency) (Coerenza finale)</span><span class="sxs-lookup"><span data-stu-id="92a43-209">**Eventual consistency**
[*https://en.wikipedia.org/wiki/Eventual\_consistency*](https://en.wikipedia.org/wiki/Eventual_consistency)</span></span>

-   <span data-ttu-id="92a43-210">**Data Consistency Primer**
    [*https://msdn.microsoft.com/library/dn589800.aspx*](https://msdn.microsoft.com/library/dn589800.aspx) (Primer coerenza dati)</span><span class="sxs-lookup"><span data-stu-id="92a43-210">**Data Consistency Primer**
[*https://msdn.microsoft.com/library/dn589800.aspx*](https://msdn.microsoft.com/library/dn589800.aspx)</span></span>

-   <span data-ttu-id="92a43-211">**Martin Fowler. CQRS (Command and Query Responsibility Segregation)**
    [*https://martinfowler.com/bliki/CQRS.html*](https://martinfowler.com/bliki/CQRS.html)</span><span class="sxs-lookup"><span data-stu-id="92a43-211">**Martin Fowler. CQRS (Command and Query Responsibility Segregation)**
[*https://martinfowler.com/bliki/CQRS.html*](https://martinfowler.com/bliki/CQRS.html)</span></span>

-   <span data-ttu-id="92a43-212">**Materialized View**
    [*https://docs.microsoft.com/azure/architecture/patterns/materialized-view*](https://docs.microsoft.com/azure/architecture/patterns/materialized-view) (Vista materializzata)</span><span class="sxs-lookup"><span data-stu-id="92a43-212">**Materialized View**
[*https://docs.microsoft.com/azure/architecture/patterns/materialized-view*](https://docs.microsoft.com/azure/architecture/patterns/materialized-view)</span></span>

-   <span data-ttu-id="92a43-213">**Charles Row. ACID vs. BASE: The Shifting pH of Database Transaction Processing**
    [*http://www.dataversity.net/acid-vs-base-the-shifting-ph-of-database-transaction-processing/*](http://www.dataversity.net/acid-vs-base-the-shifting-ph-of-database-transaction-processing/) (BASE: il pH mutevole dell'elaborazione delle transazioni del database)</span><span class="sxs-lookup"><span data-stu-id="92a43-213">**Charles Row. ACID vs. BASE: The Shifting pH of Database Transaction Processing**
[*http://www.dataversity.net/acid-vs-base-the-shifting-ph-of-database-transaction-processing/*](http://www.dataversity.net/acid-vs-base-the-shifting-ph-of-database-transaction-processing/)</span></span>

-   <span data-ttu-id="92a43-214">**Transazione di compensazione**
    [*https://docs.microsoft.com/azure/architecture/patterns/compensating-transaction*](https://docs.microsoft.com/azure/architecture/patterns/compensating-transaction)</span><span class="sxs-lookup"><span data-stu-id="92a43-214">**Compensating Transaction**
[*https://docs.microsoft.com/azure/architecture/patterns/compensating-transaction*](https://docs.microsoft.com/azure/architecture/patterns/compensating-transaction)</span></span>

-   <span data-ttu-id="92a43-215">**Udi Dahan. Service Oriented Composition (Composizione orientata ai servizi)**
    [*http://udidahan.com/2014/07/30/service-oriented-composition-with-video/*](http://udidahan.com/2014/07/30/service-oriented-composition-with-video/)</span><span class="sxs-lookup"><span data-stu-id="92a43-215">**Udi Dahan. Service Oriented Composition**
[*http://udidahan.com/2014/07/30/service-oriented-composition-with-video/*](http://udidahan.com/2014/07/30/service-oriented-composition-with-video/)</span></span>


>[!div class="step-by-step"]
<span data-ttu-id="92a43-216">[Indietro] (logical-versus-physical-architecture.md) [Avanti] (identify-microservice-domain-model-boundaries.md)</span><span class="sxs-lookup"><span data-stu-id="92a43-216">[Previous] (logical-versus-physical-architecture.md) [Next] (identify-microservice-domain-model-boundaries.md)</span></span>
