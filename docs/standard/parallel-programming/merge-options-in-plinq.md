---
title: Opzioni di merge in PLINQ
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-standard
ms.tgt_pltfrm: 
ms.topic: article
dev_langs:
- csharp
- vb
helpviewer_keywords: PLINQ queries, merge options
ms.assetid: e8f7be3b-88de-4f33-ab14-dc008e76c1ba
caps.latest.revision: "10"
author: rpetrusha
ms.author: ronpet
manager: wpickett
ms.openlocfilehash: e9bf586c1805fc5b5f1cc5f96f4e6b08d80c199a
ms.sourcegitcommit: 4f3fef493080a43e70e951223894768d36ce430a
ms.translationtype: HT
ms.contentlocale: it-IT
ms.lasthandoff: 11/21/2017
---
# <a name="merge-options-in-plinq"></a><span data-ttu-id="cb62e-102">Opzioni di merge in PLINQ</span><span class="sxs-lookup"><span data-stu-id="cb62e-102">Merge Options in PLINQ</span></span>
<span data-ttu-id="cb62e-103">Quando una query è in esecuzione come partizioni PLINQ parallele, la sequenza di origine in modo che più thread possano funzionare su parti diverse contemporaneamente, in genere su un thread separato.</span><span class="sxs-lookup"><span data-stu-id="cb62e-103">When a query is executing as parallel, PLINQ partitions the source sequence so that multiple threads can work on different parts concurrently, typically on separate threads.</span></span> <span data-ttu-id="cb62e-104">Se i risultati devono essere utilizzati in un unico thread, ad esempio, in un `foreach` (`For Each` in [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]) ciclo, quindi i risultati di ogni thread devono essere uniti in un'unica sequenza.</span><span class="sxs-lookup"><span data-stu-id="cb62e-104">If the results are to be consumed on one thread, for example, in a `foreach` (`For Each` in [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]) loop, then the results from every thread must be merged back into one sequence.</span></span> <span data-ttu-id="cb62e-105">Il tipo di unione che PLINQ esegue dipende dagli operatori presenti nella query.</span><span class="sxs-lookup"><span data-stu-id="cb62e-105">The kind of merge that PLINQ performs depends on the operators that are present in the query.</span></span> <span data-ttu-id="cb62e-106">Ad esempio, gli operatori che impongono un nuovo ordine i risultati devono memorizzare nel buffer tutti gli elementi da tutti i thread.</span><span class="sxs-lookup"><span data-stu-id="cb62e-106">For example, operators that impose a new order on the results must buffer all elements from all threads.</span></span> <span data-ttu-id="cb62e-107">Dalla prospettiva del thread consumer, che corrisponde anche che dell'utente dell'applicazione, potrebbe essere eseguita una query completamente memorizzato nel buffer per un periodo di tempo prima che il primo risultato significativo.</span><span class="sxs-lookup"><span data-stu-id="cb62e-107">From the perspective of the consuming thread (which is also that of the application user) a fully buffered query might run for a noticeable period of time before it produces its first result.</span></span> <span data-ttu-id="cb62e-108">Altri operatori, per impostazione predefinita, sono parzialmente memorizzata nel buffer; producono i risultati in batch.</span><span class="sxs-lookup"><span data-stu-id="cb62e-108">Other operators, by default, are partially buffered; they yield their results in batches.</span></span> <span data-ttu-id="cb62e-109">Un operatore, <xref:System.Linq.ParallelEnumerable.ForAll%2A> non memorizzato nel buffer per impostazione predefinita.</span><span class="sxs-lookup"><span data-stu-id="cb62e-109">One operator, <xref:System.Linq.ParallelEnumerable.ForAll%2A> is not buffered by default.</span></span> <span data-ttu-id="cb62e-110">Restituisce tutti gli elementi di tutti i thread immediatamente.</span><span class="sxs-lookup"><span data-stu-id="cb62e-110">It yields all elements from all threads immediately.</span></span>  
  
 <span data-ttu-id="cb62e-111">Tramite il <xref:System.Linq.ParallelEnumerable.WithMergeOptions%2A> (metodo), come illustrato nell'esempio seguente, è possibile fornire un suggerimento a PLINQ che indica il tipo di unione da eseguire.</span><span class="sxs-lookup"><span data-stu-id="cb62e-111">By using the <xref:System.Linq.ParallelEnumerable.WithMergeOptions%2A> method, as shown in the following example, you can provide a hint to PLINQ that indicates what kind of merging to perform.</span></span>  
  
 [!code-csharp[PLINQ#26](../../../samples/snippets/csharp/VS_Snippets_Misc/plinq/cs/plinqsamples.cs#26)]
 [!code-vb[PLINQ#26](../../../samples/snippets/visualbasic/VS_Snippets_Misc/plinq/vb/plinq2_vb.vb#26)]  
  
 <span data-ttu-id="cb62e-112">Per un esempio completo, vedere [procedura: specificare le opzioni di Merge in PLINQ](../../../docs/standard/parallel-programming/how-to-specify-merge-options-in-plinq.md).</span><span class="sxs-lookup"><span data-stu-id="cb62e-112">For the complete example, see [How to: Specify Merge Options in PLINQ](../../../docs/standard/parallel-programming/how-to-specify-merge-options-in-plinq.md).</span></span>  
  
 <span data-ttu-id="cb62e-113">Se la query specifica non supporta l'opzione richiesta, quindi l'opzione verrà ignorata.</span><span class="sxs-lookup"><span data-stu-id="cb62e-113">If the particular query cannot support the requested option, then the option will just be ignored.</span></span> <span data-ttu-id="cb62e-114">Nella maggior parte dei casi, non è necessario specificare un'opzione di merge per una query PLINQ.</span><span class="sxs-lookup"><span data-stu-id="cb62e-114">In most cases, you do not have to specify a merge option for a PLINQ query.</span></span> <span data-ttu-id="cb62e-115">Tuttavia, in alcuni casi può risultare tramite test e misurazioni che una query viene eseguita meglio in una modalità non predefinito.</span><span class="sxs-lookup"><span data-stu-id="cb62e-115">However, in some cases you may find by testing and measurement that a query executes best in a non-default mode.</span></span> <span data-ttu-id="cb62e-116">Un utilizzo comune di questa opzione è per forzare un operatore di unione di blocco per trasmettere i risultati per fornire una maggiore efficienza di risposta interfaccia utente.</span><span class="sxs-lookup"><span data-stu-id="cb62e-116">A common use of this option is to force a chunk-merging operator to stream its results in order to provide a more responsive user interface.</span></span>  
  
## <a name="parallelmergeoptions"></a><span data-ttu-id="cb62e-117">ParallelMergeOptions</span><span class="sxs-lookup"><span data-stu-id="cb62e-117">ParallelMergeOptions</span></span>  
 <span data-ttu-id="cb62e-118">Il <xref:System.Linq.ParallelMergeOptions> enumerazione include le opzioni seguenti che specificano, per le forme di query supportate, come viene prodotto l'output finale della query quando vengono usati i risultati in un unico thread:</span><span class="sxs-lookup"><span data-stu-id="cb62e-118">The <xref:System.Linq.ParallelMergeOptions> enumeration includes the following options that specify, for supported query shapes, how the final output of the query is yielded when the results are consumed on one thread:</span></span>  
  
-   `Not Buffered`  
  
     <span data-ttu-id="cb62e-119">Il <xref:System.Linq.ParallelMergeOptions.NotBuffered> opzione fa sì che ogni elemento elaborato venga restituito da ogni thread, non appena viene prodotto.</span><span class="sxs-lookup"><span data-stu-id="cb62e-119">The <xref:System.Linq.ParallelMergeOptions.NotBuffered> option causes each processed element to be returned from each thread as soon as it is produced.</span></span> <span data-ttu-id="cb62e-120">Questo comportamento è analogo a "" il flusso di output.</span><span class="sxs-lookup"><span data-stu-id="cb62e-120">This behavior is analogous to "streaming" the output.</span></span> <span data-ttu-id="cb62e-121">Se il <xref:System.Linq.ParallelEnumerable.AsOrdered%2A> operatore è presente nella query, `NotBuffered` mantiene l'ordine degli elementi di origine.</span><span class="sxs-lookup"><span data-stu-id="cb62e-121">If the <xref:System.Linq.ParallelEnumerable.AsOrdered%2A> operator is present in the query, `NotBuffered` preserves the order of the source elements.</span></span> <span data-ttu-id="cb62e-122">Anche se `NotBuffered` viene avviato, generando risultati non appena ma sono disponibili, il tempo totale necessario per generare tutti i risultati potrebbe comunque essere più lungo di utilizzando una delle altre opzioni di unione.</span><span class="sxs-lookup"><span data-stu-id="cb62e-122">Although `NotBuffered` starts yielding results as soon as they're available,, the total time to produce all the results might still be longer than using one of the other merge options.</span></span>  
  
-   `Auto Buffered`  
  
     <span data-ttu-id="cb62e-123">Quando si utilizza l'opzione <xref:System.Linq.ParallelMergeOptions.AutoBuffered>, tramite la query vengono raccolti gli elementi in un buffer, quindi viene passato periodicamente il contenuto del buffer in un unico blocco al thread consumer.</span><span class="sxs-lookup"><span data-stu-id="cb62e-123">The <xref:System.Linq.ParallelMergeOptions.AutoBuffered> option causes the query to collect elements into a buffer and then periodically yield the buffer contents all at once to the consuming thread.</span></span> <span data-ttu-id="cb62e-124">Questo comportamento è analogo a restituire i dati di origine in "blocchi" anziché il comportamento di "streaming" `NotBuffered`.</span><span class="sxs-lookup"><span data-stu-id="cb62e-124">This is analogous to yielding the source data in "chunks" instead of using the "streaming" behavior of `NotBuffered`.</span></span> <span data-ttu-id="cb62e-125">`AutoBuffered`può richiedere più `NotBuffered` per rendere disponibile il primo elemento nel thread consumer.</span><span class="sxs-lookup"><span data-stu-id="cb62e-125">`AutoBuffered` may take longer than `NotBuffered` to make the first element available on the consuming thread.</span></span> <span data-ttu-id="cb62e-126">Le dimensioni del buffer e l'esatto comportamento di produzione non sono configurabili e possono variare a seconda di vari fattori correlati alla query.</span><span class="sxs-lookup"><span data-stu-id="cb62e-126">The size of the buffer and the exact yielding behavior are not configurable and may vary, depending on various factors that relate to the query.</span></span>  
  
-   `FullyBuffered`  
  
     <span data-ttu-id="cb62e-127">Il <xref:System.Linq.ParallelMergeOptions.FullyBuffered> opzione fa sì che l'output dell'intera query da memorizzare nel buffer prima di tutti gli elementi vengono restituiti.</span><span class="sxs-lookup"><span data-stu-id="cb62e-127">The <xref:System.Linq.ParallelMergeOptions.FullyBuffered> option causes the output of the whole query to be buffered before any of the elements are yielded.</span></span> <span data-ttu-id="cb62e-128">Quando si utilizza questa opzione, può richiedere più tempo prima che il primo elemento è disponibile nel thread consumer, ma i risultati completi possono comunque essere prodotti più veloce tramite le altre opzioni.</span><span class="sxs-lookup"><span data-stu-id="cb62e-128">When you use this option, it can take longer before the first element is available on the consuming thread, but the complete results might still be produced faster than by using the other options.</span></span>  
  
## <a name="query-operators-that-support-merge-options"></a><span data-ttu-id="cb62e-129">Operatori di query che supportano le opzioni di unione</span><span class="sxs-lookup"><span data-stu-id="cb62e-129">Query Operators that Support Merge Options</span></span>  
 <span data-ttu-id="cb62e-130">Nella tabella seguente vengono elencati gli operatori che supportano tutte le modalità di opzione di unione, soggetto alle restrizioni specificate.</span><span class="sxs-lookup"><span data-stu-id="cb62e-130">The following table lists the operators that support all merge option modes, subject to the specified restrictions.</span></span>  
  
|<span data-ttu-id="cb62e-131">Operatore</span><span class="sxs-lookup"><span data-stu-id="cb62e-131">Operator</span></span>|<span data-ttu-id="cb62e-132">Restrizioni</span><span class="sxs-lookup"><span data-stu-id="cb62e-132">Restrictions</span></span>|  
|--------------|------------------|  
|<xref:System.Linq.ParallelEnumerable.AsEnumerable%2A>|<span data-ttu-id="cb62e-133">Nessuno</span><span class="sxs-lookup"><span data-stu-id="cb62e-133">None</span></span>|  
|<xref:System.Linq.ParallelEnumerable.Cast%2A>|<span data-ttu-id="cb62e-134">Nessuno</span><span class="sxs-lookup"><span data-stu-id="cb62e-134">None</span></span>|  
|<xref:System.Linq.ParallelEnumerable.Concat%2A>|<span data-ttu-id="cb62e-135">Query non ordinate che hanno solo un'origine matrice o elenco.</span><span class="sxs-lookup"><span data-stu-id="cb62e-135">Non-ordered queries that have an Array or List source only.</span></span>|  
|<xref:System.Linq.ParallelEnumerable.DefaultIfEmpty%2A>|<span data-ttu-id="cb62e-136">Nessuno</span><span class="sxs-lookup"><span data-stu-id="cb62e-136">None</span></span>|  
|<xref:System.Linq.ParallelEnumerable.OfType%2A>|<span data-ttu-id="cb62e-137">Nessuno</span><span class="sxs-lookup"><span data-stu-id="cb62e-137">None</span></span>|  
|<xref:System.Linq.ParallelEnumerable.Reverse%2A>|<span data-ttu-id="cb62e-138">Query non ordinate che hanno solo un'origine matrice o elenco.</span><span class="sxs-lookup"><span data-stu-id="cb62e-138">Non-ordered queries that have an Array or List source only.</span></span>|  
|<xref:System.Linq.ParallelEnumerable.Select%2A>|<span data-ttu-id="cb62e-139">Nessuno</span><span class="sxs-lookup"><span data-stu-id="cb62e-139">None</span></span>|  
|<xref:System.Linq.ParallelEnumerable.SelectMany%2A>|<span data-ttu-id="cb62e-140">Nessuna</span><span class="sxs-lookup"><span data-stu-id="cb62e-140">None</span></span>|  
|<xref:System.Linq.ParallelEnumerable.Skip%2A>|<span data-ttu-id="cb62e-141">Nessuna</span><span class="sxs-lookup"><span data-stu-id="cb62e-141">None</span></span>|  
|<xref:System.Linq.ParallelEnumerable.Take%2A>|<span data-ttu-id="cb62e-142">Nessuna</span><span class="sxs-lookup"><span data-stu-id="cb62e-142">None</span></span>|  
|<xref:System.Linq.ParallelEnumerable.Where%2A>|<span data-ttu-id="cb62e-143">Nessuno</span><span class="sxs-lookup"><span data-stu-id="cb62e-143">None</span></span>|  
  
 <span data-ttu-id="cb62e-144">Tutti gli altri operatori di query PLINQ potrebbero ignorare le opzioni di unione fornito dall'utente.</span><span class="sxs-lookup"><span data-stu-id="cb62e-144">All other PLINQ query operators might ignore user-provided merge options.</span></span> <span data-ttu-id="cb62e-145">Alcuni operatori di query, ad esempio, <xref:System.Linq.ParallelEnumerable.Reverse%2A> e <xref:System.Linq.ParallelEnumerable.OrderBy%2A>, possono produrre elementi fino a quando tutti i prodotti e riordinati.</span><span class="sxs-lookup"><span data-stu-id="cb62e-145">Some query operators, for example, <xref:System.Linq.ParallelEnumerable.Reverse%2A> and <xref:System.Linq.ParallelEnumerable.OrderBy%2A>, cannot yield any elements until all have been produced and reordered.</span></span> <span data-ttu-id="cb62e-146">Pertanto, quando <xref:System.Linq.ParallelMergeOptions> viene utilizzato in una query che contiene anche un operatore, ad esempio <xref:System.Linq.ParallelEnumerable.Reverse%2A>, il comportamento di tipo merge non essere applicato nella query solo dopo che l'operatore ha generato i risultati.</span><span class="sxs-lookup"><span data-stu-id="cb62e-146">Therefore, when <xref:System.Linq.ParallelMergeOptions> is used in a query that also contains an operator such as <xref:System.Linq.ParallelEnumerable.Reverse%2A>, the merge behavior will not be applied in the query until after that operator has produced its results.</span></span>  
  
 <span data-ttu-id="cb62e-147">La possibilità di alcuni operatori di gestire le opzioni di unione dipende dal tipo della sequenza di origine e se il <xref:System.Linq.ParallelEnumerable.AsOrdered%2A> operatore è stato utilizzato nella query.</span><span class="sxs-lookup"><span data-stu-id="cb62e-147">The ability of some operators to handle merge options depends on the type of the source sequence, and whether the <xref:System.Linq.ParallelEnumerable.AsOrdered%2A> operator was used earlier in the query.</span></span> <span data-ttu-id="cb62e-148"><xref:System.Linq.ParallelEnumerable.ForAll%2A>è sempre <xref:System.Linq.ParallelMergeOptions.NotBuffered> ; produce immediatamente gli elementi.</span><span class="sxs-lookup"><span data-stu-id="cb62e-148"><xref:System.Linq.ParallelEnumerable.ForAll%2A> is always <xref:System.Linq.ParallelMergeOptions.NotBuffered> ; it yields its elements immediately.</span></span> <span data-ttu-id="cb62e-149"><xref:System.Linq.ParallelEnumerable.OrderBy%2A>è sempre <xref:System.Linq.ParallelMergeOptions.FullyBuffered>; deve ordinare l'intero elenco prima di produrre elementi.</span><span class="sxs-lookup"><span data-stu-id="cb62e-149"><xref:System.Linq.ParallelEnumerable.OrderBy%2A> is always <xref:System.Linq.ParallelMergeOptions.FullyBuffered>; it must sort the whole list before it yields.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="cb62e-150">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="cb62e-150">See Also</span></span>  
 [<span data-ttu-id="cb62e-151">Parallel LINQ (PLINQ)</span><span class="sxs-lookup"><span data-stu-id="cb62e-151">Parallel LINQ (PLINQ)</span></span>](../../../docs/standard/parallel-programming/parallel-linq-plinq.md)  
 [<span data-ttu-id="cb62e-152">Procedura: Specificare le opzioni di merge in PLINQ</span><span class="sxs-lookup"><span data-stu-id="cb62e-152">How to: Specify Merge Options in PLINQ</span></span>](../../../docs/standard/parallel-programming/how-to-specify-merge-options-in-plinq.md)
