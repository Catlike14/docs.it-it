---
title: "Procedura: utilizzare JoinBlock per leggere dati da più origini"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-standard
ms.tgt_pltfrm: 
ms.topic: article
dev_langs:
- csharp
- vb
helpviewer_keywords:
- Task Parallel Library, dataflows
- TPL dataflow library, joining blocks in
- dataflow blocks, joining in TPL
ms.assetid: e9c1ada4-ac57-4704-87cb-2f5117f8151d
caps.latest.revision: "7"
author: rpetrusha
ms.author: ronpet
manager: wpickett
ms.openlocfilehash: 41445e4874b94809840ecf9ebda6f27ccc955c9b
ms.sourcegitcommit: bd1ef61f4bb794b25383d3d72e71041a5ced172e
ms.translationtype: HT
ms.contentlocale: it-IT
ms.lasthandoff: 10/18/2017
---
# <a name="how-to-use-joinblock-to-read-data-from-multiple-sources"></a><span data-ttu-id="14d83-102">Procedura: utilizzare JoinBlock per leggere dati da più origini</span><span class="sxs-lookup"><span data-stu-id="14d83-102">How to: Use JoinBlock to Read Data From Multiple Sources</span></span>
<span data-ttu-id="14d83-103">In questo documento viene spiegato come utilizzare la classe <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> per eseguire un'operazione quando i dati sono disponibili da più origini.</span><span class="sxs-lookup"><span data-stu-id="14d83-103">This document explains how to use the <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> class to perform an operation when data is available from multiple sources.</span></span> <span data-ttu-id="14d83-104">Viene inoltre illustrato come utilizzare la modalità non greedy per consentire la condivisione in modo più efficiente di un'origine dati da parte di più blocchi join.</span><span class="sxs-lookup"><span data-stu-id="14d83-104">It also demonstrates how to use non-greedy mode to enable multiple join blocks to share a data source more efficiently.</span></span>  
  
> [!TIP]
>  <span data-ttu-id="14d83-105">La libreria del flusso di dati TPL (spazio dei nomi <xref:System.Threading.Tasks.Dataflow?displayProperty=nameWithType>) non viene distribuita con [!INCLUDE[net_v45](../../../includes/net-v45-md.md)].</span><span class="sxs-lookup"><span data-stu-id="14d83-105">The TPL Dataflow Library (<xref:System.Threading.Tasks.Dataflow?displayProperty=nameWithType> namespace) is not distributed with the [!INCLUDE[net_v45](../../../includes/net-v45-md.md)].</span></span> <span data-ttu-id="14d83-106">Per installare il <xref:System.Threading.Tasks.Dataflow> dello spazio dei nomi, Apri il progetto in [!INCLUDE[vs_dev11_long](../../../includes/vs-dev11-long-md.md)], scegliere **Gestisci pacchetti NuGet** dal menu progetto e cercare online il `Microsoft.Tpl.Dataflow` pacchetto.</span><span class="sxs-lookup"><span data-stu-id="14d83-106">To install the <xref:System.Threading.Tasks.Dataflow> namespace, open your project in [!INCLUDE[vs_dev11_long](../../../includes/vs-dev11-long-md.md)], choose **Manage NuGet Packages** from the Project menu, and search online for the `Microsoft.Tpl.Dataflow` package.</span></span>  
  
## <a name="example"></a><span data-ttu-id="14d83-107">Esempio</span><span class="sxs-lookup"><span data-stu-id="14d83-107">Example</span></span>  
 <span data-ttu-id="14d83-108">Nell'esempio seguente vengono definiti tre tipi di risorsa, `NetworkResource`, `FileResource` e `MemoryResource` e vengono eseguite operazioni quando queste diventano disponibili.</span><span class="sxs-lookup"><span data-stu-id="14d83-108">The following example defines three resource types, `NetworkResource`, `FileResource`, and `MemoryResource`, and performs operations when resources become available.</span></span> <span data-ttu-id="14d83-109">Per questo esempio è richiesta una coppia `NetworkResource` e `MemoryResource` per eseguire la prima operazione e una coppia `FileResource` e `MemoryResource` per eseguire la seconda.</span><span class="sxs-lookup"><span data-stu-id="14d83-109">This example requires a `NetworkResource` and `MemoryResource` pair in order to perform the first operation and a `FileResource` and `MemoryResource` pair in order to perform the second operation.</span></span> <span data-ttu-id="14d83-110">Per consentire l'esecuzione di queste operazioni quando tutte le risorse necessarie sono disponibili, nell'esempio viene utilizzata la classe <xref:System.Threading.Tasks.Dataflow.JoinBlock%602>.</span><span class="sxs-lookup"><span data-stu-id="14d83-110">To enable these operations to occur when all required resources are available, this example uses the <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> class.</span></span> <span data-ttu-id="14d83-111">Quando tramite un oggetto <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> vengono ricevuti dati da tutte le origini, questi dati vengono propagati alla relativa destinazione, che in questo esempio è un oggetto <xref:System.Threading.Tasks.Dataflow.ActionBlock%601>.</span><span class="sxs-lookup"><span data-stu-id="14d83-111">When a <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> object receives data from all sources, it propagates that data to its target, which in this example is an <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> object.</span></span> <span data-ttu-id="14d83-112">La lettura da parte di entrambi gli oggetti <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> viene eseguita da un pool condiviso di oggetti `MemoryResource`.</span><span class="sxs-lookup"><span data-stu-id="14d83-112">Both <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> objects read from a shared pool of `MemoryResource` objects.</span></span>  
  
 [!code-csharp[TPLDataflow_NonGreedyJoin#1](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_nongreedyjoin/cs/nongreedyjoin.cs#1)]
 [!code-vb[TPLDataflow_NonGreedyJoin#1](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_nongreedyjoin/vb/nongreedyjoin.vb#1)]  
  
 <span data-ttu-id="14d83-113">Per consentire un utilizzo efficiente del pool condiviso di oggetti `MemoryResource`, in questo esempio viene specificato un oggetto <xref:System.Threading.Tasks.Dataflow.GroupingDataflowBlockOptions> con la proprietà <xref:System.Threading.Tasks.Dataflow.GroupingDataflowBlockOptions.Greedy%2A> impostata su `False` per creare oggetti <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> utilizzati in modalità non greedy.</span><span class="sxs-lookup"><span data-stu-id="14d83-113">To enable efficient use of the shared pool of `MemoryResource` objects, this example specifies a <xref:System.Threading.Tasks.Dataflow.GroupingDataflowBlockOptions> object that has the <xref:System.Threading.Tasks.Dataflow.GroupingDataflowBlockOptions.Greedy%2A> property set to `False` to create <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> objects that act in non-greedy mode.</span></span> <span data-ttu-id="14d83-114">In un blocco join non greedy tutti i messaggi in ingresso vengono posticipati finché non ne è disponibile uno da ogni origine.</span><span class="sxs-lookup"><span data-stu-id="14d83-114">A non-greedy join block postpones all incoming messages until one is available from each source.</span></span> <span data-ttu-id="14d83-115">Se uno dei messaggi posposti viene accettato da un altro blocco, tramite il blocco join viene riavviato il processo.</span><span class="sxs-lookup"><span data-stu-id="14d83-115">If any of the postponed messages were accepted by another block, the join block restarts the process.</span></span> <span data-ttu-id="14d83-116">La modalità non greedy consente ai blocchi join in cui vengono condivisi uno o più blocchi di origine di proseguire il lavoro mentre i dati vengono attesi dagli altri blocchi.</span><span class="sxs-lookup"><span data-stu-id="14d83-116">Non-greedy mode enables join blocks that share one or more source blocks to make forward progress as the other blocks wait for data.</span></span> <span data-ttu-id="14d83-117">In questo esempio, se un oggetto `MemoryResource` viene aggiunto al pool `memoryResources`, il primo blocco join utilizzato per ricevere la seconda origine dati può continuare.</span><span class="sxs-lookup"><span data-stu-id="14d83-117">In this example, if a `MemoryResource` object is added to the `memoryResources` pool, the first join block to receive its second data source can make forward progress.</span></span> <span data-ttu-id="14d83-118">Se in questo esempio venisse utilizzata la modalità greedy, vale a dire l'impostazione predefinita, un blocco join potrebbe accettare l'oggetto `MemoryResource` e attendere che la seconda risorsa diventi disponibile.</span><span class="sxs-lookup"><span data-stu-id="14d83-118">If this example were to use greedy mode, which is the default, one join block might take the `MemoryResource` object and wait for the second resource to become available.</span></span> <span data-ttu-id="14d83-119">Tuttavia, se nell'altro blocco join è presente la seconda origine dati disponibile, non è possibile continuare perché l'oggetto `MemoryResource` è stato accettato dall'altro blocco join.</span><span class="sxs-lookup"><span data-stu-id="14d83-119">However, if the other join block has its second data source available, it cannot make forward progress because the `MemoryResource` object has been taken by the other join block.</span></span>  
  
## <a name="compiling-the-code"></a><span data-ttu-id="14d83-120">Compilazione del codice</span><span class="sxs-lookup"><span data-stu-id="14d83-120">Compiling the Code</span></span>  
 <span data-ttu-id="14d83-121">Copiare il codice di esempio e incollarlo in un progetto di Visual Studio oppure incollarlo in un file denominato `DataflowNonGreedyJoin.cs` (`DataflowNonGreedyJoin.vb` per [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]), quindi eseguire il comando riportato di seguito in una finestra del prompt dei comandi di Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="14d83-121">Copy the example code and paste it in a Visual Studio project, or paste it in a file that is named `DataflowNonGreedyJoin.cs` (`DataflowNonGreedyJoin.vb` for [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]), and then run the following command in a Visual Studio Command Prompt window.</span></span>  
  
 [!INCLUDE[csprcs](../../../includes/csprcs-md.md)]  
  
 <span data-ttu-id="14d83-122">**csc.exe /r:System.Threading.Tasks.Dataflow.dll dataflownongreedyjoin. cs**</span><span class="sxs-lookup"><span data-stu-id="14d83-122">**csc.exe /r:System.Threading.Tasks.Dataflow.dll DataflowNonGreedyJoin.cs**</span></span>  
  
 [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]  
  
 <span data-ttu-id="14d83-123">**vbc.exe /r:System.Threading.Tasks.Dataflow.dll dataflownongreedyjoin. vb**</span><span class="sxs-lookup"><span data-stu-id="14d83-123">**vbc.exe /r:System.Threading.Tasks.Dataflow.dll DataflowNonGreedyJoin.vb**</span></span>  
  
## <a name="robust-programming"></a><span data-ttu-id="14d83-124">Programmazione efficiente</span><span class="sxs-lookup"><span data-stu-id="14d83-124">Robust Programming</span></span>  
 <span data-ttu-id="14d83-125">L'utilizzo di join non greedy può inoltre aiutare a impedire un deadlock nell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="14d83-125">The use of non-greedy joins can also help you prevent deadlock in your application.</span></span> <span data-ttu-id="14d83-126">In un'applicazione software *deadlock* si verifica quando due o più processi ogni contengono una risorsa e attendere che si escludono a un altro processo rilasciare un'altra risorsa.</span><span class="sxs-lookup"><span data-stu-id="14d83-126">In a software application, *deadlock* occurs when two or more processes each hold a resource and mutually wait for another process to release some other resource.</span></span> <span data-ttu-id="14d83-127">Si consideri un'applicazione in cui sono definiti due oggetti <xref:System.Threading.Tasks.Dataflow.JoinBlock%602>.</span><span class="sxs-lookup"><span data-stu-id="14d83-127">Consider an application that defines two <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> objects.</span></span> <span data-ttu-id="14d83-128">I dati dei due blocchi di origine condivisi possono essere letti da entrambi gli oggetti.</span><span class="sxs-lookup"><span data-stu-id="14d83-128">Both objects each read data from two shared source blocks.</span></span> <span data-ttu-id="14d83-129">In modalità greedy, se la prima origine viene letta dal primo blocco e la seconda origine dal secondo blocco, si potrebbe verificare un deadlock dell'applicazione poiché entrambi i blocchi join sono in attesa del completamento dell'altro per liberare la relativa risorsa.</span><span class="sxs-lookup"><span data-stu-id="14d83-129">In greedy mode, if one join block reads from the first source and the second join block reads from the second source, the application might deadlock because both join blocks mutually wait for the other to release its resource.</span></span> <span data-ttu-id="14d83-130">In modalità non greedy, la lettura dalle relative origini da parte di ogni blocco join viene eseguita solo quando tutti i dati sono disponibili e, di conseguenza, il rischio di deadlock è eliminato.</span><span class="sxs-lookup"><span data-stu-id="14d83-130">In non-greedy mode, each join block reads from its sources only when all data is available, and therefore, the risk of deadlock is eliminated.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="14d83-131">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="14d83-131">See Also</span></span>  
 [<span data-ttu-id="14d83-132">Flusso di dati</span><span class="sxs-lookup"><span data-stu-id="14d83-132">Dataflow</span></span>](../../../docs/standard/parallel-programming/dataflow-task-parallel-library.md)
