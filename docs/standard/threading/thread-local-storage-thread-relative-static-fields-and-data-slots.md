---
title: 'Archiviazione locale del thread: slot di dati e campi statici relativi ai thread'
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-standard
ms.tgt_pltfrm: 
ms.topic: article
helpviewer_keywords:
- threading [.NET Framework], local storage
- threading [.NET Framework], thread-relative static fields
- local thread storage
- TLS
ms.assetid: c633a4dc-a790-4ed1-96b5-f72bd968b284
caps.latest.revision: "13"
author: rpetrusha
ms.author: ronpet
manager: wpickett
ms.openlocfilehash: 39dd80d378171563f2aadadaa146278e8a417d32
ms.sourcegitcommit: 4f3fef493080a43e70e951223894768d36ce430a
ms.translationtype: HT
ms.contentlocale: it-IT
ms.lasthandoff: 11/21/2017
---
# <a name="thread-local-storage-thread-relative-static-fields-and-data-slots"></a><span data-ttu-id="7d1a3-102">Archiviazione locale del thread: slot di dati e campi statici relativi ai thread</span><span class="sxs-lookup"><span data-stu-id="7d1a3-102">Thread Local Storage: Thread-Relative Static Fields and Data Slots</span></span>
<span data-ttu-id="7d1a3-103">È possibile utilizzare l'archiviazione locale del thread (TLS) per archiviare i dati che è univoco a un dominio applicazione e thread.</span><span class="sxs-lookup"><span data-stu-id="7d1a3-103">You can use managed thread local storage (TLS) to store data that is unique to a thread and application domain.</span></span> <span data-ttu-id="7d1a3-104">.NET Framework fornisce due modalità di utilizzo gestito TLS: slot di dati e i campi statici relativi ai thread.</span><span class="sxs-lookup"><span data-stu-id="7d1a3-104">The .NET Framework provides two ways to use managed TLS: thread-relative static fields and data slots.</span></span>  
  
-   <span data-ttu-id="7d1a3-105">Utilizzare i campi statici relativi ai thread (relativi ai thread `Shared` campi in Visual Basic) se è possibile prevedere le esigenze specifiche in fase di compilazione.</span><span class="sxs-lookup"><span data-stu-id="7d1a3-105">Use thread-relative static fields (thread-relative `Shared` fields in Visual Basic) if you can anticipate your exact needs at compile time.</span></span> <span data-ttu-id="7d1a3-106">I campi statici relativi ai thread forniscono prestazioni ottimali.</span><span class="sxs-lookup"><span data-stu-id="7d1a3-106">Thread-relative static fields provide the best performance.</span></span> <span data-ttu-id="7d1a3-107">Offrono inoltre i vantaggi del controllo dei tipi in fase di compilazione.</span><span class="sxs-lookup"><span data-stu-id="7d1a3-107">They also give you the benefits of compile-time type checking.</span></span>  
  
-   <span data-ttu-id="7d1a3-108">Utilizzare gli slot di dati quando i requisiti effettivi possono essere individuati solo in fase di esecuzione.</span><span class="sxs-lookup"><span data-stu-id="7d1a3-108">Use data slots when your actual requirements might be discovered only at run time.</span></span> <span data-ttu-id="7d1a3-109">Gli slot di dati sono più lenti e più difficili da utilizzare rispetto ai campi statici relativi ai thread e vengono archiviati come tipo di dati <xref:System.Object>, pertanto è necessario eseguirne il cast del tipo corretto prima di utilizzarlo.</span><span class="sxs-lookup"><span data-stu-id="7d1a3-109">Data slots are slower and more awkward to use than thread-relative static fields, and data is stored as type <xref:System.Object>, so you must cast it to the correct type before you use it.</span></span>  
  
 <span data-ttu-id="7d1a3-110">In C++ gestito, utilizza `TlsAlloc` per allocare gli slot dinamicamente e `__declspec(thread)` per dichiarare che una variabile deve essere allocata nel servizio di archiviazione relativi ai thread.</span><span class="sxs-lookup"><span data-stu-id="7d1a3-110">In unmanaged C++, you use `TlsAlloc` to allocate slots dynamically and `__declspec(thread)` to declare that a variable should be allocated in thread-relative storage.</span></span> <span data-ttu-id="7d1a3-111">Slot di dati e i campi statici relativi ai thread forniscono la versione gestita di questo comportamento.</span><span class="sxs-lookup"><span data-stu-id="7d1a3-111">Thread-relative static fields and data slots provide the managed version of this behavior.</span></span>  
  
 <span data-ttu-id="7d1a3-112">Nel [!INCLUDE[net_v40_long](../../../includes/net-v40-long-md.md)], è possibile utilizzare la <xref:System.Threading.ThreadLocal%601?displayProperty=nameWithType> classe per creare oggetti locali del thread che vengono inizializzati in modo differito quando l'oggetto viene innanzitutto utilizzato.</span><span class="sxs-lookup"><span data-stu-id="7d1a3-112">In the [!INCLUDE[net_v40_long](../../../includes/net-v40-long-md.md)], you can use the <xref:System.Threading.ThreadLocal%601?displayProperty=nameWithType> class to create thread-local objects that are initialized lazily when the object is first consumed.</span></span> <span data-ttu-id="7d1a3-113">Per altre informazioni, vedere [Inizializzazione differita](../../../docs/framework/performance/lazy-initialization.md).</span><span class="sxs-lookup"><span data-stu-id="7d1a3-113">For more information, see [Lazy Initialization](../../../docs/framework/performance/lazy-initialization.md).</span></span>  
  
## <a name="uniqueness-of-data-in-managed-tls"></a><span data-ttu-id="7d1a3-114">Univocità dei dati in TLS gestito</span><span class="sxs-lookup"><span data-stu-id="7d1a3-114">Uniqueness of Data in Managed TLS</span></span>  
 <span data-ttu-id="7d1a3-115">Se si usano i campi statici relativi ai thread o slot di dati, i dati in TLS gestito sono univoci per la combinazione di thread e un dominio applicazione.</span><span class="sxs-lookup"><span data-stu-id="7d1a3-115">Whether you use thread-relative static fields or data slots, data in managed TLS is unique to the combination of thread and application domain.</span></span>  
  
-   <span data-ttu-id="7d1a3-116">All'interno di un dominio applicazione, un thread non è possibile modificare i dati da un altro thread, anche se entrambi i thread usano lo stesso campo o uno slot.</span><span class="sxs-lookup"><span data-stu-id="7d1a3-116">Within an application domain, one thread cannot modify data from another thread, even when both threads use the same field or slot.</span></span>  
  
-   <span data-ttu-id="7d1a3-117">Quando un thread accede lo stesso campo o lo slot da più domini applicazione, viene mantenuto un valore distinto in ogni dominio applicazione.</span><span class="sxs-lookup"><span data-stu-id="7d1a3-117">When a thread accesses the same field or slot from multiple application domains, a separate value is maintained in each application domain.</span></span>  
  
 <span data-ttu-id="7d1a3-118">Ad esempio, se un thread imposta il valore di un campo statico relativi ai thread, entra in un altro dominio applicazione e quindi recupera il valore del campo, il valore recuperato nel secondo dominio applicazione è diverso dal valore nel dominio dell'applicazione prima.</span><span class="sxs-lookup"><span data-stu-id="7d1a3-118">For example, if a thread sets the value of a thread-relative static field, enters another application domain, and then retrieves the value of the field, the value retrieved in the second application domain differs from the value in the first application domain.</span></span> <span data-ttu-id="7d1a3-119">L'impostazione di un nuovo valore per il campo del secondo dominio di applicazione non interessa il valore del campo nel primo dominio di applicazione.</span><span class="sxs-lookup"><span data-stu-id="7d1a3-119">Setting a new value for the field in the second application domain does not affect the field's value in the first application domain.</span></span>  
  
 <span data-ttu-id="7d1a3-120">Analogamente, quando un thread ottiene lo stesso slot di dati con nome in due domini applicazione diversi, i dati nel primo dominio di applicazione rimangono indipendenti dai dati del secondo dominio di applicazione.</span><span class="sxs-lookup"><span data-stu-id="7d1a3-120">Similarly, when a thread gets the same named data slot in two different application domains, the data in the first application domain remains independent of the data in the second application domain.</span></span>  
  
## <a name="thread-relative-static-fields"></a><span data-ttu-id="7d1a3-121">Campi statici relativi ai thread</span><span class="sxs-lookup"><span data-stu-id="7d1a3-121">Thread-Relative Static Fields</span></span>  
 <span data-ttu-id="7d1a3-122">Se si è certi che dei dati sono sempre univoci per una combinazione di thread e dominio di applicazione, applicare il <xref:System.ThreadStaticAttribute> attributo per il campo statico.</span><span class="sxs-lookup"><span data-stu-id="7d1a3-122">If you know that a piece of data is always unique to a thread and application-domain combination, apply the <xref:System.ThreadStaticAttribute> attribute to the static field.</span></span> <span data-ttu-id="7d1a3-123">Utilizzare il campo si utilizza qualsiasi altro campo statico.</span><span class="sxs-lookup"><span data-stu-id="7d1a3-123">Use the field as you would use any other static field.</span></span> <span data-ttu-id="7d1a3-124">I dati nel campo sono univoci per ogni thread che lo utilizza.</span><span class="sxs-lookup"><span data-stu-id="7d1a3-124">The data in the field is unique to each thread that uses it.</span></span>  
  
 <span data-ttu-id="7d1a3-125">I campi statici relativi ai thread forniscono prestazioni migliori rispetto agli slot di dati e il vantaggio di controllo dei tipi in fase di compilazione.</span><span class="sxs-lookup"><span data-stu-id="7d1a3-125">Thread-relative static fields provide better performance than data slots and have the benefit of compile-time type checking.</span></span>  
  
 <span data-ttu-id="7d1a3-126">Tenere presente che qualsiasi codice del costruttore di classe verrà eseguito sul primo thread nel primo contesto che accede al campo.</span><span class="sxs-lookup"><span data-stu-id="7d1a3-126">Be aware that any class constructor code will run on the first thread in the first context that accesses the field.</span></span> <span data-ttu-id="7d1a3-127">In tutti gli altri thread o contesti nello stesso dominio dell'applicazione, i campi verranno inizializzati su `null` (`Nothing` in Visual Basic) se sono tipi di riferimento, o sui valori predefiniti i valori sono i tipi di valore.</span><span class="sxs-lookup"><span data-stu-id="7d1a3-127">In all other threads or contexts in the same application domain, the fields will be initialized to `null` (`Nothing` in Visual Basic) if they are reference types, or to their default values if they are value types.</span></span> <span data-ttu-id="7d1a3-128">Pertanto, deve fare affidamento sui costruttori di classe per inizializzare i campi statici relativi ai thread.</span><span class="sxs-lookup"><span data-stu-id="7d1a3-128">Therefore, you should not rely on class constructors to initialize thread-relative static fields.</span></span> <span data-ttu-id="7d1a3-129">Al contrario, evitare l'inizializzazione di campi statici relativi ai thread e supporre che vengano inizializzati a `null` (`Nothing`) o i valori predefiniti.</span><span class="sxs-lookup"><span data-stu-id="7d1a3-129">Instead, avoid initializing thread-relative static fields and assume that they are initialized to `null` (`Nothing`) or to their default values.</span></span>  
  
## <a name="data-slots"></a><span data-ttu-id="7d1a3-130">Slot di dati</span><span class="sxs-lookup"><span data-stu-id="7d1a3-130">Data Slots</span></span>  
 <span data-ttu-id="7d1a3-131">.NET Framework fornisce gli slot di dati dinamici che sono univoci a una combinazione di thread e dominio di applicazione.</span><span class="sxs-lookup"><span data-stu-id="7d1a3-131">The .NET Framework provides dynamic data slots that are unique to a combination of thread and application-domain.</span></span> <span data-ttu-id="7d1a3-132">Esistono due tipi di slot di dati: denominati e senza.</span><span class="sxs-lookup"><span data-stu-id="7d1a3-132">There are two types of data slots: named slots and unnamed slots.</span></span> <span data-ttu-id="7d1a3-133">Entrambi vengono implementati utilizzando la <xref:System.LocalDataStoreSlot> struttura.</span><span class="sxs-lookup"><span data-stu-id="7d1a3-133">Both are implemented by using the <xref:System.LocalDataStoreSlot> structure.</span></span>  
  
-   <span data-ttu-id="7d1a3-134">Per creare uno slot di dati denominato, usare il <xref:System.Threading.Thread.AllocateNamedDataSlot%2A?displayProperty=nameWithType> o <xref:System.Threading.Thread.GetNamedDataSlot%2A?displayProperty=nameWithType> metodo.</span><span class="sxs-lookup"><span data-stu-id="7d1a3-134">To create a named data slot, use the <xref:System.Threading.Thread.AllocateNamedDataSlot%2A?displayProperty=nameWithType> or <xref:System.Threading.Thread.GetNamedDataSlot%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="7d1a3-135">Per ottenere un riferimento a uno slot denominato esistente, passare il nome per il <xref:System.Threading.Thread.GetNamedDataSlot%2A> metodo.</span><span class="sxs-lookup"><span data-stu-id="7d1a3-135">To get a reference to an existing named slot, pass its name to the <xref:System.Threading.Thread.GetNamedDataSlot%2A> method.</span></span>  
  
-   <span data-ttu-id="7d1a3-136">Per creare uno slot di dati senza nome, utilizzare il <xref:System.Threading.Thread.AllocateDataSlot%2A?displayProperty=nameWithType> metodo.</span><span class="sxs-lookup"><span data-stu-id="7d1a3-136">To create an unnamed data slot, use the <xref:System.Threading.Thread.AllocateDataSlot%2A?displayProperty=nameWithType> method.</span></span>  
  
 <span data-ttu-id="7d1a3-137">Per entrambi denominati e senza nome slot, usare il <xref:System.Threading.Thread.SetData%2A?displayProperty=nameWithType> e <xref:System.Threading.Thread.GetData%2A?displayProperty=nameWithType> metodi per impostare e recuperare le informazioni nello slot.</span><span class="sxs-lookup"><span data-stu-id="7d1a3-137">For both named and unnamed slots, use the <xref:System.Threading.Thread.SetData%2A?displayProperty=nameWithType> and <xref:System.Threading.Thread.GetData%2A?displayProperty=nameWithType> methods to set and retrieve the information in the slot.</span></span> <span data-ttu-id="7d1a3-138">Si tratta di metodi statici che è sempre agiscono sui dati per il thread è in esecuzione.</span><span class="sxs-lookup"><span data-stu-id="7d1a3-138">These are static methods that always act on the data for the thread that is currently executing them.</span></span>  
  
 <span data-ttu-id="7d1a3-139">Gli slot denominati possono risultare utile, perché è possibile recuperare lo slot quando è necessario passando il nome per il <xref:System.Threading.Thread.GetNamedDataSlot%2A> (metodo), invece di mantenere un riferimento a uno slot senza nome.</span><span class="sxs-lookup"><span data-stu-id="7d1a3-139">Named slots can be convenient, because you can retrieve the slot when you need it by passing its name to the <xref:System.Threading.Thread.GetNamedDataSlot%2A> method, instead of maintaining a reference to an unnamed slot.</span></span> <span data-ttu-id="7d1a3-140">Tuttavia, se un altro componente utilizza lo stesso nome per lo spazio di archiviazione relativi ai thread e un thread esegue codice dal componente e l'altro componente, i due componenti possono danneggiare i dati.</span><span class="sxs-lookup"><span data-stu-id="7d1a3-140">However, if another component uses the same name for its thread-relative storage and a thread executes code from both your component and the other component, the two components might corrupt each other's data.</span></span> <span data-ttu-id="7d1a3-141">(Questo scenario si presuppone che entrambi i componenti siano in esecuzione nello stesso dominio applicazione e che essi non sono progettati per condividere gli stessi dati)</span><span class="sxs-lookup"><span data-stu-id="7d1a3-141">(This scenario assumes that both components are running in the same application domain, and that they are not designed to share the same data.)</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="7d1a3-142">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="7d1a3-142">See Also</span></span>  
 <xref:System.ContextStaticAttribute>  
 <xref:System.Threading.Thread.GetNamedDataSlot%2A?displayProperty=nameWithType>  
 <xref:System.ThreadStaticAttribute>  
 <xref:System.Runtime.Remoting.Messaging.CallContext>  
 [<span data-ttu-id="7d1a3-143">Threading</span><span class="sxs-lookup"><span data-stu-id="7d1a3-143">Threading</span></span>](../../../docs/standard/threading/index.md)
