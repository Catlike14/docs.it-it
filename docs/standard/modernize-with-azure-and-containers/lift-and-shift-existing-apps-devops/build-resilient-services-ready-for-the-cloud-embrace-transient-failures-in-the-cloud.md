---
title: Compilare servizi resilienti pronti per il cloud. Adottare gli errori temporanei nel cloud
description: Architettura di Microservizi .NET per le applicazioni nei contenitori .NET | Compilare servizi resilienti pronti per il cloud. Adottare gli errori temporanei nel cloud
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 10/26/2017
ms.workload:
- dotnet
- dotnetcore
ms.openlocfilehash: aaf1ef968600a56d91267c6c12efa90d99446dd7
ms.sourcegitcommit: c0dd436f6f8f44dc80dc43b07f6841a00b74b23f
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/19/2018
---
# <a name="build-resilient-services-ready-for-the-cloud-embrace-transient-failures-in-the-cloud"></a><span data-ttu-id="ee775-105">Compilare servizi resilienti pronti per il cloud: adottare gli errori temporanei nel cloud</span><span class="sxs-lookup"><span data-stu-id="ee775-105">Build resilient services ready for the cloud: Embrace transient failures in the cloud</span></span> 

<span data-ttu-id="ee775-106">La resilienza è la capacità di correggere gli errori e continuare a funzionare.</span><span class="sxs-lookup"><span data-stu-id="ee775-106">Resiliency is the ability to recover from failures and continue to function.</span></span> <span data-ttu-id="ee775-107">Resilienza non è tuttavia evitare errori, ma che accetta il fatto che si verificheranno errori e rispondere ad essi in modo da evitare tempi di inattività o perdita di dati.</span><span class="sxs-lookup"><span data-stu-id="ee775-107">Resiliency is not about avoiding failures, but accepting the fact that failures will occur, and then responding to them in a way that avoids downtime or data loss.</span></span> <span data-ttu-id="ee775-108">L'obiettivo della resilienza è riportare l'applicazione in uno stato pienamente operativo dopo un errore.</span><span class="sxs-lookup"><span data-stu-id="ee775-108">The goal of resiliency is to return the application to a fully functioning state after a failure.</span></span>

<span data-ttu-id="ee775-109">Quando, come minimo, implementa un modello basato sul software di resilienza, piuttosto che un modello basato su hardware, l'applicazione è pronta per il cloud.</span><span class="sxs-lookup"><span data-stu-id="ee775-109">Your application is ready for the cloud when, at a minimum, it implements a software-based model of resiliency, rather than a hardware-based model.</span></span> <span data-ttu-id="ee775-110">L'applicazione cloud deve prevedere l'eventualità di errori parziali che certamente si verificherà.</span><span class="sxs-lookup"><span data-stu-id="ee775-110">Your cloud application must embrace the partial failures that will certainly occur.</span></span> <span data-ttu-id="ee775-111">È necessario progettare o parzialmente il refactoring dell'applicazione se si desidera ottenere resilienza agli errori parziali previsto.</span><span class="sxs-lookup"><span data-stu-id="ee775-111">You need to design or partially refactor your application if you want to achieve resiliency to expected partial failures.</span></span> <span data-ttu-id="ee775-112">Deve essere progettato per gestire gli errori parziali, ad esempio interruzioni temporanee della rete e i nodi o le macchine virtuali nel cloud di un arresto anomalo.</span><span class="sxs-lookup"><span data-stu-id="ee775-112">It should be designed to cope with partial failures, like transient network outages and nodes, or VMs crashing in the cloud.</span></span> <span data-ttu-id="ee775-113">Anche i contenitori viene spostati su un nodo diverso all'interno di un cluster di orchestrator possono causare errori di breve intermittenti all'interno dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="ee775-113">Even containers being moved to a different node within an orchestrator cluster can cause intermittent short failures within the application.</span></span>

## <a name="handling-partial-failure"></a><span data-ttu-id="ee775-114">Gestione degli errori parziali</span><span class="sxs-lookup"><span data-stu-id="ee775-114">Handling partial failure</span></span>

<span data-ttu-id="ee775-115">In un'applicazione basata su cloud, c'è un rischio più di un errore parziale.</span><span class="sxs-lookup"><span data-stu-id="ee775-115">In a cloud-based application, there's an ever-present risk of partial failure.</span></span> <span data-ttu-id="ee775-116">Ad esempio, un'istanza singola del sito Web o un contenitore potrebbe non riuscire oppure potrebbe essere non disponibile o non risponde per un breve periodo di tempo.</span><span class="sxs-lookup"><span data-stu-id="ee775-116">For instance, a single website instance or a container might fail, or it might be unavailable or unresponsive for a short time.</span></span> <span data-ttu-id="ee775-117">In alternativa, una macchina virtuale o un server singolo potrebbe arrestarsi in modo anomalo.</span><span class="sxs-lookup"><span data-stu-id="ee775-117">Or, a single VM or server might crash.</span></span>

<span data-ttu-id="ee775-118">Poiché i client e servizi sono processi separati, un servizio potrebbe non essere in grado di rispondere in modo tempestivo a una richiesta del client.</span><span class="sxs-lookup"><span data-stu-id="ee775-118">Because clients and services are separate processes, a service might not be able to respond in a timely manner to a client's request.</span></span> <span data-ttu-id="ee775-119">Il servizio potrebbe essere sottoposto a overload e solo molto lentamente rispondere alle richieste o potrebbe semplicemente non essere accessibile per un breve periodo di tempo a causa di problemi di rete.</span><span class="sxs-lookup"><span data-stu-id="ee775-119">The service might be overloaded and respond extremely slowly to requests, or it might simply not be accessible for a short time because of network issues.</span></span>

<span data-ttu-id="ee775-120">Si consideri ad esempio un'applicazione .NET monolitica che accede a un database nel Database di SQL Azure.</span><span class="sxs-lookup"><span data-stu-id="ee775-120">For example, consider a monolithic .NET application that accesses a database in Azure SQL Database.</span></span> <span data-ttu-id="ee775-121">Se il database SQL di Azure o qualsiasi altro servizio di terze parti non risponde per una breve tempo (un database SQL di Azure potrebbe essere spostato in un server o un nodo diverso e non risponde per alcuni secondi), quando l'utente tenta di eseguire alcuna azione, l'applicazione potrebbe bloccarsi e un'eccezione al momento stessa w.</span><span class="sxs-lookup"><span data-stu-id="ee775-121">If the Azure SQL database or any other third-party service is unresponsive for a brief time (an Azure SQL database might be moved to a different node or server, and be unresponsive for a few seconds), when the user tries to do any action, the application might crash and show an exception at the very same moment.</span></span>

<span data-ttu-id="ee775-122">Uno scenario analogo può verificarsi in un'applicazione che utilizza i servizi HTTP.</span><span class="sxs-lookup"><span data-stu-id="ee775-122">A similar scenario might occur in an app that consumes HTTP services.</span></span> <span data-ttu-id="ee775-123">La rete o del servizio potrebbe non essere disponibile nel cloud durante un errore temporaneo, breve.</span><span class="sxs-lookup"><span data-stu-id="ee775-123">The network or the service itself might not be available in the cloud during a short, transient failure.</span></span>

<span data-ttu-id="ee775-124">Un'applicazione simile a quello illustrato nella figura 4-9 resiliente deve implementare tecniche come "tentativi con backoff esponenziale" per assegnare all'applicazione la possibilità di gestire gli errori temporanei nelle risorse.</span><span class="sxs-lookup"><span data-stu-id="ee775-124">A resilient application like the one shown in Figure 4-9 should implement techniques like "retries with exponential backoff" to give the application an opportunity to handle transient failures in resources.</span></span> <span data-ttu-id="ee775-125">È inoltre necessario utilizzare "interruttori" nelle applicazioni.</span><span class="sxs-lookup"><span data-stu-id="ee775-125">You also should use "circuit breakers" in your applications.</span></span> <span data-ttu-id="ee775-126">Un interruttore arresta un'applicazione di tentare di accedere a una risorsa quando è effettivamente un errore a lungo termine.</span><span class="sxs-lookup"><span data-stu-id="ee775-126">A circuit breaker stops an application from trying to access a resource when it's actually a long-term failure.</span></span> <span data-ttu-id="ee775-127">Utilizzando un interruttore, l'applicazione evita avere provocato un attacco denial of service a se stessa.</span><span class="sxs-lookup"><span data-stu-id="ee775-127">By using a circuit breaker, the application avoids provoking a denial of service to itself.</span></span>

![Errori parziali gestiti dai tentativi con backoff esponenziale](./media/image9.png)

> <span data-ttu-id="ee775-129">**Figura 4 a 9.**</span><span class="sxs-lookup"><span data-stu-id="ee775-129">**Figure 4-9.**</span></span> <span data-ttu-id="ee775-130">Errori parziali gestiti dai tentativi con backoff esponenziale</span><span class="sxs-lookup"><span data-stu-id="ee775-130">Partial failures handled by retries with exponential backoff</span></span>

<span data-ttu-id="ee775-131">È possibile utilizzare queste tecniche in risorse HTTP e nelle risorse di database.</span><span class="sxs-lookup"><span data-stu-id="ee775-131">You can use these techniques both in HTTP resources and in database resources.</span></span> <span data-ttu-id="ee775-132">Nella figura 4-9, l'applicazione si basa su un'architettura a 3 livelli, pertanto è necessario queste tecniche a livello di servizi (HTTP) e al livello dati (TCP).</span><span class="sxs-lookup"><span data-stu-id="ee775-132">In Figure 4-9, the application is based on a 3-tier architecture, so you need these techniques at the services level (HTTP) and at the data tier level (TCP).</span></span> <span data-ttu-id="ee775-133">In un'applicazione monolitica che utilizza solo un livello di singola app oltre al database (servizi aggiuntivi o microservizi), gestione degli errori temporanei a livello di connessione di database potrebbe essere sufficiente.</span><span class="sxs-lookup"><span data-stu-id="ee775-133">In a monolithic application that uses only a single app tier in addition to the database (no additional services or microservices), handling transient failures at the database connection level might be enough.</span></span> <span data-ttu-id="ee775-134">In questo scenario, è necessario in genere solo una particolare configurazione della connessione di database.</span><span class="sxs-lookup"><span data-stu-id="ee775-134">In that scenario, usually just a particular configuration of the database connection is required.</span></span>

<span data-ttu-id="ee775-135">Quando si implementa resiliente delle comunicazioni che accedono al database, a seconda della versione di .NET in uso, può essere molto semplice (ad esempio, [con Entity Framework 6 o versione successiva](https://msdn.microsoft.com/library/dn456835(v=vs.113).aspx), è sufficiente la configurazione di connessione di database).</span><span class="sxs-lookup"><span data-stu-id="ee775-135">When implementing resilient communications that access the database, depending on the version of .NET you are using, it can be very straightforward (for example, [with Entity Framework 6 or later](https://msdn.microsoft.com/library/dn456835(v=vs.113).aspx), it's just a matter of configuring the database connection).</span></span> <span data-ttu-id="ee775-136">In alternativa, potrebbe essere necessario utilizzare librerie aggiuntive come la [Transient Fault Handling Application Block](https://msdn.microsoft.com/library/hh680934(v=pandp.50).aspx) (per le versioni precedenti di .NET), o anche di implementare la propria libreria.</span><span class="sxs-lookup"><span data-stu-id="ee775-136">Or, you might need to use additional libraries like the [Transient Fault Handling Application Block](https://msdn.microsoft.com/library/hh680934(v=pandp.50).aspx) (for earlier versions of .NET), or even implement your own library.</span></span>

<span data-ttu-id="ee775-137">Quando si implementa tentativi HTTP e circuito, l'indicazione per .NET consiste nell'usare il [Polly](https://github.com/App-vNext/Polly) libreria che ha come destinazione .NET 4.0, .NET 4.5 e .NET Standard 1.1, che include il supporto di .NET Core.</span><span class="sxs-lookup"><span data-stu-id="ee775-137">When implementing HTTP retries and circuit breakers, the recommendation for .NET is to use the [Polly](https://github.com/App-vNext/Polly) library, which targets .NET 4.0, .NET 4.5, and .NET Standard 1.1, which includes .NET Core support.</span></span>

<span data-ttu-id="ee775-138">Per informazioni su come implementare strategie di gestione degli errori parziali nel cloud, vedere i seguenti riferimenti.</span><span class="sxs-lookup"><span data-stu-id="ee775-138">To learn how to implement strategies for handling partial failures in the cloud, see the following references.</span></span>

### <a name="additional-resources"></a><span data-ttu-id="ee775-139">Risorse aggiuntive</span><span class="sxs-lookup"><span data-stu-id="ee775-139">Additional resources</span></span>

-   <span data-ttu-id="ee775-140">**Implementazione di comunicazione resiliente per gestire gli errori parziali**</span><span class="sxs-lookup"><span data-stu-id="ee775-140">**Implementing resilient communication to handle partial failure**</span></span>

    [<span data-ttu-id="ee775-141">https://docs.microsoft.com/dotnet/standard/microservices-architecture/implement-resilient-applications/partial-failure-strategies</span><span class="sxs-lookup"><span data-stu-id="ee775-141">https://docs.microsoft.com/dotnet/standard/microservices-architecture/implement-resilient-applications/partial-failure-strategies</span></span>](https://docs.microsoft.com/dotnet/standard/microservices-architecture/implement-resilient-applications/partial-failure-strategies)

-   <span data-ttu-id="ee775-142">**Entità connessione resilienza e riprovare la logica del Framework (versione 6 e versioni successive)**</span><span class="sxs-lookup"><span data-stu-id="ee775-142">**Entity Framework connection resiliency and retry logic (version 6 and later)**</span></span>

    <span data-ttu-id="ee775-143">[https://msdn.microsoft.com/library/dn456835(v=vs.113).aspx](https://msdn.microsoft.com/library/dn456835(v=vs.113).aspx)</span><span class="sxs-lookup"><span data-stu-id="ee775-143">[https://msdn.microsoft.com/library/dn456835(v=vs.113).aspx](https://msdn.microsoft.com/library/dn456835(v=vs.113).aspx)</span></span>

-   <span data-ttu-id="ee775-144">**Il blocco applicazione di gestione degli errori temporanei**</span><span class="sxs-lookup"><span data-stu-id="ee775-144">**The Transient Fault Handling Application Block**</span></span>

<!-- -->

-   <span data-ttu-id="ee775-145">[https://msdn.microsoft.com/library/hh680934(v=pandp.50).aspx](https://msdn.microsoft.com/library/hh680934(v=pandp.50).aspx)</span><span class="sxs-lookup"><span data-stu-id="ee775-145">[https://msdn.microsoft.com/library/hh680934(v=pandp.50).aspx](https://msdn.microsoft.com/library/hh680934(v=pandp.50).aspx)</span></span>

-   <span data-ttu-id="ee775-146">**Libreria Polly per le comunicazioni HTTP resilienti**</span><span class="sxs-lookup"><span data-stu-id="ee775-146">**Polly library for resilient HTTP communication**</span></span>

    <span data-ttu-id="ee775-147">https://github.com/App-vNext/Polly</span><span class="sxs-lookup"><span data-stu-id="ee775-147">https://github.com/App-vNext/Polly</span></span>

>[!div class="step-by-step"]
<span data-ttu-id="ee775-148">[Precedente](when-to-deploy-windows-containers-to-azure-container-service-kubernetes.md)
[Successivo](modernize-your-apps-with-monitoring-and-telemetry.md)</span><span class="sxs-lookup"><span data-stu-id="ee775-148">[Previous](when-to-deploy-windows-containers-to-azure-container-service-kubernetes.md)
[Next](modernize-your-apps-with-monitoring-and-telemetry.md)</span></span>
