---
title: Test ASP.NET Core applicazioni MVC
description: Architettura di moderne applicazioni Web con ASP.NET Core e Azure | Test ASP.NET Core applicazioni MVC
author: ardalis
ms.author: wiwagn
ms.date: 10/08/2017
ms.prod: .net-core
ms.technology: dotnet-docker
ms.workload:
- dotnet
- dotnetcore
ms.openlocfilehash: d23d0accc33fb8335dff602d6e1d6c8689972906
ms.sourcegitcommit: e7f04439d78909229506b56935a1105a4149ff3d
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 12/23/2017
---
# <a name="test-aspnet-core-mvc-apps"></a><span data-ttu-id="82262-103">Test ASP.NET Core applicazioni MVC</span><span class="sxs-lookup"><span data-stu-id="82262-103">Test ASP.NET Core MVC Apps</span></span>

> <span data-ttu-id="82262-104">_"Se non si desidera che gli unit test del prodotto, molto probabilmente i clienti non desiderano eseguire il test, sia."_</span><span class="sxs-lookup"><span data-stu-id="82262-104">_"If you don't like unit testing your product, most likely your customers won't like to test it, either."_</span></span>
> <span data-ttu-id="82262-105">_ - Anonimo:</span><span class="sxs-lookup"><span data-stu-id="82262-105">_- Anonymous-</span></span>

## <a name="summary"></a><span data-ttu-id="82262-106">Riepilogo</span><span class="sxs-lookup"><span data-stu-id="82262-106">Summary</span></span>

<span data-ttu-id="82262-107">Software di qualsiasi complessità può non riuscire in modo imprevisto in risposta alle modifiche.</span><span class="sxs-lookup"><span data-stu-id="82262-107">Software of any complexity can fail in unexpected ways in response to changes.</span></span> <span data-ttu-id="82262-108">Di conseguenza, è necessario per tutte le applicazioni più comuni (o meno critiche) eseguire test dopo aver apportato modifiche.</span><span class="sxs-lookup"><span data-stu-id="82262-108">Thus, testing after making changes is required for all but the most trivial (or least critical) applications.</span></span> <span data-ttu-id="82262-109">Il test manuale è il più lento, modo meno affidabile e più costoso per testare il software.</span><span class="sxs-lookup"><span data-stu-id="82262-109">Manual testing is the slowest, least reliable, most expensive way to test software.</span></span> <span data-ttu-id="82262-110">Sfortunatamente, se le applicazioni non sono progettate per essere sottoposti a test, può essere l'unico mezzo disponibile.</span><span class="sxs-lookup"><span data-stu-id="82262-110">Unfortunately, if applications are not designed to be testable, it can be the only means available.</span></span> <span data-ttu-id="82262-111">Le applicazioni scritte seguenti principi architetturali disposti nel capitolo X devono essere unità testabili e delle applicazioni ASP.NET Core supportano automatizzate e anche eseguire test funzionali.</span><span class="sxs-lookup"><span data-stu-id="82262-111">Applications written following the architectural principles laid out in chapter X should be unit testable, and ASP.NET Core applications support automated integration and functional testing as well.</span></span>

## <a name="kinds-of-automated-tests"></a><span data-ttu-id="82262-112">Tipi di test automatizzati</span><span class="sxs-lookup"><span data-stu-id="82262-112">Kinds of Automated Tests</span></span>

<span data-ttu-id="82262-113">Esistono molti tipi di test automatizzati per le applicazioni software.</span><span class="sxs-lookup"><span data-stu-id="82262-113">There are many kinds of automated tests for software applications.</span></span> <span data-ttu-id="82262-114">La più semplice, test di livello più basso è lo unit test.</span><span class="sxs-lookup"><span data-stu-id="82262-114">The simplest, lowest level test is the unit test.</span></span> <span data-ttu-id="82262-115">A un livello leggermente superiore sono presenti test funzionali e test di integrazione.</span><span class="sxs-lookup"><span data-stu-id="82262-115">At a slightly higher level there are integration tests and functional tests.</span></span> <span data-ttu-id="82262-116">Altri tipi di test, come i test dell'interfaccia utente, test di carico, test di stress e smoke test, non rientrano nell'ambito di questo documento.</span><span class="sxs-lookup"><span data-stu-id="82262-116">Other kinds of tests, like UI tests, load tests, stress tests, and smoke tests, are beyond the scope of this document.</span></span>

### <a name="unit-tests"></a><span data-ttu-id="82262-117">Unit test</span><span class="sxs-lookup"><span data-stu-id="82262-117">Unit Tests</span></span>

<span data-ttu-id="82262-118">Uno unit test di verifica di una singola parte della logica dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="82262-118">A unit test tests a single part of your application's logic.</span></span> <span data-ttu-id="82262-119">Una possibile descrivere ulteriormente elencando alcune delle operazioni che non lo è.</span><span class="sxs-lookup"><span data-stu-id="82262-119">One can further describe it by listing some of the things that it isn't.</span></span> <span data-ttu-id="82262-120">Non testare uno unit test come i codice funziona correttamente con dipendenze o infrastruttura, quali integration test sono per.</span><span class="sxs-lookup"><span data-stu-id="82262-120">A unit test doesn't test how your code works with dependencies or infrastructure – that's what integration tests are for.</span></span> <span data-ttu-id="82262-121">Uno unit test non verifica il framework per scrivere il codice in: è necessario presupporre che funziona o, se si ritiene non, inviare un bug e code di una soluzione alternativa.</span><span class="sxs-lookup"><span data-stu-id="82262-121">A unit test doesn't test the framework your code is written on – you should assume it works or, if you find it doesn't, file a bug and code a workaround.</span></span> <span data-ttu-id="82262-122">Uno unit test viene eseguito completamente in memoria e nel processo.</span><span class="sxs-lookup"><span data-stu-id="82262-122">A unit test runs completely in memory and in process.</span></span> <span data-ttu-id="82262-123">Comunica con il file system, la rete o un database.</span><span class="sxs-lookup"><span data-stu-id="82262-123">It doesn't communicate with the file system, the network, or a database.</span></span> <span data-ttu-id="82262-124">Unit test solo i test del codice.</span><span class="sxs-lookup"><span data-stu-id="82262-124">Unit tests should only test your code.</span></span>

<span data-ttu-id="82262-125">Unit test, grazie al fatto che solo una singola unità di codice, senza dipendenze esterne, eseguono il test deve essere eseguita molto rapidamente.</span><span class="sxs-lookup"><span data-stu-id="82262-125">Unit tests, by virtue of the fact that they test only a single unit of your code, with no external dependencies, should execute extremely quickly.</span></span> <span data-ttu-id="82262-126">Pertanto, deve essere in grado di eseguire gruppi di test di centinaia di unit test in pochi secondi.</span><span class="sxs-lookup"><span data-stu-id="82262-126">Thus, you should be able to run test suites of hundreds of unit tests in a few seconds.</span></span> <span data-ttu-id="82262-127">È necessario eseguirli frequentemente, idealmente prima di ogni push a un repository del controllo del codice sorgente condiviso e certamente con ogni compilazione automatica nel server di compilazione.</span><span class="sxs-lookup"><span data-stu-id="82262-127">Run them frequently, ideally before every push to a shared source control repository, and certainly with every automated build on your build server.</span></span>

### <a name="integration-tests"></a><span data-ttu-id="82262-128">Test di integrazione</span><span class="sxs-lookup"><span data-stu-id="82262-128">Integration Tests</span></span>

<span data-ttu-id="82262-129">Sebbene sia consigliabile per incapsulare il codice che interagisce con infrastruttura come ad esempio database e file System, sarà comunque possibile parte del codice e si desidera eseguire il test probabilmente.</span><span class="sxs-lookup"><span data-stu-id="82262-129">Although it's a good idea to encapsulate your code that interacts with infrastructure like databases and file systems, you will still have some of that code, and you will probably want to test it.</span></span> <span data-ttu-id="82262-130">Inoltre, è necessario verificare che i livelli del codice interagiscono nel modo previsto quando sono completamente risolte le dipendenze dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="82262-130">Additionally, you should verify that your code's layers interact as you expect when your application's dependencies are fully resolved.</span></span> <span data-ttu-id="82262-131">Questa è la responsabilità di test di integrazione.</span><span class="sxs-lookup"><span data-stu-id="82262-131">This is the responsibility of integration tests.</span></span> <span data-ttu-id="82262-132">Test di integrazione tendono a essere più lenta e più difficili da configurare rispetto agli unit test, perché spesso dipendono dell'infrastruttura e le dipendenze esterne.</span><span class="sxs-lookup"><span data-stu-id="82262-132">Integration tests tend to be slower and more difficult to set up than unit tests, because they often depend on external dependencies and infrastructure.</span></span> <span data-ttu-id="82262-133">Di conseguenza, è consigliabile evitare di operazioni che potrebbero essere test con unit test in test di integrazione di test.</span><span class="sxs-lookup"><span data-stu-id="82262-133">Thus, you should avoid testing things that could be tests with unit tests in integration tests.</span></span> <span data-ttu-id="82262-134">Se è possibile testare uno scenario specifico con uno unit test, è necessario eseguirne il test con uno unit test.</span><span class="sxs-lookup"><span data-stu-id="82262-134">If you can test a given scenario with a unit test, you should test it with a unit test.</span></span> <span data-ttu-id="82262-135">Se non è possibile, utilizzare un test di integrazione.</span><span class="sxs-lookup"><span data-stu-id="82262-135">If you can't, then consider using an integration test.</span></span>

<span data-ttu-id="82262-136">Test di integrazione sono spesso contenuti più complessi e disinstallazione procedure di configurazione di unit test.</span><span class="sxs-lookup"><span data-stu-id="82262-136">Integration tests will often have more complex setup and teardown procedures than unit tests.</span></span> <span data-ttu-id="82262-137">Ad esempio, un test di integrazione che va inserito in un database effettivo sarà necessario un modo per riportare il database in uno stato noto prima di ciascuna esecuzione dei test.</span><span class="sxs-lookup"><span data-stu-id="82262-137">For example, an integration test that goes against an actual database will need a way to return the database to a known state before each test run.</span></span> <span data-ttu-id="82262-138">Come vengono aggiunti nuovi test e lo schema del database di produzione si evolve, questi test script verrà tendono ad aumentare le dimensioni e complessità.</span><span class="sxs-lookup"><span data-stu-id="82262-138">As new tests are added and the production database schema evolves, these test scripts will tend to grow in size and complexity.</span></span> <span data-ttu-id="82262-139">In molti sistemi di grandi dimensioni, non è pratico eseguire completi gruppi di test di integrazione sulle workstation degli sviluppatori prima di archiviare le modifiche apportate al controllo del codice sorgente condiviso.</span><span class="sxs-lookup"><span data-stu-id="82262-139">In many large systems, it is impractical to run full suites of integration tests on developer workstations before checking in changes to shared source control.</span></span> <span data-ttu-id="82262-140">In questi casi, è possibile eseguire test di integrazione in un server di compilazione.</span><span class="sxs-lookup"><span data-stu-id="82262-140">In these cases, integration tests may be run on a build server.</span></span>

<span data-ttu-id="82262-141">La classe di implementazione LocalFileImageService implementa la logica per il recupero e restituisce i byte di un file di immagine da una cartella particolare assegnata un id:</span><span class="sxs-lookup"><span data-stu-id="82262-141">The LocalFileImageService implementation class implements the logic for fetching and returning the bytes of an image file from a particular folder given an id:</span></span>

```cs
public class LocalFileImageService : IImageService
{
    private readonly IHostingEnvironment _env;
    public LocalFileImageService(IHostingEnvironment env)
    {
        _env = env;
    }
    public byte[] GetImageBytesById(int id)
    {
        try
        {
            var contentRoot = _env.ContentRootPath + "//Pics";
            var path = Path.Combine(contentRoot, id + ".png");
            return File.ReadAllBytes(path);
```

### <a name="functional-tests"></a><span data-ttu-id="82262-142">Test funzionali</span><span class="sxs-lookup"><span data-stu-id="82262-142">Functional Tests</span></span>

<span data-ttu-id="82262-143">Test di integrazione vengono scritti dal punto di vista dello sviluppatore, verificare che alcuni componenti del sistema interagiscano correttamente.</span><span class="sxs-lookup"><span data-stu-id="82262-143">Integration tests are written from the perspective of the developer, to verify that some components of the system work correctly together.</span></span> <span data-ttu-id="82262-144">Test funzionali vengono scritte dal punto di vista dell'utente e verificare la correttezza del sistema in base ai relativi requisiti.</span><span class="sxs-lookup"><span data-stu-id="82262-144">Functional tests are written from the perspective of the user, and verify the correctness of the system based on its requirements.</span></span> <span data-ttu-id="82262-145">L'estratto seguente offre un'utile analogia come preoccuparsi di test funzionali, rispetto agli unit test:</span><span class="sxs-lookup"><span data-stu-id="82262-145">The following excerpt offers a useful analogy for how to think about functional tests, compared to unit tests:</span></span>

> <span data-ttu-id="82262-146">"È paragonato più volte lo sviluppo di un sistema per la compilazione di una casa.</span><span class="sxs-lookup"><span data-stu-id="82262-146">"Many times the development of a system is likened to the building of a house.</span></span> <span data-ttu-id="82262-147">Durante questa analogia non è abbastanza corretta, è possibile estenderlo per quanto riguarda le differenze tra unit test e test funzionale.</span><span class="sxs-lookup"><span data-stu-id="82262-147">While this analogy isn't quite correct, we can extend it for the purposes of understanding the difference between unit and functional tests.</span></span> <span data-ttu-id="82262-148">Unit test è analogo a un controllo di compilazione, visitare il sito di costruzione di un'abitazione.</span><span class="sxs-lookup"><span data-stu-id="82262-148">Unit testing is analogous to a building inspector visiting a house's construction site.</span></span> <span data-ttu-id="82262-149">Giorgio è incentrato sui vari sistemi interni dell'abitazione, foundation, frame, elettrica, plumbing e così via.</span><span class="sxs-lookup"><span data-stu-id="82262-149">He is focused on the various internal systems of the house, the foundation, framing, electrical, plumbing, and so on.</span></span> <span data-ttu-id="82262-150">Verificare che (test), che le parti della casa verranno correttamente e in modo sicuro, vale a dire, soddisfare il codice di compilazione.</span><span class="sxs-lookup"><span data-stu-id="82262-150">He ensures (tests) that the parts of the house will work correctly and safely, that is, meet the building code.</span></span> <span data-ttu-id="82262-151">Test funzionali in questo scenario sono analoghe al proprietario di immobile citato visitare il sito stesso di costruzione.</span><span class="sxs-lookup"><span data-stu-id="82262-151">Functional tests in this scenario are analogous to the homeowner visiting this same construction site.</span></span> <span data-ttu-id="82262-152">Si presuppone che i sistemi interni si comporterà in modo appropriato, che il controllo di compilazione sta eseguendo un'operazione.</span><span class="sxs-lookup"><span data-stu-id="82262-152">He assumes that the internal systems will behave appropriately, that the building inspector is performing his task.</span></span> <span data-ttu-id="82262-153">Il proprietario di immobile citato è incentrata su cosa sarà simile a live questa casa.</span><span class="sxs-lookup"><span data-stu-id="82262-153">The homeowner is focused on what it will be like to live in this house.</span></span> <span data-ttu-id="82262-154">Egli si riferisce l'aspetto della casa, sono i vari room dimensioni familiarità, la casa esigenze della famiglia, sono windows in un luogo ideale per rilevare il sole mattina.</span><span class="sxs-lookup"><span data-stu-id="82262-154">He is concerned with how the house looks, are the various rooms a comfortable size, does the house fit the family's needs, are the windows in a good spot to catch the morning sun.</span></span> <span data-ttu-id="82262-155">Il proprietario di immobile citato esegue test funzionali in casa.</span><span class="sxs-lookup"><span data-stu-id="82262-155">The homeowner is performing functional tests on the house.</span></span> <span data-ttu-id="82262-156">Ha un punto di vista dell'utente.</span><span class="sxs-lookup"><span data-stu-id="82262-156">He has the user's perspective.</span></span> <span data-ttu-id="82262-157">Il controllo di compilazione esegue unit test in casa.</span><span class="sxs-lookup"><span data-stu-id="82262-157">The building inspector is performing unit tests on the house.</span></span> <span data-ttu-id="82262-158">Ha prospettiva del generatore."</span><span class="sxs-lookup"><span data-stu-id="82262-158">He has the builder's perspective."</span></span>

<span data-ttu-id="82262-159">Origine: [Unit test e test funzionali](http://www.softwaretestingtricks.com/2007/01/unit-testing-versus-functional-tests.html)</span><span class="sxs-lookup"><span data-stu-id="82262-159">Source: [Unit Testing versus Functional Tests](http://www.softwaretestingtricks.com/2007/01/unit-testing-versus-functional-tests.html)</span></span>

<span data-ttu-id="82262-160">Sto carattere indicando "usate dagli sviluppatori, di errore in due modi: creiamo la cosa errata o è compilare l'elemento corretto."</span><span class="sxs-lookup"><span data-stu-id="82262-160">I'm fond of saying "As developers, we fail in two ways: we build the thing wrong, or we build the wrong thing."</span></span> <span data-ttu-id="82262-161">Verificare che si sta compilando il diritto di cosa; unit test test funzionali verificare che si sta compilando il giusto.</span><span class="sxs-lookup"><span data-stu-id="82262-161">Unit tests ensure you are building the thing right; functional tests ensure you are building the right thing.</span></span>

<span data-ttu-id="82262-162">Poiché i test funzionali operano a livello di sistema, richiedere un certo grado di automazione interfaccia utente.</span><span class="sxs-lookup"><span data-stu-id="82262-162">Since functional tests operate at the system level, they may require some degree of UI automation.</span></span> <span data-ttu-id="82262-163">Ad esempio test di integrazione, e in genere funzionano con un tipo di infrastruttura di test anche.</span><span class="sxs-lookup"><span data-stu-id="82262-163">Like integration tests, they usually work with some kind of test infrastructure as well.</span></span> <span data-ttu-id="82262-164">Questo li rende più lenta e più fragile di unit test e integrazione test.</span><span class="sxs-lookup"><span data-stu-id="82262-164">This makes them slower and more brittle than unit and integration tests.</span></span> <span data-ttu-id="82262-165">È necessario solo come molti test funzionali che è necessario avere la certezza che il sistema funzioni come gli utenti.</span><span class="sxs-lookup"><span data-stu-id="82262-165">You should have only as many functional tests as you need to be confident the system is behaving as users expect.</span></span>

### <a name="testing-pyramid"></a><span data-ttu-id="82262-166">Test a piramide</span><span class="sxs-lookup"><span data-stu-id="82262-166">Testing Pyramid</span></span>

<span data-ttu-id="82262-167">Martin Fowler è parlato della piramide test, un esempio di cui è illustrato nella figura 9-1.</span><span class="sxs-lookup"><span data-stu-id="82262-167">Martin Fowler wrote about the testing pyramid, an example of which is shown in Figure 9-1.</span></span>

![](./media/image9-1.png)

<span data-ttu-id="82262-168">Figura 9-1 test a piramide</span><span class="sxs-lookup"><span data-stu-id="82262-168">Figure 9-1 Testing Pyramid</span></span>

<span data-ttu-id="82262-169">I diversi livelli di piramide e le dimensioni relative, rappresentano i diversi tipi di test e il numero è consigliabile scrivere per l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="82262-169">The different layers of the pyramid, and their relative sizes, represent different kinds of tests and how many you should write for your application.</span></span> <span data-ttu-id="82262-170">Come si può notare, l'indicazione è che una grande quantità di unit test, supportato da un livello inferiore di test di integrazione, con un livello ancora più piccolo di test funzionali.</span><span class="sxs-lookup"><span data-stu-id="82262-170">As you can see, the recommendation is to have a large base of unit tests, supported by a smaller layer of integration tests, with an even smaller layer of functional tests.</span></span> <span data-ttu-id="82262-171">Ogni livello idealmente può contenere solo test che non è possibile eseguire in modo adeguato a un livello inferiore.</span><span class="sxs-lookup"><span data-stu-id="82262-171">Each layer should ideally only have tests in it that cannot be performed adequately at a lower layer.</span></span> <span data-ttu-id="82262-172">Tenere presente della piramide test quando si sta tentando di decidere quale tipo di test è necessario per un determinato scenario.</span><span class="sxs-lookup"><span data-stu-id="82262-172">Keep the testing pyramid in mind when you are trying to decide which kind of test you need for a particular scenario.</span></span>

### <a name="what-to-test"></a><span data-ttu-id="82262-173">Cosa accade a Test</span><span class="sxs-lookup"><span data-stu-id="82262-173">What to Test</span></span>

<span data-ttu-id="82262-174">Con il contenuto eseguire il test è a presentarsi un problema comune per gli sviluppatori che non hanno dimestichezza con la scrittura di test automatizzati.</span><span class="sxs-lookup"><span data-stu-id="82262-174">A common problem for developers who are inexperienced with writing automated tests is coming up with what to test.</span></span> <span data-ttu-id="82262-175">Un buon punto di partenza è per testare la logica condizionale.</span><span class="sxs-lookup"><span data-stu-id="82262-175">A good starting point is to test conditional logic.</span></span> <span data-ttu-id="82262-176">In qualsiasi punto si dispone di un metodo con un comportamento che le modifiche in base a un'istruzione condizionale (if-else, cambiare, e così via), è possibile richiamare almeno un paio di test che confermano il comportamento corretto per determinate condizioni.</span><span class="sxs-lookup"><span data-stu-id="82262-176">Anywhere you have a method with behavior that changes based on a conditional statement (if-else, switch, etc.), you should be able to come up at least a couple of tests that confirm the correct behavior for certain conditions.</span></span> <span data-ttu-id="82262-177">Se il codice contiene le condizioni di errore, è consigliabile scrivere almeno un test per il percorso"i" tramite il codice (con nessun errore) e almeno un test per il percorso"sad" (con errori o risultati atipici) per confermare che l'applicazione si comporta come previsto in caso di errori.</span><span class="sxs-lookup"><span data-stu-id="82262-177">If your code has error conditions, it's good to write at least one test for the "happy path" through the code (with no errors), and at least one test for the "sad path" (with errors or atypical results) to confirm your application behaves as expected in the face of errors.</span></span> <span data-ttu-id="82262-178">Infine, provare a concentrarsi sulle operazioni che è possono eseguire il test, piuttosto che sulla metrica relativa a come il code coverage.</span><span class="sxs-lookup"><span data-stu-id="82262-178">Finally, try to focus on testing things that can fail, rather than focusing on metrics like code coverage.</span></span> <span data-ttu-id="82262-179">Altre code coverage è migliore di minore, in genere.</span><span class="sxs-lookup"><span data-stu-id="82262-179">More code coverage is better than less, generally.</span></span> <span data-ttu-id="82262-180">Tuttavia, la scrittura di un numero limitato di test più di un metodo molto complesso e business-critical è in genere un migliore utilizzo di tempo rispetto alla scrittura di test per le proprietà automatiche solo migliorare la metrica di code coverage dei test.</span><span class="sxs-lookup"><span data-stu-id="82262-180">However, writing a few more tests of a very complex and business-critical method is usually a better use of time than writing tests for auto-properties just to improve test code coverage metrics.</span></span>

## <a name="organizing-test-projects"></a><span data-ttu-id="82262-181">Organizzazione dei progetti di Test</span><span class="sxs-lookup"><span data-stu-id="82262-181">Organizing Test Projects</span></span>

<span data-ttu-id="82262-182">Tuttavia i risultati migliori per l'utente, è possono organizzare i progetti di test.</span><span class="sxs-lookup"><span data-stu-id="82262-182">Test projects can be organized however works best for you.</span></span> <span data-ttu-id="82262-183">È consigliabile separare i test per tipo (unit test di, test di integrazione) e per cui il test (dal progetto, dallo spazio dei nomi).</span><span class="sxs-lookup"><span data-stu-id="82262-183">It's a good idea to separate tests by type (unit test, integration test) and by what they are testing (by project, by namespace).</span></span> <span data-ttu-id="82262-184">Se questa separazione costituita da cartelle all'interno di un progetto di test singolo o più progetti di test, è una decisione di progettazione.</span><span class="sxs-lookup"><span data-stu-id="82262-184">Whether this separation consists of folders within a single test project, or multiple test projects, is a design decision.</span></span> <span data-ttu-id="82262-185">Un progetto è più semplice, ma per progetti di grandi dimensioni con molti test, o per eseguire più facilmente diversi set di test, è consigliabile disporre di più progetti di test diversi.</span><span class="sxs-lookup"><span data-stu-id="82262-185">One project is simplest, but for large projects with many tests, or in order to more easily run different sets of tests, you might want to have several different test projects.</span></span> <span data-ttu-id="82262-186">Molti team per organizzare i progetti di test basati sul progetto sottoposto a test, che per le applicazioni con più progetti può comportare un numero elevato di progetti di test, soprattutto se è ancora suddividere questi in base alle quali sono di tipo di test in ogni progetto.</span><span class="sxs-lookup"><span data-stu-id="82262-186">Many teams organize test projects based on the project they are testing, which for applications with more than a few projects can result in a large number of test projects, especially if you still break these down according to what kind of tests are in each project.</span></span> <span data-ttu-id="82262-187">Un compromesso è che un progetto per ogni tipo di test, per ogni applicazione, con le cartelle all'interno di progetti di test per indicare il progetto e classe, sottoposto a test.</span><span class="sxs-lookup"><span data-stu-id="82262-187">A compromise approach is to have one project per kind of test, per application, with folders inside the test projects to indicate the project (and class) being tested.</span></span>

<span data-ttu-id="82262-188">Un approccio comune consiste nell'organizzare i progetti di applicazione in una cartella 'src' e i progetti di test dell'applicazione in una cartella parallel 'test'.</span><span class="sxs-lookup"><span data-stu-id="82262-188">A common approach is to organize the application projects under a ‘src' folder, and the application's test projects under a parallel ‘tests' folder.</span></span> <span data-ttu-id="82262-189">È possibile creare cartelle della soluzione corrispondente in Visual Studio, se utile questa organizzazione.</span><span class="sxs-lookup"><span data-stu-id="82262-189">You can create matching solution folders in Visual Studio, if you find this organization useful.</span></span>

![](./media/image9-2.png)

<span data-ttu-id="82262-190">Figura 9-2 di organizzazione dei Test nella soluzione</span><span class="sxs-lookup"><span data-stu-id="82262-190">Figure 9-2 Test organization in your solution</span></span>

<span data-ttu-id="82262-191">È possibile utilizzare qualsiasi framework di test desiderato.</span><span class="sxs-lookup"><span data-stu-id="82262-191">You can use whichever test framework you prefer.</span></span> <span data-ttu-id="82262-192">Il framework xUnit funziona e cosa è scritte in tutti i test di ASP.NET Core e componenti di base di Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="82262-192">The xUnit framework works well and is what all of the ASP.NET Core and EF Core tests are written in.</span></span> <span data-ttu-id="82262-193">È possibile aggiungere un progetto di test xUnit in Visual Studio usando il modello illustrato nella figura 9-3, oppure da CLI utilizzando dotnet nuovo xunit.</span><span class="sxs-lookup"><span data-stu-id="82262-193">You can add an xUnit test project in Visual Studio using the template shown in Figure 9-3, or from the CLI using dotnet new xunit.</span></span>

![](./media/image9-3.png)

<span data-ttu-id="82262-194">Nella figura 9-3 aggiungere un progetto di Test xUnit in Visual Studio</span><span class="sxs-lookup"><span data-stu-id="82262-194">Figure 9-3 Add an xUnit Test Project in Visual Studio</span></span>

### <a name="test-naming"></a><span data-ttu-id="82262-195">Denominazione di test</span><span class="sxs-lookup"><span data-stu-id="82262-195">Test Naming</span></span>

<span data-ttu-id="82262-196">I test in modo coerente, è necessario assegnare un nome con nomi che indicano lo scopo di ogni test.</span><span class="sxs-lookup"><span data-stu-id="82262-196">You should name your tests in a consistent fashion, with names that indicate what each test does.</span></span> <span data-ttu-id="82262-197">Un approccio che ho avuto successo con è alle classi di test di nome in base di classe e metodo che sottoposto a test.</span><span class="sxs-lookup"><span data-stu-id="82262-197">One approach I've had great success with is to name test classes according to the class and method they are testing.</span></span> <span data-ttu-id="82262-198">Di conseguenza, molte classi di test di piccole dimensioni, ma rende inoltre estremamente deselezionare che cos'è responsabili per ogni test.</span><span class="sxs-lookup"><span data-stu-id="82262-198">This results in many small test classes, but it makes it extremely clear what each test is responsible for.</span></span> <span data-ttu-id="82262-199">Con il nome di classe di test impostato per identificare la classe e il metodo da sottoporre a test, è possibile utilizzare il nome del metodo di test per specificare il comportamento sottoposto a test.</span><span class="sxs-lookup"><span data-stu-id="82262-199">With the test class name set up to identify the class and method to be tested, the test method name can be used to specify the behavior being tested.</span></span> <span data-ttu-id="82262-200">Deve includere il comportamento previsto e alcun input o i presupposti che devono produrre questo comportamento.</span><span class="sxs-lookup"><span data-stu-id="82262-200">This should include the expected behavior and any inputs or assumptions that should yield this behavior.</span></span> <span data-ttu-id="82262-201">Alcuni esempi di nomi di test:</span><span class="sxs-lookup"><span data-stu-id="82262-201">Some example test names:</span></span>

-   <span data-ttu-id="82262-202">CatalogControllerGetImage.CallsImageServiceWithId</span><span class="sxs-lookup"><span data-stu-id="82262-202">CatalogControllerGetImage.CallsImageServiceWithId</span></span>

-   <span data-ttu-id="82262-203">CatalogControllerGetImage.LogsWarningGivenImageMissingException</span><span class="sxs-lookup"><span data-stu-id="82262-203">CatalogControllerGetImage.LogsWarningGivenImageMissingException</span></span>

-   <span data-ttu-id="82262-204">CatalogControllerGetImage.ReturnsFileResultWithBytesGivenSuccess</span><span class="sxs-lookup"><span data-stu-id="82262-204">CatalogControllerGetImage.ReturnsFileResultWithBytesGivenSuccess</span></span>

-   <span data-ttu-id="82262-205">CatalogControllerGetImage.ReturnsNotFoundResultGivenImageMissingException</span><span class="sxs-lookup"><span data-stu-id="82262-205">CatalogControllerGetImage.ReturnsNotFoundResultGivenImageMissingException</span></span>

<span data-ttu-id="82262-206">Una variante di questo approccio termina con "Deve" nome di ogni classe di test e modifica i tempi verbali leggermente:</span><span class="sxs-lookup"><span data-stu-id="82262-206">A variation of this approach ends each test class name with "Should" and modifies the tense slightly:</span></span>

-   <span data-ttu-id="82262-207">CatalogControllerGetImage**deve**. **Chiamare**ImageServiceWithId</span><span class="sxs-lookup"><span data-stu-id="82262-207">CatalogControllerGetImage**Should**.**Call**ImageServiceWithId</span></span>

-   <span data-ttu-id="82262-208">CatalogControllerGetImage**deve**. **Log**WarningGivenImageMissingException</span><span class="sxs-lookup"><span data-stu-id="82262-208">CatalogControllerGetImage**Should**.**Log**WarningGivenImageMissingException</span></span>

<span data-ttu-id="82262-209">Alcuni team di trovare il secondo approccio più chiaro, denominazione tuttavia leggermente più dettagliata.</span><span class="sxs-lookup"><span data-stu-id="82262-209">Some teams find the second naming approach clearer, though slightly more verbose.</span></span> <span data-ttu-id="82262-210">In ogni caso, provare a utilizzare una convenzione di denominazione che consente di comprendere il comportamento di test, in modo che quando uno o più test hanno esito negativo, è evidente dai nomi dei quali casi non sono riuscita.</span><span class="sxs-lookup"><span data-stu-id="82262-210">In any case, try to use a naming convention that provides insight into test behavior, so that when one or more tests fail, it's obvious from their names what cases have failed.</span></span> <span data-ttu-id="82262-211">Evitare di denominare è test massima, ad esempio ControllerTests.Test1, perché queste offrono alcun valore, quando vengono visualizzate nei risultati del test.</span><span class="sxs-lookup"><span data-stu-id="82262-211">Avoid naming you tests vaguely, such as ControllerTests.Test1, as these offer no value when you see them in test results.</span></span>

<span data-ttu-id="82262-212">Se si segue una convenzione di denominazione come quella illustrata sopra che produce molte classi di test di piccole dimensioni, è consigliabile organizzare ulteriormente i test utilizzando le cartelle e spazi dei nomi.</span><span class="sxs-lookup"><span data-stu-id="82262-212">If you follow a naming convention like the one above that produces many small test classes, it's a good idea to further organize your tests using folders and namespaces.</span></span> <span data-ttu-id="82262-213">Nella figura 9-4 viene illustrato un approccio per l'organizzazione dei test dalla cartella all'interno dei progetti di test diversi.</span><span class="sxs-lookup"><span data-stu-id="82262-213">Figure 9-4 shows one approach to organizing tests by folder within several test projects.</span></span>

![](./media/image9-4.png)

<span data-ttu-id="82262-214">**Nella figura 9-4.**</span><span class="sxs-lookup"><span data-stu-id="82262-214">**Figure 9-4.**</span></span> <span data-ttu-id="82262-215">Organizzazione delle classi di test dalla cartella basato sulla classe da testare.</span><span class="sxs-lookup"><span data-stu-id="82262-215">Organizing test classes by folder based on class being tested.</span></span>

<span data-ttu-id="82262-216">Naturalmente, se una classe particolare applicazione dispone di molti metodi testati e pertanto molte classi di test, può essere utile inserire in una cartella corrispondente alla classe dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="82262-216">Of course, if a particular application class has many methods being tested (and thus many test classes), it may make sense to place these in a folder corresponding to the application class.</span></span> <span data-ttu-id="82262-217">Questa organizzazione non è diversa rispetto a come è possibile organizzare i file in cartelle in un' posizione.</span><span class="sxs-lookup"><span data-stu-id="82262-217">This organization is no different than how you might organize files into folders elsewhere.</span></span> <span data-ttu-id="82262-218">Se si dispone di più di tre o quattro i file in una cartella che contiene molti altri file correlati, è spesso utile per spostarli nella rispettiva sottocartella.</span><span class="sxs-lookup"><span data-stu-id="82262-218">If you have more than three or four related files in a folder containing many other files, it's often helpful to move them into their own subfolder.</span></span>

## <a name="unit-testing-aspnet-core-apps"></a><span data-ttu-id="82262-219">Unit test ASP.NET Core App</span><span class="sxs-lookup"><span data-stu-id="82262-219">Unit Testing ASP.NET Core Apps</span></span>

<span data-ttu-id="82262-220">In un'applicazione ASP.NET di base ben progettata, la maggior parte delle complessità e della logica di business verrà incapsulata in entità aziendali e una varietà di servizi.</span><span class="sxs-lookup"><span data-stu-id="82262-220">In a well-designed ASP.NET Core application, most of the complexity and business logic will be encapsulated in business entities and a variety of services.</span></span> <span data-ttu-id="82262-221">L'app ASP.NET MVC di base, con il controller, i filtri, ViewModel e viste, deve richiedere un numero esiguo di unit test.</span><span class="sxs-lookup"><span data-stu-id="82262-221">The ASP.NET Core MVC app itself, with its controllers, filters, viewmodels, and views, should require very few unit tests.</span></span> <span data-ttu-id="82262-222">La maggior parte delle funzionalità di un'azione specificata si trova all'esterno del metodo di azione stessa.</span><span class="sxs-lookup"><span data-stu-id="82262-222">Much of the functionality of a given action lies outside the action method itself.</span></span> <span data-ttu-id="82262-223">Verificare se il routing funziona correttamente, o la gestione degli errori globale non può essere eseguita in modo efficace con uno unit test.</span><span class="sxs-lookup"><span data-stu-id="82262-223">Testing whether routing works correctly, or global error handling, cannot be done effectively with a unit test.</span></span> <span data-ttu-id="82262-224">Analogamente, eventuali filtri, compresa l'autenticazione e la convalida del modello e i filtri di autorizzazione non può essere sottoposta a unit test.</span><span class="sxs-lookup"><span data-stu-id="82262-224">Likewise, any filters, including model validation and authentication and authorization filters, cannot be unit tested.</span></span> <span data-ttu-id="82262-225">Senza queste origini di comportamento, la maggior parte dei metodi di azione devono essere facilmente piccoli, delega la maggior parte delle attività di servizi che possono essere testati indipendente del controller in cui vengono utilizzati.</span><span class="sxs-lookup"><span data-stu-id="82262-225">Without these sources of behavior, most action methods should be trivially small, delegating the bulk of their work to services that can be tested independent of the controller that uses them.</span></span>

<span data-ttu-id="82262-226">In alcuni casi è necessario eseguire il refactoring del codice in ordine a unit test.</span><span class="sxs-lookup"><span data-stu-id="82262-226">Sometimes you'll need to refactor your code in order to unit test it.</span></span> <span data-ttu-id="82262-227">Spesso ciò comporta l'identificazione astrazioni e mediante l'inserimento di dipendenza per accedere l'astrazione nel codice di cui che si desidera testare, anziché scrivere codice direttamente per l'infrastruttura.</span><span class="sxs-lookup"><span data-stu-id="82262-227">Frequently this involves identifying abstractions and using dependency injection to access the abstraction in the code you'd like to test, rather than coding directly against infrastructure.</span></span> <span data-ttu-id="82262-228">Si consideri, ad esempio, questo metodo di azione semplice per la visualizzazione di immagini:</span><span class="sxs-lookup"><span data-stu-id="82262-228">For example, consider this simple action method for displaying images:</span></span>

```cs
[HttpGet("[controller]/pic/{id}")]
public IActionResult GetImage(int id)
{
    var contentRoot = _env.ContentRootPath + "//Pics";
    var path = Path.Combine(contentRoot, id + ".png");
    Byte[] b = System.IO.File.ReadAllBytes(path);
    return File(b, "image/png");
}
```

<span data-ttu-id="82262-229">Unit test di questo metodo è difficile da relativa dipendenza diretta su System.IO, che verrà utilizzato per leggere dal file system.</span><span class="sxs-lookup"><span data-stu-id="82262-229">Unit testing this method is made difficult by its direct dependency on System.IO.File, which it uses to read from the file system.</span></span> <span data-ttu-id="82262-230">È possibile verificare questo comportamento per assicurarsi che funzioni come previsto, ma in questo modo i file reali è un test di integrazione.</span><span class="sxs-lookup"><span data-stu-id="82262-230">You can test this behavior to ensure it works as expected, but doing so with real files is an integration test.</span></span> <span data-ttu-id="82262-231">Vale la pena notare route di questo metodo non è possibile testare, si vedrà come eseguire questa operazione con un test funzionale a breve.</span><span class="sxs-lookup"><span data-stu-id="82262-231">It's worth noting you can't test this method's route – you'll see how to do this with a functional test shortly.</span></span>

<span data-ttu-id="82262-232">Se non è possibile unit test del comportamento del file system direttamente e non è possibile testare la route, cosa è per eseguire il test?</span><span class="sxs-lookup"><span data-stu-id="82262-232">If you can't unit test the file system behavior directly, and you can't test the route, what is there to test?</span></span> <span data-ttu-id="82262-233">Anche dopo il refactoring per rendere possibile l'esecuzione di unit test, si potrebbe scoprire che alcuni test case e il comportamento mancano, ad esempio la gestione degli errori.</span><span class="sxs-lookup"><span data-stu-id="82262-233">Well, after refactoring to make unit testing possible, you may discover some test cases and missing behavior, such as error handling.</span></span> <span data-ttu-id="82262-234">Quali è il metodo? quando non viene trovato un file</span><span class="sxs-lookup"><span data-stu-id="82262-234">What does the method do when a file isn't found?</span></span> <span data-ttu-id="82262-235">Cosa è necessario fare?</span><span class="sxs-lookup"><span data-stu-id="82262-235">What should it do?</span></span> <span data-ttu-id="82262-236">In questo esempio, il metodo sottoposto a refactoring simile al seguente:</span><span class="sxs-lookup"><span data-stu-id="82262-236">In this example, the refactored method looks like this:</span></span>

```cs
[HttpGet("[controller]/pic/{id}")\]
public IActionResult GetImage(int id)
{
    byte[] imageBytes;
    try
    {
        imageBytes = _imageService.GetImageBytesById(id);
    }
    catch (CatalogImageMissingException ex)
    {
        _logger.LogWarning($"No image found for id: {id}");
        return NotFound();
    }
    return File(imageBytes, "image/png");
}
```

<span data-ttu-id="82262-237">Il \_logger e \_entrambi imageService vengono inseriti come dipendenze.</span><span class="sxs-lookup"><span data-stu-id="82262-237">The \_logger and \_imageService are both injected as dependencies.</span></span> <span data-ttu-id="82262-238">Ora è possibile verificare che lo stesso id che viene passato al metodo di azione viene passato per il \_imageService, e restituite come parte di FileResult i byte risultanti.</span><span class="sxs-lookup"><span data-stu-id="82262-238">Now you can test that the same id that is passed to the action method is passed to the \_imageService, and that the resulting bytes are returned as part of the FileResult.</span></span> <span data-ttu-id="82262-239">È possibile verificare anche che la registrazione degli errori è in corso come previsto e che viene restituito un risultato di NotFound se l'immagine è manca, presupponendo che il comportamento di importanti dell'applicazione (ovvero, non solo codice temporaneo lo sviluppatore aggiunto per diagnosticare un problema).</span><span class="sxs-lookup"><span data-stu-id="82262-239">You can also test that error logging is happening as expected, and that a NotFound result is returned if the image is missing, assuming this is important application behavior (that is, not just temporary code the developer added to diagnose an issue).</span></span> <span data-ttu-id="82262-240">La logica effettiva del file è stato spostato in un servizio separato di implementazione ed è stata migliorata per restituire un'eccezione specifiche dell'applicazione per il caso di un file mancante.</span><span class="sxs-lookup"><span data-stu-id="82262-240">The actual file logic has moved into a separate implementation service, and has been augmented to return an application-specific exception for the case of a missing file.</span></span> <span data-ttu-id="82262-241">È possibile testare questa implementazione in modo indipendente, utilizzando un test di integrazione.</span><span class="sxs-lookup"><span data-stu-id="82262-241">You can test this implementation independently, using an integration test.</span></span>

## <a name="integration-testing-aspnet-core-apps"></a><span data-ttu-id="82262-242">Integrazione di applicazioni ASP.NET Core test</span><span class="sxs-lookup"><span data-stu-id="82262-242">Integration Testing ASP.NET Core Apps</span></span>

```cs
    }
        catch (FileNotFoundException ex)
        {
            throw new CatalogImageMissingException(ex);
        }
    }
}
```

<span data-ttu-id="82262-243">Questo servizio utilizza IHostingEnvironment, come il CatalogController codice ha prima del refactoring in un servizio separato.</span><span class="sxs-lookup"><span data-stu-id="82262-243">This service uses the IHostingEnvironment, just as the CatalogController code did before it was refactored into a separate service.</span></span> <span data-ttu-id="82262-244">Poiché questo è l'unico codice nel controller utilizzato IHostingEnvironment, tale dipendenza è stata rimossa dal costruttore del CatalogController.</span><span class="sxs-lookup"><span data-stu-id="82262-244">Since this was the only code in the controller that used IHostingEnvironment, that dependency was removed from CatalogController's constructor.</span></span>

<span data-ttu-id="82262-245">Per verificare il corretto funzionamento di questo servizio, è necessario creare un file di immagine test nota e verificare che il servizio restituisce viene fornito un input specifico.</span><span class="sxs-lookup"><span data-stu-id="82262-245">To test that this service works correctly, you need to create a known test image file and verify that the service returns it given a specific input.</span></span> <span data-ttu-id="82262-246">È necessario prestare attenzione per non utilizzare gli oggetti fittizi al comportamento effettivamente da testare (in questo caso, la lettura dal file system).</span><span class="sxs-lookup"><span data-stu-id="82262-246">You should take care not to use mock objects on the behavior you actually want to test (in this case, reading from the file system).</span></span> <span data-ttu-id="82262-247">Oggetti fittizi, tuttavia, possono rivelarsi utili per impostare i test di integrazione.</span><span class="sxs-lookup"><span data-stu-id="82262-247">However, mock objects may still be useful to set up integration tests.</span></span> <span data-ttu-id="82262-248">In questo caso, è possibile simulare IHostingEnvironment in modo che il relativo ContentRootPath punta alla cartella che si intende utilizzare per l'immagine di test.</span><span class="sxs-lookup"><span data-stu-id="82262-248">In this case, you can mock IHostingEnvironment so that its ContentRootPath points to the folder you're going to use for your test image.</span></span> <span data-ttu-id="82262-249">La classe di test di integrazione funzionante completo è illustrata di seguito:</span><span class="sxs-lookup"><span data-stu-id="82262-249">The complete working integration test class is shown here:</span></span>

```cs
public class LocalFileImageServiceGetImageBytesById
{
    private byte[] _testBytes = new byte[] { 0x01, 0x02, 0x03 };
    private readonly Mock<IHostingEnvironment> _mockEnvironment = new Mock<IHostingEnvironment>();
    private int _testImageId = 123;
    private string _testFileName = "123.png";
    public LocalFileImageServiceGetImageBytesById()
    {
        // create folder if necessary
        Directory.CreateDirectory(Path.Combine(GetFileDirectory(), "Pics"));
        string filePath = GetFilePath(_testFileName);
        System.IO.File.WriteAllBytes(filePath, _testBytes);
        _mockEnvironment.SetupGet<string>(m => m.ContentRootPath).Returns(GetFileDirectory());
    }
    private string GetFilePath(string fileName)
    {
        return Path.Combine(GetFileDirectory(), "Pics", fileName);
        }
            private string GetFileDirectory()
        {
            var location = System.Reflection.Assembly.GetEntryAssembly().Location;
            return Path.GetDirectoryName(location);
        }

        [Fact]
        public void ReturnsFileContentResultGivenValidId()
        {
            var fileService = new LocalFileImageService(_mockEnvironment.Object);
            var result = fileService.GetImageBytesById(_testImageId);
            Assert.Equal(_testBytes, result);
        }
    }
```

> [!NOTE]
> <span data-ttu-id="82262-250">la maggior parte del codice che il test è molto semplice: è necessaria configurare il sistema e creare l'infrastruttura di test (in questo caso, un file da leggere dal disco).</span><span class="sxs-lookup"><span data-stu-id="82262-250">that the test itself is very simple – the bulk of the code is necessary to configure the system and create the testing infrastructure (in this case, an actual file to be read from disk).</span></span> <span data-ttu-id="82262-251">È tipico per i test di integrazione, che spesso richiedono operazioni di configurazione più complessa rispetto agli unit test.</span><span class="sxs-lookup"><span data-stu-id="82262-251">This is typical for integration tests, which often require more complex setup work than unit tests.</span></span>

## <a name="functional-testing-aspnet-core-apps"></a><span data-ttu-id="82262-252">Applicazioni ASP.NET Core test funzionali</span><span class="sxs-lookup"><span data-stu-id="82262-252">Functional Testing ASP.NET Core Apps</span></span>

<span data-ttu-id="82262-253">Per le applicazioni ASP.NET Core, la classe TestServer consente test funzionale piuttosto facili da scrivere.</span><span class="sxs-lookup"><span data-stu-id="82262-253">For ASP.NET Core applications, the TestServer class makes functional tests fairly easy to write.</span></span> <span data-ttu-id="82262-254">Configurare un TestServer utilizzando un WebHostBuilder, esattamente come si farebbe per l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="82262-254">You configure a TestServer using a WebHostBuilder, just as you normally do for your application.</span></span> <span data-ttu-id="82262-255">Questo WebHostBuilder deve essere configurato come host reale dell'applicazione, ma è possibile modificare tutti gli aspetti che facilitare il testing.</span><span class="sxs-lookup"><span data-stu-id="82262-255">This WebHostBuilder should be configured just like your application's real host, but you can modify any aspects of it that make testing easier.</span></span> <span data-ttu-id="82262-256">La maggior parte dei casi, riutilizzare la stessa TestServer per molti test case, in modo possibile incapsulare un metodo riutilizzabili (ad esempio in una classe di base):</span><span class="sxs-lookup"><span data-stu-id="82262-256">Most of the time, you'll reuse the same TestServer for many test cases, so you can encapsulate it in a reusable method (perhaps in a base class):</span></span>

```cs
public abstract class BaseWebTest
{
    protected readonly HttpClient _client;
    protected string _contentRoot;

    public BaseWebTest()
    {
        _client = GetClient();
    }
    
    protected HttpClient GetClient()
    {
        var startupAssembly = typeof(Startup).GetTypeInfo().Assembly;
        _contentRoot = GetProjectPath("src", startupAssembly);
        var builder = new WebHostBuilder()
        .UseContentRoot(_contentRoot)
        .UseStartup&lt;Startup&gt;();
        var server = new TestServer(builder);
        var client = server.CreateClient();
        return client;
    }
}
```

<span data-ttu-id="82262-257">GetProjectPath (metodo) restituisce semplicemente il percorso fisico per il progetto web (download soluzione di esempio).</span><span class="sxs-lookup"><span data-stu-id="82262-257">The GetProjectPath method simply returns the physical path to the web project (download sample solution).</span></span> <span data-ttu-id="82262-258">Il WebHostBuilder in questo caso semplicemente specifica dove è la radice del contenuto per l'applicazione web e fa riferimento alla stessa classe di avvio che viene utilizzata l'applicazione web reale.</span><span class="sxs-lookup"><span data-stu-id="82262-258">The WebHostBuilder in this case simply specifies where the content root for the web application is, and references the same Startup class the real web application uses.</span></span> <span data-ttu-id="82262-259">Per utilizzare il TestServer, utilizzare il tipo System.Net.HttpClient standard per effettuare richieste a esso.</span><span class="sxs-lookup"><span data-stu-id="82262-259">To work with the TestServer, you use the standard System.Net.HttpClient type to make requests to it.</span></span> <span data-ttu-id="82262-260">TestServer espone un metodo CreateClient utile che fornisce un client configurato in precedenza che è pronto per effettuare richieste per l'applicazione in esecuzione sul TestServer.</span><span class="sxs-lookup"><span data-stu-id="82262-260">TestServer exposes a helpful CreateClient method that provides a pre-configured client that is ready to make requests to the application running on the TestServer.</span></span> <span data-ttu-id="82262-261">Si utilizza questo client (impostato su protetto \_membro di client del test di base precedente) durante la scrittura di test funzionali dell'applicazione ASP.NET di base:</span><span class="sxs-lookup"><span data-stu-id="82262-261">You use this client (set to the protected \_client member on the base test above) when writing functional tests for your ASP.NET Core application:</span></span>

```cs
public class CatalogControllerGetImage : BaseWebTest
{
    [Fact]
    public async Task ReturnsFileContentResultGivenValidId()
    {
        var testFilePath = Path.Combine(_contentRoot, "pics//1.png");
        var expectedFileBytes = File.ReadAllBytes(testFilePath);
        var response = await _client.GetAsync("/catalog/pic/1");
        response.EnsureSuccessStatusCode();
        var streamResponse = await response.Content.ReadAsStreamAsync();
        byte[] byteResult;
        using (var ms = new MemoryStream())
        {
            streamResponse.CopyTo(ms);
            byteResult = ms.ToArray();
        }
        Assert.Equal(expectedFileBytes, byteResult);
    }
}
```

<span data-ttu-id="82262-262">Questo test funzionale esercita lo stack dell'applicazione ASP.NET MVC di base completo, inclusi tutti i middleware, filtri, gestori di associazione e così via che possono essere presenti.</span><span class="sxs-lookup"><span data-stu-id="82262-262">This functional test exercises the full ASP.NET Core MVC application stack, including all middleware, filters, binders, etc. that may be in place.</span></span> <span data-ttu-id="82262-263">Verifica che un dato route ("/ pic/catalogo/1") restituisce la matrice di byte previsto per un file in un percorso noto.</span><span class="sxs-lookup"><span data-stu-id="82262-263">It verifies that a given route ("/catalog/pic/1") returns the expected byte array for a file in a known location.</span></span> <span data-ttu-id="82262-264">A tale scopo senza dover configurare un server web reale e pertanto consente di evitare gran parte del vulnerabilità che possono verificarsi (ad esempio, problemi con le impostazioni del firewall) del server per il test con un web reale.</span><span class="sxs-lookup"><span data-stu-id="82262-264">It does so without setting up a real web server, and so avoids much of the brittleness that using a real web server for testing can experience (for example, problems with firewall settings).</span></span> <span data-ttu-id="82262-265">Test funzionali eseguite su TestServer sono in genere più lento rispetto all'integrazione e unit test, ma sono molto più veloci rispetto ai test che verrebbe eseguito in rete per un server web.</span><span class="sxs-lookup"><span data-stu-id="82262-265">Functional tests that run against TestServer are usually slower than integration and unit tests, but are much faster than tests that would run over the network to a test web server.</span></span>

>[!div class="step-by-step"]
<span data-ttu-id="82262-266">[Precedente] [Avanti] (sviluppo-processo-per-azure.md) (work-with-data-in-asp-net-core-apps.md)</span><span class="sxs-lookup"><span data-stu-id="82262-266">[Previous] (work-with-data-in-asp-net-core-apps.md) [Next] (development-process-for-azure.md)</span></span>
