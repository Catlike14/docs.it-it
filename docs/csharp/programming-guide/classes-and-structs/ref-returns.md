---
title: Valori restituiti e variabili locali ref (Guida a C#)
description: Informazioni su come definire e usare valori restituiti e variabili locali ref
author: rpetrusha
ms.author: ronpet
ms.date: 05/30/2017
ms.topic: article
ms.prod: .net
ms.technology: devlang-csharp
ms.devlang: csharp
ms.assetid: 18cf7a4b-29f0-4b14-85b8-80af754aabd8
ms.translationtype: HT
ms.sourcegitcommit: 4582cb0ee091526423cce3fc1d8243029f34f59c
ms.openlocfilehash: 3f2ee35db5b77efcce629b6315060a723429b19c
ms.contentlocale: it-it
ms.lasthandoff: 08/16/2017

---
# <a name="ref-returns-and-ref-locals"></a><span data-ttu-id="4198f-103">Valori restituiti e variabili locali ref</span><span class="sxs-lookup"><span data-stu-id="4198f-103">Ref returns and ref locals</span></span>

<span data-ttu-id="4198f-104">A partire da C# 7, C# supporta i valori restituiti di riferimento (valori restituiti ref).</span><span class="sxs-lookup"><span data-stu-id="4198f-104">Starting with C# 7, C# supports reference return values (ref returns).</span></span> <span data-ttu-id="4198f-105">Un valore restituito di riferimento consente a un metodo di restituire a un chiamante un riferimento a un oggetto, anziché un valore.</span><span class="sxs-lookup"><span data-stu-id="4198f-105">A reference return value allows a method to return a reference to an object, rather than a value, back to a caller.</span></span> <span data-ttu-id="4198f-106">Il chiamante può quindi scegliere di trattare l'oggetto restituito come se fosse stato restituito tramite un valore o un riferimento.</span><span class="sxs-lookup"><span data-stu-id="4198f-106">The caller can then choose to treat the returned object returned as if it were returned by value or by reference.</span></span> <span data-ttu-id="4198f-107">Un valore restituito di riferimento che il chiamante gestisce come un riferimento anziché come un valore è una variabile locale ref.</span><span class="sxs-lookup"><span data-stu-id="4198f-107">A value returned by reference that the caller handles as a reference rather than a value is a ref local.</span></span>

## <a name="what-is-a-reference-return-value"></a><span data-ttu-id="4198f-108">Che cos'è un valore restituito di riferimento?</span><span class="sxs-lookup"><span data-stu-id="4198f-108">What is a reference return value?</span></span>

<span data-ttu-id="4198f-109">La maggior parte degli sviluppatori ha familiarità con il passaggio di un argomento a un metodo chiamato *tramite un riferimento*.</span><span class="sxs-lookup"><span data-stu-id="4198f-109">Most developers are familiar with passing an argument to a called method *by reference*.</span></span> <span data-ttu-id="4198f-110">Un elenco di argomenti del metodo chiamato include un valore passato tramite un riferimento e tutte le modifiche apportate al relativo valore dal metodo chiamato vengono restituite al chiamante.</span><span class="sxs-lookup"><span data-stu-id="4198f-110">A called method's argument list includes a value passed by reference, and any changes made to its value by the called method are returned to the caller.</span></span> <span data-ttu-id="4198f-111">Un *valore restituito di riferimento* è l'opposto:</span><span class="sxs-lookup"><span data-stu-id="4198f-111">A *reference return value* is the opposite:</span></span>

- <span data-ttu-id="4198f-112">Il valore restituito del metodo chiamato è un riferimento, anziché un argomento passato al metodo.</span><span class="sxs-lookup"><span data-stu-id="4198f-112">The called method's return value, rather than an argument passed to it, is a reference.</span></span>

- <span data-ttu-id="4198f-113">Il chiamante, anziché il metodo chiamato, può modificare il valore restituito dal metodo.</span><span class="sxs-lookup"><span data-stu-id="4198f-113">The caller, rather than the called method, can modify the value returned by the method.</span></span>

- <span data-ttu-id="4198f-114">Invece di riflettere le modifiche all'argomento nello stato dell'oggetto sul chiamante, le modifiche al valore restituito del metodo dal chiamante vengono riflesse nello stato dell'oggetto di cui è stato chiamato il metodo.</span><span class="sxs-lookup"><span data-stu-id="4198f-114">Instead of modifications to the argument that are reflected in state of the object on the caller, modifications to the method's return value by the caller are reflected in the state of the object whose method was called.</span></span>

<span data-ttu-id="4198f-115">I valori restituiti di riferimento possono produrre codice più compatto, nonché consentire a un oggetto di esporre solo i singoli elementi di dati, ad esempio un elemento di matrice, che sono di interesse per il chiamante.</span><span class="sxs-lookup"><span data-stu-id="4198f-115">Reference return values can produce more compact code, as well as allow an object to expose only the individual data items, such as an array element, that are of interest to the caller.</span></span> <span data-ttu-id="4198f-116">In tal modo si riduce la probabilità che il chiamante modifichi inavvertitamente lo stato dell'oggetto.</span><span class="sxs-lookup"><span data-stu-id="4198f-116">This reduces the likelihood that the caller will inadvertently modify the object's state.</span></span>

<span data-ttu-id="4198f-117">Esistono alcune restrizioni per il valore che un metodo può restituire come valore restituito di riferimento,</span><span class="sxs-lookup"><span data-stu-id="4198f-117">There are some restrictions on the value that a method can return as a reference return value.</span></span> <span data-ttu-id="4198f-118">tra cui:</span><span class="sxs-lookup"><span data-stu-id="4198f-118">These include:</span></span>

- <span data-ttu-id="4198f-119">Il valore restituito non può essere `void`.</span><span class="sxs-lookup"><span data-stu-id="4198f-119">The return value cannot be `void`.</span></span> <span data-ttu-id="4198f-120">Se si tenta di definire un metodo con un valore restituito di riferimento `void`, viene generato l'errore del compilatore CS1547, "Non è possibile usare la parola chiave 'void' in questo contesto".</span><span class="sxs-lookup"><span data-stu-id="4198f-120">Attempting to define a method with a `void` reference return value generates compiler error CS1547, "Keyword 'void' cannot be used in this context."</span></span>
 
- <span data-ttu-id="4198f-121">Il valore restituito non può essere una variabile locale nel metodo che lo restituisce: deve avere un ambito all'esterno del metodo che lo restituisce.</span><span class="sxs-lookup"><span data-stu-id="4198f-121">The return value cannot be a local variable in the method that returns it; it must have a scope that is outside the method that returns it.</span></span> <span data-ttu-id="4198f-122">Può essere un'istanza o un campo statico di una classe oppure un argomento passato al metodo.</span><span class="sxs-lookup"><span data-stu-id="4198f-122">It can be an instance or static field of a class, or it can be an argument passed to the method.</span></span> <span data-ttu-id="4198f-123">Se si tenta di restituire una variabile locale, viene generato l'errore del compilatore CS8168, "Non è possibile restituire la variabile locale 'obj' per riferimento perché non è una variabile locale ref".</span><span class="sxs-lookup"><span data-stu-id="4198f-123">Attempting to return a local variable generates compiler error CS8168, "Cannot return local 'obj' by reference because it is not a ref local."</span></span>

- <span data-ttu-id="4198f-124">Il valore restituito non può essere `null`.</span><span class="sxs-lookup"><span data-stu-id="4198f-124">The return value cannot be a `null`.</span></span> <span data-ttu-id="4198f-125">Se si tenta di restituire `null`, viene generato l'errore del compilatore CS8156, "Non è possibile usare un'espressione in questo contesto perché non può essere restituita per riferimento".</span><span class="sxs-lookup"><span data-stu-id="4198f-125">Attempting to return `null` generates compiler error CS8156, "An expression cannot be used in this context because it may not be returned by reference."</span></span>

   <span data-ttu-id="4198f-126">Se un metodo con un valore restituito ref deve restituire un valore null, è possibile restituire un valore null (privo di istanze) per un tipo riferimento o un [tipo nullable](../nullable-types/index.md) per un tipo valore.</span><span class="sxs-lookup"><span data-stu-id="4198f-126">If a method with a ref return needs to return a null value, you can either return a null (uninstantiated) value for a reference type or a [nullable type](../nullable-types/index.md) for a value type.</span></span>
 
- <span data-ttu-id="4198f-127">Il valore restituito non può essere una costante, un membro di enumerazione o una proprietà di un oggetto `class` o `struct`.</span><span class="sxs-lookup"><span data-stu-id="4198f-127">The return value cannot be a constant, an enumeration member, or a property of a `class` or `struct`.</span></span> <span data-ttu-id="4198f-128">Se si tenta di restituire questi valori, viene generato l'errore del compilatore CS8156, "Non è possibile usare un'espressione in questo contesto perché non può essere restituita per riferimento".</span><span class="sxs-lookup"><span data-stu-id="4198f-128">Attempting to return these generates compiler error CS8156, "An expression cannot be used in this context because it may not be returned by reference."</span></span>

<span data-ttu-id="4198f-129">Inoltre, poiché un metodo asincrono può eseguire la restituzione prima di aver terminato l'esecuzione mentre il relativo valore restituito non è ancora noto, i valori restituiti di riferimento non sono consentiti nei metodi asincroni.</span><span class="sxs-lookup"><span data-stu-id="4198f-129">In addition, because an asynchronous method may return before it has finished execution, while its return value is still unknown, reference return values are not allowed on async methods.</span></span>
 
## <a name="defining-a-ref-return-value"></a><span data-ttu-id="4198f-130">Definizione di un valore restituito ref</span><span class="sxs-lookup"><span data-stu-id="4198f-130">Defining a ref return value</span></span>

<span data-ttu-id="4198f-131">È possibile definire un valore restituito ref aggiungendo la parola chiave [ref](../../language-reference/keywords/ref.md) al tipo restituito della firma del metodo.</span><span class="sxs-lookup"><span data-stu-id="4198f-131">You define a ref return value by adding the [ref](../../language-reference/keywords/ref.md) keyword to the return type of the method signature.</span></span> <span data-ttu-id="4198f-132">Ad esempio, la firma seguente indica che la proprietà `GetContactInformation` restituisce al chiamante un riferimento a un oggetto `Person`:</span><span class="sxs-lookup"><span data-stu-id="4198f-132">For example, the following signature indicates that the `GetContactInformation` property returns a reference to a `Person` object to the caller:</span></span>

```csharp
public ref Person GetContactInformation(string fname, string lname);
```

<span data-ttu-id="4198f-133">Inoltre, il nome dell'oggetto restituito da ciascuna istruzione [return](../../language-reference/keywords/return.md) nel corpo del metodo deve essere preceduto dalla parola chiave [ref](../../language-reference/keywords/ref.md).</span><span class="sxs-lookup"><span data-stu-id="4198f-133">In addition, the name of the object returned by each [return](../../language-reference/keywords/return.md) statement in the method body must be preceded by the [ref](../../language-reference/keywords/ref.md) keyword.</span></span> <span data-ttu-id="4198f-134">Ad esempio, l'istruzione `return` seguente restituisce un oggetto `Person` denominato `p` per riferimento:</span><span class="sxs-lookup"><span data-stu-id="4198f-134">For example, the following `return` statement returns a `Person` object named `p` by reference:</span></span>

```csharp
return ref p;
```

## <a name="consuming-a-ref-return-value"></a><span data-ttu-id="4198f-135">Uso di un valore restituito ref</span><span class="sxs-lookup"><span data-stu-id="4198f-135">Consuming a ref return value</span></span>

<span data-ttu-id="4198f-136">Un chiamante può gestire un valore restituito ref in due modi:</span><span class="sxs-lookup"><span data-stu-id="4198f-136">A caller can handle a ref return value in either of two ways:</span></span>

- <span data-ttu-id="4198f-137">Come un normale valore restituito per valore da un metodo.</span><span class="sxs-lookup"><span data-stu-id="4198f-137">As an ordinary value returned by value from a method.</span></span> <span data-ttu-id="4198f-138">Il chiamante può scegliere di ignorare il fatto che il valore restituito è un valore restituito di riferimento.</span><span class="sxs-lookup"><span data-stu-id="4198f-138">The caller can choose to ignore that the return value is a reference return value.</span></span> <span data-ttu-id="4198f-139">In questo caso, tutte le modifiche apportate al valore restituito dalla chiamata al metodo non vengono riflesse nello stato del tipo chiamato.</span><span class="sxs-lookup"><span data-stu-id="4198f-139">In this case, any changes made to the value returned by the method call are not reflected in the state of the called type.</span></span> <span data-ttu-id="4198f-140">Se il valore restituito è un tipo valore, tutte le modifiche apportate al valore restituito dalla chiamata al metodo non vengono riflesse nello stato del tipo chiamato.</span><span class="sxs-lookup"><span data-stu-id="4198f-140">If the returned value is a value type, any changes made to the value returned by the method call are not reflected in the state of the called type.</span></span>

- <span data-ttu-id="4198f-141">Come un valore restituito di riferimento.</span><span class="sxs-lookup"><span data-stu-id="4198f-141">As a reference return value.</span></span> <span data-ttu-id="4198f-142">Il chiamante deve definire la variabile a cui è assegnato il valore restituito di riferimento come una [variabile locale ref](#ref-local) e tutte le modifiche apportate al valore restituito dalla chiamata al metodo vengono riflesse nello stato del tipo chiamato.</span><span class="sxs-lookup"><span data-stu-id="4198f-142">The caller must define the variable to which the reference return value is assigned as a [ref local](#ref-local), and any changes to the value returned by the method call are reflected in the state of the called type.</span></span> 

## <a name="ref-locals"></a><span data-ttu-id="4198f-143">Variabili locali ref</span><span class="sxs-lookup"><span data-stu-id="4198f-143">Ref locals</span></span>

<span data-ttu-id="4198f-144">Per gestire il valore restituito di riferimento come un riferimento, il chiamante deve dichiarare il valore come una *variabile locale ref* usando la parola chiave `ref`.</span><span class="sxs-lookup"><span data-stu-id="4198f-144">To handle the reference return value as a reference, the caller must declare the value to be a *ref local* by using the `ref` keyword.</span></span> <span data-ttu-id="4198f-145">Ad esempio, se il valore restituito dal metodo `Person.GetContactInfomation` deve essere usato come un riferimento anziché come un valore, la chiamata al metodo avrà il seguente aspetto:</span><span class="sxs-lookup"><span data-stu-id="4198f-145">For example, if the value returned by the `Person.GetContactInfomation` method is to be consumed as a reference rather than a value, the method call appears as:</span></span>

```csharp
ref Person p = ref contacts.GetContactInformation("Brandie", "Best");
```

<span data-ttu-id="4198f-146">Si noti che la parola chiave `ref` viene usata sia prima della dichiarazione di variabile locale *che* prima della chiamata al metodo.</span><span class="sxs-lookup"><span data-stu-id="4198f-146">Note that the `ref` keyword is used both before the local variable declaration *and* before the method call.</span></span> <span data-ttu-id="4198f-147">Se non si includono entrambe le parole chiave `ref` nella dichiarazione di variabile e nell'assegnazione, viene generato l'errore del compilatore CS8172, "Non è possibile inizializzare una variabile per riferimento con un valore".</span><span class="sxs-lookup"><span data-stu-id="4198f-147">Failure to include both `ref` keywords in the variable declaration and assignment results in compiler error CS8172, "Cannot initialize a by-reference variable with a value."</span></span> 
 
<span data-ttu-id="4198f-148">Le successive modifiche all'oggetto `Person` restituito dal metodo vengono riflesse nell'oggetto `contacts`.</span><span class="sxs-lookup"><span data-stu-id="4198f-148">Subsequent changes to the `Person` object returned by the method are reflected in the `contacts` object.</span></span>

<span data-ttu-id="4198f-149">Se `p` non è definito come una variabile locale ref usando la parola chiave `ref`, qualsiasi modifica apportata a `p` dal chiamante non viene riflessa nell'oggetto `contacts`.</span><span class="sxs-lookup"><span data-stu-id="4198f-149">If `p` is not defined as a ref local by using the `ref` keyword, any changes made to `p` by the caller are not reflected in the `contacts` object.</span></span>
 
## <a name="ref-returns-and-ref-locals-an-example"></a><span data-ttu-id="4198f-150">Valori restituiti e variabili locali ref: un esempio</span><span class="sxs-lookup"><span data-stu-id="4198f-150">Ref returns and ref locals: an example</span></span>

<span data-ttu-id="4198f-151">L'esempio seguente definisce una classe `NumberStore` che archivia una matrice di valori integer.</span><span class="sxs-lookup"><span data-stu-id="4198f-151">The following example defines a `NumberStore` class that stores an array of integer values.</span></span> <span data-ttu-id="4198f-152">Il metodo `FindNumber` restituisce per riferimento il primo numero maggiore o uguale al numero passato come argomento.</span><span class="sxs-lookup"><span data-stu-id="4198f-152">The `FindNumber` method returns by reference the first number that is greater than or equal to the number passed as an argument.</span></span> <span data-ttu-id="4198f-153">Se nessun numero è maggiore o uguale all'argomento, il metodo restituisce il numero nell'indice 0.</span><span class="sxs-lookup"><span data-stu-id="4198f-153">If no number is greater than or equal to the argument, the method returns the number in index 0.</span></span> 

<span data-ttu-id="4198f-154">[!CODE-cs[ref-returns](../../../../samples/snippets/csharp/programming-guide/ref-returns/ref-returns1.cs#1)]</span><span class="sxs-lookup"><span data-stu-id="4198f-154">[!CODE-cs[ref-returns](../../../../samples/snippets/csharp/programming-guide/ref-returns/ref-returns1.cs#1)]</span></span>

<span data-ttu-id="4198f-155">L'esempio seguente chiama il metodo `NumberStore.FindNumber` per recuperare il primo valore maggiore o uguale a 16.</span><span class="sxs-lookup"><span data-stu-id="4198f-155">The following example calls the `NumberStore.FindNumber` method to retrieve the first value that is greater than or equal to 16.</span></span> <span data-ttu-id="4198f-156">Il chiamante raddoppia quindi il valore restituito dal metodo.</span><span class="sxs-lookup"><span data-stu-id="4198f-156">The caller then doubles the value returned by the method.</span></span> <span data-ttu-id="4198f-157">Come illustrato nell'output dell'esempio, questa modifica viene riflessa nel valore degli elementi della matrice dell'istanza di `NumberStore`.</span><span class="sxs-lookup"><span data-stu-id="4198f-157">As the output from the example shows, this change is reflected in the value of the array elements of the `NumberStore` instance.</span></span>

<span data-ttu-id="4198f-158">[!CODE-cs[ref-returns](../../../../samples/snippets/csharp/programming-guide/ref-returns/ref-returns1.cs#2)]</span><span class="sxs-lookup"><span data-stu-id="4198f-158">[!CODE-cs[ref-returns](../../../../samples/snippets/csharp/programming-guide/ref-returns/ref-returns1.cs#2)]</span></span>

<span data-ttu-id="4198f-159">Senza il supporto per i valori restituiti di riferimento, tale operazione viene in genere eseguita restituendo l'indice dell'elemento di matrice insieme al relativo valore.</span><span class="sxs-lookup"><span data-stu-id="4198f-159">Without support for reference return values, such an operation is usually performed by returning the index of the array element along with its value.</span></span> <span data-ttu-id="4198f-160">Il chiamante può quindi usare questo indice per modificare il valore in una chiamata al metodo distinta.</span><span class="sxs-lookup"><span data-stu-id="4198f-160">The caller can then use this index to modify the value in a separate method call.</span></span> <span data-ttu-id="4198f-161">Il chiamante può tuttavia anche modificare l'indice per accedere ed eventualmente modificare altri valori della matrice.</span><span class="sxs-lookup"><span data-stu-id="4198f-161">However, the caller can also modify the index to access and possibly modify other array values.</span></span>  
 
## <a name="see-also"></a><span data-ttu-id="4198f-162">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="4198f-162">See also</span></span>

[<span data-ttu-id="4198f-163">ref (parola chiave)</span><span class="sxs-lookup"><span data-stu-id="4198f-163">ref keyword</span></span>](../../language-reference/keywords/ref.md)

